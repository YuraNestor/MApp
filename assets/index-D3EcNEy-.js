function C_(X,ae){for(var he=0;he<ae.length;he++){const Q=ae[he];if(typeof Q!="string"&&!Array.isArray(Q)){for(const pe in Q)if(pe!=="default"&&!(pe in X)){const ve=Object.getOwnPropertyDescriptor(Q,pe);ve&&Object.defineProperty(X,pe,ve.get?ve:{enumerable:!0,get:()=>Q[pe]})}}}return Object.freeze(Object.defineProperty(X,Symbol.toStringTag,{value:"Module"}))}(function(){const ae=document.createElement("link").relList;if(ae&&ae.supports&&ae.supports("modulepreload"))return;for(const pe of document.querySelectorAll('link[rel="modulepreload"]'))Q(pe);new MutationObserver(pe=>{for(const ve of pe)if(ve.type==="childList")for(const P of ve.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&Q(P)}).observe(document,{childList:!0,subtree:!0});function he(pe){const ve={};return pe.integrity&&(ve.integrity=pe.integrity),pe.referrerPolicy&&(ve.referrerPolicy=pe.referrerPolicy),pe.crossOrigin==="use-credentials"?ve.credentials="include":pe.crossOrigin==="anonymous"?ve.credentials="omit":ve.credentials="same-origin",ve}function Q(pe){if(pe.ep)return;pe.ep=!0;const ve=he(pe);fetch(pe.href,ve)}})();function z_(X){return X&&X.__esModule&&Object.prototype.hasOwnProperty.call(X,"default")?X.default:X}var gg={exports:{}},Zp={};var Bg;function D_(){if(Bg)return Zp;Bg=1;var X=Symbol.for("react.transitional.element"),ae=Symbol.for("react.fragment");function he(Q,pe,ve){var P=null;if(ve!==void 0&&(P=""+ve),pe.key!==void 0&&(P=""+pe.key),"key"in pe){ve={};for(var h in pe)h!=="key"&&(ve[h]=pe[h])}else ve=pe;return pe=ve.ref,{$$typeof:X,type:Q,key:P,ref:pe!==void 0?pe:null,props:ve}}return Zp.Fragment=ae,Zp.jsx=he,Zp.jsxs=he,Zp}var Fg;function I_(){return Fg||(Fg=1,gg.exports=D_()),gg.exports}var ot=I_(),_g={exports:{}},ri={};var jg;function P_(){if(jg)return ri;jg=1;var X=Symbol.for("react.transitional.element"),ae=Symbol.for("react.portal"),he=Symbol.for("react.fragment"),Q=Symbol.for("react.strict_mode"),pe=Symbol.for("react.profiler"),ve=Symbol.for("react.consumer"),P=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),ge=Symbol.for("react.suspense"),ke=Symbol.for("react.memo"),st=Symbol.for("react.lazy"),Ye=Symbol.for("react.activity"),xt=Symbol.iterator;function Tt(me){return me===null||typeof me!="object"?null:(me=xt&&me[xt]||me["@@iterator"],typeof me=="function"?me:null)}var ui={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bt=Object.assign,Ce={};function di(me,Ze,lt){this.props=me,this.context=Ze,this.refs=Ce,this.updater=lt||ui}di.prototype.isReactComponent={},di.prototype.setState=function(me,Ze){if(typeof me!="object"&&typeof me!="function"&&me!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,me,Ze,"setState")},di.prototype.forceUpdate=function(me){this.updater.enqueueForceUpdate(this,me,"forceUpdate")};function ti(){}ti.prototype=di.prototype;function pt(me,Ze,lt){this.props=me,this.context=Ze,this.refs=Ce,this.updater=lt||ui}var si=pt.prototype=new ti;si.constructor=pt,bt(si,di.prototype),si.isPureReactComponent=!0;var $t=Array.isArray;function Mi(){}var Pt={H:null,A:null,T:null,S:null},Kt=Object.prototype.hasOwnProperty;function Lt(me,Ze,lt){var dt=lt.ref;return{$$typeof:X,type:me,key:Ze,ref:dt!==void 0?dt:null,props:lt}}function ii(me,Ze){return Lt(me.type,Ze,me.props)}function gi(me){return typeof me=="object"&&me!==null&&me.$$typeof===X}function kt(me){var Ze={"=":"=0",":":"=2"};return"$"+me.replace(/[=:]/g,function(lt){return Ze[lt]})}var Nt=/\/+/g;function ni(me,Ze){return typeof me=="object"&&me!==null&&me.key!=null?kt(""+me.key):Ze.toString(36)}function Vi(me){switch(me.status){case"fulfilled":return me.value;case"rejected":throw me.reason;default:switch(typeof me.status=="string"?me.then(Mi,Mi):(me.status="pending",me.then(function(Ze){me.status==="pending"&&(me.status="fulfilled",me.value=Ze)},function(Ze){me.status==="pending"&&(me.status="rejected",me.reason=Ze)})),me.status){case"fulfilled":return me.value;case"rejected":throw me.reason}}throw me}function Fe(me,Ze,lt,dt,Mt){var Ot=typeof me;(Ot==="undefined"||Ot==="boolean")&&(me=null);var Zt=!1;if(me===null)Zt=!0;else switch(Ot){case"bigint":case"string":case"number":Zt=!0;break;case"object":switch(me.$$typeof){case X:case ae:Zt=!0;break;case st:return Zt=me._init,Fe(Zt(me._payload),Ze,lt,dt,Mt)}}if(Zt)return Mt=Mt(me),Zt=dt===""?"."+ni(me,0):dt,$t(Mt)?(lt="",Zt!=null&&(lt=Zt.replace(Nt,"$&/")+"/"),Fe(Mt,Ze,lt,"",function(Mr){return Mr})):Mt!=null&&(gi(Mt)&&(Mt=ii(Mt,lt+(Mt.key==null||me&&me.key===Mt.key?"":(""+Mt.key).replace(Nt,"$&/")+"/")+Zt)),Ze.push(Mt)),1;Zt=0;var Ui=dt===""?".":dt+":";if($t(me))for(var Hi=0;Hi<me.length;Hi++)dt=me[Hi],Ot=Ui+ni(dt,Hi),Zt+=Fe(dt,Ze,lt,Ot,Mt);else if(Hi=Tt(me),typeof Hi=="function")for(me=Hi.call(me),Hi=0;!(dt=me.next()).done;)dt=dt.value,Ot=Ui+ni(dt,Hi++),Zt+=Fe(dt,Ze,lt,Ot,Mt);else if(Ot==="object"){if(typeof me.then=="function")return Fe(Vi(me),Ze,lt,dt,Mt);throw Ze=String(me),Error("Objects are not valid as a React child (found: "+(Ze==="[object Object]"?"object with keys {"+Object.keys(me).join(", ")+"}":Ze)+"). If you meant to render a collection of children, use an array instead.")}return Zt}function nt(me,Ze,lt){if(me==null)return me;var dt=[],Mt=0;return Fe(me,dt,"","",function(Ot){return Ze.call(lt,Ot,Mt++)}),dt}function ht(me){if(me._status===-1){var Ze=me._result;Ze=Ze(),Ze.then(function(lt){(me._status===0||me._status===-1)&&(me._status=1,me._result=lt)},function(lt){(me._status===0||me._status===-1)&&(me._status=2,me._result=lt)}),me._status===-1&&(me._status=0,me._result=Ze)}if(me._status===1)return me._result.default;throw me._result}var _t=typeof reportError=="function"?reportError:function(me){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ze=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof me=="object"&&me!==null&&typeof me.message=="string"?String(me.message):String(me),error:me});if(!window.dispatchEvent(Ze))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",me);return}console.error(me)},li={map:nt,forEach:function(me,Ze,lt){nt(me,function(){Ze.apply(this,arguments)},lt)},count:function(me){var Ze=0;return nt(me,function(){Ze++}),Ze},toArray:function(me){return nt(me,function(Ze){return Ze})||[]},only:function(me){if(!gi(me))throw Error("React.Children.only expected to receive a single React element child.");return me}};return ri.Activity=Ye,ri.Children=li,ri.Component=di,ri.Fragment=he,ri.Profiler=pe,ri.PureComponent=pt,ri.StrictMode=Q,ri.Suspense=ge,ri.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Pt,ri.__COMPILER_RUNTIME={__proto__:null,c:function(me){return Pt.H.useMemoCache(me)}},ri.cache=function(me){return function(){return me.apply(null,arguments)}},ri.cacheSignal=function(){return null},ri.cloneElement=function(me,Ze,lt){if(me==null)throw Error("The argument must be a React element, but you passed "+me+".");var dt=bt({},me.props),Mt=me.key;if(Ze!=null)for(Ot in Ze.key!==void 0&&(Mt=""+Ze.key),Ze)!Kt.call(Ze,Ot)||Ot==="key"||Ot==="__self"||Ot==="__source"||Ot==="ref"&&Ze.ref===void 0||(dt[Ot]=Ze[Ot]);var Ot=arguments.length-2;if(Ot===1)dt.children=lt;else if(1<Ot){for(var Zt=Array(Ot),Ui=0;Ui<Ot;Ui++)Zt[Ui]=arguments[Ui+2];dt.children=Zt}return Lt(me.type,Mt,dt)},ri.createContext=function(me){return me={$$typeof:P,_currentValue:me,_currentValue2:me,_threadCount:0,Provider:null,Consumer:null},me.Provider=me,me.Consumer={$$typeof:ve,_context:me},me},ri.createElement=function(me,Ze,lt){var dt,Mt={},Ot=null;if(Ze!=null)for(dt in Ze.key!==void 0&&(Ot=""+Ze.key),Ze)Kt.call(Ze,dt)&&dt!=="key"&&dt!=="__self"&&dt!=="__source"&&(Mt[dt]=Ze[dt]);var Zt=arguments.length-2;if(Zt===1)Mt.children=lt;else if(1<Zt){for(var Ui=Array(Zt),Hi=0;Hi<Zt;Hi++)Ui[Hi]=arguments[Hi+2];Mt.children=Ui}if(me&&me.defaultProps)for(dt in Zt=me.defaultProps,Zt)Mt[dt]===void 0&&(Mt[dt]=Zt[dt]);return Lt(me,Ot,Mt)},ri.createRef=function(){return{current:null}},ri.forwardRef=function(me){return{$$typeof:h,render:me}},ri.isValidElement=gi,ri.lazy=function(me){return{$$typeof:st,_payload:{_status:-1,_result:me},_init:ht}},ri.memo=function(me,Ze){return{$$typeof:ke,type:me,compare:Ze===void 0?null:Ze}},ri.startTransition=function(me){var Ze=Pt.T,lt={};Pt.T=lt;try{var dt=me(),Mt=Pt.S;Mt!==null&&Mt(lt,dt),typeof dt=="object"&&dt!==null&&typeof dt.then=="function"&&dt.then(Mi,_t)}catch(Ot){_t(Ot)}finally{Ze!==null&&lt.types!==null&&(Ze.types=lt.types),Pt.T=Ze}},ri.unstable_useCacheRefresh=function(){return Pt.H.useCacheRefresh()},ri.use=function(me){return Pt.H.use(me)},ri.useActionState=function(me,Ze,lt){return Pt.H.useActionState(me,Ze,lt)},ri.useCallback=function(me,Ze){return Pt.H.useCallback(me,Ze)},ri.useContext=function(me){return Pt.H.useContext(me)},ri.useDebugValue=function(){},ri.useDeferredValue=function(me,Ze){return Pt.H.useDeferredValue(me,Ze)},ri.useEffect=function(me,Ze){return Pt.H.useEffect(me,Ze)},ri.useEffectEvent=function(me){return Pt.H.useEffectEvent(me)},ri.useId=function(){return Pt.H.useId()},ri.useImperativeHandle=function(me,Ze,lt){return Pt.H.useImperativeHandle(me,Ze,lt)},ri.useInsertionEffect=function(me,Ze){return Pt.H.useInsertionEffect(me,Ze)},ri.useLayoutEffect=function(me,Ze){return Pt.H.useLayoutEffect(me,Ze)},ri.useMemo=function(me,Ze){return Pt.H.useMemo(me,Ze)},ri.useOptimistic=function(me,Ze){return Pt.H.useOptimistic(me,Ze)},ri.useReducer=function(me,Ze,lt){return Pt.H.useReducer(me,Ze,lt)},ri.useRef=function(me){return Pt.H.useRef(me)},ri.useState=function(me){return Pt.H.useState(me)},ri.useSyncExternalStore=function(me,Ze,lt){return Pt.H.useSyncExternalStore(me,Ze,lt)},ri.useTransition=function(){return Pt.H.useTransition()},ri.version="19.2.4",ri}var Ng;function Tg(){return Ng||(Ng=1,_g.exports=P_()),_g.exports}var it=Tg(),yg={exports:{}},Hp={},vg={exports:{}},xg={};var Vg;function R_(){return Vg||(Vg=1,(function(X){function ae(Fe,nt){var ht=Fe.length;Fe.push(nt);e:for(;0<ht;){var _t=ht-1>>>1,li=Fe[_t];if(0<pe(li,nt))Fe[_t]=nt,Fe[ht]=li,ht=_t;else break e}}function he(Fe){return Fe.length===0?null:Fe[0]}function Q(Fe){if(Fe.length===0)return null;var nt=Fe[0],ht=Fe.pop();if(ht!==nt){Fe[0]=ht;e:for(var _t=0,li=Fe.length,me=li>>>1;_t<me;){var Ze=2*(_t+1)-1,lt=Fe[Ze],dt=Ze+1,Mt=Fe[dt];if(0>pe(lt,ht))dt<li&&0>pe(Mt,lt)?(Fe[_t]=Mt,Fe[dt]=ht,_t=dt):(Fe[_t]=lt,Fe[Ze]=ht,_t=Ze);else if(dt<li&&0>pe(Mt,ht))Fe[_t]=Mt,Fe[dt]=ht,_t=dt;else break e}}return nt}function pe(Fe,nt){var ht=Fe.sortIndex-nt.sortIndex;return ht!==0?ht:Fe.id-nt.id}if(X.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var ve=performance;X.unstable_now=function(){return ve.now()}}else{var P=Date,h=P.now();X.unstable_now=function(){return P.now()-h}}var ge=[],ke=[],st=1,Ye=null,xt=3,Tt=!1,ui=!1,bt=!1,Ce=!1,di=typeof setTimeout=="function"?setTimeout:null,ti=typeof clearTimeout=="function"?clearTimeout:null,pt=typeof setImmediate<"u"?setImmediate:null;function si(Fe){for(var nt=he(ke);nt!==null;){if(nt.callback===null)Q(ke);else if(nt.startTime<=Fe)Q(ke),nt.sortIndex=nt.expirationTime,ae(ge,nt);else break;nt=he(ke)}}function $t(Fe){if(bt=!1,si(Fe),!ui)if(he(ge)!==null)ui=!0,Mi||(Mi=!0,kt());else{var nt=he(ke);nt!==null&&Vi($t,nt.startTime-Fe)}}var Mi=!1,Pt=-1,Kt=5,Lt=-1;function ii(){return Ce?!0:!(X.unstable_now()-Lt<Kt)}function gi(){if(Ce=!1,Mi){var Fe=X.unstable_now();Lt=Fe;var nt=!0;try{e:{ui=!1,bt&&(bt=!1,ti(Pt),Pt=-1),Tt=!0;var ht=xt;try{t:{for(si(Fe),Ye=he(ge);Ye!==null&&!(Ye.expirationTime>Fe&&ii());){var _t=Ye.callback;if(typeof _t=="function"){Ye.callback=null,xt=Ye.priorityLevel;var li=_t(Ye.expirationTime<=Fe);if(Fe=X.unstable_now(),typeof li=="function"){Ye.callback=li,si(Fe),nt=!0;break t}Ye===he(ge)&&Q(ge),si(Fe)}else Q(ge);Ye=he(ge)}if(Ye!==null)nt=!0;else{var me=he(ke);me!==null&&Vi($t,me.startTime-Fe),nt=!1}}break e}finally{Ye=null,xt=ht,Tt=!1}nt=void 0}}finally{nt?kt():Mi=!1}}}var kt;if(typeof pt=="function")kt=function(){pt(gi)};else if(typeof MessageChannel<"u"){var Nt=new MessageChannel,ni=Nt.port2;Nt.port1.onmessage=gi,kt=function(){ni.postMessage(null)}}else kt=function(){di(gi,0)};function Vi(Fe,nt){Pt=di(function(){Fe(X.unstable_now())},nt)}X.unstable_IdlePriority=5,X.unstable_ImmediatePriority=1,X.unstable_LowPriority=4,X.unstable_NormalPriority=3,X.unstable_Profiling=null,X.unstable_UserBlockingPriority=2,X.unstable_cancelCallback=function(Fe){Fe.callback=null},X.unstable_forceFrameRate=function(Fe){0>Fe||125<Fe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Kt=0<Fe?Math.floor(1e3/Fe):5},X.unstable_getCurrentPriorityLevel=function(){return xt},X.unstable_next=function(Fe){switch(xt){case 1:case 2:case 3:var nt=3;break;default:nt=xt}var ht=xt;xt=nt;try{return Fe()}finally{xt=ht}},X.unstable_requestPaint=function(){Ce=!0},X.unstable_runWithPriority=function(Fe,nt){switch(Fe){case 1:case 2:case 3:case 4:case 5:break;default:Fe=3}var ht=xt;xt=Fe;try{return nt()}finally{xt=ht}},X.unstable_scheduleCallback=function(Fe,nt,ht){var _t=X.unstable_now();switch(typeof ht=="object"&&ht!==null?(ht=ht.delay,ht=typeof ht=="number"&&0<ht?_t+ht:_t):ht=_t,Fe){case 1:var li=-1;break;case 2:li=250;break;case 5:li=1073741823;break;case 4:li=1e4;break;default:li=5e3}return li=ht+li,Fe={id:st++,callback:nt,priorityLevel:Fe,startTime:ht,expirationTime:li,sortIndex:-1},ht>_t?(Fe.sortIndex=ht,ae(ke,Fe),he(ge)===null&&Fe===he(ke)&&(bt?(ti(Pt),Pt=-1):bt=!0,Vi($t,ht-_t))):(Fe.sortIndex=li,ae(ge,Fe),ui||Tt||(ui=!0,Mi||(Mi=!0,kt()))),Fe},X.unstable_shouldYield=ii,X.unstable_wrapCallback=function(Fe){var nt=xt;return function(){var ht=xt;xt=nt;try{return Fe.apply(this,arguments)}finally{xt=ht}}}})(xg)),xg}var Ug;function L_(){return Ug||(Ug=1,vg.exports=R_()),vg.exports}var bg={exports:{}},Sr={};var Gg;function k_(){if(Gg)return Sr;Gg=1;var X=Tg();function ae(ge){var ke="https://react.dev/errors/"+ge;if(1<arguments.length){ke+="?args[]="+encodeURIComponent(arguments[1]);for(var st=2;st<arguments.length;st++)ke+="&args[]="+encodeURIComponent(arguments[st])}return"Minified React error #"+ge+"; visit "+ke+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function he(){}var Q={d:{f:he,r:function(){throw Error(ae(522))},D:he,C:he,L:he,m:he,X:he,S:he,M:he},p:0,findDOMNode:null},pe=Symbol.for("react.portal");function ve(ge,ke,st){var Ye=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pe,key:Ye==null?null:""+Ye,children:ge,containerInfo:ke,implementation:st}}var P=X.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(ge,ke){if(ge==="font")return"";if(typeof ke=="string")return ke==="use-credentials"?ke:""}return Sr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Q,Sr.createPortal=function(ge,ke){var st=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ke||ke.nodeType!==1&&ke.nodeType!==9&&ke.nodeType!==11)throw Error(ae(299));return ve(ge,ke,null,st)},Sr.flushSync=function(ge){var ke=P.T,st=Q.p;try{if(P.T=null,Q.p=2,ge)return ge()}finally{P.T=ke,Q.p=st,Q.d.f()}},Sr.preconnect=function(ge,ke){typeof ge=="string"&&(ke?(ke=ke.crossOrigin,ke=typeof ke=="string"?ke==="use-credentials"?ke:"":void 0):ke=null,Q.d.C(ge,ke))},Sr.prefetchDNS=function(ge){typeof ge=="string"&&Q.d.D(ge)},Sr.preinit=function(ge,ke){if(typeof ge=="string"&&ke&&typeof ke.as=="string"){var st=ke.as,Ye=h(st,ke.crossOrigin),xt=typeof ke.integrity=="string"?ke.integrity:void 0,Tt=typeof ke.fetchPriority=="string"?ke.fetchPriority:void 0;st==="style"?Q.d.S(ge,typeof ke.precedence=="string"?ke.precedence:void 0,{crossOrigin:Ye,integrity:xt,fetchPriority:Tt}):st==="script"&&Q.d.X(ge,{crossOrigin:Ye,integrity:xt,fetchPriority:Tt,nonce:typeof ke.nonce=="string"?ke.nonce:void 0})}},Sr.preinitModule=function(ge,ke){if(typeof ge=="string")if(typeof ke=="object"&&ke!==null){if(ke.as==null||ke.as==="script"){var st=h(ke.as,ke.crossOrigin);Q.d.M(ge,{crossOrigin:st,integrity:typeof ke.integrity=="string"?ke.integrity:void 0,nonce:typeof ke.nonce=="string"?ke.nonce:void 0})}}else ke==null&&Q.d.M(ge)},Sr.preload=function(ge,ke){if(typeof ge=="string"&&typeof ke=="object"&&ke!==null&&typeof ke.as=="string"){var st=ke.as,Ye=h(st,ke.crossOrigin);Q.d.L(ge,st,{crossOrigin:Ye,integrity:typeof ke.integrity=="string"?ke.integrity:void 0,nonce:typeof ke.nonce=="string"?ke.nonce:void 0,type:typeof ke.type=="string"?ke.type:void 0,fetchPriority:typeof ke.fetchPriority=="string"?ke.fetchPriority:void 0,referrerPolicy:typeof ke.referrerPolicy=="string"?ke.referrerPolicy:void 0,imageSrcSet:typeof ke.imageSrcSet=="string"?ke.imageSrcSet:void 0,imageSizes:typeof ke.imageSizes=="string"?ke.imageSizes:void 0,media:typeof ke.media=="string"?ke.media:void 0})}},Sr.preloadModule=function(ge,ke){if(typeof ge=="string")if(ke){var st=h(ke.as,ke.crossOrigin);Q.d.m(ge,{as:typeof ke.as=="string"&&ke.as!=="script"?ke.as:void 0,crossOrigin:st,integrity:typeof ke.integrity=="string"?ke.integrity:void 0})}else Q.d.m(ge)},Sr.requestFormReset=function(ge){Q.d.r(ge)},Sr.unstable_batchedUpdates=function(ge,ke){return ge(ke)},Sr.useFormState=function(ge,ke,st){return P.H.useFormState(ge,ke,st)},Sr.useFormStatus=function(){return P.H.useHostTransitionStatus()},Sr.version="19.2.4",Sr}var qg;function s_(){if(qg)return bg.exports;qg=1;function X(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(X)}catch(ae){console.error(ae)}}return X(),bg.exports=k_(),bg.exports}var Zg;function O_(){if(Zg)return Hp;Zg=1;var X=L_(),ae=Tg(),he=s_();function Q(a){var s="https://react.dev/errors/"+a;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+a+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function pe(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function ve(a){var s=a,c=a;if(a.alternate)for(;s.return;)s=s.return;else{a=s;do s=a,(s.flags&4098)!==0&&(c=s.return),a=s.return;while(a)}return s.tag===3?c:null}function P(a){if(a.tag===13){var s=a.memoizedState;if(s===null&&(a=a.alternate,a!==null&&(s=a.memoizedState)),s!==null)return s.dehydrated}return null}function h(a){if(a.tag===31){var s=a.memoizedState;if(s===null&&(a=a.alternate,a!==null&&(s=a.memoizedState)),s!==null)return s.dehydrated}return null}function ge(a){if(ve(a)!==a)throw Error(Q(188))}function ke(a){var s=a.alternate;if(!s){if(s=ve(a),s===null)throw Error(Q(188));return s!==a?null:a}for(var c=a,g=s;;){var w=c.return;if(w===null)break;var M=w.alternate;if(M===null){if(g=w.return,g!==null){c=g;continue}break}if(w.child===M.child){for(M=w.child;M;){if(M===c)return ge(w),a;if(M===g)return ge(w),s;M=M.sibling}throw Error(Q(188))}if(c.return!==g.return)c=w,g=M;else{for(var k=!1,H=w.child;H;){if(H===c){k=!0,c=w,g=M;break}if(H===g){k=!0,g=w,c=M;break}H=H.sibling}if(!k){for(H=M.child;H;){if(H===c){k=!0,c=M,g=w;break}if(H===g){k=!0,g=M,c=w;break}H=H.sibling}if(!k)throw Error(Q(189))}}if(c.alternate!==g)throw Error(Q(190))}if(c.tag!==3)throw Error(Q(188));return c.stateNode.current===c?a:s}function st(a){var s=a.tag;if(s===5||s===26||s===27||s===6)return a;for(a=a.child;a!==null;){if(s=st(a),s!==null)return s;a=a.sibling}return null}var Ye=Object.assign,xt=Symbol.for("react.element"),Tt=Symbol.for("react.transitional.element"),ui=Symbol.for("react.portal"),bt=Symbol.for("react.fragment"),Ce=Symbol.for("react.strict_mode"),di=Symbol.for("react.profiler"),ti=Symbol.for("react.consumer"),pt=Symbol.for("react.context"),si=Symbol.for("react.forward_ref"),$t=Symbol.for("react.suspense"),Mi=Symbol.for("react.suspense_list"),Pt=Symbol.for("react.memo"),Kt=Symbol.for("react.lazy"),Lt=Symbol.for("react.activity"),ii=Symbol.for("react.memo_cache_sentinel"),gi=Symbol.iterator;function kt(a){return a===null||typeof a!="object"?null:(a=gi&&a[gi]||a["@@iterator"],typeof a=="function"?a:null)}var Nt=Symbol.for("react.client.reference");function ni(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===Nt?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case bt:return"Fragment";case di:return"Profiler";case Ce:return"StrictMode";case $t:return"Suspense";case Mi:return"SuspenseList";case Lt:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case ui:return"Portal";case pt:return a.displayName||"Context";case ti:return(a._context.displayName||"Context")+".Consumer";case si:var s=a.render;return a=a.displayName,a||(a=s.displayName||s.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Pt:return s=a.displayName||null,s!==null?s:ni(a.type)||"Memo";case Kt:s=a._payload,a=a._init;try{return ni(a(s))}catch{}}return null}var Vi=Array.isArray,Fe=ae.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,nt=he.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ht={pending:!1,data:null,method:null,action:null},_t=[],li=-1;function me(a){return{current:a}}function Ze(a){0>li||(a.current=_t[li],_t[li]=null,li--)}function lt(a,s){li++,_t[li]=a.current,a.current=s}var dt=me(null),Mt=me(null),Ot=me(null),Zt=me(null);function Ui(a,s){switch(lt(Ot,s),lt(Mt,a),lt(dt,null),s.nodeType){case 9:case 11:a=(a=s.documentElement)&&(a=a.namespaceURI)?Jl(a):0;break;default:if(a=s.tagName,s=s.namespaceURI)s=Jl(s),a=Ap(s,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Ze(dt),lt(dt,a)}function Hi(){Ze(dt),Ze(Mt),Ze(Ot)}function Mr(a){a.memoizedState!==null&&lt(Zt,a);var s=dt.current,c=Ap(s,a.type);s!==c&&(lt(Mt,a),lt(dt,c))}function qr(a){Mt.current===a&&(Ze(dt),Ze(Mt)),Zt.current===a&&(Ze(Zt),ld._currentValue=ht)}var Nn,ou;function xn(a){if(Nn===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);Nn=s&&s[1]||"",ou=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Nn+a+ou}var ca=!1;function ar(a,s){if(!a||ca)return"";ca=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(s){var Ke=function(){throw Error()};if(Object.defineProperty(Ke.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ke,[])}catch(je){var Le=je}Reflect.construct(a,[],Ke)}else{try{Ke.call()}catch(je){Le=je}a.call(Ke.prototype)}}else{try{throw Error()}catch(je){Le=je}(Ke=a())&&typeof Ke.catch=="function"&&Ke.catch(function(){})}}catch(je){if(je&&Le&&typeof je.stack=="string")return[je.stack,Le.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var w=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");w&&w.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var M=g.DetermineComponentFrameRoot(),k=M[0],H=M[1];if(k&&H){var fe=k.split(`
`),Re=H.split(`
`);for(w=g=0;g<fe.length&&!fe[g].includes("DetermineComponentFrameRoot");)g++;for(;w<Re.length&&!Re[w].includes("DetermineComponentFrameRoot");)w++;if(g===fe.length||w===Re.length)for(g=fe.length-1,w=Re.length-1;1<=g&&0<=w&&fe[g]!==Re[w];)w--;for(;1<=g&&0<=w;g--,w--)if(fe[g]!==Re[w]){if(g!==1||w!==1)do if(g--,w--,0>w||fe[g]!==Re[w]){var Ge=`
`+fe[g].replace(" at new "," at ");return a.displayName&&Ge.includes("<anonymous>")&&(Ge=Ge.replace("<anonymous>",a.displayName)),Ge}while(1<=g&&0<=w);break}}}finally{ca=!1,Error.prepareStackTrace=c}return(c=a?a.displayName||a.name:"")?xn(c):""}function Wi(a,s){switch(a.tag){case 26:case 27:case 5:return xn(a.type);case 16:return xn("Lazy");case 13:return a.child!==s&&s!==null?xn("Suspense Fallback"):xn("Suspense");case 19:return xn("SuspenseList");case 0:case 15:return ar(a.type,!1);case 11:return ar(a.type.render,!1);case 1:return ar(a.type,!0);case 31:return xn("Activity");default:return""}}function Zr(a){try{var s="",c=null;do s+=Wi(a,c),c=a,a=a.return;while(a);return s}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}var $s=Object.prototype.hasOwnProperty,bs=X.unstable_scheduleCallback,Hr=X.unstable_cancelCallback,Er=X.unstable_shouldYield,vl=X.unstable_requestPaint,Ln=X.unstable_now,Oa=X.unstable_getCurrentPriorityLevel,xl=X.unstable_ImmediatePriority,ws=X.unstable_UserBlockingPriority,Ts=X.unstable_NormalPriority,lu=X.unstable_LowPriority,Xs=X.unstable_IdlePriority,xe=X.log,B=X.unstable_setDisableYieldValue,N=null,U=null;function ie(a){if(typeof xe=="function"&&B(a),U&&typeof U.setStrictMode=="function")try{U.setStrictMode(N,a)}catch{}}var ue=Math.clz32?Math.clz32:be,Me=Math.log,Te=Math.LN2;function be(a){return a>>>=0,a===0?32:31-(Me(a)/Te|0)|0}var Se=256,He=262144,Be=4194304;function le(a){var s=a&42;if(s!==0)return s;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function mt(a,s,c){var g=a.pendingLanes;if(g===0)return 0;var w=0,M=a.suspendedLanes,k=a.pingedLanes;a=a.warmLanes;var H=g&134217727;return H!==0?(g=H&~M,g!==0?w=le(g):(k&=H,k!==0?w=le(k):c||(c=H&~a,c!==0&&(w=le(c))))):(H=g&~M,H!==0?w=le(H):k!==0?w=le(k):c||(c=g&~a,c!==0&&(w=le(c)))),w===0?0:s!==0&&s!==w&&(s&M)===0&&(M=w&-w,c=s&-s,M>=c||M===32&&(c&4194048)!==0)?s:w}function Bt(a,s){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&s)===0}function Et(a,s){switch(a){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zt(){var a=Be;return Be<<=1,(Be&62914560)===0&&(Be=4194304),a}function Dt(a){for(var s=[],c=0;31>c;c++)s.push(a);return s}function Ft(a,s){a.pendingLanes|=s,s!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Ki(a,s,c,g,w,M){var k=a.pendingLanes;a.pendingLanes=c,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=c,a.entangledLanes&=c,a.errorRecoveryDisabledLanes&=c,a.shellSuspendCounter=0;var H=a.entanglements,fe=a.expirationTimes,Re=a.hiddenUpdates;for(c=k&~c;0<c;){var Ge=31-ue(c),Ke=1<<Ge;H[Ge]=0,fe[Ge]=-1;var Le=Re[Ge];if(Le!==null)for(Re[Ge]=null,Ge=0;Ge<Le.length;Ge++){var je=Le[Ge];je!==null&&(je.lane&=-536870913)}c&=~Ke}g!==0&&hn(a,g,0),M!==0&&w===0&&a.tag!==0&&(a.suspendedLanes|=M&~(k&~s))}function hn(a,s,c){a.pendingLanes|=s,a.suspendedLanes&=~s;var g=31-ue(s);a.entangledLanes|=s,a.entanglements[g]=a.entanglements[g]|1073741824|c&261930}function sn(a,s){var c=a.entangledLanes|=s;for(a=a.entanglements;c;){var g=31-ue(c),w=1<<g;w&s|a[g]&s&&(a[g]|=s),c&=~w}}function Qn(a,s){var c=s&-s;return c=(c&42)!==0?1:Qi(c),(c&(a.suspendedLanes|s))!==0?0:c}function Qi(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function We(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function _i(){var a=nt.p;return a!==0?a:(a=window.event,a===void 0?32:Nm(a.type))}function qi(a,s){var c=nt.p;try{return nt.p=a,s()}finally{nt.p=c}}var ba=Math.random().toString(36).slice(2),Ei="__reactFiber$"+ba,Je="__reactProps$"+ba,Ct="__reactContainer$"+ba,Gt="__reactEvents$"+ba,Ba="__reactListeners$"+ba,hc="__reactHandles$"+ba,$r="__reactResources$"+ba,qt="__reactMarker$"+ba;function Co(a){delete a[Ei],delete a[Je],delete a[Gt],delete a[Ba],delete a[hc]}function Xr(a){var s=a[Ei];if(s)return s;for(var c=a.parentNode;c;){if(s=c[Ct]||c[Ei]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(a=Sf(a);a!==null;){if(c=a[Ei])return c;a=Sf(a)}return s}a=c,c=a.parentNode}return null}function Ss(a){if(a=a[Ei]||a[Ct]){var s=a.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return a}return null}function Yr(a){var s=a.tag;if(s===5||s===26||s===27||s===6)return a.stateNode;throw Error(Q(33))}function Wr(a){var s=a[$r];return s||(s=a[$r]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function dn(a){a[qt]=!0}var bl=new Set,na={};function ci(a,s){Ms(a,s),Ms(a+"Capture",s)}function Ms(a,s){for(na[a]=s,a=0;a<s.length;a++)bl.add(s[a])}var wl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Tl={},Ys={};function Ar(a){return $s.call(Ys,a)?!0:$s.call(Tl,a)?!1:wl.test(a)?Ys[a]=!0:(Tl[a]=!0,!1)}function uu(a,s,c){if(Ar(s))if(c===null)a.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":a.removeAttribute(s);return;case"boolean":var g=s.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){a.removeAttribute(s);return}}a.setAttribute(s,""+c)}}function Kr(a,s,c){if(c===null)a.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(s);return}a.setAttribute(s,""+c)}}function rr(a,s,c,g){if(g===null)a.removeAttribute(c);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttributeNS(s,c,""+g)}}function yi(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function lh(a){var s=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function yd(a,s,c){var g=Object.getOwnPropertyDescriptor(a.constructor.prototype,s);if(!a.hasOwnProperty(s)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var w=g.get,M=g.set;return Object.defineProperty(a,s,{configurable:!0,get:function(){return w.call(this)},set:function(k){c=""+k,M.call(this,k)}}),Object.defineProperty(a,s,{enumerable:g.enumerable}),{getValue:function(){return c},setValue:function(k){c=""+k},stopTracking:function(){a._valueTracker=null,delete a[s]}}}}function zo(a){if(!a._valueTracker){var s=lh(a)?"checked":"value";a._valueTracker=yd(a,s,""+a[s])}}function uh(a){if(!a)return!1;var s=a._valueTracker;if(!s)return!0;var c=s.getValue(),g="";return a&&(g=lh(a)?a.checked?"true":"false":a.value),a=g,a!==c?(s.setValue(a),!0):!1}function cu(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var vd=/[\n"\\]/g;function ha(a){return a.replace(vd,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function hu(a,s,c,g,w,M,k,H){a.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?a.type=k:a.removeAttribute("type"),s!=null?k==="number"?(s===0&&a.value===""||a.value!=s)&&(a.value=""+yi(s)):a.value!==""+yi(s)&&(a.value=""+yi(s)):k!=="submit"&&k!=="reset"||a.removeAttribute("value"),s!=null?du(a,k,yi(s)):c!=null?du(a,k,yi(c)):g!=null&&a.removeAttribute("value"),w==null&&M!=null&&(a.defaultChecked=!!M),w!=null&&(a.checked=w&&typeof w!="function"&&typeof w!="symbol"),H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"?a.name=""+yi(H):a.removeAttribute("name")}function dc(a,s,c,g,w,M,k,H){if(M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(a.type=M),s!=null||c!=null){if(!(M!=="submit"&&M!=="reset"||s!=null)){zo(a);return}c=c!=null?""+yi(c):"",s=s!=null?""+yi(s):c,H||s===a.value||(a.value=s),a.defaultValue=s}g=g??w,g=typeof g!="function"&&typeof g!="symbol"&&!!g,a.checked=H?a.checked:!!g,a.defaultChecked=!!g,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(a.name=k),zo(a)}function du(a,s,c){s==="number"&&cu(a.ownerDocument)===a||a.defaultValue===""+c||(a.defaultValue=""+c)}function Ws(a,s,c,g){if(a=a.options,s){s={};for(var w=0;w<c.length;w++)s["$"+c[w]]=!0;for(c=0;c<a.length;c++)w=s.hasOwnProperty("$"+a[c].value),a[c].selected!==w&&(a[c].selected=w),w&&g&&(a[c].defaultSelected=!0)}else{for(c=""+yi(c),s=null,w=0;w<a.length;w++){if(a[w].value===c){a[w].selected=!0,g&&(a[w].defaultSelected=!0);return}s!==null||a[w].disabled||(s=a[w])}s!==null&&(s.selected=!0)}}function xd(a,s,c){if(s!=null&&(s=""+yi(s),s!==a.value&&(a.value=s),c==null)){a.defaultValue!==s&&(a.defaultValue=s);return}a.defaultValue=c!=null?""+yi(c):""}function Sl(a,s,c,g){if(s==null){if(g!=null){if(c!=null)throw Error(Q(92));if(Vi(g)){if(1<g.length)throw Error(Q(93));g=g[0]}c=g}c==null&&(c=""),s=c}c=yi(s),a.defaultValue=c,g=a.textContent,g===c&&g!==""&&g!==null&&(a.value=g),zo(a)}function Es(a,s){if(s){var c=a.firstChild;if(c&&c===a.lastChild&&c.nodeType===3){c.nodeValue=s;return}}a.textContent=s}var bd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Do(a,s,c){var g=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?g?a.setProperty(s,""):s==="float"?a.cssFloat="":a[s]="":g?a.setProperty(s,c):typeof c!="number"||c===0||bd.has(s)?s==="float"?a.cssFloat=c:a[s]=(""+c).trim():a[s]=c+"px"}function fc(a,s,c){if(s!=null&&typeof s!="object")throw Error(Q(62));if(a=a.style,c!=null){for(var g in c)!c.hasOwnProperty(g)||s!=null&&s.hasOwnProperty(g)||(g.indexOf("--")===0?a.setProperty(g,""):g==="float"?a.cssFloat="":a[g]="");for(var w in s)g=s[w],s.hasOwnProperty(w)&&c[w]!==g&&Do(a,w,g)}else for(var M in s)s.hasOwnProperty(M)&&Do(a,M,s[M])}function Io(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ks=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ml=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Yt(a){return Ml.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function Cr(){}var ch=null;function fu(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var kn=null,En=null;function Ji(a){var s=Ss(a);if(s&&(a=s.stateNode)){var c=a[Je]||null;e:switch(a=s.stateNode,s.type){case"input":if(hu(a,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=a;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+ha(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var g=c[s];if(g!==a&&g.form===a.form){var w=g[Je]||null;if(!w)throw Error(Q(90));hu(g,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name)}}for(s=0;s<c.length;s++)g=c[s],g.form===a.form&&uh(g)}break e;case"textarea":xd(a,c.value,c.defaultValue);break e;case"select":s=c.value,s!=null&&Ws(a,!!c.multiple,s,!1)}}}var It=!1;function Li(a,s,c){if(It)return a(s,c);It=!0;try{var g=a(s);return g}finally{if(It=!1,(kn!==null||En!==null)&&(Hh(),kn&&(s=kn,a=En,En=kn=null,Ji(s),a)))for(s=0;s<a.length;s++)Ji(a[s])}}function sr(a,s){var c=a.stateNode;if(c===null)return null;var g=c[Je]||null;if(g===null)return null;c=g[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(a=a.type,g=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!g;break e;default:a=!1}if(a)return null;if(c&&typeof c!="function")throw Error(Q(231,s,typeof c));return c}var fn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),da=!1;if(fn)try{var On={};Object.defineProperty(On,"passive",{get:function(){da=!0}}),window.addEventListener("test",On,On),window.removeEventListener("test",On,On)}catch{da=!1}var Fa=null,Qr=null,en=null;function Qs(){if(en)return en;var a,s=Qr,c=s.length,g,w="value"in Fa?Fa.value:Fa.textContent,M=w.length;for(a=0;a<c&&s[a]===w[a];a++);var k=c-a;for(g=1;g<=k&&s[c-g]===w[M-g];g++);return en=w.slice(a,1<g?1-g:void 0)}function ja(a){var s=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&s===13&&(a=13)):a=s,a===10&&(a=13),32<=a||a===13?a:0}function Po(){return!0}function fa(){return!1}function In(a){function s(c,g,w,M,k){this._reactName=c,this._targetInst=w,this.type=g,this.nativeEvent=M,this.target=k,this.currentTarget=null;for(var H in a)a.hasOwnProperty(H)&&(c=a[H],this[H]=c?c(M):M[H]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?Po:fa,this.isPropagationStopped=fa,this}return Ye(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Po)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Po)},persist:function(){},isPersistent:Po}),s}var pa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pu=In(pa),Ro=Ye({},pa,{view:0,detail:0}),Lo=In(Ro),Di,Js,ai,Ht=Ye({},Ro,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_u,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==ai&&(ai&&a.type==="mousemove"?(Di=a.screenX-ai.screenX,Js=a.screenY-ai.screenY):Js=Di=0,ai=a),Di)},movementY:function(a){return"movementY"in a?a.movementY:Js}}),ko=In(Ht),hi=Ye({},Ht,{dataTransfer:0}),mu=In(hi),or=Ye({},Ro,{relatedTarget:0}),eo=In(or),to=Ye({},pa,{animationName:0,elapsedTime:0,pseudoElement:0}),wd=In(to),gu=Ye({},pa,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),hh=In(gu),Zf=Ye({},pa,{data:0}),dh=In(Zf),ma={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Oo(a){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(a):(a=tn[a])?!!s[a]:!1}function _u(){return Oo}var yu=Ye({},Ro,{key:function(a){if(a.key){var s=ma[a.key]||a.key;if(s!=="Unidentified")return s}return a.type==="keypress"?(a=ja(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Jr[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_u,charCode:function(a){return a.type==="keypress"?ja(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?ja(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),pn=In(yu),Td=Ye({},Ht,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pc=In(Td),Sd=Ye({},Ro,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_u}),Hf=In(Sd),El=Ye({},pa,{propertyName:0,elapsedTime:0,pseudoElement:0}),mc=In(El),Al=Ye({},Ht,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),fh=In(Al),vu=Ye({},pa,{newState:0,oldState:0}),Cl=In(vu),zl=[9,13,27,32],bn=fn&&"CompositionEvent"in window,Dl=null;fn&&"documentMode"in document&&(Dl=document.documentMode);var Il=fn&&"TextEvent"in window&&!Dl,Pl=fn&&(!bn||Dl&&8<Dl&&11>=Dl),io=" ",Md=!1;function xu(a,s){switch(a){case"keyup":return zl.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ed(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var zr=!1;function gc(a,s){switch(a){case"compositionend":return Ed(s);case"keypress":return s.which!==32?null:(Md=!0,io);case"textInput":return a=s.data,a===io&&Md?null:a;default:return null}}function Ad(a,s){if(zr)return a==="compositionend"||!bn&&xu(a,s)?(a=Qs(),en=Qr=Fa=null,zr=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Pl&&s.locale!=="ko"?null:s.data;default:return null}}var Cd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _c(a){var s=a&&a.nodeName&&a.nodeName.toLowerCase();return s==="input"?!!Cd[a.type]:s==="textarea"}function yc(a,s,c,g){kn?En?En.push(g):En=[g]:kn=g,s=Wh(s,"onChange"),0<s.length&&(c=new pu("onChange","change",null,c,g),a.push({event:c,listeners:s}))}var Bo=null,Rl=null;function zd(a){Mm(a,0)}function bu(a){var s=Yr(a);if(uh(s))return a}function no(a,s){if(a==="change")return s}var ph=!1;if(fn){var wu;if(fn){var ao="oninput"in document;if(!ao){var mh=document.createElement("div");mh.setAttribute("oninput","return;"),ao=typeof mh.oninput=="function"}wu=ao}else wu=!1;ph=wu&&(!document.documentMode||9<document.documentMode)}function Tu(){Bo&&(Bo.detachEvent("onpropertychange",Dd),Rl=Bo=null)}function Dd(a){if(a.propertyName==="value"&&bu(Rl)){var s=[];yc(s,Rl,a,fu(a)),Li(zd,s)}}function $f(a,s,c){a==="focusin"?(Tu(),Bo=s,Rl=c,Bo.attachEvent("onpropertychange",Dd)):a==="focusout"&&Tu()}function Id(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return bu(Rl)}function Su(a,s){if(a==="click")return bu(s)}function Pd(a,s){if(a==="input"||a==="change")return bu(s)}function gh(a,s){return a===s&&(a!==0||1/a===1/s)||a!==a&&s!==s}var wa=typeof Object.is=="function"?Object.is:gh;function ro(a,s){if(wa(a,s))return!0;if(typeof a!="object"||a===null||typeof s!="object"||s===null)return!1;var c=Object.keys(a),g=Object.keys(s);if(c.length!==g.length)return!1;for(g=0;g<c.length;g++){var w=c[g];if(!$s.call(s,w)||!wa(a[w],s[w]))return!1}return!0}function lr(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Mu(a,s){var c=lr(a);a=0;for(var g;c;){if(c.nodeType===3){if(g=a+c.textContent.length,a<=s&&g>=s)return{node:c,offset:s-a};a=g}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=lr(c)}}function vc(a,s){return a&&s?a===s?!0:a&&a.nodeType===3?!1:s&&s.nodeType===3?vc(a,s.parentNode):"contains"in a?a.contains(s):a.compareDocumentPosition?!!(a.compareDocumentPosition(s)&16):!1:!1}function xc(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var s=cu(a.document);s instanceof a.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)a=s.contentWindow;else break;s=cu(a.document)}return s}function Eu(a){var s=a&&a.nodeName&&a.nodeName.toLowerCase();return s&&(s==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||s==="textarea"||a.contentEditable==="true")}var bc=fn&&"documentMode"in document&&11>=document.documentMode,ur=null,Au=null,Cu=null,wc=!1;function Rd(a,s,c){var g=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;wc||ur==null||ur!==cu(g)||(g=ur,"selectionStart"in g&&Eu(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Cu&&ro(Cu,g)||(Cu=g,g=Wh(Au,"onSelect"),0<g.length&&(s=new pu("onSelect","select",null,s,c),a.push({event:s,listeners:g}),s.target=ur)))}function Fo(a,s){var c={};return c[a.toLowerCase()]=s.toLowerCase(),c["Webkit"+a]="webkit"+s,c["Moz"+a]="moz"+s,c}var jo={animationend:Fo("Animation","AnimationEnd"),animationiteration:Fo("Animation","AnimationIteration"),animationstart:Fo("Animation","AnimationStart"),transitionrun:Fo("Transition","TransitionRun"),transitionstart:Fo("Transition","TransitionStart"),transitioncancel:Fo("Transition","TransitionCancel"),transitionend:Fo("Transition","TransitionEnd")},_h={},vi={};fn&&(vi=document.createElement("div").style,"AnimationEvent"in window||(delete jo.animationend.animation,delete jo.animationiteration.animation,delete jo.animationstart.animation),"TransitionEvent"in window||delete jo.transitionend.transition);function es(a){if(_h[a])return _h[a];if(!jo[a])return a;var s=jo[a],c;for(c in s)if(s.hasOwnProperty(c)&&c in vi)return _h[a]=s[c];return a}var zu=es("animationend"),Du=es("animationiteration"),Tc=es("animationstart"),No=es("transitionrun"),Iu=es("transitionstart"),Ll=es("transitioncancel"),Na=es("transitionend"),yh=new Map,Sc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Sc.push("scrollEnd");function Va(a,s){yh.set(a,s),ci(s,[a])}var ts=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},ga=[],As=0,Vo=0;function Uo(){for(var a=As,s=Vo=As=0;s<a;){var c=ga[s];ga[s++]=null;var g=ga[s];ga[s++]=null;var w=ga[s];ga[s++]=null;var M=ga[s];if(ga[s++]=null,g!==null&&w!==null){var k=g.pending;k===null?w.next=w:(w.next=k.next,k.next=w),g.pending=w}M!==0&&vh(c,w,M)}}function Pu(a,s,c,g){ga[As++]=a,ga[As++]=s,ga[As++]=c,ga[As++]=g,Vo|=g,a.lanes|=g,a=a.alternate,a!==null&&(a.lanes|=g)}function so(a,s,c,g){return Pu(a,s,c,g),kl(a)}function cr(a,s){return Pu(a,null,null,s),kl(a)}function vh(a,s,c){a.lanes|=c;var g=a.alternate;g!==null&&(g.lanes|=c);for(var w=!1,M=a.return;M!==null;)M.childLanes|=c,g=M.alternate,g!==null&&(g.childLanes|=c),M.tag===22&&(a=M.stateNode,a===null||a._visibility&1||(w=!0)),a=M,M=M.return;return a.tag===3?(M=a.stateNode,w&&s!==null&&(w=31-ue(c),a=M.hiddenUpdates,g=a[w],g===null?a[w]=[s]:g.push(s),s.lane=c|536870912),M):null}function kl(a){if(50<Zh)throw Zh=0,hp=null,Error(Q(185));for(var s=a.return;s!==null;)a=s,s=a.return;return a.tag===3?a.stateNode:null}var Xt={};function Mc(a,s,c,g){this.tag=a,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ua(a,s,c,g){return new Mc(a,s,c,g)}function Ec(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Ga(a,s){var c=a.alternate;return c===null?(c=Ua(a.tag,s,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=s,c.type=a.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=a.flags&65011712,c.childLanes=a.childLanes,c.lanes=a.lanes,c.child=a.child,c.memoizedProps=a.memoizedProps,c.memoizedState=a.memoizedState,c.updateQueue=a.updateQueue,s=a.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=a.sibling,c.index=a.index,c.ref=a.ref,c.refCleanup=a.refCleanup,c}function Ld(a,s){a.flags&=65011714;var c=a.alternate;return c===null?(a.childLanes=0,a.lanes=s,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,s=c.dependencies,a.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),a}function Ac(a,s,c,g,w,M){var k=0;if(g=a,typeof a=="function")Ec(a)&&(k=1);else if(typeof a=="string")k=Df(a,c,dt.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case Lt:return a=Ua(31,c,s,w),a.elementType=Lt,a.lanes=M,a;case bt:return oo(c.children,w,M,s);case Ce:k=8,w|=24;break;case di:return a=Ua(12,c,s,w|2),a.elementType=di,a.lanes=M,a;case $t:return a=Ua(13,c,s,w),a.elementType=$t,a.lanes=M,a;case Mi:return a=Ua(19,c,s,w),a.elementType=Mi,a.lanes=M,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case pt:k=10;break e;case ti:k=9;break e;case si:k=11;break e;case Pt:k=14;break e;case Kt:k=16,g=null;break e}k=29,c=Error(Q(130,a===null?"null":typeof a,"")),g=null}return s=Ua(k,c,s,w),s.elementType=a,s.type=g,s.lanes=M,s}function oo(a,s,c,g){return a=Ua(7,a,g,s),a.lanes=c,a}function xh(a,s,c){return a=Ua(6,a,null,s),a.lanes=c,a}function Cc(a){var s=Ua(18,null,null,0);return s.stateNode=a,s}function lo(a,s,c){return s=Ua(4,a.children!==null?a.children:[],a.key,s),s.lanes=c,s.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},s}var Ol=new WeakMap;function _a(a,s){if(typeof a=="object"&&a!==null){var c=Ol.get(a);return c!==void 0?c:(s={value:a,source:s,stack:Zr(s)},Ol.set(a,s),s)}return{value:a,source:s,stack:Zr(s)}}var uo=[],co=0,Go=null,ho=0,Bn=[],Vn=0,is=null,ns=1,Ta="";function Cs(a,s){uo[co++]=ho,uo[co++]=Go,Go=a,ho=s}function bh(a,s,c){Bn[Vn++]=ns,Bn[Vn++]=Ta,Bn[Vn++]=is,is=a;var g=ns;a=Ta;var w=32-ue(g)-1;g&=~(1<<w),c+=1;var M=32-ue(s)+w;if(30<M){var k=w-w%5;M=(g&(1<<k)-1).toString(32),g>>=k,w-=k,ns=1<<32-ue(s)+w|c<<w|g,Ta=M+a}else ns=1<<M|c<<w|g,Ta=a}function qo(a){a.return!==null&&(Cs(a,1),bh(a,1,0))}function Bl(a){for(;a===Go;)Go=uo[--co],uo[co]=null,ho=uo[--co],uo[co]=null;for(;a===is;)is=Bn[--Vn],Bn[Vn]=null,Ta=Bn[--Vn],Bn[Vn]=null,ns=Bn[--Vn],Bn[Vn]=null}function wh(a,s){Bn[Vn++]=ns,Bn[Vn++]=Ta,Bn[Vn++]=is,ns=s.id,Ta=s.overflow,is=a}var Un=null,ki=null,oi=!1,zs=null,qa=!1,on=Error(Q(519));function Sa(a){var s=Error(Q(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ds(_a(s,a)),on}function Ma(a){var s=a.stateNode,c=a.type,g=a.memoizedProps;switch(s[Ei]=a,s[Je]=g,c){case"dialog":mi("cancel",s),mi("close",s);break;case"iframe":case"object":case"embed":mi("load",s);break;case"video":case"audio":for(c=0;c<Ql.length;c++)mi(Ql[c],s);break;case"source":mi("error",s);break;case"img":case"image":case"link":mi("error",s),mi("load",s);break;case"details":mi("toggle",s);break;case"input":mi("invalid",s),dc(s,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0);break;case"select":mi("invalid",s);break;case"textarea":mi("invalid",s),Sl(s,g.value,g.defaultValue,g.children)}c=g.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||g.suppressHydrationWarning===!0||Mp(s.textContent,c)?(g.popover!=null&&(mi("beforetoggle",s),mi("toggle",s)),g.onScroll!=null&&mi("scroll",s),g.onScrollEnd!=null&&mi("scrollend",s),g.onClick!=null&&(s.onclick=Cr),s=!0):s=!1,s||Sa(a,!0)}function Ru(a){for(Un=a.return;Un;)switch(Un.tag){case 5:case 31:case 13:qa=!1;return;case 27:case 3:qa=!0;return;default:Un=Un.return}}function as(a){if(a!==Un)return!1;if(!oi)return Ru(a),oi=!0,!1;var s=a.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=a.type,c=!(c!=="form"&&c!=="button")||bf(a.type,a.memoizedProps)),c=!c),c&&ki&&Sa(a),Ru(a),s===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Q(317));ki=oa(a)}else if(s===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Q(317));ki=oa(a)}else s===27?(s=ki,tu(a.type)?(a=Ja,Ja=null,ki=a):ki=s):ki=Un?Vr(a.stateNode.nextSibling):null;return!0}function rs(){ki=Un=null,oi=!1}function ss(){var a=zs;return a!==null&&(xr===null?xr=a:xr.push.apply(xr,a),zs=null),a}function Ds(a){zs===null?zs=[a]:zs.push(a)}var Is=me(null),hr=null,os=null;function Ps(a,s,c){lt(Is,s._currentValue),s._currentValue=c}function ls(a){a._currentValue=Is.current,Ze(Is)}function zc(a,s,c){for(;a!==null;){var g=a.alternate;if((a.childLanes&s)!==s?(a.childLanes|=s,g!==null&&(g.childLanes|=s)):g!==null&&(g.childLanes&s)!==s&&(g.childLanes|=s),a===c)break;a=a.return}}function Dc(a,s,c,g){var w=a.child;for(w!==null&&(w.return=a);w!==null;){var M=w.dependencies;if(M!==null){var k=w.child;M=M.firstContext;e:for(;M!==null;){var H=M;M=w;for(var fe=0;fe<s.length;fe++)if(H.context===s[fe]){M.lanes|=c,H=M.alternate,H!==null&&(H.lanes|=c),zc(M.return,c,a),g||(k=null);break e}M=H.next}}else if(w.tag===18){if(k=w.return,k===null)throw Error(Q(341));k.lanes|=c,M=k.alternate,M!==null&&(M.lanes|=c),zc(k,c,a),k=null}else k=w.child;if(k!==null)k.return=w;else for(k=w;k!==null;){if(k===a){k=null;break}if(w=k.sibling,w!==null){w.return=k.return,k=w;break}k=k.return}w=k}}function Za(a,s,c,g){a=null;for(var w=s,M=!1;w!==null;){if(!M){if((w.flags&524288)!==0)M=!0;else if((w.flags&262144)!==0)break}if(w.tag===10){var k=w.alternate;if(k===null)throw Error(Q(387));if(k=k.memoizedProps,k!==null){var H=w.type;wa(w.pendingProps.value,k.value)||(a!==null?a.push(H):a=[H])}}else if(w===Zt.current){if(k=w.alternate,k===null)throw Error(Q(387));k.memoizedState.memoizedState!==w.memoizedState.memoizedState&&(a!==null?a.push(ld):a=[ld])}w=w.return}a!==null&&Dc(s,a,c,g),s.flags|=262144}function Fl(a){for(a=a.firstContext;a!==null;){if(!wa(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Rs(a){hr=a,os=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function An(a){return Ic(hr,a)}function Lu(a,s){return hr===null&&Rs(a),Ic(a,s)}function Ic(a,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},os===null){if(a===null)throw Error(Q(308));os=s,a.dependencies={lanes:0,firstContext:s},a.flags|=524288}else os=os.next=s;return c}var Th=typeof AbortController<"u"?AbortController:function(){var a=[],s=this.signal={aborted:!1,addEventListener:function(c,g){a.push(g)}};this.abort=function(){s.aborted=!0,a.forEach(function(c){return c()})}},kd=X.unstable_scheduleCallback,Sh=X.unstable_NormalPriority,wn={$$typeof:pt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function us(){return{controller:new Th,data:new Map,refCount:0}}function jl(a){a.refCount--,a.refCount===0&&kd(Sh,function(){a.controller.abort()})}var aa=null,Ha=0,Zo=0,ra=null;function Xf(a,s){if(aa===null){var c=aa=[];Ha=0,Zo=xp(),ra={status:"pending",value:void 0,then:function(g){c.push(g)}}}return Ha++,s.then(Nl,Nl),s}function Nl(){if(--Ha===0&&aa!==null){ra!==null&&(ra.status="fulfilled");var a=aa;aa=null,Zo=0,ra=null;for(var s=0;s<a.length;s++)(0,a[s])()}}function ku(a,s){var c=[],g={status:"pending",value:null,reason:null,then:function(w){c.push(w)}};return a.then(function(){g.status="fulfilled",g.value=s;for(var w=0;w<c.length;w++)(0,c[w])(s)},function(w){for(g.status="rejected",g.reason=w,w=0;w<c.length;w++)(0,c[w])(void 0)}),g}var Fn=Fe.S;Fe.S=function(a,s){lm=Ln(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&Xf(a,s),Fn!==null&&Fn(a,s)};var Dr=me(null);function Pc(){var a=Dr.current;return a!==null?a:rn.pooledCache}function Rc(a,s){s===null?lt(Dr,Dr.current):lt(Dr,s.pool)}function Od(){var a=Pc();return a===null?null:{parent:wn._currentValue,pool:a}}var Ir=Error(Q(460)),fo=Error(Q(474)),Ea=Error(Q(542)),ut={then:function(){}};function Ou(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Lc(a,s,c){switch(c=a[c],c===void 0?a.push(s):c!==s&&(s.then(Cr,Cr),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw a=s.reason,kc(a),a;default:if(typeof s.status=="string")s.then(Cr,Cr);else{if(a=rn,a!==null&&100<a.shellSuspendCounter)throw Error(Q(482));a=s,a.status="pending",a.then(function(g){if(s.status==="pending"){var w=s;w.status="fulfilled",w.value=g}},function(g){if(s.status==="pending"){var w=s;w.status="rejected",w.reason=g}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw a=s.reason,kc(a),a}throw Pr=s,Ir}}function dr(a){try{var s=a._init;return s(a._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(Pr=c,Ir):c}}var Pr=null;function Vl(){if(Pr===null)throw Error(Q(459));var a=Pr;return Pr=null,a}function kc(a){if(a===Ir||a===Ea)throw Error(Q(483))}var cs=null,Ho=0;function Bu(a){var s=Ho;return Ho+=1,cs===null&&(cs=[]),Lc(cs,a,s)}function hs(a,s){s=s.props.ref,a.ref=s!==void 0?s:null}function Oc(a,s){throw s.$$typeof===xt?Error(Q(525)):(a=Object.prototype.toString.call(s),Error(Q(31,a==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":a)))}function Fu(a){function s(we,ye){if(a){var Pe=we.deletions;Pe===null?(we.deletions=[ye],we.flags|=16):Pe.push(ye)}}function c(we,ye){if(!a)return null;for(;ye!==null;)s(we,ye),ye=ye.sibling;return null}function g(we){for(var ye=new Map;we!==null;)we.key!==null?ye.set(we.key,we):ye.set(we.index,we),we=we.sibling;return ye}function w(we,ye){return we=Ga(we,ye),we.index=0,we.sibling=null,we}function M(we,ye,Pe){return we.index=Pe,a?(Pe=we.alternate,Pe!==null?(Pe=Pe.index,Pe<ye?(we.flags|=67108866,ye):Pe):(we.flags|=67108866,ye)):(we.flags|=1048576,ye)}function k(we){return a&&we.alternate===null&&(we.flags|=67108866),we}function H(we,ye,Pe,$e){return ye===null||ye.tag!==6?(ye=xh(Pe,we.mode,$e),ye.return=we,ye):(ye=w(ye,Pe),ye.return=we,ye)}function fe(we,ye,Pe,$e){var Rt=Pe.type;return Rt===bt?Ge(we,ye,Pe.props.children,$e,Pe.key):ye!==null&&(ye.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===Kt&&dr(Rt)===ye.type)?(ye=w(ye,Pe.props),hs(ye,Pe),ye.return=we,ye):(ye=Ac(Pe.type,Pe.key,Pe.props,null,we.mode,$e),hs(ye,Pe),ye.return=we,ye)}function Re(we,ye,Pe,$e){return ye===null||ye.tag!==4||ye.stateNode.containerInfo!==Pe.containerInfo||ye.stateNode.implementation!==Pe.implementation?(ye=lo(Pe,we.mode,$e),ye.return=we,ye):(ye=w(ye,Pe.children||[]),ye.return=we,ye)}function Ge(we,ye,Pe,$e,Rt){return ye===null||ye.tag!==7?(ye=oo(Pe,we.mode,$e,Rt),ye.return=we,ye):(ye=w(ye,Pe),ye.return=we,ye)}function Ke(we,ye,Pe){if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return ye=xh(""+ye,we.mode,Pe),ye.return=we,ye;if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case Tt:return Pe=Ac(ye.type,ye.key,ye.props,null,we.mode,Pe),hs(Pe,ye),Pe.return=we,Pe;case ui:return ye=lo(ye,we.mode,Pe),ye.return=we,ye;case Kt:return ye=dr(ye),Ke(we,ye,Pe)}if(Vi(ye)||kt(ye))return ye=oo(ye,we.mode,Pe,null),ye.return=we,ye;if(typeof ye.then=="function")return Ke(we,Bu(ye),Pe);if(ye.$$typeof===pt)return Ke(we,Lu(we,ye),Pe);Oc(we,ye)}return null}function Le(we,ye,Pe,$e){var Rt=ye!==null?ye.key:null;if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number"||typeof Pe=="bigint")return Rt!==null?null:H(we,ye,""+Pe,$e);if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case Tt:return Pe.key===Rt?fe(we,ye,Pe,$e):null;case ui:return Pe.key===Rt?Re(we,ye,Pe,$e):null;case Kt:return Pe=dr(Pe),Le(we,ye,Pe,$e)}if(Vi(Pe)||kt(Pe))return Rt!==null?null:Ge(we,ye,Pe,$e,null);if(typeof Pe.then=="function")return Le(we,ye,Bu(Pe),$e);if(Pe.$$typeof===pt)return Le(we,ye,Lu(we,Pe),$e);Oc(we,Pe)}return null}function je(we,ye,Pe,$e,Rt){if(typeof $e=="string"&&$e!==""||typeof $e=="number"||typeof $e=="bigint")return we=we.get(Pe)||null,H(ye,we,""+$e,Rt);if(typeof $e=="object"&&$e!==null){switch($e.$$typeof){case Tt:return we=we.get($e.key===null?Pe:$e.key)||null,fe(ye,we,$e,Rt);case ui:return we=we.get($e.key===null?Pe:$e.key)||null,Re(ye,we,$e,Rt);case Kt:return $e=dr($e),je(we,ye,Pe,$e,Rt)}if(Vi($e)||kt($e))return we=we.get(Pe)||null,Ge(ye,we,$e,Rt,null);if(typeof $e.then=="function")return je(we,ye,Pe,Bu($e),Rt);if($e.$$typeof===pt)return je(we,ye,Pe,Lu(ye,$e),Rt);Oc(ye,$e)}return null}function wt(we,ye,Pe,$e){for(var Rt=null,Ri=null,At=ye,Wt=ye=0,jt=null;At!==null&&Wt<Pe.length;Wt++){At.index>Wt?(jt=At,At=null):jt=At.sibling;var Si=Le(we,At,Pe[Wt],$e);if(Si===null){At===null&&(At=jt);break}a&&At&&Si.alternate===null&&s(we,At),ye=M(Si,ye,Wt),Ri===null?Rt=Si:Ri.sibling=Si,Ri=Si,At=jt}if(Wt===Pe.length)return c(we,At),oi&&Cs(we,Wt),Rt;if(At===null){for(;Wt<Pe.length;Wt++)At=Ke(we,Pe[Wt],$e),At!==null&&(ye=M(At,ye,Wt),Ri===null?Rt=At:Ri.sibling=At,Ri=At);return oi&&Cs(we,Wt),Rt}for(At=g(At);Wt<Pe.length;Wt++)jt=je(At,we,Wt,Pe[Wt],$e),jt!==null&&(a&&jt.alternate!==null&&At.delete(jt.key===null?Wt:jt.key),ye=M(jt,ye,Wt),Ri===null?Rt=jt:Ri.sibling=jt,Ri=jt);return a&&At.forEach(function(ml){return s(we,ml)}),oi&&Cs(we,Wt),Rt}function Ut(we,ye,Pe,$e){if(Pe==null)throw Error(Q(151));for(var Rt=null,Ri=null,At=ye,Wt=ye=0,jt=null,Si=Pe.next();At!==null&&!Si.done;Wt++,Si=Pe.next()){At.index>Wt?(jt=At,At=null):jt=At.sibling;var ml=Le(we,At,Si.value,$e);if(ml===null){At===null&&(At=jt);break}a&&At&&ml.alternate===null&&s(we,At),ye=M(ml,ye,Wt),Ri===null?Rt=ml:Ri.sibling=ml,Ri=ml,At=jt}if(Si.done)return c(we,At),oi&&Cs(we,Wt),Rt;if(At===null){for(;!Si.done;Wt++,Si=Pe.next())Si=Ke(we,Si.value,$e),Si!==null&&(ye=M(Si,ye,Wt),Ri===null?Rt=Si:Ri.sibling=Si,Ri=Si);return oi&&Cs(we,Wt),Rt}for(At=g(At);!Si.done;Wt++,Si=Pe.next())Si=je(At,we,Wt,Si.value,$e),Si!==null&&(a&&Si.alternate!==null&&At.delete(Si.key===null?Wt:Si.key),ye=M(Si,ye,Wt),Ri===null?Rt=Si:Ri.sibling=Si,Ri=Si);return a&&At.forEach(function($m){return s(we,$m)}),oi&&Cs(we,Wt),Rt}function Ni(we,ye,Pe,$e){if(typeof Pe=="object"&&Pe!==null&&Pe.type===bt&&Pe.key===null&&(Pe=Pe.props.children),typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case Tt:e:{for(var Rt=Pe.key;ye!==null;){if(ye.key===Rt){if(Rt=Pe.type,Rt===bt){if(ye.tag===7){c(we,ye.sibling),$e=w(ye,Pe.props.children),$e.return=we,we=$e;break e}}else if(ye.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===Kt&&dr(Rt)===ye.type){c(we,ye.sibling),$e=w(ye,Pe.props),hs($e,Pe),$e.return=we,we=$e;break e}c(we,ye);break}else s(we,ye);ye=ye.sibling}Pe.type===bt?($e=oo(Pe.props.children,we.mode,$e,Pe.key),$e.return=we,we=$e):($e=Ac(Pe.type,Pe.key,Pe.props,null,we.mode,$e),hs($e,Pe),$e.return=we,we=$e)}return k(we);case ui:e:{for(Rt=Pe.key;ye!==null;){if(ye.key===Rt)if(ye.tag===4&&ye.stateNode.containerInfo===Pe.containerInfo&&ye.stateNode.implementation===Pe.implementation){c(we,ye.sibling),$e=w(ye,Pe.children||[]),$e.return=we,we=$e;break e}else{c(we,ye);break}else s(we,ye);ye=ye.sibling}$e=lo(Pe,we.mode,$e),$e.return=we,we=$e}return k(we);case Kt:return Pe=dr(Pe),Ni(we,ye,Pe,$e)}if(Vi(Pe))return wt(we,ye,Pe,$e);if(kt(Pe)){if(Rt=kt(Pe),typeof Rt!="function")throw Error(Q(150));return Pe=Rt.call(Pe),Ut(we,ye,Pe,$e)}if(typeof Pe.then=="function")return Ni(we,ye,Bu(Pe),$e);if(Pe.$$typeof===pt)return Ni(we,ye,Lu(we,Pe),$e);Oc(we,Pe)}return typeof Pe=="string"&&Pe!==""||typeof Pe=="number"||typeof Pe=="bigint"?(Pe=""+Pe,ye!==null&&ye.tag===6?(c(we,ye.sibling),$e=w(ye,Pe),$e.return=we,we=$e):(c(we,ye),$e=xh(Pe,we.mode,$e),$e.return=we,we=$e),k(we)):c(we,ye)}return function(we,ye,Pe,$e){try{Ho=0;var Rt=Ni(we,ye,Pe,$e);return cs=null,Rt}catch(At){if(At===Ir||At===Ea)throw At;var Ri=Ua(29,At,null,we.mode);return Ri.lanes=$e,Ri.return=we,Ri}}}var ds=Fu(!0),Mh=Fu(!1),fs=!1;function Bc(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ju(a,s){a=a.updateQueue,s.updateQueue===a&&(s.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function ps(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Ls(a,s,c){var g=a.updateQueue;if(g===null)return null;if(g=g.shared,(Fi&2)!==0){var w=g.pending;return w===null?s.next=s:(s.next=w.next,w.next=s),g.pending=s,s=kl(a),vh(a,null,c),s}return Pu(a,g,s,c),kl(a)}function fr(a,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var g=s.lanes;g&=a.pendingLanes,c|=g,s.lanes=c,sn(a,c)}}function Ai(a,s){var c=a.updateQueue,g=a.alternate;if(g!==null&&(g=g.updateQueue,c===g)){var w=null,M=null;if(c=c.firstBaseUpdate,c!==null){do{var k={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};M===null?w=M=k:M=M.next=k,c=c.next}while(c!==null);M===null?w=M=s:M=M.next=s}else w=M=s;c={baseState:g.baseState,firstBaseUpdate:w,lastBaseUpdate:M,shared:g.shared,callbacks:g.callbacks},a.updateQueue=c;return}a=c.lastBaseUpdate,a===null?c.firstBaseUpdate=s:a.next=s,c.lastBaseUpdate=s}var Eh=!1;function ks(){if(Eh){var a=ra;if(a!==null)throw a}}function po(a,s,c,g){Eh=!1;var w=a.updateQueue;fs=!1;var M=w.firstBaseUpdate,k=w.lastBaseUpdate,H=w.shared.pending;if(H!==null){w.shared.pending=null;var fe=H,Re=fe.next;fe.next=null,k===null?M=Re:k.next=Re,k=fe;var Ge=a.alternate;Ge!==null&&(Ge=Ge.updateQueue,H=Ge.lastBaseUpdate,H!==k&&(H===null?Ge.firstBaseUpdate=Re:H.next=Re,Ge.lastBaseUpdate=fe))}if(M!==null){var Ke=w.baseState;k=0,Ge=Re=fe=null,H=M;do{var Le=H.lane&-536870913,je=Le!==H.lane;if(je?(pi&Le)===Le:(g&Le)===Le){Le!==0&&Le===Zo&&(Eh=!0),Ge!==null&&(Ge=Ge.next={lane:0,tag:H.tag,payload:H.payload,callback:null,next:null});e:{var wt=a,Ut=H;Le=s;var Ni=c;switch(Ut.tag){case 1:if(wt=Ut.payload,typeof wt=="function"){Ke=wt.call(Ni,Ke,Le);break e}Ke=wt;break e;case 3:wt.flags=wt.flags&-65537|128;case 0:if(wt=Ut.payload,Le=typeof wt=="function"?wt.call(Ni,Ke,Le):wt,Le==null)break e;Ke=Ye({},Ke,Le);break e;case 2:fs=!0}}Le=H.callback,Le!==null&&(a.flags|=64,je&&(a.flags|=8192),je=w.callbacks,je===null?w.callbacks=[Le]:je.push(Le))}else je={lane:Le,tag:H.tag,payload:H.payload,callback:H.callback,next:null},Ge===null?(Re=Ge=je,fe=Ke):Ge=Ge.next=je,k|=Le;if(H=H.next,H===null){if(H=w.shared.pending,H===null)break;je=H,H=je.next,je.next=null,w.lastBaseUpdate=je,w.shared.pending=null}}while(!0);Ge===null&&(fe=Ke),w.baseState=fe,w.firstBaseUpdate=Re,w.lastBaseUpdate=Ge,M===null&&(w.shared.lanes=0),sl|=k,a.lanes=k,a.memoizedState=Ke}}function Nu(a,s){if(typeof a!="function")throw Error(Q(191,a));a.call(s)}function Fc(a,s){var c=a.callbacks;if(c!==null)for(a.callbacks=null,a=0;a<c.length;a++)Nu(c[a],s)}var $o=me(null),Vu=me(0);function Ah(a,s){a=rl,lt(Vu,a),lt($o,s),rl=a|s.baseLanes}function $a(){lt(Vu,rl),lt($o,$o.current)}function Xo(){rl=Vu.current,Ze($o),Ze(Vu)}var ct=me(null),yt=null;function pr(a){var s=a.alternate;lt(mn,mn.current&1),lt(ct,a),yt===null&&(s===null||$o.current!==null||s.memoizedState!==null)&&(yt=a)}function Ul(a){lt(mn,mn.current),lt(ct,a),yt===null&&(yt=a)}function Uu(a){a.tag===22?(lt(mn,mn.current),lt(ct,a),yt===null&&(yt=a)):Tn()}function Tn(){lt(mn,mn.current),lt(ct,ct.current)}function ln(a){Ze(ct),yt===a&&(yt=null),Ze(mn)}var mn=me(0);function Gu(a){for(var s=a;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Da(c)||cn(c)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break;for(;s.sibling===null;){if(s.return===null||s.return===a)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Os=0,ei=null,wi=null,Qt=null,nn=!1,mr=!1,Rr=!1,Yo=0,Wo=0,Bs=null,Ch=0;function $i(){throw Error(Q(321))}function Lr(a,s){if(s===null)return!1;for(var c=0;c<s.length&&c<a.length;c++)if(!wa(a[c],s[c]))return!1;return!0}function Gl(a,s,c,g,w,M){return Os=M,ei=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Fe.H=a===null||a.memoizedState===null?Bi:Cn,Rr=!1,M=c(g,w),Rr=!1,mr&&(M=qu(s,c,g,w)),ql(a),M}function ql(a){Fe.H=Ci;var s=wi!==null&&wi.next!==null;if(Os=0,Qt=wi=ei=null,nn=!1,Wo=0,Bs=null,s)throw Error(Q(300));a===null||Zn||(a=a.dependencies,a!==null&&Fl(a)&&(Zn=!0))}function qu(a,s,c,g){ei=a;var w=0;do{if(mr&&(Bs=null),Wo=0,mr=!1,25<=w)throw Error(Q(301));if(w+=1,Qt=wi=null,a.updateQueue!=null){var M=a.updateQueue;M.lastEffect=null,M.events=null,M.stores=null,M.memoCache!=null&&(M.memoCache.index=0)}Fe.H=Pn,M=s(c,g)}while(mr);return M}function Zu(){var a=Fe.H,s=a.useState()[0];return s=typeof s.then=="function"?Ko(s):s,a=a.useState()[0],(wi!==null?wi.memoizedState:null)!==a&&(ei.flags|=1024),s}function Hu(){var a=Yo!==0;return Yo=0,a}function mo(a,s,c){s.updateQueue=a.updateQueue,s.flags&=-2053,a.lanes&=~c}function Fs(a){if(nn){for(a=a.memoizedState;a!==null;){var s=a.queue;s!==null&&(s.pending=null),a=a.next}nn=!1}Os=0,Qt=wi=ei=null,mr=!1,Wo=Yo=0,Bs=null}function Jn(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qt===null?ei.memoizedState=Qt=a:Qt=Qt.next=a,Qt}function an(){if(wi===null){var a=ei.alternate;a=a!==null?a.memoizedState:null}else a=wi.next;var s=Qt===null?ei.memoizedState:Qt.next;if(s!==null)Qt=s,wi=a;else{if(a===null)throw ei.alternate===null?Error(Q(467)):Error(Q(310));wi=a,a={memoizedState:wi.memoizedState,baseState:wi.baseState,baseQueue:wi.baseQueue,queue:wi.queue,next:null},Qt===null?ei.memoizedState=Qt=a:Qt=Qt.next=a}return Qt}function ms(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ko(a){var s=Wo;return Wo+=1,Bs===null&&(Bs=[]),a=Lc(Bs,a,s),s=ei,(Qt===null?s.memoizedState:Qt.next)===null&&(s=s.alternate,Fe.H=s===null||s.memoizedState===null?Bi:Cn),a}function Qo(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Ko(a);if(a.$$typeof===pt)return An(a)}throw Error(Q(438,String(a)))}function Zl(a){var s=null,c=ei.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var g=ei.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(s={data:g.data.map(function(w){return w.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=ms(),ei.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(a),g=0;g<a;g++)c[g]=ii;return s.index++,c}function kr(a,s){return typeof s=="function"?s(a):s}function m(a){var s=an();return t(s,wi,a)}function t(a,s,c){var g=a.queue;if(g===null)throw Error(Q(311));g.lastRenderedReducer=c;var w=a.baseQueue,M=g.pending;if(M!==null){if(w!==null){var k=w.next;w.next=M.next,M.next=k}s.baseQueue=w=M,g.pending=null}if(M=a.baseState,w===null)a.memoizedState=M;else{s=w.next;var H=k=null,fe=null,Re=s,Ge=!1;do{var Ke=Re.lane&-536870913;if(Ke!==Re.lane?(pi&Ke)===Ke:(Os&Ke)===Ke){var Le=Re.revertLane;if(Le===0)fe!==null&&(fe=fe.next={lane:0,revertLane:0,gesture:null,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null}),Ke===Zo&&(Ge=!0);else if((Os&Le)===Le){Re=Re.next,Le===Zo&&(Ge=!0);continue}else Ke={lane:0,revertLane:Re.revertLane,gesture:null,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null},fe===null?(H=fe=Ke,k=M):fe=fe.next=Ke,ei.lanes|=Le,sl|=Le;Ke=Re.action,Rr&&c(M,Ke),M=Re.hasEagerState?Re.eagerState:c(M,Ke)}else Le={lane:Ke,revertLane:Re.revertLane,gesture:Re.gesture,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null},fe===null?(H=fe=Le,k=M):fe=fe.next=Le,ei.lanes|=Ke,sl|=Ke;Re=Re.next}while(Re!==null&&Re!==s);if(fe===null?k=M:fe.next=H,!wa(M,a.memoizedState)&&(Zn=!0,Ge&&(c=ra,c!==null)))throw c;a.memoizedState=M,a.baseState=k,a.baseQueue=fe,g.lastRenderedState=M}return w===null&&(g.lanes=0),[a.memoizedState,g.dispatch]}function r(a){var s=an(),c=s.queue;if(c===null)throw Error(Q(311));c.lastRenderedReducer=a;var g=c.dispatch,w=c.pending,M=s.memoizedState;if(w!==null){c.pending=null;var k=w=w.next;do M=a(M,k.action),k=k.next;while(k!==w);wa(M,s.memoizedState)||(Zn=!0),s.memoizedState=M,s.baseQueue===null&&(s.baseState=M),c.lastRenderedState=M}return[M,g]}function l(a,s,c){var g=ei,w=an(),M=oi;if(M){if(c===void 0)throw Error(Q(407));c=c()}else c=s();var k=!wa((wi||w).memoizedState,c);if(k&&(w.memoizedState=c,Zn=!0),w=w.queue,De(v.bind(null,g,w,a),[a]),w.getSnapshot!==s||k||Qt!==null&&Qt.memoizedState.tag&1){if(g.flags|=2048,ne(9,{destroy:void 0},_.bind(null,g,w,c,s),null),rn===null)throw Error(Q(349));M||(Os&127)!==0||d(g,s,c)}return c}function d(a,s,c){a.flags|=16384,a={getSnapshot:s,value:c},s=ei.updateQueue,s===null?(s=ms(),ei.updateQueue=s,s.stores=[a]):(c=s.stores,c===null?s.stores=[a]:c.push(a))}function _(a,s,c,g){s.value=c,s.getSnapshot=g,b(s)&&S(a)}function v(a,s,c){return c(function(){b(s)&&S(a)})}function b(a){var s=a.getSnapshot;a=a.value;try{var c=s();return!wa(a,c)}catch{return!0}}function S(a){var s=cr(a,2);s!==null&&wr(s,a,2)}function C(a){var s=Jn();if(typeof a=="function"){var c=a;if(a=c(),Rr){ie(!0);try{c()}finally{ie(!1)}}}return s.memoizedState=s.baseState=a,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:kr,lastRenderedState:a},s}function z(a,s,c,g){return a.baseState=c,t(a,wi,typeof g=="function"?g:kr)}function L(a,s,c,g,w){if(Xa(a))throw Error(Q(485));if(a=s.action,a!==null){var M={payload:w,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){M.listeners.push(k)}};Fe.T!==null?c(!0):M.isTransition=!1,g(M),c=s.pending,c===null?(M.next=s.pending=M,R(s,M)):(M.next=c.next,s.pending=c.next=M)}}function R(a,s){var c=s.action,g=s.payload,w=a.state;if(s.isTransition){var M=Fe.T,k={};Fe.T=k;try{var H=c(w,g),fe=Fe.S;fe!==null&&fe(k,H),j(a,s,H)}catch(Re){$(a,s,Re)}finally{M!==null&&k.types!==null&&(M.types=k.types),Fe.T=M}}else try{M=c(w,g),j(a,s,M)}catch(Re){$(a,s,Re)}}function j(a,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(g){G(a,s,g)},function(g){return $(a,s,g)}):G(a,s,c)}function G(a,s,c){s.status="fulfilled",s.value=c,K(s),a.state=c,s=a.pending,s!==null&&(c=s.next,c===s?a.pending=null:(c=c.next,s.next=c,R(a,c)))}function $(a,s,c){var g=a.pending;if(a.pending=null,g!==null){g=g.next;do s.status="rejected",s.reason=c,K(s),s=s.next;while(s!==g)}a.action=null}function K(a){a=a.listeners;for(var s=0;s<a.length;s++)(0,a[s])()}function W(a,s){return s}function te(a,s){if(oi){var c=rn.formState;if(c!==null){e:{var g=ei;if(oi){if(ki){t:{for(var w=ki,M=qa;w.nodeType!==8;){if(!M){w=null;break t}if(w=Vr(w.nextSibling),w===null){w=null;break t}}M=w.data,w=M==="F!"||M==="F"?w:null}if(w){ki=Vr(w.nextSibling),g=w.data==="F!";break e}}Sa(g)}g=!1}g&&(s=c[0])}}return c=Jn(),c.memoizedState=c.baseState=s,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:W,lastRenderedState:s},c.queue=g,c=Hl.bind(null,ei,g),g.dispatch=c,g=C(!1),M=Ca.bind(null,ei,!1,g.queue),g=Jn(),w={state:s,dispatch:null,action:a,pending:null},g.queue=w,c=L.bind(null,ei,w,M,c),w.dispatch=c,g.memoizedState=a,[s,c,!1]}function oe(a){var s=an();return ee(s,wi,a)}function ee(a,s,c){if(s=t(a,s,W)[0],a=m(kr)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var g=Ko(s)}catch(k){throw k===Ir?Ea:k}else g=s;s=an();var w=s.queue,M=w.dispatch;return c!==s.memoizedState&&(ei.flags|=2048,ne(9,{destroy:void 0},se.bind(null,w,c),null)),[g,M,a]}function se(a,s){a.action=s}function ce(a){var s=an(),c=wi;if(c!==null)return ee(s,c,a);an(),s=s.memoizedState,c=an();var g=c.queue.dispatch;return c.memoizedState=a,[s,g,!1]}function ne(a,s,c,g){return a={tag:a,create:c,deps:g,inst:s,next:null},s=ei.updateQueue,s===null&&(s=ms(),ei.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=a.next=a:(g=c.next,c.next=a,a.next=g,s.lastEffect=a),a}function _e(){return an().memoizedState}function Ie(a,s,c,g){var w=Jn();ei.flags|=a,w.memoizedState=ne(1|s,{destroy:void 0},c,g===void 0?null:g)}function Ee(a,s,c,g){var w=an();g=g===void 0?null:g;var M=w.memoizedState.inst;wi!==null&&g!==null&&Lr(g,wi.memoizedState.deps)?w.memoizedState=ne(s,M,c,g):(ei.flags|=a,w.memoizedState=ne(1|s,M,c,g))}function ze(a,s){Ie(8390656,8,a,s)}function De(a,s){Ee(2048,8,a,s)}function et(a){ei.flags|=4;var s=ei.updateQueue;if(s===null)s=ms(),ei.updateQueue=s,s.events=[a];else{var c=s.events;c===null?s.events=[a]:c.push(a)}}function tt(a){var s=an().memoizedState;return et({ref:s,nextImpl:a}),function(){if((Fi&2)!==0)throw Error(Q(440));return s.impl.apply(void 0,arguments)}}function qe(a,s){return Ee(4,2,a,s)}function rt(a,s){return Ee(4,4,a,s)}function Vt(a,s){if(typeof s=="function"){a=a();var c=s(a);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return a=a(),s.current=a,function(){s.current=null}}function Ti(a,s,c){c=c!=null?c.concat([a]):null,Ee(4,4,Vt.bind(null,s,a),c)}function Gi(){}function Oi(a,s){var c=an();s=s===void 0?null:s;var g=c.memoizedState;return s!==null&&Lr(s,g[1])?g[0]:(c.memoizedState=[a,s],a)}function Xi(a,s){var c=an();s=s===void 0?null:s;var g=c.memoizedState;if(s!==null&&Lr(s,g[1]))return g[0];if(g=a(),Rr){ie(!0);try{a()}finally{ie(!1)}}return c.memoizedState=[g,s],g}function Ii(a,s,c){return c===void 0||(Os&1073741824)!==0&&(pi&261930)===0?a.memoizedState=s:(a.memoizedState=c,a=cm(),ei.lanes|=a,sl|=a,c)}function un(a,s,c,g){return wa(c,s)?c:$o.current!==null?(a=Ii(a,c,g),wa(a,s)||(Zn=!0),a):(Os&42)===0||(Os&1073741824)!==0&&(pi&261930)===0?(Zn=!0,a.memoizedState=c):(a=cm(),ei.lanes|=a,sl|=a,s)}function Yi(a,s,c,g,w){var M=nt.p;nt.p=M!==0&&8>M?M:8;var k=Fe.T,H={};Fe.T=H,Ca(a,!1,s,c);try{var fe=w(),Re=Fe.S;if(Re!==null&&Re(H,fe),fe!==null&&typeof fe=="object"&&typeof fe.then=="function"){var Ge=ku(fe,g);Br(a,s,Ge,br(a))}else Br(a,s,g,br(a))}catch(Ke){Br(a,s,{then:function(){},status:"rejected",reason:Ke},br())}finally{nt.p=M,k!==null&&H.types!==null&&(k.types=H.types),Fe.T=k}}function Gn(){}function gn(a,s,c,g){if(a.tag!==5)throw Error(Q(476));var w=_n(a).queue;Yi(a,w,s,ht,c===null?Gn:function(){return qn(a),c(g)})}function _n(a){var s=a.memoizedState;if(s!==null)return s;s={memoizedState:ht,baseState:ht,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:kr,lastRenderedState:ht},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:kr,lastRenderedState:c},next:null},a.memoizedState=s,a=a.alternate,a!==null&&(a.memoizedState=s),s}function qn(a){var s=_n(a);s.next===null&&(s=a.alternate.memoizedState),Br(a,s.next.queue,{},br())}function gs(){return An(ld)}function _s(){return an().memoizedState}function Or(){return an().memoizedState}function Aa(a){for(var s=a.return;s!==null;){switch(s.tag){case 24:case 3:var c=br();a=ps(c);var g=Ls(s,a,c);g!==null&&(wr(g,s,c),fr(g,s,c)),s={cache:us()},a.payload=s;return}s=s.return}}function Jo(a,s,c){var g=br();c={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Xa(a)?gr(s,c):(c=so(a,s,c,g),c!==null&&(wr(c,a,g),_r(c,s,g)))}function Hl(a,s,c){var g=br();Br(a,s,c,g)}function Br(a,s,c,g){var w={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Xa(a))gr(s,w);else{var M=a.alternate;if(a.lanes===0&&(M===null||M.lanes===0)&&(M=s.lastRenderedReducer,M!==null))try{var k=s.lastRenderedState,H=M(k,c);if(w.hasEagerState=!0,w.eagerState=H,wa(H,k))return Pu(a,s,w,0),rn===null&&Uo(),!1}catch{}if(c=so(a,s,w,g),c!==null)return wr(c,a,g),_r(c,s,g),!0}return!1}function Ca(a,s,c,g){if(g={lane:2,revertLane:xp(),gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},Xa(a)){if(s)throw Error(Q(479))}else s=so(a,c,g,2),s!==null&&wr(s,a,2)}function Xa(a){var s=a.alternate;return a===ei||s!==null&&s===ei}function gr(a,s){mr=nn=!0;var c=a.pending;c===null?s.next=s:(s.next=c.next,c.next=s),a.pending=s}function _r(a,s,c){if((c&4194048)!==0){var g=s.lanes;g&=a.pendingLanes,c|=g,s.lanes=c,sn(a,c)}}var Ci={readContext:An,use:Qo,useCallback:$i,useContext:$i,useEffect:$i,useImperativeHandle:$i,useLayoutEffect:$i,useInsertionEffect:$i,useMemo:$i,useReducer:$i,useRef:$i,useState:$i,useDebugValue:$i,useDeferredValue:$i,useTransition:$i,useSyncExternalStore:$i,useId:$i,useHostTransitionStatus:$i,useFormState:$i,useActionState:$i,useOptimistic:$i,useMemoCache:$i,useCacheRefresh:$i};Ci.useEffectEvent=$i;var Bi={readContext:An,use:Qo,useCallback:function(a,s){return Jn().memoizedState=[a,s===void 0?null:s],a},useContext:An,useEffect:ze,useImperativeHandle:function(a,s,c){c=c!=null?c.concat([a]):null,Ie(4194308,4,Vt.bind(null,s,a),c)},useLayoutEffect:function(a,s){return Ie(4194308,4,a,s)},useInsertionEffect:function(a,s){Ie(4,2,a,s)},useMemo:function(a,s){var c=Jn();s=s===void 0?null:s;var g=a();if(Rr){ie(!0);try{a()}finally{ie(!1)}}return c.memoizedState=[g,s],g},useReducer:function(a,s,c){var g=Jn();if(c!==void 0){var w=c(s);if(Rr){ie(!0);try{c(s)}finally{ie(!1)}}}else w=s;return g.memoizedState=g.baseState=w,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:w},g.queue=a,a=a.dispatch=Jo.bind(null,ei,a),[g.memoizedState,a]},useRef:function(a){var s=Jn();return a={current:a},s.memoizedState=a},useState:function(a){a=C(a);var s=a.queue,c=Hl.bind(null,ei,s);return s.dispatch=c,[a.memoizedState,c]},useDebugValue:Gi,useDeferredValue:function(a,s){var c=Jn();return Ii(c,a,s)},useTransition:function(){var a=C(!1);return a=Yi.bind(null,ei,a.queue,!0,!1),Jn().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,s,c){var g=ei,w=Jn();if(oi){if(c===void 0)throw Error(Q(407));c=c()}else{if(c=s(),rn===null)throw Error(Q(349));(pi&127)!==0||d(g,s,c)}w.memoizedState=c;var M={value:c,getSnapshot:s};return w.queue=M,ze(v.bind(null,g,M,a),[a]),g.flags|=2048,ne(9,{destroy:void 0},_.bind(null,g,M,c,s),null),c},useId:function(){var a=Jn(),s=rn.identifierPrefix;if(oi){var c=Ta,g=ns;c=(g&~(1<<32-ue(g)-1)).toString(32)+c,s="_"+s+"R_"+c,c=Yo++,0<c&&(s+="H"+c.toString(32)),s+="_"}else c=Ch++,s="_"+s+"r_"+c.toString(32)+"_";return a.memoizedState=s},useHostTransitionStatus:gs,useFormState:te,useActionState:te,useOptimistic:function(a){var s=Jn();s.memoizedState=s.baseState=a;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=Ca.bind(null,ei,!0,c),c.dispatch=s,[a,s]},useMemoCache:Zl,useCacheRefresh:function(){return Jn().memoizedState=Aa.bind(null,ei)},useEffectEvent:function(a){var s=Jn(),c={impl:a};return s.memoizedState=c,function(){if((Fi&2)!==0)throw Error(Q(440));return c.impl.apply(void 0,arguments)}}},Cn={readContext:An,use:Qo,useCallback:Oi,useContext:An,useEffect:De,useImperativeHandle:Ti,useInsertionEffect:qe,useLayoutEffect:rt,useMemo:Xi,useReducer:m,useRef:_e,useState:function(){return m(kr)},useDebugValue:Gi,useDeferredValue:function(a,s){var c=an();return un(c,wi.memoizedState,a,s)},useTransition:function(){var a=m(kr)[0],s=an().memoizedState;return[typeof a=="boolean"?a:Ko(a),s]},useSyncExternalStore:l,useId:_s,useHostTransitionStatus:gs,useFormState:oe,useActionState:oe,useOptimistic:function(a,s){var c=an();return z(c,wi,a,s)},useMemoCache:Zl,useCacheRefresh:Or};Cn.useEffectEvent=tt;var Pn={readContext:An,use:Qo,useCallback:Oi,useContext:An,useEffect:De,useImperativeHandle:Ti,useInsertionEffect:qe,useLayoutEffect:rt,useMemo:Xi,useReducer:r,useRef:_e,useState:function(){return r(kr)},useDebugValue:Gi,useDeferredValue:function(a,s){var c=an();return wi===null?Ii(c,a,s):un(c,wi.memoizedState,a,s)},useTransition:function(){var a=r(kr)[0],s=an().memoizedState;return[typeof a=="boolean"?a:Ko(a),s]},useSyncExternalStore:l,useId:_s,useHostTransitionStatus:gs,useFormState:ce,useActionState:ce,useOptimistic:function(a,s){var c=an();return wi!==null?z(c,wi,a,s):(c.baseState=a,[a,c.queue.dispatch])},useMemoCache:Zl,useCacheRefresh:Or};Pn.useEffectEvent=tt;function jc(a,s,c,g){s=a.memoizedState,c=c(g,s),c=c==null?s:Ye({},s,c),a.memoizedState=c,a.lanes===0&&(a.updateQueue.baseState=c)}var Nc={enqueueSetState:function(a,s,c){a=a._reactInternals;var g=br(),w=ps(g);w.payload=s,c!=null&&(w.callback=c),s=Ls(a,w,g),s!==null&&(wr(s,a,g),fr(s,a,g))},enqueueReplaceState:function(a,s,c){a=a._reactInternals;var g=br(),w=ps(g);w.tag=1,w.payload=s,c!=null&&(w.callback=c),s=Ls(a,w,g),s!==null&&(wr(s,a,g),fr(s,a,g))},enqueueForceUpdate:function(a,s){a=a._reactInternals;var c=br(),g=ps(c);g.tag=2,s!=null&&(g.callback=s),s=Ls(a,g,c),s!==null&&(wr(s,a,c),fr(s,a,c))}};function go(a,s,c,g,w,M,k){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(g,M,k):s.prototype&&s.prototype.isPureReactComponent?!ro(c,g)||!ro(w,M):!0}function Bd(a,s,c,g){a=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,g),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,g),s.state!==a&&Nc.enqueueReplaceState(s,s.state,null)}function _o(a,s){var c=s;if("ref"in s){c={};for(var g in s)g!=="ref"&&(c[g]=s[g])}if(a=a.defaultProps){c===s&&(c=Ye({},c));for(var w in a)c[w]===void 0&&(c[w]=a[w])}return c}function Vc(a){ts(a)}function js(a){console.error(a)}function Ns(a){ts(a)}function Fr(a,s){try{var c=a.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(g){setTimeout(function(){throw g})}}function Uc(a,s,c){try{var g=a.onCaughtError;g(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(w){setTimeout(function(){throw w})}}function $u(a,s,c){return c=ps(c),c.tag=3,c.payload={element:null},c.callback=function(){Fr(a,s)},c}function Xu(a){return a=ps(a),a.tag=3,a}function Yu(a,s,c,g){var w=c.type.getDerivedStateFromError;if(typeof w=="function"){var M=g.value;a.payload=function(){return w(M)},a.callback=function(){Uc(s,c,g)}}var k=c.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(a.callback=function(){Uc(s,c,g),typeof w!="function"&&(ol===null?ol=new Set([this]):ol.add(this));var H=g.stack;this.componentDidCatch(g.value,{componentStack:H!==null?H:""})})}function Fd(a,s,c,g,w){if(c.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(s=c.alternate,s!==null&&Za(s,c,w,!0),c=ct.current,c!==null){switch(c.tag){case 31:case 13:return yt===null?$h():c.alternate===null&&zn===0&&(zn=3),c.flags&=-257,c.flags|=65536,c.lanes=w,g===ut?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([g]):s.add(g),cf(a,g,w)),!1;case 22:return c.flags|=65536,g===ut?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([g])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([g]):c.add(g)),cf(a,g,w)),!1}throw Error(Q(435,c.tag))}return cf(a,g,w),$h(),!1}if(oi)return s=ct.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=w,g!==on&&(a=Error(Q(422),{cause:g}),Ds(_a(a,c)))):(g!==on&&(s=Error(Q(423),{cause:g}),Ds(_a(s,c))),a=a.current.alternate,a.flags|=65536,w&=-w,a.lanes|=w,g=_a(g,c),w=$u(a.stateNode,g,w),Ai(a,w),zn!==4&&(zn=2)),!1;var M=Error(Q(520),{cause:g});if(M=_a(M,c),Gh===null?Gh=[M]:Gh.push(M),zn!==4&&(zn=2),s===null)return!0;g=_a(g,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,a=w&-w,c.lanes|=a,a=$u(c.stateNode,g,a),Ai(c,a),!1;case 1:if(s=c.type,M=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(ol===null||!ol.has(M))))return c.flags|=65536,w&=-w,c.lanes|=w,w=Xu(w),Yu(w,a,c,g),Ai(c,w),!1}c=c.return}while(c!==null);return!1}var jd=Error(Q(461)),Zn=!1;function ea(a,s,c,g){s.child=a===null?Mh(s,null,c,g):ds(s,a.child,c,g)}function $p(a,s,c,g,w){c=c.render;var M=s.ref;if("ref"in g){var k={};for(var H in g)H!=="ref"&&(k[H]=g[H])}else k=g;return Rs(s),g=Gl(a,s,c,k,M,w),H=Hu(),a!==null&&!Zn?(mo(a,s,w),vo(a,s,w)):(oi&&H&&qo(s),s.flags|=1,ea(a,s,g,w),s.child)}function Nd(a,s,c,g,w){if(a===null){var M=c.type;return typeof M=="function"&&!Ec(M)&&M.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=M,Yf(a,s,M,g,w)):(a=Ac(c.type,null,g,s,s.mode,w),a.ref=s.ref,a.return=s,s.child=a)}if(M=a.child,!Ih(a,w)){var k=M.memoizedProps;if(c=c.compare,c=c!==null?c:ro,c(k,g)&&a.ref===s.ref)return vo(a,s,w)}return s.flags|=1,a=Ga(M,g),a.ref=s.ref,a.return=s,s.child=a}function Yf(a,s,c,g,w){if(a!==null){var M=a.memoizedProps;if(ro(M,g)&&a.ref===s.ref)if(Zn=!1,s.pendingProps=g=M,Ih(a,w))(a.flags&131072)!==0&&(Zn=!0);else return s.lanes=a.lanes,vo(a,s,w)}return Kf(a,s,c,g,w)}function Wf(a,s,c,g){var w=g.children,M=a!==null?a.memoizedState:null;if(a===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.mode==="hidden"){if((s.flags&128)!==0){if(M=M!==null?M.baseLanes|c:c,a!==null){for(g=s.child=a.child,w=0;g!==null;)w=w|g.lanes|g.childLanes,g=g.sibling;g=w&~M}else g=0,s.child=null;return Xp(a,s,M,c,g)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},a!==null&&Rc(s,M!==null?M.cachePool:null),M!==null?Ah(s,M):$a(),Uu(s);else return g=s.lanes=536870912,Xp(a,s,M!==null?M.baseLanes|c:c,c,g)}else M!==null?(Rc(s,M.cachePool),Ah(s,M),Tn(),s.memoizedState=null):(a!==null&&Rc(s,null),$a(),Tn());return ea(a,s,w,c),s.child}function yo(a,s){return a!==null&&a.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Xp(a,s,c,g,w){var M=Pc();return M=M===null?null:{parent:wn._currentValue,pool:M},s.memoizedState={baseLanes:c,cachePool:M},a!==null&&Rc(s,null),$a(),Uu(s),a!==null&&Za(a,s,g,!0),s.childLanes=w,null}function el(a,s){return s=Zd({mode:s.mode,children:s.children},a.mode),s.ref=a.ref,a.child=s,s.return=a,s}function zh(a,s,c){return ds(s,a.child,null,c),a=el(s,s.pendingProps),a.flags|=2,ln(s),s.memoizedState=null,a}function Vd(a,s,c){var g=s.pendingProps,w=(s.flags&128)!==0;if(s.flags&=-129,a===null){if(oi){if(g.mode==="hidden")return a=el(s,g),s.lanes=536870912,yo(null,a);if(Ul(s),(a=ki)?(a=iu(a,qa),a=a!==null&&a.data==="&"?a:null,a!==null&&(s.memoizedState={dehydrated:a,treeContext:is!==null?{id:ns,overflow:Ta}:null,retryLane:536870912,hydrationErrors:null},c=Cc(a),c.return=s,s.child=c,Un=s,ki=null)):a=null,a===null)throw Sa(s);return s.lanes=536870912,null}return el(s,g)}var M=a.memoizedState;if(M!==null){var k=M.dehydrated;if(Ul(s),w)if(s.flags&256)s.flags&=-257,s=zh(a,s,c);else if(s.memoizedState!==null)s.child=a.child,s.flags|=128,s=null;else throw Error(Q(558));else if(Zn||Za(a,s,c,!1),w=(c&a.childLanes)!==0,Zn||w){if(g=rn,g!==null&&(k=Qn(g,c),k!==0&&k!==M.retryLane))throw M.retryLane=k,cr(a,k),wr(g,a,k),jd;$h(),s=zh(a,s,c)}else a=M.treeContext,ki=Vr(k.nextSibling),Un=s,oi=!0,zs=null,qa=!1,a!==null&&wh(s,a),s=el(s,g),s.flags|=4096;return s}return a=Ga(a.child,{mode:g.mode,children:g.children}),a.ref=s.ref,s.child=a,a.return=s,a}function Ud(a,s){var c=s.ref;if(c===null)a!==null&&a.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(Q(284));(a===null||a.ref!==c)&&(s.flags|=4194816)}}function Kf(a,s,c,g,w){return Rs(s),c=Gl(a,s,c,g,void 0,w),g=Hu(),a!==null&&!Zn?(mo(a,s,w),vo(a,s,w)):(oi&&g&&qo(s),s.flags|=1,ea(a,s,c,w),s.child)}function Yp(a,s,c,g,w,M){return Rs(s),s.updateQueue=null,c=qu(s,g,c,w),ql(a),g=Hu(),a!==null&&!Zn?(mo(a,s,M),vo(a,s,M)):(oi&&g&&qo(s),s.flags|=1,ea(a,s,c,M),s.child)}function Wp(a,s,c,g,w){if(Rs(s),s.stateNode===null){var M=Xt,k=c.contextType;typeof k=="object"&&k!==null&&(M=An(k)),M=new c(g,M),s.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,M.updater=Nc,s.stateNode=M,M._reactInternals=s,M=s.stateNode,M.props=g,M.state=s.memoizedState,M.refs={},Bc(s),k=c.contextType,M.context=typeof k=="object"&&k!==null?An(k):Xt,M.state=s.memoizedState,k=c.getDerivedStateFromProps,typeof k=="function"&&(jc(s,c,k,g),M.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(k=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),k!==M.state&&Nc.enqueueReplaceState(M,M.state,null),po(s,g,M,w),ks(),M.state=s.memoizedState),typeof M.componentDidMount=="function"&&(s.flags|=4194308),g=!0}else if(a===null){M=s.stateNode;var H=s.memoizedProps,fe=_o(c,H);M.props=fe;var Re=M.context,Ge=c.contextType;k=Xt,typeof Ge=="object"&&Ge!==null&&(k=An(Ge));var Ke=c.getDerivedStateFromProps;Ge=typeof Ke=="function"||typeof M.getSnapshotBeforeUpdate=="function",H=s.pendingProps!==H,Ge||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(H||Re!==k)&&Bd(s,M,g,k),fs=!1;var Le=s.memoizedState;M.state=Le,po(s,g,M,w),ks(),Re=s.memoizedState,H||Le!==Re||fs?(typeof Ke=="function"&&(jc(s,c,Ke,g),Re=s.memoizedState),(fe=fs||go(s,c,fe,g,Le,Re,k))?(Ge||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(s.flags|=4194308)):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=g,s.memoizedState=Re),M.props=g,M.state=Re,M.context=k,g=fe):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),g=!1)}else{M=s.stateNode,ju(a,s),k=s.memoizedProps,Ge=_o(c,k),M.props=Ge,Ke=s.pendingProps,Le=M.context,Re=c.contextType,fe=Xt,typeof Re=="object"&&Re!==null&&(fe=An(Re)),H=c.getDerivedStateFromProps,(Re=typeof H=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(k!==Ke||Le!==fe)&&Bd(s,M,g,fe),fs=!1,Le=s.memoizedState,M.state=Le,po(s,g,M,w),ks();var je=s.memoizedState;k!==Ke||Le!==je||fs||a!==null&&a.dependencies!==null&&Fl(a.dependencies)?(typeof H=="function"&&(jc(s,c,H,g),je=s.memoizedState),(Ge=fs||go(s,c,Ge,g,Le,je,fe)||a!==null&&a.dependencies!==null&&Fl(a.dependencies))?(Re||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(g,je,fe),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(g,je,fe)),typeof M.componentDidUpdate=="function"&&(s.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof M.componentDidUpdate!="function"||k===a.memoizedProps&&Le===a.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||k===a.memoizedProps&&Le===a.memoizedState||(s.flags|=1024),s.memoizedProps=g,s.memoizedState=je),M.props=g,M.state=je,M.context=fe,g=Ge):(typeof M.componentDidUpdate!="function"||k===a.memoizedProps&&Le===a.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||k===a.memoizedProps&&Le===a.memoizedState||(s.flags|=1024),g=!1)}return M=g,Ud(a,s),g=(s.flags&128)!==0,M||g?(M=s.stateNode,c=g&&typeof c.getDerivedStateFromError!="function"?null:M.render(),s.flags|=1,a!==null&&g?(s.child=ds(s,a.child,null,w),s.child=ds(s,null,c,w)):ea(a,s,c,w),s.memoizedState=M.state,a=s.child):a=vo(a,s,w),a}function Kp(a,s,c,g){return rs(),s.flags|=256,ea(a,s,c,g),s.child}var Gd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Dh(a){return{baseLanes:a,cachePool:Od()}}function qd(a,s,c){return a=a!==null?a.childLanes&~c:0,s&&(a|=ya),a}function Qf(a,s,c){var g=s.pendingProps,w=!1,M=(s.flags&128)!==0,k;if((k=M)||(k=a!==null&&a.memoizedState===null?!1:(mn.current&2)!==0),k&&(w=!0,s.flags&=-129),k=(s.flags&32)!==0,s.flags&=-33,a===null){if(oi){if(w?pr(s):Tn(),(a=ki)?(a=iu(a,qa),a=a!==null&&a.data!=="&"?a:null,a!==null&&(s.memoizedState={dehydrated:a,treeContext:is!==null?{id:ns,overflow:Ta}:null,retryLane:536870912,hydrationErrors:null},c=Cc(a),c.return=s,s.child=c,Un=s,ki=null)):a=null,a===null)throw Sa(s);return cn(a)?s.lanes=32:s.lanes=536870912,null}var H=g.children;return g=g.fallback,w?(Tn(),w=s.mode,H=Zd({mode:"hidden",children:H},w),g=oo(g,w,c,null),H.return=s,g.return=s,H.sibling=g,s.child=H,g=s.child,g.memoizedState=Dh(c),g.childLanes=qd(a,k,c),s.memoizedState=Gd,yo(null,g)):(pr(s),Jf(s,H))}var fe=a.memoizedState;if(fe!==null&&(H=fe.dehydrated,H!==null)){if(M)s.flags&256?(pr(s),s.flags&=-257,s=Hd(a,s,c)):s.memoizedState!==null?(Tn(),s.child=a.child,s.flags|=128,s=null):(Tn(),H=g.fallback,w=s.mode,g=Zd({mode:"visible",children:g.children},w),H=oo(H,w,c,null),H.flags|=2,g.return=s,H.return=s,g.sibling=H,s.child=g,ds(s,a.child,null,c),g=s.child,g.memoizedState=Dh(c),g.childLanes=qd(a,k,c),s.memoizedState=Gd,s=yo(null,g));else if(pr(s),cn(H)){if(k=H.nextSibling&&H.nextSibling.dataset,k)var Re=k.dgst;k=Re,g=Error(Q(419)),g.stack="",g.digest=k,Ds({value:g,source:null,stack:null}),s=Hd(a,s,c)}else if(Zn||Za(a,s,c,!1),k=(c&a.childLanes)!==0,Zn||k){if(k=rn,k!==null&&(g=Qn(k,c),g!==0&&g!==fe.retryLane))throw fe.retryLane=g,cr(a,g),wr(k,a,g),jd;Da(H)||$h(),s=Hd(a,s,c)}else Da(H)?(s.flags|=192,s.child=a.child,s=null):(a=fe.treeContext,ki=Vr(H.nextSibling),Un=s,oi=!0,zs=null,qa=!1,a!==null&&wh(s,a),s=Jf(s,g.children),s.flags|=4096);return s}return w?(Tn(),H=g.fallback,w=s.mode,fe=a.child,Re=fe.sibling,g=Ga(fe,{mode:"hidden",children:g.children}),g.subtreeFlags=fe.subtreeFlags&65011712,Re!==null?H=Ga(Re,H):(H=oo(H,w,c,null),H.flags|=2),H.return=s,g.return=s,g.sibling=H,s.child=g,yo(null,g),g=s.child,H=a.child.memoizedState,H===null?H=Dh(c):(w=H.cachePool,w!==null?(fe=wn._currentValue,w=w.parent!==fe?{parent:fe,pool:fe}:w):w=Od(),H={baseLanes:H.baseLanes|c,cachePool:w}),g.memoizedState=H,g.childLanes=qd(a,k,c),s.memoizedState=Gd,yo(a.child,g)):(pr(s),c=a.child,a=c.sibling,c=Ga(c,{mode:"visible",children:g.children}),c.return=s,c.sibling=null,a!==null&&(k=s.deletions,k===null?(s.deletions=[a],s.flags|=16):k.push(a)),s.child=c,s.memoizedState=null,c)}function Jf(a,s){return s=Zd({mode:"visible",children:s},a.mode),s.return=a,a.child=s}function Zd(a,s){return a=Ua(22,a,null,s),a.lanes=0,a}function Hd(a,s,c){return ds(s,a.child,null,c),a=Jf(s,s.pendingProps.children),a.flags|=2,s.memoizedState=null,a}function ep(a,s,c){a.lanes|=s;var g=a.alternate;g!==null&&(g.lanes|=s),zc(a.return,s,c)}function tp(a,s,c,g,w,M){var k=a.memoizedState;k===null?a.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:g,tail:c,tailMode:w,treeForkCount:M}:(k.isBackwards=s,k.rendering=null,k.renderingStartTime=0,k.last=g,k.tail=c,k.tailMode=w,k.treeForkCount=M)}function $d(a,s,c){var g=s.pendingProps,w=g.revealOrder,M=g.tail;g=g.children;var k=mn.current,H=(k&2)!==0;if(H?(k=k&1|2,s.flags|=128):k&=1,lt(mn,k),ea(a,s,g,c),g=oi?ho:0,!H&&a!==null&&(a.flags&128)!==0)e:for(a=s.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&ep(a,c,s);else if(a.tag===19)ep(a,c,s);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(w){case"forwards":for(c=s.child,w=null;c!==null;)a=c.alternate,a!==null&&Gu(a)===null&&(w=c),c=c.sibling;c=w,c===null?(w=s.child,s.child=null):(w=c.sibling,c.sibling=null),tp(s,!1,w,c,M,g);break;case"backwards":case"unstable_legacy-backwards":for(c=null,w=s.child,s.child=null;w!==null;){if(a=w.alternate,a!==null&&Gu(a)===null){s.child=w;break}a=w.sibling,w.sibling=c,c=w,w=a}tp(s,!0,c,null,M,g);break;case"together":tp(s,!1,null,null,void 0,g);break;default:s.memoizedState=null}return s.child}function vo(a,s,c){if(a!==null&&(s.dependencies=a.dependencies),sl|=s.lanes,(c&s.childLanes)===0)if(a!==null){if(Za(a,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(a!==null&&s.child!==a.child)throw Error(Q(153));if(s.child!==null){for(a=s.child,c=Ga(a,a.pendingProps),s.child=c,c.return=s;a.sibling!==null;)a=a.sibling,c=c.sibling=Ga(a,a.pendingProps),c.return=s;c.sibling=null}return s.child}function Ih(a,s){return(a.lanes&s)!==0?!0:(a=a.dependencies,!!(a!==null&&Fl(a)))}function Ph(a,s,c){switch(s.tag){case 3:Ui(s,s.stateNode.containerInfo),Ps(s,wn,a.memoizedState.cache),rs();break;case 27:case 5:Mr(s);break;case 4:Ui(s,s.stateNode.containerInfo);break;case 10:Ps(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,Ul(s),null;break;case 13:var g=s.memoizedState;if(g!==null)return g.dehydrated!==null?(pr(s),s.flags|=128,null):(c&s.child.childLanes)!==0?Qf(a,s,c):(pr(s),a=vo(a,s,c),a!==null?a.sibling:null);pr(s);break;case 19:var w=(a.flags&128)!==0;if(g=(c&s.childLanes)!==0,g||(Za(a,s,c,!1),g=(c&s.childLanes)!==0),w){if(g)return $d(a,s,c);s.flags|=128}if(w=s.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),lt(mn,mn.current),g)break;return null;case 22:return s.lanes=0,Wf(a,s,c,s.pendingProps);case 24:Ps(s,wn,a.memoizedState.cache)}return vo(a,s,c)}function za(a,s,c){if(a!==null)if(a.memoizedProps!==s.pendingProps)Zn=!0;else{if(!Ih(a,c)&&(s.flags&128)===0)return Zn=!1,Ph(a,s,c);Zn=(a.flags&131072)!==0}else Zn=!1,oi&&(s.flags&1048576)!==0&&bh(s,ho,s.index);switch(s.lanes=0,s.tag){case 16:e:{var g=s.pendingProps;if(a=dr(s.elementType),s.type=a,typeof a=="function")Ec(a)?(g=_o(a,g),s.tag=1,s=Wp(null,s,a,g,c)):(s.tag=0,s=Kf(null,s,a,g,c));else{if(a!=null){var w=a.$$typeof;if(w===si){s.tag=11,s=$p(null,s,a,g,c);break e}else if(w===Pt){s.tag=14,s=Nd(null,s,a,g,c);break e}}throw s=ni(a)||a,Error(Q(306,s,""))}}return s;case 0:return Kf(a,s,s.type,s.pendingProps,c);case 1:return g=s.type,w=_o(g,s.pendingProps),Wp(a,s,g,w,c);case 3:e:{if(Ui(s,s.stateNode.containerInfo),a===null)throw Error(Q(387));g=s.pendingProps;var M=s.memoizedState;w=M.element,ju(a,s),po(s,g,null,c);var k=s.memoizedState;if(g=k.cache,Ps(s,wn,g),g!==M.cache&&Dc(s,[wn],c,!0),ks(),g=k.element,M.isDehydrated)if(M={element:g,isDehydrated:!1,cache:k.cache},s.updateQueue.baseState=M,s.memoizedState=M,s.flags&256){s=Kp(a,s,g,c);break e}else if(g!==w){w=_a(Error(Q(424)),s),Ds(w),s=Kp(a,s,g,c);break e}else for(a=s.stateNode.containerInfo,a.nodeType===9?a=a.body:a=a.nodeName==="HTML"?a.ownerDocument.body:a,ki=Vr(a.firstChild),Un=s,oi=!0,zs=null,qa=!0,c=Mh(s,null,g,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(rs(),g===w){s=vo(a,s,c);break e}ea(a,s,g,c)}s=s.child}return s;case 26:return Ud(a,s),a===null?(c=Rp(s.type,null,s.pendingProps,null))?s.memoizedState=c:oi||(c=s.type,a=s.pendingProps,g=Jh(Ot.current).createElement(c),g[Ei]=s,g[Je]=a,ia(g,c,a),dn(g),s.stateNode=g):s.memoizedState=Rp(s.type,a.memoizedProps,s.pendingProps,a.memoizedState),null;case 27:return Mr(s),a===null&&oi&&(g=s.stateNode=Im(s.type,s.pendingProps,Ot.current),Un=s,qa=!0,w=ki,tu(s.type)?(Ja=w,ki=Vr(g.firstChild)):ki=w),ea(a,s,s.pendingProps.children,c),Ud(a,s),a===null&&(s.flags|=4194304),s.child;case 5:return a===null&&oi&&((w=g=ki)&&(g=sa(g,s.type,s.pendingProps,qa),g!==null?(s.stateNode=g,Un=s,ki=Vr(g.firstChild),qa=!1,w=!0):w=!1),w||Sa(s)),Mr(s),w=s.type,M=s.pendingProps,k=a!==null?a.memoizedProps:null,g=M.children,bf(w,M)?g=null:k!==null&&bf(w,k)&&(s.flags|=32),s.memoizedState!==null&&(w=Gl(a,s,Zu,null,null,c),ld._currentValue=w),Ud(a,s),ea(a,s,g,c),s.child;case 6:return a===null&&oi&&((a=c=ki)&&(c=qs(c,s.pendingProps,qa),c!==null?(s.stateNode=c,Un=s,ki=null,a=!0):a=!1),a||Sa(s)),null;case 13:return Qf(a,s,c);case 4:return Ui(s,s.stateNode.containerInfo),g=s.pendingProps,a===null?s.child=ds(s,null,g,c):ea(a,s,g,c),s.child;case 11:return $p(a,s,s.type,s.pendingProps,c);case 7:return ea(a,s,s.pendingProps,c),s.child;case 8:return ea(a,s,s.pendingProps.children,c),s.child;case 12:return ea(a,s,s.pendingProps.children,c),s.child;case 10:return g=s.pendingProps,Ps(s,s.type,g.value),ea(a,s,g.children,c),s.child;case 9:return w=s.type._context,g=s.pendingProps.children,Rs(s),w=An(w),g=g(w),s.flags|=1,ea(a,s,g,c),s.child;case 14:return Nd(a,s,s.type,s.pendingProps,c);case 15:return Yf(a,s,s.type,s.pendingProps,c);case 19:return $d(a,s,c);case 31:return Vd(a,s,c);case 22:return Wf(a,s,c,s.pendingProps);case 24:return Rs(s),g=An(wn),a===null?(w=Pc(),w===null&&(w=rn,M=us(),w.pooledCache=M,M.refCount++,M!==null&&(w.pooledCacheLanes|=c),w=M),s.memoizedState={parent:g,cache:w},Bc(s),Ps(s,wn,w)):((a.lanes&c)!==0&&(ju(a,s),po(s,null,null,c),ks()),w=a.memoizedState,M=s.memoizedState,w.parent!==g?(w={parent:g,cache:g},s.memoizedState=w,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=w),Ps(s,wn,g)):(g=M.cache,Ps(s,wn,g),g!==w.cache&&Dc(s,[wn],c,!0))),ea(a,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(Q(156,s.tag))}function xo(a){a.flags|=4}function Rh(a,s,c,g,w){if((s=(a.mode&32)!==0)&&(s=!1),s){if(a.flags|=16777216,(w&335544128)===w)if(a.stateNode.complete)a.flags|=8192;else if(fp())a.flags|=8192;else throw Pr=ut,fo}else a.flags&=-16777217}function Qp(a,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!If(s))if(fp())a.flags|=8192;else throw Pr=ut,fo}function Lh(a,s){s!==null&&(a.flags|=4),a.flags&16384&&(s=a.tag!==22?zt():536870912,a.lanes|=s,ec|=s)}function kh(a,s){if(!oi)switch(a.tailMode){case"hidden":s=a.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?a.tail=null:c.sibling=null;break;case"collapsed":c=a.tail;for(var g=null;c!==null;)c.alternate!==null&&(g=c),c=c.sibling;g===null?s||a.tail===null?a.tail=null:a.tail.sibling=null:g.sibling=null}}function yn(a){var s=a.alternate!==null&&a.alternate.child===a.child,c=0,g=0;if(s)for(var w=a.child;w!==null;)c|=w.lanes|w.childLanes,g|=w.subtreeFlags&65011712,g|=w.flags&65011712,w.return=a,w=w.sibling;else for(w=a.child;w!==null;)c|=w.lanes|w.childLanes,g|=w.subtreeFlags,g|=w.flags,w.return=a,w=w.sibling;return a.subtreeFlags|=g,a.childLanes=c,s}function Jp(a,s,c){var g=s.pendingProps;switch(Bl(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yn(s),null;case 1:return yn(s),null;case 3:return c=s.stateNode,g=null,a!==null&&(g=a.memoizedState.cache),s.memoizedState.cache!==g&&(s.flags|=2048),ls(wn),Hi(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(a===null||a.child===null)&&(as(s)?xo(s):a===null||a.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,ss())),yn(s),null;case 26:var w=s.type,M=s.memoizedState;return a===null?(xo(s),M!==null?(yn(s),Qp(s,M)):(yn(s),Rh(s,w,null,g,c))):M?M!==a.memoizedState?(xo(s),yn(s),Qp(s,M)):(yn(s),s.flags&=-16777217):(a=a.memoizedProps,a!==g&&xo(s),yn(s),Rh(s,w,a,g,c)),null;case 27:if(qr(s),c=Ot.current,w=s.type,a!==null&&s.stateNode!=null)a.memoizedProps!==g&&xo(s);else{if(!g){if(s.stateNode===null)throw Error(Q(166));return yn(s),null}a=dt.current,as(s)?Ma(s):(a=Im(w,g,c),s.stateNode=a,xo(s))}return yn(s),null;case 5:if(qr(s),w=s.type,a!==null&&s.stateNode!=null)a.memoizedProps!==g&&xo(s);else{if(!g){if(s.stateNode===null)throw Error(Q(166));return yn(s),null}if(M=dt.current,as(s))Ma(s);else{var k=Jh(Ot.current);switch(M){case 1:M=k.createElementNS("http://www.w3.org/2000/svg",w);break;case 2:M=k.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;default:switch(w){case"svg":M=k.createElementNS("http://www.w3.org/2000/svg",w);break;case"math":M=k.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;case"script":M=k.createElement("div"),M.innerHTML="<script><\/script>",M=M.removeChild(M.firstChild);break;case"select":M=typeof g.is=="string"?k.createElement("select",{is:g.is}):k.createElement("select"),g.multiple?M.multiple=!0:g.size&&(M.size=g.size);break;default:M=typeof g.is=="string"?k.createElement(w,{is:g.is}):k.createElement(w)}}M[Ei]=s,M[Je]=g;e:for(k=s.child;k!==null;){if(k.tag===5||k.tag===6)M.appendChild(k.stateNode);else if(k.tag!==4&&k.tag!==27&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===s)break e;for(;k.sibling===null;){if(k.return===null||k.return===s)break e;k=k.return}k.sibling.return=k.return,k=k.sibling}s.stateNode=M;e:switch(ia(M,w,g),w){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}g&&xo(s)}}return yn(s),Rh(s,s.type,a===null?null:a.memoizedProps,s.pendingProps,c),null;case 6:if(a&&s.stateNode!=null)a.memoizedProps!==g&&xo(s);else{if(typeof g!="string"&&s.stateNode===null)throw Error(Q(166));if(a=Ot.current,as(s)){if(a=s.stateNode,c=s.memoizedProps,g=null,w=Un,w!==null)switch(w.tag){case 27:case 5:g=w.memoizedProps}a[Ei]=s,a=!!(a.nodeValue===c||g!==null&&g.suppressHydrationWarning===!0||Mp(a.nodeValue,c)),a||Sa(s,!0)}else a=Jh(a).createTextNode(g),a[Ei]=s,s.stateNode=a}return yn(s),null;case 31:if(c=s.memoizedState,a===null||a.memoizedState!==null){if(g=as(s),c!==null){if(a===null){if(!g)throw Error(Q(318));if(a=s.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Q(557));a[Ei]=s}else rs(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;yn(s),a=!1}else c=ss(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=c),a=!0;if(!a)return s.flags&256?(ln(s),s):(ln(s),null);if((s.flags&128)!==0)throw Error(Q(558))}return yn(s),null;case 13:if(g=s.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(w=as(s),g!==null&&g.dehydrated!==null){if(a===null){if(!w)throw Error(Q(318));if(w=s.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(Q(317));w[Ei]=s}else rs(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;yn(s),w=!1}else w=ss(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=w),w=!0;if(!w)return s.flags&256?(ln(s),s):(ln(s),null)}return ln(s),(s.flags&128)!==0?(s.lanes=c,s):(c=g!==null,a=a!==null&&a.memoizedState!==null,c&&(g=s.child,w=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(w=g.alternate.memoizedState.cachePool.pool),M=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(M=g.memoizedState.cachePool.pool),M!==w&&(g.flags|=2048)),c!==a&&c&&(s.child.flags|=8192),Lh(s,s.updateQueue),yn(s),null);case 4:return Hi(),a===null&&Tp(s.stateNode.containerInfo),yn(s),null;case 10:return ls(s.type),yn(s),null;case 19:if(Ze(mn),g=s.memoizedState,g===null)return yn(s),null;if(w=(s.flags&128)!==0,M=g.rendering,M===null)if(w)kh(g,!1);else{if(zn!==0||a!==null&&(a.flags&128)!==0)for(a=s.child;a!==null;){if(M=Gu(a),M!==null){for(s.flags|=128,kh(g,!1),a=M.updateQueue,s.updateQueue=a,Lh(s,a),s.subtreeFlags=0,a=c,c=s.child;c!==null;)Ld(c,a),c=c.sibling;return lt(mn,mn.current&1|2),oi&&Cs(s,g.treeForkCount),s.child}a=a.sibling}g.tail!==null&&Ln()>qh&&(s.flags|=128,w=!0,kh(g,!1),s.lanes=4194304)}else{if(!w)if(a=Gu(M),a!==null){if(s.flags|=128,w=!0,a=a.updateQueue,s.updateQueue=a,Lh(s,a),kh(g,!0),g.tail===null&&g.tailMode==="hidden"&&!M.alternate&&!oi)return yn(s),null}else 2*Ln()-g.renderingStartTime>qh&&c!==536870912&&(s.flags|=128,w=!0,kh(g,!1),s.lanes=4194304);g.isBackwards?(M.sibling=s.child,s.child=M):(a=g.last,a!==null?a.sibling=M:s.child=M,g.last=M)}return g.tail!==null?(a=g.tail,g.rendering=a,g.tail=a.sibling,g.renderingStartTime=Ln(),a.sibling=null,c=mn.current,lt(mn,w?c&1|2:c&1),oi&&Cs(s,g.treeForkCount),a):(yn(s),null);case 22:case 23:return ln(s),Xo(),g=s.memoizedState!==null,a!==null?a.memoizedState!==null!==g&&(s.flags|=8192):g&&(s.flags|=8192),g?(c&536870912)!==0&&(s.flags&128)===0&&(yn(s),s.subtreeFlags&6&&(s.flags|=8192)):yn(s),c=s.updateQueue,c!==null&&Lh(s,c.retryQueue),c=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(c=a.memoizedState.cachePool.pool),g=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(g=s.memoizedState.cachePool.pool),g!==c&&(s.flags|=2048),a!==null&&Ze(Dr),null;case 24:return c=null,a!==null&&(c=a.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),ls(wn),yn(s),null;case 25:return null;case 30:return null}throw Error(Q(156,s.tag))}function Qm(a,s){switch(Bl(s),s.tag){case 1:return a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 3:return ls(wn),Hi(),a=s.flags,(a&65536)!==0&&(a&128)===0?(s.flags=a&-65537|128,s):null;case 26:case 27:case 5:return qr(s),null;case 31:if(s.memoizedState!==null){if(ln(s),s.alternate===null)throw Error(Q(340));rs()}return a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 13:if(ln(s),a=s.memoizedState,a!==null&&a.dehydrated!==null){if(s.alternate===null)throw Error(Q(340));rs()}return a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 19:return Ze(mn),null;case 4:return Hi(),null;case 10:return ls(s.type),null;case 22:case 23:return ln(s),Xo(),a!==null&&Ze(Dr),a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 24:return ls(wn),null;case 25:return null;default:return null}}function Xd(a,s){switch(Bl(s),s.tag){case 3:ls(wn),Hi();break;case 26:case 27:case 5:qr(s);break;case 4:Hi();break;case 31:s.memoizedState!==null&&ln(s);break;case 13:ln(s);break;case 19:Ze(mn);break;case 10:ls(s.type);break;case 22:case 23:ln(s),Xo(),a!==null&&Ze(Dr);break;case 24:ls(wn)}}function Gc(a,s){try{var c=s.updateQueue,g=c!==null?c.lastEffect:null;if(g!==null){var w=g.next;c=w;do{if((c.tag&a)===a){g=void 0;var M=c.create,k=c.inst;g=M(),k.destroy=g}c=c.next}while(c!==w)}}catch(H){ji(s,s.return,H)}}function tl(a,s,c){try{var g=s.updateQueue,w=g!==null?g.lastEffect:null;if(w!==null){var M=w.next;g=M;do{if((g.tag&a)===a){var k=g.inst,H=k.destroy;if(H!==void 0){k.destroy=void 0,w=s;var fe=c,Re=H;try{Re()}catch(Ge){ji(w,fe,Ge)}}}g=g.next}while(g!==M)}}catch(Ge){ji(s,s.return,Ge)}}function em(a){var s=a.updateQueue;if(s!==null){var c=a.stateNode;try{Fc(s,c)}catch(g){ji(a,a.return,g)}}}function tm(a,s,c){c.props=_o(a.type,a.memoizedProps),c.state=a.memoizedState;try{c.componentWillUnmount()}catch(g){ji(a,s,g)}}function Oh(a,s){try{var c=a.ref;if(c!==null){switch(a.tag){case 26:case 27:case 5:var g=a.stateNode;break;case 30:g=a.stateNode;break;default:g=a.stateNode}typeof c=="function"?a.refCleanup=c(g):c.current=g}}catch(w){ji(a,s,w)}}function jr(a,s){var c=a.ref,g=a.refCleanup;if(c!==null)if(typeof g=="function")try{g()}catch(w){ji(a,s,w)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(w){ji(a,s,w)}else c.current=null}function Yd(a){var s=a.type,c=a.memoizedProps,g=a.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&g.focus();break e;case"img":c.src?g.src=c.src:c.srcSet&&(g.srcset=c.srcSet)}}catch(w){ji(a,a.return,w)}}function Wd(a,s,c){try{var g=a.stateNode;zm(g,a.type,c,s),g[Je]=s}catch(w){ji(a,a.return,w)}}function $l(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&tu(a.type)||a.tag===4}function Wu(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||$l(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&tu(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function ip(a,s,c){var g=a.tag;if(g===5||g===6)a=a.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(a,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(a),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=Cr));else if(g!==4&&(g===27&&tu(a.type)&&(c=a.stateNode,s=null),a=a.child,a!==null))for(ip(a,s,c),a=a.sibling;a!==null;)ip(a,s,c),a=a.sibling}function Kd(a,s,c){var g=a.tag;if(g===5||g===6)a=a.stateNode,s?c.insertBefore(a,s):c.appendChild(a);else if(g!==4&&(g===27&&tu(a.type)&&(c=a.stateNode),a=a.child,a!==null))for(Kd(a,s,c),a=a.sibling;a!==null;)Kd(a,s,c),a=a.sibling}function im(a){var s=a.stateNode,c=a.memoizedProps;try{for(var g=a.type,w=s.attributes;w.length;)s.removeAttributeNode(w[0]);ia(s,g,c),s[Ei]=a,s[Je]=c}catch(M){ji(a,a.return,M)}}var il=!1,Hn=!1,np=!1,nm=typeof WeakSet=="function"?WeakSet:Set,$n=null;function Jm(a,s){if(a=a.containerInfo,Qh=au,a=xc(a),Eu(a)){if("selectionStart"in a)var c={start:a.selectionStart,end:a.selectionEnd};else e:{c=(c=a.ownerDocument)&&c.defaultView||window;var g=c.getSelection&&c.getSelection();if(g&&g.rangeCount!==0){c=g.anchorNode;var w=g.anchorOffset,M=g.focusNode;g=g.focusOffset;try{c.nodeType,M.nodeType}catch{c=null;break e}var k=0,H=-1,fe=-1,Re=0,Ge=0,Ke=a,Le=null;t:for(;;){for(var je;Ke!==c||w!==0&&Ke.nodeType!==3||(H=k+w),Ke!==M||g!==0&&Ke.nodeType!==3||(fe=k+g),Ke.nodeType===3&&(k+=Ke.nodeValue.length),(je=Ke.firstChild)!==null;)Le=Ke,Ke=je;for(;;){if(Ke===a)break t;if(Le===c&&++Re===w&&(H=k),Le===M&&++Ge===g&&(fe=k),(je=Ke.nextSibling)!==null)break;Ke=Le,Le=Ke.parentNode}Ke=je}c=H===-1||fe===-1?null:{start:H,end:fe}}else c=null}c=c||{start:0,end:0}}else c=null;for(Ep={focusedElem:a,selectionRange:c},au=!1,$n=s;$n!==null;)if(s=$n,a=s.child,(s.subtreeFlags&1028)!==0&&a!==null)a.return=s,$n=a;else for(;$n!==null;){switch(s=$n,M=s.alternate,a=s.flags,s.tag){case 0:if((a&4)!==0&&(a=s.updateQueue,a=a!==null?a.events:null,a!==null))for(c=0;c<a.length;c++)w=a[c],w.ref.impl=w.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&M!==null){a=void 0,c=s,w=M.memoizedProps,M=M.memoizedState,g=c.stateNode;try{var wt=_o(c.type,w);a=g.getSnapshotBeforeUpdate(wt,M),g.__reactInternalSnapshotBeforeUpdate=a}catch(Ut){ji(c,c.return,Ut)}}break;case 3:if((a&1024)!==0){if(a=s.stateNode.containerInfo,c=a.nodeType,c===9)To(a);else if(c===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":To(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(Q(163))}if(a=s.sibling,a!==null){a.return=s.return,$n=a;break}$n=s.return}}function ap(a,s,c){var g=c.flags;switch(c.tag){case 0:case 11:case 15:vr(a,c),g&4&&Gc(5,c);break;case 1:if(vr(a,c),g&4)if(a=c.stateNode,s===null)try{a.componentDidMount()}catch(k){ji(c,c.return,k)}else{var w=_o(c.type,s.memoizedProps);s=s.memoizedState;try{a.componentDidUpdate(w,s,a.__reactInternalSnapshotBeforeUpdate)}catch(k){ji(c,c.return,k)}}g&64&&em(c),g&512&&Oh(c,c.return);break;case 3:if(vr(a,c),g&64&&(a=c.updateQueue,a!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{Fc(a,s)}catch(k){ji(c,c.return,k)}}break;case 27:s===null&&g&4&&im(c);case 26:case 5:vr(a,c),s===null&&g&4&&Yd(c),g&512&&Oh(c,c.return);break;case 12:vr(a,c);break;case 31:vr(a,c),g&4&&Bh(a,c);break;case 13:vr(a,c),g&4&&Fh(a,c),g&64&&(a=c.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(c=mp.bind(null,c),Yn(a,c))));break;case 22:if(g=c.memoizedState!==null||il,!g){s=s!==null&&s.memoizedState!==null||Hn,w=il;var M=Hn;il=g,(Hn=s)&&!M?nl(a,c,(c.subtreeFlags&8772)!==0):vr(a,c),il=w,Hn=M}break;case 30:break;default:vr(a,c)}}function qc(a){var s=a.alternate;s!==null&&(a.alternate=null,qc(s)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(s=a.stateNode,s!==null&&Co(s)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Sn=null,xi=!1;function yr(a,s,c){for(c=c.child;c!==null;)rp(a,s,c),c=c.sibling}function rp(a,s,c){if(U&&typeof U.onCommitFiberUnmount=="function")try{U.onCommitFiberUnmount(N,c)}catch{}switch(c.tag){case 26:Hn||jr(c,s),yr(a,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Hn||jr(c,s);var g=Sn,w=xi;tu(c.type)&&(Sn=c.stateNode,xi=!1),yr(a,s,c),ed(c.stateNode),Sn=g,xi=w;break;case 5:Hn||jr(c,s);case 6:if(g=Sn,w=xi,Sn=null,yr(a,s,c),Sn=g,xi=w,Sn!==null)if(xi)try{(Sn.nodeType===9?Sn.body:Sn.nodeName==="HTML"?Sn.ownerDocument.body:Sn).removeChild(c.stateNode)}catch(M){ji(c,s,M)}else try{Sn.removeChild(c.stateNode)}catch(M){ji(c,s,M)}break;case 18:Sn!==null&&(xi?(a=Sn,Dm(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,c.stateNode),sh(a)):Dm(Sn,c.stateNode));break;case 4:g=Sn,w=xi,Sn=c.stateNode.containerInfo,xi=!0,yr(a,s,c),Sn=g,xi=w;break;case 0:case 11:case 14:case 15:tl(2,c,s),Hn||tl(4,c,s),yr(a,s,c);break;case 1:Hn||(jr(c,s),g=c.stateNode,typeof g.componentWillUnmount=="function"&&tm(c,s,g)),yr(a,s,c);break;case 21:yr(a,s,c);break;case 22:Hn=(g=Hn)||c.memoizedState!==null,yr(a,s,c),Hn=g;break;default:yr(a,s,c)}}function Bh(a,s){if(s.memoizedState===null&&(a=s.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{sh(a)}catch(c){ji(s,s.return,c)}}}function Fh(a,s){if(s.memoizedState===null&&(a=s.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{sh(a)}catch(c){ji(s,s.return,c)}}function jh(a){switch(a.tag){case 31:case 13:case 19:var s=a.stateNode;return s===null&&(s=a.stateNode=new nm),s;case 22:return a=a.stateNode,s=a._retryCache,s===null&&(s=a._retryCache=new nm),s;default:throw Error(Q(435,a.tag))}}function Nh(a,s){var c=jh(a);s.forEach(function(g){if(!c.has(g)){c.add(g);var w=ig.bind(null,a,g);g.then(w,w)}})}function Ya(a,s){var c=s.deletions;if(c!==null)for(var g=0;g<c.length;g++){var w=c[g],M=a,k=s,H=k;e:for(;H!==null;){switch(H.tag){case 27:if(tu(H.type)){Sn=H.stateNode,xi=!1;break e}break;case 5:Sn=H.stateNode,xi=!1;break e;case 3:case 4:Sn=H.stateNode.containerInfo,xi=!0;break e}H=H.return}if(Sn===null)throw Error(Q(160));rp(M,k,w),Sn=null,xi=!1,M=w.alternate,M!==null&&(M.return=null),w.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Qd(s,a),s=s.sibling}var Wa=null;function Qd(a,s){var c=a.alternate,g=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Ya(s,a),ta(a),g&4&&(tl(3,a,a.return),Gc(3,a),tl(5,a,a.return));break;case 1:Ya(s,a),ta(a),g&512&&(Hn||c===null||jr(c,c.return)),g&64&&il&&(a=a.updateQueue,a!==null&&(g=a.callbacks,g!==null&&(c=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=c===null?g:c.concat(g))));break;case 26:var w=Wa;if(Ya(s,a),ta(a),g&512&&(Hn||c===null||jr(c,c.return)),g&4){var M=c!==null?c.memoizedState:null;if(g=a.memoizedState,c===null)if(g===null)if(a.stateNode===null){e:{g=a.type,c=a.memoizedProps,w=w.ownerDocument||w;t:switch(g){case"title":M=w.getElementsByTagName("title")[0],(!M||M[qt]||M[Ei]||M.namespaceURI==="http://www.w3.org/2000/svg"||M.hasAttribute("itemprop"))&&(M=w.createElement(g),w.head.insertBefore(M,w.querySelector("head > title"))),ia(M,g,c),M[Ei]=a,dn(M),g=M;break e;case"link":var k=id("link","href",w).get(g+(c.href||""));if(k){for(var H=0;H<k.length;H++)if(M=k[H],M.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&M.getAttribute("rel")===(c.rel==null?null:c.rel)&&M.getAttribute("title")===(c.title==null?null:c.title)&&M.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){k.splice(H,1);break t}}M=w.createElement(g),ia(M,g,c),w.head.appendChild(M);break;case"meta":if(k=id("meta","content",w).get(g+(c.content||""))){for(H=0;H<k.length;H++)if(M=k[H],M.getAttribute("content")===(c.content==null?null:""+c.content)&&M.getAttribute("name")===(c.name==null?null:c.name)&&M.getAttribute("property")===(c.property==null?null:c.property)&&M.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&M.getAttribute("charset")===(c.charSet==null?null:c.charSet)){k.splice(H,1);break t}}M=w.createElement(g),ia(M,g,c),w.head.appendChild(M);break;default:throw Error(Q(468,g))}M[Ei]=a,dn(M),g=M}a.stateNode=g}else nd(w,a.type,a.stateNode);else a.stateNode=rc(w,g,a.memoizedProps);else M!==g?(M===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):M.count--,g===null?nd(w,a.type,a.stateNode):rc(w,g,a.memoizedProps)):g===null&&a.stateNode!==null&&Wd(a,a.memoizedProps,c.memoizedProps)}break;case 27:Ya(s,a),ta(a),g&512&&(Hn||c===null||jr(c,c.return)),c!==null&&g&4&&Wd(a,a.memoizedProps,c.memoizedProps);break;case 5:if(Ya(s,a),ta(a),g&512&&(Hn||c===null||jr(c,c.return)),a.flags&32){w=a.stateNode;try{Es(w,"")}catch(wt){ji(a,a.return,wt)}}g&4&&a.stateNode!=null&&(w=a.memoizedProps,Wd(a,w,c!==null?c.memoizedProps:w)),g&1024&&(np=!0);break;case 6:if(Ya(s,a),ta(a),g&4){if(a.stateNode===null)throw Error(Q(162));g=a.memoizedProps,c=a.stateNode;try{c.nodeValue=g}catch(wt){ji(a,a.return,wt)}}break;case 3:if(td=null,w=Wa,Wa=cl(s.containerInfo),Ya(s,a),Wa=w,ta(a),g&4&&c!==null&&c.memoizedState.isDehydrated)try{sh(s.containerInfo)}catch(wt){ji(a,a.return,wt)}np&&(np=!1,Vh(a));break;case 4:g=Wa,Wa=cl(a.stateNode.containerInfo),Ya(s,a),ta(a),Wa=g;break;case 12:Ya(s,a),ta(a);break;case 31:Ya(s,a),ta(a),g&4&&(g=a.updateQueue,g!==null&&(a.updateQueue=null,Nh(a,g)));break;case 13:Ya(s,a),ta(a),a.child.flags&8192&&a.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(tf=Ln()),g&4&&(g=a.updateQueue,g!==null&&(a.updateQueue=null,Nh(a,g)));break;case 22:w=a.memoizedState!==null;var fe=c!==null&&c.memoizedState!==null,Re=il,Ge=Hn;if(il=Re||w,Hn=Ge||fe,Ya(s,a),Hn=Ge,il=Re,ta(a),g&8192)e:for(s=a.stateNode,s._visibility=w?s._visibility&-2:s._visibility|1,w&&(c===null||fe||il||Hn||Vs(a)),c=null,s=a;;){if(s.tag===5||s.tag===26){if(c===null){fe=c=s;try{if(M=fe.stateNode,w)k=M.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{H=fe.stateNode;var Ke=fe.memoizedProps.style,Le=Ke!=null&&Ke.hasOwnProperty("display")?Ke.display:null;H.style.display=Le==null||typeof Le=="boolean"?"":(""+Le).trim()}}catch(wt){ji(fe,fe.return,wt)}}}else if(s.tag===6){if(c===null){fe=s;try{fe.stateNode.nodeValue=w?"":fe.memoizedProps}catch(wt){ji(fe,fe.return,wt)}}}else if(s.tag===18){if(c===null){fe=s;try{var je=fe.stateNode;w?zi(je,!0):zi(fe.stateNode,!1)}catch(wt){ji(fe,fe.return,wt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===a)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}g&4&&(g=a.updateQueue,g!==null&&(c=g.retryQueue,c!==null&&(g.retryQueue=null,Nh(a,c))));break;case 19:Ya(s,a),ta(a),g&4&&(g=a.updateQueue,g!==null&&(a.updateQueue=null,Nh(a,g)));break;case 30:break;case 21:break;default:Ya(s,a),ta(a)}}function ta(a){var s=a.flags;if(s&2){try{for(var c,g=a.return;g!==null;){if($l(g)){c=g;break}g=g.return}if(c==null)throw Error(Q(160));switch(c.tag){case 27:var w=c.stateNode,M=Wu(a);Kd(a,M,w);break;case 5:var k=c.stateNode;c.flags&32&&(Es(k,""),c.flags&=-33);var H=Wu(a);Kd(a,H,k);break;case 3:case 4:var fe=c.stateNode.containerInfo,Re=Wu(a);ip(a,Re,fe);break;default:throw Error(Q(161))}}catch(Ge){ji(a,a.return,Ge)}a.flags&=-3}s&4096&&(a.flags&=-4097)}function Vh(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var s=a;Vh(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),a=a.sibling}}function vr(a,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)ap(a,s.alternate,s),s=s.sibling}function Vs(a){for(a=a.child;a!==null;){var s=a;switch(s.tag){case 0:case 11:case 14:case 15:tl(4,s,s.return),Vs(s);break;case 1:jr(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&tm(s,s.return,c),Vs(s);break;case 27:ed(s.stateNode);case 26:case 5:jr(s,s.return),Vs(s);break;case 22:s.memoizedState===null&&Vs(s);break;case 30:Vs(s);break;default:Vs(s)}a=a.sibling}}function nl(a,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var g=s.alternate,w=a,M=s,k=M.flags;switch(M.tag){case 0:case 11:case 15:nl(w,M,c),Gc(4,M);break;case 1:if(nl(w,M,c),g=M,w=g.stateNode,typeof w.componentDidMount=="function")try{w.componentDidMount()}catch(Re){ji(g,g.return,Re)}if(g=M,w=g.updateQueue,w!==null){var H=g.stateNode;try{var fe=w.shared.hiddenCallbacks;if(fe!==null)for(w.shared.hiddenCallbacks=null,w=0;w<fe.length;w++)Nu(fe[w],H)}catch(Re){ji(g,g.return,Re)}}c&&k&64&&em(M),Oh(M,M.return);break;case 27:im(M);case 26:case 5:nl(w,M,c),c&&g===null&&k&4&&Yd(M),Oh(M,M.return);break;case 12:nl(w,M,c);break;case 31:nl(w,M,c),c&&k&4&&Bh(w,M);break;case 13:nl(w,M,c),c&&k&4&&Fh(w,M);break;case 22:M.memoizedState===null&&nl(w,M,c),Oh(M,M.return);break;case 30:break;default:nl(w,M,c)}s=s.sibling}}function Jd(a,s){var c=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(c=a.memoizedState.cachePool.pool),a=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(a=s.memoizedState.cachePool.pool),a!==c&&(a!=null&&a.refCount++,c!=null&&jl(c))}function al(a,s){a=null,s.alternate!==null&&(a=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==a&&(s.refCount++,a!=null&&jl(a))}function Us(a,s,c,g){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)sp(a,s,c,g),s=s.sibling}function sp(a,s,c,g){var w=s.flags;switch(s.tag){case 0:case 11:case 15:Us(a,s,c,g),w&2048&&Gc(9,s);break;case 1:Us(a,s,c,g);break;case 3:Us(a,s,c,g),w&2048&&(a=null,s.alternate!==null&&(a=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==a&&(s.refCount++,a!=null&&jl(a)));break;case 12:if(w&2048){Us(a,s,c,g),a=s.stateNode;try{var M=s.memoizedProps,k=M.id,H=M.onPostCommit;typeof H=="function"&&H(k,s.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(fe){ji(s,s.return,fe)}}else Us(a,s,c,g);break;case 31:Us(a,s,c,g);break;case 13:Us(a,s,c,g);break;case 23:break;case 22:M=s.stateNode,k=s.alternate,s.memoizedState!==null?M._visibility&2?Us(a,s,c,g):Ku(a,s):M._visibility&2?Us(a,s,c,g):(M._visibility|=2,bo(a,s,c,g,(s.subtreeFlags&10256)!==0||!1)),w&2048&&Jd(k,s);break;case 24:Us(a,s,c,g),w&2048&&al(s.alternate,s);break;default:Us(a,s,c,g)}}function bo(a,s,c,g,w){for(w=w&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var M=a,k=s,H=c,fe=g,Re=k.flags;switch(k.tag){case 0:case 11:case 15:bo(M,k,H,fe,w),Gc(8,k);break;case 23:break;case 22:var Ge=k.stateNode;k.memoizedState!==null?Ge._visibility&2?bo(M,k,H,fe,w):Ku(M,k):(Ge._visibility|=2,bo(M,k,H,fe,w)),w&&Re&2048&&Jd(k.alternate,k);break;case 24:bo(M,k,H,fe,w),w&&Re&2048&&al(k.alternate,k);break;default:bo(M,k,H,fe,w)}s=s.sibling}}function Ku(a,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=a,g=s,w=g.flags;switch(g.tag){case 22:Ku(c,g),w&2048&&Jd(g.alternate,g);break;case 24:Ku(c,g),w&2048&&al(g.alternate,g);break;default:Ku(c,g)}s=s.sibling}}var Zc=8192;function Qu(a,s,c){if(a.subtreeFlags&Zc)for(a=a.child;a!==null;)am(a,s,c),a=a.sibling}function am(a,s,c){switch(a.tag){case 26:Qu(a,s,c),a.flags&Zc&&a.memoizedState!==null&&Op(c,Wa,a.memoizedState,a.memoizedProps);break;case 5:Qu(a,s,c);break;case 3:case 4:var g=Wa;Wa=cl(a.stateNode.containerInfo),Qu(a,s,c),Wa=g;break;case 22:a.memoizedState===null&&(g=a.alternate,g!==null&&g.memoizedState!==null?(g=Zc,Zc=16777216,Qu(a,s,c),Zc=g):Qu(a,s,c));break;default:Qu(a,s,c)}}function rm(a){var s=a.alternate;if(s!==null&&(a=s.child,a!==null)){s.child=null;do s=a.sibling,a.sibling=null,a=s;while(a!==null)}}function Uh(a){var s=a.deletions;if((a.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];$n=g,Hc(g,a)}rm(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)sm(a),a=a.sibling}function sm(a){switch(a.tag){case 0:case 11:case 15:Uh(a),a.flags&2048&&tl(9,a,a.return);break;case 3:Uh(a);break;case 12:Uh(a);break;case 22:var s=a.stateNode;a.memoizedState!==null&&s._visibility&2&&(a.return===null||a.return.tag!==13)?(s._visibility&=-3,ef(a)):Uh(a);break;default:Uh(a)}}function ef(a){var s=a.deletions;if((a.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];$n=g,Hc(g,a)}rm(a)}for(a=a.child;a!==null;){switch(s=a,s.tag){case 0:case 11:case 15:tl(8,s,s.return),ef(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,ef(s));break;default:ef(s)}a=a.sibling}}function Hc(a,s){for(;$n!==null;){var c=$n;switch(c.tag){case 0:case 11:case 15:tl(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var g=c.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:jl(c.memoizedState.cache)}if(g=c.child,g!==null)g.return=c,$n=g;else e:for(c=a;$n!==null;){g=$n;var w=g.sibling,M=g.return;if(qc(g),g===c){$n=null;break e}if(w!==null){w.return=M,$n=w;break e}$n=M}}}var eg={getCacheForType:function(a){var s=An(wn),c=s.data.get(a);return c===void 0&&(c=a(),s.data.set(a,c)),c},cacheSignal:function(){return An(wn).controller.signal}},om=typeof WeakMap=="function"?WeakMap:Map,Fi=0,rn=null,fi=null,pi=0,Zi=0,Ka=null,ys=!1,Xl=!1,op=!1,rl=0,zn=0,sl=0,Ju=0,lp=0,ya=0,ec=0,Gh=null,xr=null,up=!1,tf=0,lm=0,qh=1/0,$c=null,ol=null,Xn=0,ll=null,Xc=null,vs=0,cp=0,nf=null,um=null,Zh=0,hp=null;function br(){return(Fi&2)!==0&&pi!==0?pi&-pi:Fe.T!==null?xp():_i()}function cm(){if(ya===0)if((pi&536870912)===0||oi){var a=He;He<<=1,(He&3932160)===0&&(He=262144),ya=a}else ya=536870912;return a=ct.current,a!==null&&(a.flags|=32),ya}function wr(a,s,c){(a===rn&&(Zi===2||Zi===9)||a.cancelPendingCommit!==null)&&(Wc(a,0),Yl(a,pi,ya,!1)),Ft(a,c),((Fi&2)===0||a!==rn)&&(a===rn&&((Fi&2)===0&&(Ju|=c),zn===4&&Yl(a,pi,ya,!1)),Gs(a))}function jn(a,s,c){if((Fi&6)!==0)throw Error(Q(327));var g=!c&&(s&127)===0&&(s&a.expiredLanes)===0||Bt(a,s),w=g?Kc(a,s):sf(a,s,!0),M=g;do{if(w===0){Xl&&!g&&Yl(a,s,0,!1);break}else{if(c=a.current.alternate,M&&!tg(c)){w=sf(a,s,!1),M=!1;continue}if(w===2){if(M=s,a.errorRecoveryDisabledLanes&M)var k=0;else k=a.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){s=k;e:{var H=a;w=Gh;var fe=H.current.memoizedState.isDehydrated;if(fe&&(Wc(H,k).flags|=256),k=sf(H,k,!1),k!==2){if(op&&!fe){H.errorRecoveryDisabledLanes|=M,Ju|=M,w=4;break e}M=xr,xr=w,M!==null&&(xr===null?xr=M:xr.push.apply(xr,M))}w=k}if(M=!1,w!==2)continue}}if(w===1){Wc(a,0),Yl(a,s,0,!0);break}e:{switch(g=a,M=w,M){case 0:case 1:throw Error(Q(345));case 4:if((s&4194048)!==s)break;case 6:Yl(g,s,ya,!ys);break e;case 2:xr=null;break;case 3:case 5:break;default:throw Error(Q(329))}if((s&62914560)===s&&(w=tf+300-Ln(),10<w)){if(Yl(g,s,ya,!ys),mt(g,0,!0)!==0)break e;vs=s,g.timeoutHandle=Tf(Yc.bind(null,g,c,xr,$c,up,s,ya,Ju,ec,ys,M,"Throttled",-0,0),w);break e}Yc(g,c,xr,$c,up,s,ya,Ju,ec,ys,M,null,-0,0)}}break}while(!0);Gs(a)}function Yc(a,s,c,g,w,M,k,H,fe,Re,Ge,Ke,Le,je){if(a.timeoutHandle=-1,Ke=s.subtreeFlags,Ke&8192||(Ke&16785408)===16785408){Ke={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Cr},am(s,M,Ke);var wt=(M&62914560)===M?tf-Ln():(M&4194048)===M?lm-Ln():0;if(wt=Lm(Ke,wt),wt!==null){vs=M,a.cancelPendingCommit=wt(mm.bind(null,a,s,M,c,g,w,k,H,fe,Ge,Ke,null,Le,je)),Yl(a,M,k,!Re);return}}mm(a,s,M,c,g,w,k,H,fe)}function tg(a){for(var s=a;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var g=0;g<c.length;g++){var w=c[g],M=w.getSnapshot;w=w.value;try{if(!wa(M(),w))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===a)break;for(;s.sibling===null;){if(s.return===null||s.return===a)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Yl(a,s,c,g){s&=~lp,s&=~Ju,a.suspendedLanes|=s,a.pingedLanes&=~s,g&&(a.warmLanes|=s),g=a.expirationTimes;for(var w=s;0<w;){var M=31-ue(w),k=1<<M;g[M]=-1,w&=~k}c!==0&&hn(a,c,s)}function Hh(){return(Fi&6)===0?(Nr(0),!1):!0}function af(){if(fi!==null){if(Zi===0)var a=fi.return;else a=fi,os=hr=null,Fs(a),cs=null,Ho=0,a=fi;for(;a!==null;)Xd(a.alternate,a),a=a.return;fi=null}}function Wc(a,s){var c=a.timeoutHandle;c!==-1&&(a.timeoutHandle=-1,Cp(c)),c=a.cancelPendingCommit,c!==null&&(a.cancelPendingCommit=null,c()),vs=0,af(),rn=a,fi=c=Ga(a.current,null),pi=s,Zi=0,Ka=null,ys=!1,Xl=Bt(a,s),op=!1,ec=ya=lp=Ju=sl=zn=0,xr=Gh=null,up=!1,(s&8)!==0&&(s|=s&32);var g=a.entangledLanes;if(g!==0)for(a=a.entanglements,g&=s;0<g;){var w=31-ue(g),M=1<<w;s|=a[w],g&=~M}return rl=s,Uo(),c}function dp(a,s){ei=null,Fe.H=Ci,s===Ir||s===Ea?(s=Vl(),Zi=3):s===fo?(s=Vl(),Zi=4):Zi=s===jd?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Ka=s,fi===null&&(zn=1,Fr(a,_a(s,a.current)))}function fp(){var a=ct.current;return a===null?!0:(pi&4194048)===pi?yt===null:(pi&62914560)===pi||(pi&536870912)!==0?a===yt:!1}function tc(){var a=Fe.H;return Fe.H=Ci,a===null?Ci:a}function rf(){var a=Fe.A;return Fe.A=eg,a}function $h(){zn=4,ys||(pi&4194048)!==pi&&ct.current!==null||(Xl=!0),(sl&134217727)===0&&(Ju&134217727)===0||rn===null||Yl(rn,pi,ya,!1)}function sf(a,s,c){var g=Fi;Fi|=2;var w=tc(),M=rf();(rn!==a||pi!==s)&&($c=null,Wc(a,s)),s=!1;var k=zn;e:do try{if(Zi!==0&&fi!==null){var H=fi,fe=Ka;switch(Zi){case 8:af(),k=6;break e;case 3:case 2:case 9:case 6:ct.current===null&&(s=!0);var Re=Zi;if(Zi=0,Ka=null,Qc(a,H,fe,Re),c&&Xl){k=0;break e}break;default:Re=Zi,Zi=0,Ka=null,Qc(a,H,fe,Re)}}of(),k=zn;break}catch(Ge){dp(a,Ge)}while(!0);return s&&a.shellSuspendCounter++,os=hr=null,Fi=g,Fe.H=w,Fe.A=M,fi===null&&(rn=null,pi=0,Uo()),k}function of(){for(;fi!==null;)dm(fi)}function Kc(a,s){var c=Fi;Fi|=2;var g=tc(),w=rf();rn!==a||pi!==s?($c=null,qh=Ln()+500,Wc(a,s)):Xl=Bt(a,s);e:do try{if(Zi!==0&&fi!==null){s=fi;var M=Ka;t:switch(Zi){case 1:Zi=0,Ka=null,Qc(a,s,M,1);break;case 2:case 9:if(Ou(M)){Zi=0,Ka=null,fm(s);break}s=function(){Zi!==2&&Zi!==9||rn!==a||(Zi=7),Gs(a)},M.then(s,s);break e;case 3:Zi=7;break e;case 4:Zi=5;break e;case 7:Ou(M)?(Zi=0,Ka=null,fm(s)):(Zi=0,Ka=null,Qc(a,s,M,7));break;case 5:var k=null;switch(fi.tag){case 26:k=fi.memoizedState;case 5:case 27:var H=fi;if(k?If(k):H.stateNode.complete){Zi=0,Ka=null;var fe=H.sibling;if(fe!==null)fi=fe;else{var Re=H.return;Re!==null?(fi=Re,lf(Re)):fi=null}break t}}Zi=0,Ka=null,Qc(a,s,M,5);break;case 6:Zi=0,Ka=null,Qc(a,s,M,6);break;case 8:af(),zn=6;break e;default:throw Error(Q(462))}}hm();break}catch(Ge){dp(a,Ge)}while(!0);return os=hr=null,Fe.H=g,Fe.A=w,Fi=c,fi!==null?0:(rn=null,pi=0,Uo(),zn)}function hm(){for(;fi!==null&&!Er();)dm(fi)}function dm(a){var s=za(a.alternate,a,rl);a.memoizedProps=a.pendingProps,s===null?lf(a):fi=s}function fm(a){var s=a,c=s.alternate;switch(s.tag){case 15:case 0:s=Yp(c,s,s.pendingProps,s.type,void 0,pi);break;case 11:s=Yp(c,s,s.pendingProps,s.type.render,s.ref,pi);break;case 5:Fs(s);default:Xd(c,s),s=fi=Ld(s,rl),s=za(c,s,rl)}a.memoizedProps=a.pendingProps,s===null?lf(a):fi=s}function Qc(a,s,c,g){os=hr=null,Fs(s),cs=null,Ho=0;var w=s.return;try{if(Fd(a,w,s,c,pi)){zn=1,Fr(a,_a(c,a.current)),fi=null;return}}catch(M){if(w!==null)throw fi=w,M;zn=1,Fr(a,_a(c,a.current)),fi=null;return}s.flags&32768?(oi||g===1?a=!0:Xl||(pi&536870912)!==0?a=!1:(ys=a=!0,(g===2||g===9||g===3||g===6)&&(g=ct.current,g!==null&&g.tag===13&&(g.flags|=16384))),pm(s,a)):lf(s)}function lf(a){var s=a;do{if((s.flags&32768)!==0){pm(s,ys);return}a=s.return;var c=Jp(s.alternate,s,rl);if(c!==null){fi=c;return}if(s=s.sibling,s!==null){fi=s;return}fi=s=a}while(s!==null);zn===0&&(zn=5)}function pm(a,s){do{var c=Qm(a.alternate,a);if(c!==null){c.flags&=32767,fi=c;return}if(c=a.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(a=a.sibling,a!==null)){fi=a;return}fi=a=c}while(a!==null);zn=6,fi=null}function mm(a,s,c,g,w,M,k,H,fe){a.cancelPendingCommit=null;do uf();while(Xn!==0);if((Fi&6)!==0)throw Error(Q(327));if(s!==null){if(s===a.current)throw Error(Q(177));if(M=s.lanes|s.childLanes,M|=Vo,Ki(a,c,M,k,H,fe),a===rn&&(fi=rn=null,pi=0),Xc=s,ll=a,vs=c,cp=M,nf=w,um=g,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,bm(Ts,function(){return xm(),null})):(a.callbackNode=null,a.callbackPriority=0),g=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||g){g=Fe.T,Fe.T=null,w=nt.p,nt.p=2,k=Fi,Fi|=4;try{Jm(a,s,c)}finally{Fi=k,nt.p=w,Fe.T=g}}Xn=1,gm(),_m(),ym()}}function gm(){if(Xn===1){Xn=0;var a=ll,s=Xc,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=Fe.T,Fe.T=null;var g=nt.p;nt.p=2;var w=Fi;Fi|=4;try{Qd(s,a);var M=Ep,k=xc(a.containerInfo),H=M.focusedElem,fe=M.selectionRange;if(k!==H&&H&&H.ownerDocument&&vc(H.ownerDocument.documentElement,H)){if(fe!==null&&Eu(H)){var Re=fe.start,Ge=fe.end;if(Ge===void 0&&(Ge=Re),"selectionStart"in H)H.selectionStart=Re,H.selectionEnd=Math.min(Ge,H.value.length);else{var Ke=H.ownerDocument||document,Le=Ke&&Ke.defaultView||window;if(Le.getSelection){var je=Le.getSelection(),wt=H.textContent.length,Ut=Math.min(fe.start,wt),Ni=fe.end===void 0?Ut:Math.min(fe.end,wt);!je.extend&&Ut>Ni&&(k=Ni,Ni=Ut,Ut=k);var we=Mu(H,Ut),ye=Mu(H,Ni);if(we&&ye&&(je.rangeCount!==1||je.anchorNode!==we.node||je.anchorOffset!==we.offset||je.focusNode!==ye.node||je.focusOffset!==ye.offset)){var Pe=Ke.createRange();Pe.setStart(we.node,we.offset),je.removeAllRanges(),Ut>Ni?(je.addRange(Pe),je.extend(ye.node,ye.offset)):(Pe.setEnd(ye.node,ye.offset),je.addRange(Pe))}}}}for(Ke=[],je=H;je=je.parentNode;)je.nodeType===1&&Ke.push({element:je,left:je.scrollLeft,top:je.scrollTop});for(typeof H.focus=="function"&&H.focus(),H=0;H<Ke.length;H++){var $e=Ke[H];$e.element.scrollLeft=$e.left,$e.element.scrollTop=$e.top}}au=!!Qh,Ep=Qh=null}finally{Fi=w,nt.p=g,Fe.T=c}}a.current=s,Xn=2}}function _m(){if(Xn===2){Xn=0;var a=ll,s=Xc,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=Fe.T,Fe.T=null;var g=nt.p;nt.p=2;var w=Fi;Fi|=4;try{ap(a,s.alternate,s)}finally{Fi=w,nt.p=g,Fe.T=c}}Xn=3}}function ym(){if(Xn===4||Xn===3){Xn=0,vl();var a=ll,s=Xc,c=vs,g=um;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Xn=5:(Xn=0,Xc=ll=null,vm(a,a.pendingLanes));var w=a.pendingLanes;if(w===0&&(ol=null),We(c),s=s.stateNode,U&&typeof U.onCommitFiberRoot=="function")try{U.onCommitFiberRoot(N,s,void 0,(s.current.flags&128)===128)}catch{}if(g!==null){s=Fe.T,w=nt.p,nt.p=2,Fe.T=null;try{for(var M=a.onRecoverableError,k=0;k<g.length;k++){var H=g[k];M(H.value,{componentStack:H.stack})}}finally{Fe.T=s,nt.p=w}}(vs&3)!==0&&uf(),Gs(a),w=a.pendingLanes,(c&261930)!==0&&(w&42)!==0?a===hp?Zh++:(Zh=0,hp=a):Zh=0,Nr(0)}}function vm(a,s){(a.pooledCacheLanes&=s)===0&&(s=a.pooledCache,s!=null&&(a.pooledCache=null,jl(s)))}function uf(){return gm(),_m(),ym(),xm()}function xm(){if(Xn!==5)return!1;var a=ll,s=cp;cp=0;var c=We(vs),g=Fe.T,w=nt.p;try{nt.p=32>c?32:c,Fe.T=null,c=nf,nf=null;var M=ll,k=vs;if(Xn=0,Xc=ll=null,vs=0,(Fi&6)!==0)throw Error(Q(331));var H=Fi;if(Fi|=4,sm(M.current),sp(M,M.current,k,c),Fi=H,Nr(0,!1),U&&typeof U.onPostCommitFiberRoot=="function")try{U.onPostCommitFiberRoot(N,M)}catch{}return!0}finally{nt.p=w,Fe.T=g,vm(a,s)}}function pp(a,s,c){s=_a(c,s),s=$u(a.stateNode,s,2),a=Ls(a,s,2),a!==null&&(Ft(a,2),Gs(a))}function ji(a,s,c){if(a.tag===3)pp(a,a,c);else for(;s!==null;){if(s.tag===3){pp(s,a,c);break}else if(s.tag===1){var g=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(ol===null||!ol.has(g))){a=_a(c,a),c=Xu(2),g=Ls(s,c,2),g!==null&&(Yu(c,g,s,a),Ft(g,2),Gs(g));break}}s=s.return}}function cf(a,s,c){var g=a.pingCache;if(g===null){g=a.pingCache=new om;var w=new Set;g.set(s,w)}else w=g.get(s),w===void 0&&(w=new Set,g.set(s,w));w.has(c)||(op=!0,w.add(c),a=Wl.bind(null,a,s,c),s.then(a,a))}function Wl(a,s,c){var g=a.pingCache;g!==null&&g.delete(s),a.pingedLanes|=a.suspendedLanes&c,a.warmLanes&=~c,rn===a&&(pi&c)===c&&(zn===4||zn===3&&(pi&62914560)===pi&&300>Ln()-tf?(Fi&2)===0&&Wc(a,0):lp|=c,ec===pi&&(ec=0)),Gs(a)}function Xh(a,s){s===0&&(s=zt()),a=cr(a,s),a!==null&&(Ft(a,s),Gs(a))}function mp(a){var s=a.memoizedState,c=0;s!==null&&(c=s.retryLane),Xh(a,c)}function ig(a,s){var c=0;switch(a.tag){case 31:case 13:var g=a.stateNode,w=a.memoizedState;w!==null&&(c=w.retryLane);break;case 19:g=a.stateNode;break;case 22:g=a.stateNode._retryCache;break;default:throw Error(Q(314))}g!==null&&g.delete(s),Xh(a,c)}function bm(a,s){return bs(a,s)}var hf=null,Jc=null,gp=!1,df=!1,_p=!1,ul=0;function Gs(a){a!==Jc&&a.next===null&&(Jc===null?hf=Jc=a:Jc=Jc.next=a),df=!0,gp||(gp=!0,vp())}function Nr(a,s){if(!_p&&df){_p=!0;do for(var c=!1,g=hf;g!==null;){if(a!==0){var w=g.pendingLanes;if(w===0)var M=0;else{var k=g.suspendedLanes,H=g.pingedLanes;M=(1<<31-ue(42|a)+1)-1,M&=w&~(k&~H),M=M&201326741?M&201326741|1:M?M|2:0}M!==0&&(c=!0,Yh(g,M))}else M=pi,M=mt(g,g===rn?M:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(M&3)===0||Bt(g,M)||(c=!0,Yh(g,M));g=g.next}while(c);_p=!1}}function Kl(){yp()}function yp(){df=gp=!1;var a=0;ul!==0&&wf()&&(a=ul);for(var s=Ln(),c=null,g=hf;g!==null;){var w=g.next,M=ff(g,s);M===0?(g.next=null,c===null?hf=w:c.next=w,w===null&&(Jc=c)):(c=g,(a!==0||(M&3)!==0)&&(df=!0)),g=w}Xn!==0&&Xn!==5||Nr(a),ul!==0&&(ul=0)}function ff(a,s){for(var c=a.suspendedLanes,g=a.pingedLanes,w=a.expirationTimes,M=a.pendingLanes&-62914561;0<M;){var k=31-ue(M),H=1<<k,fe=w[k];fe===-1?((H&c)===0||(H&g)!==0)&&(w[k]=Et(H,s)):fe<=s&&(a.expiredLanes|=H),M&=~H}if(s=rn,c=pi,c=mt(a,a===s?c:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),g=a.callbackNode,c===0||a===s&&(Zi===2||Zi===9)||a.cancelPendingCommit!==null)return g!==null&&g!==null&&Hr(g),a.callbackNode=null,a.callbackPriority=0;if((c&3)===0||Bt(a,c)){if(s=c&-c,s===a.callbackPriority)return s;switch(g!==null&&Hr(g),We(c)){case 2:case 8:c=ws;break;case 32:c=Ts;break;case 268435456:c=Xs;break;default:c=Ts}return g=wm.bind(null,a),c=bs(c,g),a.callbackPriority=s,a.callbackNode=c,s}return g!==null&&g!==null&&Hr(g),a.callbackPriority=2,a.callbackNode=null,2}function wm(a,s){if(Xn!==0&&Xn!==5)return a.callbackNode=null,a.callbackPriority=0,null;var c=a.callbackNode;if(uf()&&a.callbackNode!==c)return null;var g=pi;return g=mt(a,a===rn?g:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),g===0?null:(jn(a,g,s),ff(a,Ln()),a.callbackNode!=null&&a.callbackNode===c?wm.bind(null,a):null)}function Yh(a,s){if(uf())return null;jn(a,s,!0)}function vp(){Dp(function(){(Fi&6)!==0?bs(xl,Kl):yp()})}function xp(){if(ul===0){var a=Zo;a===0&&(a=Se,Se<<=1,(Se&261888)===0&&(Se=256)),ul=a}return ul}function pf(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Yt(""+a)}function mf(a,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,a.id&&c.setAttribute("form",a.id),s.parentNode.insertBefore(c,s),a=new FormData(a),c.parentNode.removeChild(c),a}function eh(a,s,c,g,w){if(s==="submit"&&c&&c.stateNode===w){var M=pf((w[Je]||null).action),k=g.submitter;k&&(s=(s=k[Je]||null)?pf(s.formAction):k.getAttribute("formAction"),s!==null&&(M=s,k=null));var H=new pu("action","action",null,g,w);a.push({event:H,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(ul!==0){var fe=k?mf(w,k):new FormData(w);gn(c,{pending:!0,data:fe,method:w.method,action:M},null,fe)}}else typeof M=="function"&&(H.preventDefault(),fe=k?mf(w,k):new FormData(w),gn(c,{pending:!0,data:fe,method:w.method,action:M},M,fe))},currentTarget:w}]})}}for(var gf=0;gf<Sc.length;gf++){var _f=Sc[gf],bp=_f.toLowerCase(),Tm=_f[0].toUpperCase()+_f.slice(1);Va(bp,"on"+Tm)}Va(zu,"onAnimationEnd"),Va(Du,"onAnimationIteration"),Va(Tc,"onAnimationStart"),Va("dblclick","onDoubleClick"),Va("focusin","onFocus"),Va("focusout","onBlur"),Va(No,"onTransitionRun"),Va(Iu,"onTransitionStart"),Va(Ll,"onTransitionCancel"),Va(Na,"onTransitionEnd"),Ms("onMouseEnter",["mouseout","mouseover"]),Ms("onMouseLeave",["mouseout","mouseover"]),Ms("onPointerEnter",["pointerout","pointerover"]),Ms("onPointerLeave",["pointerout","pointerover"]),ci("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ci("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ci("onBeforeInput",["compositionend","keypress","textInput","paste"]),ci("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ci("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ci("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ql="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Sm=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ql));function Mm(a,s){s=(s&4)!==0;for(var c=0;c<a.length;c++){var g=a[c],w=g.event;g=g.listeners;e:{var M=void 0;if(s)for(var k=g.length-1;0<=k;k--){var H=g[k],fe=H.instance,Re=H.currentTarget;if(H=H.listener,fe!==M&&w.isPropagationStopped())break e;M=H,w.currentTarget=Re;try{M(w)}catch(Ge){ts(Ge)}w.currentTarget=null,M=fe}else for(k=0;k<g.length;k++){if(H=g[k],fe=H.instance,Re=H.currentTarget,H=H.listener,fe!==M&&w.isPropagationStopped())break e;M=H,w.currentTarget=Re;try{M(w)}catch(Ge){ts(Ge)}w.currentTarget=null,M=fe}}}}function mi(a,s){var c=s[Gt];c===void 0&&(c=s[Gt]=new Set);var g=a+"__bubble";c.has(g)||(vf(s,a,2,!1),c.add(g))}function wp(a,s,c){var g=0;s&&(g|=4),vf(c,a,g,s)}var yf="_reactListening"+Math.random().toString(36).slice(2);function Tp(a){if(!a[yf]){a[yf]=!0,bl.forEach(function(c){c!=="selectionchange"&&(Sm.has(c)||wp(c,!1,a),wp(c,!0,a))});var s=a.nodeType===9?a:a.ownerDocument;s===null||s[yf]||(s[yf]=!0,wp("selectionchange",!1,s))}}function vf(a,s,c,g){switch(Nm(s)){case 2:var w=ng;break;case 8:w=Np;break;default:w=ud}c=w.bind(null,s,c,a),w=void 0,!da||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(w=!0),g?w!==void 0?a.addEventListener(s,c,{capture:!0,passive:w}):a.addEventListener(s,c,!0):w!==void 0?a.addEventListener(s,c,{passive:w}):a.addEventListener(s,c,!1)}function wo(a,s,c,g,w){var M=g;if((s&1)===0&&(s&2)===0&&g!==null)e:for(;;){if(g===null)return;var k=g.tag;if(k===3||k===4){var H=g.stateNode.containerInfo;if(H===w)break;if(k===4)for(k=g.return;k!==null;){var fe=k.tag;if((fe===3||fe===4)&&k.stateNode.containerInfo===w)return;k=k.return}for(;H!==null;){if(k=Xr(H),k===null)return;if(fe=k.tag,fe===5||fe===6||fe===26||fe===27){g=M=k;continue e}H=H.parentNode}}g=g.return}Li(function(){var Re=M,Ge=fu(c),Ke=[];e:{var Le=yh.get(a);if(Le!==void 0){var je=pu,wt=a;switch(a){case"keypress":if(ja(c)===0)break e;case"keydown":case"keyup":je=pn;break;case"focusin":wt="focus",je=eo;break;case"focusout":wt="blur",je=eo;break;case"beforeblur":case"afterblur":je=eo;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":je=ko;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":je=mu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":je=Hf;break;case zu:case Du:case Tc:je=wd;break;case Na:je=mc;break;case"scroll":case"scrollend":je=Lo;break;case"wheel":je=fh;break;case"copy":case"cut":case"paste":je=hh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":je=pc;break;case"toggle":case"beforetoggle":je=Cl}var Ut=(s&4)!==0,Ni=!Ut&&(a==="scroll"||a==="scrollend"),we=Ut?Le!==null?Le+"Capture":null:Le;Ut=[];for(var ye=Re,Pe;ye!==null;){var $e=ye;if(Pe=$e.stateNode,$e=$e.tag,$e!==5&&$e!==26&&$e!==27||Pe===null||we===null||($e=sr(ye,we),$e!=null&&Ut.push(th(ye,$e,Pe))),Ni)break;ye=ye.return}0<Ut.length&&(Le=new je(Le,wt,null,c,Ge),Ke.push({event:Le,listeners:Ut}))}}if((s&7)===0){e:{if(Le=a==="mouseover"||a==="pointerover",je=a==="mouseout"||a==="pointerout",Le&&c!==ch&&(wt=c.relatedTarget||c.fromElement)&&(Xr(wt)||wt[Ct]))break e;if((je||Le)&&(Le=Ge.window===Ge?Ge:(Le=Ge.ownerDocument)?Le.defaultView||Le.parentWindow:window,je?(wt=c.relatedTarget||c.toElement,je=Re,wt=wt?Xr(wt):null,wt!==null&&(Ni=ve(wt),Ut=wt.tag,wt!==Ni||Ut!==5&&Ut!==27&&Ut!==6)&&(wt=null)):(je=null,wt=Re),je!==wt)){if(Ut=ko,$e="onMouseLeave",we="onMouseEnter",ye="mouse",(a==="pointerout"||a==="pointerover")&&(Ut=pc,$e="onPointerLeave",we="onPointerEnter",ye="pointer"),Ni=je==null?Le:Yr(je),Pe=wt==null?Le:Yr(wt),Le=new Ut($e,ye+"leave",je,c,Ge),Le.target=Ni,Le.relatedTarget=Pe,$e=null,Xr(Ge)===Re&&(Ut=new Ut(we,ye+"enter",wt,c,Ge),Ut.target=Pe,Ut.relatedTarget=Ni,$e=Ut),Ni=$e,je&&wt)t:{for(Ut=Em,we=je,ye=wt,Pe=0,$e=we;$e;$e=Ut($e))Pe++;$e=0;for(var Rt=ye;Rt;Rt=Ut(Rt))$e++;for(;0<Pe-$e;)we=Ut(we),Pe--;for(;0<$e-Pe;)ye=Ut(ye),$e--;for(;Pe--;){if(we===ye||ye!==null&&we===ye.alternate){Ut=we;break t}we=Ut(we),ye=Ut(ye)}Ut=null}else Ut=null;je!==null&&Sp(Ke,Le,je,Ut,!1),wt!==null&&Ni!==null&&Sp(Ke,Ni,wt,Ut,!0)}}e:{if(Le=Re?Yr(Re):window,je=Le.nodeName&&Le.nodeName.toLowerCase(),je==="select"||je==="input"&&Le.type==="file")var Ri=no;else if(_c(Le))if(ph)Ri=Pd;else{Ri=Id;var At=$f}else je=Le.nodeName,!je||je.toLowerCase()!=="input"||Le.type!=="checkbox"&&Le.type!=="radio"?Re&&Io(Re.elementType)&&(Ri=no):Ri=Su;if(Ri&&(Ri=Ri(a,Re))){yc(Ke,Ri,c,Ge);break e}At&&At(a,Le,Re),a==="focusout"&&Re&&Le.type==="number"&&Re.memoizedProps.value!=null&&du(Le,"number",Le.value)}switch(At=Re?Yr(Re):window,a){case"focusin":(_c(At)||At.contentEditable==="true")&&(ur=At,Au=Re,Cu=null);break;case"focusout":Cu=Au=ur=null;break;case"mousedown":wc=!0;break;case"contextmenu":case"mouseup":case"dragend":wc=!1,Rd(Ke,c,Ge);break;case"selectionchange":if(bc)break;case"keydown":case"keyup":Rd(Ke,c,Ge)}var Wt;if(bn)e:{switch(a){case"compositionstart":var jt="onCompositionStart";break e;case"compositionend":jt="onCompositionEnd";break e;case"compositionupdate":jt="onCompositionUpdate";break e}jt=void 0}else zr?xu(a,c)&&(jt="onCompositionEnd"):a==="keydown"&&c.keyCode===229&&(jt="onCompositionStart");jt&&(Pl&&c.locale!=="ko"&&(zr||jt!=="onCompositionStart"?jt==="onCompositionEnd"&&zr&&(Wt=Qs()):(Fa=Ge,Qr="value"in Fa?Fa.value:Fa.textContent,zr=!0)),At=Wh(Re,jt),0<At.length&&(jt=new dh(jt,a,null,c,Ge),Ke.push({event:jt,listeners:At}),Wt?jt.data=Wt:(Wt=Ed(c),Wt!==null&&(jt.data=Wt)))),(Wt=Il?gc(a,c):Ad(a,c))&&(jt=Wh(Re,"onBeforeInput"),0<jt.length&&(At=new dh("onBeforeInput","beforeinput",null,c,Ge),Ke.push({event:At,listeners:jt}),At.data=Wt)),eh(Ke,a,Re,c,Ge)}Mm(Ke,s)})}function th(a,s,c){return{instance:a,listener:s,currentTarget:c}}function Wh(a,s){for(var c=s+"Capture",g=[];a!==null;){var w=a,M=w.stateNode;if(w=w.tag,w!==5&&w!==26&&w!==27||M===null||(w=sr(a,c),w!=null&&g.unshift(th(a,w,M)),w=sr(a,s),w!=null&&g.push(th(a,w,M))),a.tag===3)return g;a=a.return}return[]}function Em(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Sp(a,s,c,g,w){for(var M=s._reactName,k=[];c!==null&&c!==g;){var H=c,fe=H.alternate,Re=H.stateNode;if(H=H.tag,fe!==null&&fe===g)break;H!==5&&H!==26&&H!==27||Re===null||(fe=Re,w?(Re=sr(c,M),Re!=null&&k.unshift(th(c,Re,fe))):w||(Re=sr(c,M),Re!=null&&k.push(th(c,Re,fe)))),c=c.return}k.length!==0&&a.push({event:s,listeners:k})}var Am=/\r\n?/g,Cm=/\u0000|\uFFFD/g;function Kh(a){return(typeof a=="string"?a:""+a).replace(Am,`
`).replace(Cm,"")}function Mp(a,s){return s=Kh(s),Kh(a)===s}function Pi(a,s,c,g,w,M){switch(c){case"children":typeof g=="string"?s==="body"||s==="textarea"&&g===""||Es(a,g):(typeof g=="number"||typeof g=="bigint")&&s!=="body"&&Es(a,""+g);break;case"className":Kr(a,"class",g);break;case"tabIndex":Kr(a,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":Kr(a,c,g);break;case"style":fc(a,g,M);break;case"data":if(s!=="object"){Kr(a,"data",g);break}case"src":case"href":if(g===""&&(s!=="a"||c!=="href")){a.removeAttribute(c);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){a.removeAttribute(c);break}g=Yt(""+g),a.setAttribute(c,g);break;case"action":case"formAction":if(typeof g=="function"){a.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof M=="function"&&(c==="formAction"?(s!=="input"&&Pi(a,s,"name",w.name,w,null),Pi(a,s,"formEncType",w.formEncType,w,null),Pi(a,s,"formMethod",w.formMethod,w,null),Pi(a,s,"formTarget",w.formTarget,w,null)):(Pi(a,s,"encType",w.encType,w,null),Pi(a,s,"method",w.method,w,null),Pi(a,s,"target",w.target,w,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){a.removeAttribute(c);break}g=Yt(""+g),a.setAttribute(c,g);break;case"onClick":g!=null&&(a.onclick=Cr);break;case"onScroll":g!=null&&mi("scroll",a);break;case"onScrollEnd":g!=null&&mi("scrollend",a);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(Q(61));if(c=g.__html,c!=null){if(w.children!=null)throw Error(Q(60));a.innerHTML=c}}break;case"multiple":a.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":a.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){a.removeAttribute("xlink:href");break}c=Yt(""+g),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(c,""+g):a.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(c,""):a.removeAttribute(c);break;case"capture":case"download":g===!0?a.setAttribute(c,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(c,g):a.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?a.setAttribute(c,g):a.removeAttribute(c);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?a.removeAttribute(c):a.setAttribute(c,g);break;case"popover":mi("beforetoggle",a),mi("toggle",a),uu(a,"popover",g);break;case"xlinkActuate":rr(a,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":rr(a,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":rr(a,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":rr(a,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":rr(a,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":rr(a,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":rr(a,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":rr(a,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":rr(a,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":uu(a,"is",g);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Ks.get(c)||c,uu(a,c,g))}}function xf(a,s,c,g,w,M){switch(c){case"style":fc(a,g,M);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(Q(61));if(c=g.__html,c!=null){if(w.children!=null)throw Error(Q(60));a.innerHTML=c}}break;case"children":typeof g=="string"?Es(a,g):(typeof g=="number"||typeof g=="bigint")&&Es(a,""+g);break;case"onScroll":g!=null&&mi("scroll",a);break;case"onScrollEnd":g!=null&&mi("scrollend",a);break;case"onClick":g!=null&&(a.onclick=Cr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!na.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(w=c.endsWith("Capture"),s=c.slice(2,w?c.length-7:void 0),M=a[Je]||null,M=M!=null?M[c]:null,typeof M=="function"&&a.removeEventListener(s,M,w),typeof g=="function")){typeof M!="function"&&M!==null&&(c in a?a[c]=null:a.hasAttribute(c)&&a.removeAttribute(c)),a.addEventListener(s,g,w);break e}c in a?a[c]=g:g===!0?a.setAttribute(c,""):uu(a,c,g)}}}function ia(a,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":mi("error",a),mi("load",a);var g=!1,w=!1,M;for(M in c)if(c.hasOwnProperty(M)){var k=c[M];if(k!=null)switch(M){case"src":g=!0;break;case"srcSet":w=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(Q(137,s));default:Pi(a,s,M,k,c,null)}}w&&Pi(a,s,"srcSet",c.srcSet,c,null),g&&Pi(a,s,"src",c.src,c,null);return;case"input":mi("invalid",a);var H=M=k=w=null,fe=null,Re=null;for(g in c)if(c.hasOwnProperty(g)){var Ge=c[g];if(Ge!=null)switch(g){case"name":w=Ge;break;case"type":k=Ge;break;case"checked":fe=Ge;break;case"defaultChecked":Re=Ge;break;case"value":M=Ge;break;case"defaultValue":H=Ge;break;case"children":case"dangerouslySetInnerHTML":if(Ge!=null)throw Error(Q(137,s));break;default:Pi(a,s,g,Ge,c,null)}}dc(a,M,H,fe,Re,k,w,!1);return;case"select":mi("invalid",a),g=k=M=null;for(w in c)if(c.hasOwnProperty(w)&&(H=c[w],H!=null))switch(w){case"value":M=H;break;case"defaultValue":k=H;break;case"multiple":g=H;default:Pi(a,s,w,H,c,null)}s=M,c=k,a.multiple=!!g,s!=null?Ws(a,!!g,s,!1):c!=null&&Ws(a,!!g,c,!0);return;case"textarea":mi("invalid",a),M=w=g=null;for(k in c)if(c.hasOwnProperty(k)&&(H=c[k],H!=null))switch(k){case"value":g=H;break;case"defaultValue":w=H;break;case"children":M=H;break;case"dangerouslySetInnerHTML":if(H!=null)throw Error(Q(91));break;default:Pi(a,s,k,H,c,null)}Sl(a,g,w,M);return;case"option":for(fe in c)c.hasOwnProperty(fe)&&(g=c[fe],g!=null)&&(fe==="selected"?a.selected=g&&typeof g!="function"&&typeof g!="symbol":Pi(a,s,fe,g,c,null));return;case"dialog":mi("beforetoggle",a),mi("toggle",a),mi("cancel",a),mi("close",a);break;case"iframe":case"object":mi("load",a);break;case"video":case"audio":for(g=0;g<Ql.length;g++)mi(Ql[g],a);break;case"image":mi("error",a),mi("load",a);break;case"details":mi("toggle",a);break;case"embed":case"source":case"link":mi("error",a),mi("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Re in c)if(c.hasOwnProperty(Re)&&(g=c[Re],g!=null))switch(Re){case"children":case"dangerouslySetInnerHTML":throw Error(Q(137,s));default:Pi(a,s,Re,g,c,null)}return;default:if(Io(s)){for(Ge in c)c.hasOwnProperty(Ge)&&(g=c[Ge],g!==void 0&&xf(a,s,Ge,g,c,void 0));return}}for(H in c)c.hasOwnProperty(H)&&(g=c[H],g!=null&&Pi(a,s,H,g,c,null))}function zm(a,s,c,g){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var w=null,M=null,k=null,H=null,fe=null,Re=null,Ge=null;for(je in c){var Ke=c[je];if(c.hasOwnProperty(je)&&Ke!=null)switch(je){case"checked":break;case"value":break;case"defaultValue":fe=Ke;default:g.hasOwnProperty(je)||Pi(a,s,je,null,g,Ke)}}for(var Le in g){var je=g[Le];if(Ke=c[Le],g.hasOwnProperty(Le)&&(je!=null||Ke!=null))switch(Le){case"type":M=je;break;case"name":w=je;break;case"checked":Re=je;break;case"defaultChecked":Ge=je;break;case"value":k=je;break;case"defaultValue":H=je;break;case"children":case"dangerouslySetInnerHTML":if(je!=null)throw Error(Q(137,s));break;default:je!==Ke&&Pi(a,s,Le,je,g,Ke)}}hu(a,k,H,fe,Re,Ge,M,w);return;case"select":je=k=H=Le=null;for(M in c)if(fe=c[M],c.hasOwnProperty(M)&&fe!=null)switch(M){case"value":break;case"multiple":je=fe;default:g.hasOwnProperty(M)||Pi(a,s,M,null,g,fe)}for(w in g)if(M=g[w],fe=c[w],g.hasOwnProperty(w)&&(M!=null||fe!=null))switch(w){case"value":Le=M;break;case"defaultValue":H=M;break;case"multiple":k=M;default:M!==fe&&Pi(a,s,w,M,g,fe)}s=H,c=k,g=je,Le!=null?Ws(a,!!c,Le,!1):!!g!=!!c&&(s!=null?Ws(a,!!c,s,!0):Ws(a,!!c,c?[]:"",!1));return;case"textarea":je=Le=null;for(H in c)if(w=c[H],c.hasOwnProperty(H)&&w!=null&&!g.hasOwnProperty(H))switch(H){case"value":break;case"children":break;default:Pi(a,s,H,null,g,w)}for(k in g)if(w=g[k],M=c[k],g.hasOwnProperty(k)&&(w!=null||M!=null))switch(k){case"value":Le=w;break;case"defaultValue":je=w;break;case"children":break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(Q(91));break;default:w!==M&&Pi(a,s,k,w,g,M)}xd(a,Le,je);return;case"option":for(var wt in c)Le=c[wt],c.hasOwnProperty(wt)&&Le!=null&&!g.hasOwnProperty(wt)&&(wt==="selected"?a.selected=!1:Pi(a,s,wt,null,g,Le));for(fe in g)Le=g[fe],je=c[fe],g.hasOwnProperty(fe)&&Le!==je&&(Le!=null||je!=null)&&(fe==="selected"?a.selected=Le&&typeof Le!="function"&&typeof Le!="symbol":Pi(a,s,fe,Le,g,je));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ut in c)Le=c[Ut],c.hasOwnProperty(Ut)&&Le!=null&&!g.hasOwnProperty(Ut)&&Pi(a,s,Ut,null,g,Le);for(Re in g)if(Le=g[Re],je=c[Re],g.hasOwnProperty(Re)&&Le!==je&&(Le!=null||je!=null))switch(Re){case"children":case"dangerouslySetInnerHTML":if(Le!=null)throw Error(Q(137,s));break;default:Pi(a,s,Re,Le,g,je)}return;default:if(Io(s)){for(var Ni in c)Le=c[Ni],c.hasOwnProperty(Ni)&&Le!==void 0&&!g.hasOwnProperty(Ni)&&xf(a,s,Ni,void 0,g,Le);for(Ge in g)Le=g[Ge],je=c[Ge],!g.hasOwnProperty(Ge)||Le===je||Le===void 0&&je===void 0||xf(a,s,Ge,Le,g,je);return}}for(var we in c)Le=c[we],c.hasOwnProperty(we)&&Le!=null&&!g.hasOwnProperty(we)&&Pi(a,s,we,null,g,Le);for(Ke in g)Le=g[Ke],je=c[Ke],!g.hasOwnProperty(Ke)||Le===je||Le==null&&je==null||Pi(a,s,Ke,Le,g,je)}function Qa(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ih(){if(typeof performance.getEntriesByType=="function"){for(var a=0,s=0,c=performance.getEntriesByType("resource"),g=0;g<c.length;g++){var w=c[g],M=w.transferSize,k=w.initiatorType,H=w.duration;if(M&&H&&Qa(k)){for(k=0,H=w.responseEnd,g+=1;g<c.length;g++){var fe=c[g],Re=fe.startTime;if(Re>H)break;var Ge=fe.transferSize,Ke=fe.initiatorType;Ge&&Qa(Ke)&&(fe=fe.responseEnd,k+=Ge*(fe<H?1:(H-Re)/(fe-Re)))}if(--g,s+=8*(M+k)/(w.duration/1e3),a++,10<a)break}}if(0<a)return s/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Qh=null,Ep=null;function Jh(a){return a.nodeType===9?a:a.ownerDocument}function Jl(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ap(a,s){if(a===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&s==="foreignObject"?0:a}function bf(a,s){return a==="textarea"||a==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var eu=null;function wf(){var a=window.event;return a&&a.type==="popstate"?a===eu?!1:(eu=a,!0):(eu=null,!1)}var Tf=typeof setTimeout=="function"?setTimeout:void 0,Cp=typeof clearTimeout=="function"?clearTimeout:void 0,zp=typeof Promise=="function"?Promise:void 0,Dp=typeof queueMicrotask=="function"?queueMicrotask:typeof zp<"u"?function(a){return zp.resolve(null).then(a).catch(Ip)}:Tf;function Ip(a){setTimeout(function(){throw a})}function tu(a){return a==="head"}function Dm(a,s){var c=s,g=0;do{var w=c.nextSibling;if(a.removeChild(c),w&&w.nodeType===8)if(c=w.data,c==="/$"||c==="/&"){if(g===0){a.removeChild(w),sh(s);return}g--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")g++;else if(c==="html")ed(a.ownerDocument.documentElement);else if(c==="head"){c=a.ownerDocument.head,ed(c);for(var M=c.firstChild;M;){var k=M.nextSibling,H=M.nodeName;M[qt]||H==="SCRIPT"||H==="STYLE"||H==="LINK"&&M.rel.toLowerCase()==="stylesheet"||c.removeChild(M),M=k}}else c==="body"&&ed(a.ownerDocument.body);c=w}while(c);sh(s)}function zi(a,s){var c=a;a=0;do{var g=c.nextSibling;if(c.nodeType===1?s?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(s?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),g&&g.nodeType===8)if(c=g.data,c==="/$"){if(a===0)break;a--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||a++;c=g}while(c)}function To(a){var s=a.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":To(c),Co(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}a.removeChild(c)}}function sa(a,s,c,g){for(;a.nodeType===1;){var w=c;if(a.nodeName.toLowerCase()!==s.toLowerCase()){if(!g&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(g){if(!a[qt])switch(s){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(M=a.getAttribute("rel"),M==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(M!==w.rel||a.getAttribute("href")!==(w.href==null||w.href===""?null:w.href)||a.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin)||a.getAttribute("title")!==(w.title==null?null:w.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(M=a.getAttribute("src"),(M!==(w.src==null?null:w.src)||a.getAttribute("type")!==(w.type==null?null:w.type)||a.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin))&&M&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(s==="input"&&a.type==="hidden"){var M=w.name==null?null:""+w.name;if(w.type==="hidden"&&a.getAttribute("name")===M)return a}else return a;if(a=Vr(a.nextSibling),a===null)break}return null}function qs(a,s,c){if(s==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!c||(a=Vr(a.nextSibling),a===null))return null;return a}function iu(a,s){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!s||(a=Vr(a.nextSibling),a===null))return null;return a}function Da(a){return a.data==="$?"||a.data==="$~"}function cn(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function Yn(a,s){var c=a.ownerDocument;if(a.data==="$~")a._reactRetry=s;else if(a.data!=="$?"||c.readyState!=="loading")s();else{var g=function(){s(),c.removeEventListener("DOMContentLoaded",g)};c.addEventListener("DOMContentLoaded",g),a._reactRetry=g}}function Vr(a){for(;a!=null;a=a.nextSibling){var s=a.nodeType;if(s===1||s===3)break;if(s===8){if(s=a.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return a}var Ja=null;function oa(a){a=a.nextSibling;for(var s=0;a;){if(a.nodeType===8){var c=a.data;if(c==="/$"||c==="/&"){if(s===0)return Vr(a.nextSibling);s--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||s++}a=a.nextSibling}return null}function Sf(a){a=a.previousSibling;for(var s=0;a;){if(a.nodeType===8){var c=a.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(s===0)return a;s--}else c!=="/$"&&c!=="/&"||s++}a=a.previousSibling}return null}function Im(a,s,c){switch(s=Jh(c),a){case"html":if(a=s.documentElement,!a)throw Error(Q(452));return a;case"head":if(a=s.head,!a)throw Error(Q(453));return a;case"body":if(a=s.body,!a)throw Error(Q(454));return a;default:throw Error(Q(451))}}function ed(a){for(var s=a.attributes;s.length;)a.removeAttributeNode(s[0]);Co(a)}var bi=new Map,er=new Set;function cl(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var So=nt.d;nt.d={f:Pm,r:Rm,D:Ia,C:Zs,L:Ef,m:Pa,X:Af,S:nu,M:Pp};function Pm(){var a=So.f(),s=Hh();return a||s}function Rm(a){var s=Ss(a);s!==null&&s.tag===5&&s.type==="form"?qn(s):So.r(a)}var ic=typeof document>"u"?null:document;function Mf(a,s,c){var g=ic;if(g&&typeof s=="string"&&s){var w=ha(s);w='link[rel="'+a+'"][href="'+w+'"]',typeof c=="string"&&(w+='[crossorigin="'+c+'"]'),er.has(w)||(er.add(w),a={rel:a,crossOrigin:c,href:s},g.querySelector(w)===null&&(s=g.createElement("link"),ia(s,"link",a),dn(s),g.head.appendChild(s)))}}function Ia(a){So.D(a),Mf("dns-prefetch",a,null)}function Zs(a,s){So.C(a,s),Mf("preconnect",a,s)}function Ef(a,s,c){So.L(a,s,c);var g=ic;if(g&&a&&s){var w='link[rel="preload"][as="'+ha(s)+'"]';s==="image"&&c&&c.imageSrcSet?(w+='[imagesrcset="'+ha(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(w+='[imagesizes="'+ha(c.imageSizes)+'"]')):w+='[href="'+ha(a)+'"]';var M=w;switch(s){case"style":M=nc(a);break;case"script":M=ac(a)}bi.has(M)||(a=Ye({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:a,as:s},c),bi.set(M,a),g.querySelector(w)!==null||s==="style"&&g.querySelector(nh(M))||s==="script"&&g.querySelector(ah(M))||(s=g.createElement("link"),ia(s,"link",a),dn(s),g.head.appendChild(s)))}}function Pa(a,s){So.m(a,s);var c=ic;if(c&&a){var g=s&&typeof s.as=="string"?s.as:"script",w='link[rel="modulepreload"][as="'+ha(g)+'"][href="'+ha(a)+'"]',M=w;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":M=ac(a)}if(!bi.has(M)&&(a=Ye({rel:"modulepreload",href:a},s),bi.set(M,a),c.querySelector(w)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(ah(M)))return}g=c.createElement("link"),ia(g,"link",a),dn(g),c.head.appendChild(g)}}}function nu(a,s,c){So.S(a,s,c);var g=ic;if(g&&a){var w=Wr(g).hoistableStyles,M=nc(a);s=s||"default";var k=w.get(M);if(!k){var H={loading:0,preload:null};if(k=g.querySelector(nh(M)))H.loading=5;else{a=Ye({rel:"stylesheet",href:a,"data-precedence":s},c),(c=bi.get(M))&&zf(a,c);var fe=k=g.createElement("link");dn(fe),ia(fe,"link",a),fe._p=new Promise(function(Re,Ge){fe.onload=Re,fe.onerror=Ge}),fe.addEventListener("load",function(){H.loading|=1}),fe.addEventListener("error",function(){H.loading|=2}),H.loading|=4,rh(k,s,g)}k={type:"stylesheet",instance:k,count:1,state:H},w.set(M,k)}}}function Af(a,s){So.X(a,s);var c=ic;if(c&&a){var g=Wr(c).hoistableScripts,w=ac(a),M=g.get(w);M||(M=c.querySelector(ah(w)),M||(a=Ye({src:a,async:!0},s),(s=bi.get(w))&&kp(a,s),M=c.createElement("script"),dn(M),ia(M,"link",a),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},g.set(w,M))}}function Pp(a,s){So.M(a,s);var c=ic;if(c&&a){var g=Wr(c).hoistableScripts,w=ac(a),M=g.get(w);M||(M=c.querySelector(ah(w)),M||(a=Ye({src:a,async:!0,type:"module"},s),(s=bi.get(w))&&kp(a,s),M=c.createElement("script"),dn(M),ia(M,"link",a),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},g.set(w,M))}}function Rp(a,s,c,g){var w=(w=Ot.current)?cl(w):null;if(!w)throw Error(Q(446));switch(a){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=nc(c.href),c=Wr(w).hoistableStyles,g=c.get(s),g||(g={type:"style",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){a=nc(c.href);var M=Wr(w).hoistableStyles,k=M.get(a);if(k||(w=w.ownerDocument||w,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},M.set(a,k),(M=w.querySelector(nh(a)))&&!M._p&&(k.instance=M,k.state.loading=5),bi.has(a)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},bi.set(a,c),M||Cf(w,a,c,k.state))),s&&g===null)throw Error(Q(528,""));return k}if(s&&g!==null)throw Error(Q(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=ac(c),c=Wr(w).hoistableScripts,g=c.get(s),g||(g={type:"script",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(Q(444,a))}}function nc(a){return'href="'+ha(a)+'"'}function nh(a){return'link[rel="stylesheet"]['+a+"]"}function Lp(a){return Ye({},a,{"data-precedence":a.precedence,precedence:null})}function Cf(a,s,c,g){a.querySelector('link[rel="preload"][as="style"]['+s+"]")?g.loading=1:(s=a.createElement("link"),g.preload=s,s.addEventListener("load",function(){return g.loading|=1}),s.addEventListener("error",function(){return g.loading|=2}),ia(s,"link",c),dn(s),a.head.appendChild(s))}function ac(a){return'[src="'+ha(a)+'"]'}function ah(a){return"script[async]"+a}function rc(a,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var g=a.querySelector('style[data-href~="'+ha(c.href)+'"]');if(g)return s.instance=g,dn(g),g;var w=Ye({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return g=(a.ownerDocument||a).createElement("style"),dn(g),ia(g,"style",w),rh(g,c.precedence,a),s.instance=g;case"stylesheet":w=nc(c.href);var M=a.querySelector(nh(w));if(M)return s.state.loading|=4,s.instance=M,dn(M),M;g=Lp(c),(w=bi.get(w))&&zf(g,w),M=(a.ownerDocument||a).createElement("link"),dn(M);var k=M;return k._p=new Promise(function(H,fe){k.onload=H,k.onerror=fe}),ia(M,"link",g),s.state.loading|=4,rh(M,c.precedence,a),s.instance=M;case"script":return M=ac(c.src),(w=a.querySelector(ah(M)))?(s.instance=w,dn(w),w):(g=c,(w=bi.get(M))&&(g=Ye({},c),kp(g,w)),a=a.ownerDocument||a,w=a.createElement("script"),dn(w),ia(w,"link",g),a.head.appendChild(w),s.instance=w);case"void":return null;default:throw Error(Q(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(g=s.instance,s.state.loading|=4,rh(g,c.precedence,a));return s.instance}function rh(a,s,c){for(var g=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),w=g.length?g[g.length-1]:null,M=w,k=0;k<g.length;k++){var H=g[k];if(H.dataset.precedence===s)M=H;else if(M!==w)break}M?M.parentNode.insertBefore(a,M.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(a,s.firstChild))}function zf(a,s){a.crossOrigin==null&&(a.crossOrigin=s.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=s.referrerPolicy),a.title==null&&(a.title=s.title)}function kp(a,s){a.crossOrigin==null&&(a.crossOrigin=s.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=s.referrerPolicy),a.integrity==null&&(a.integrity=s.integrity)}var td=null;function id(a,s,c){if(td===null){var g=new Map,w=td=new Map;w.set(c,g)}else w=td,g=w.get(c),g||(g=new Map,w.set(c,g));if(g.has(a))return g;for(g.set(a,null),c=c.getElementsByTagName(a),w=0;w<c.length;w++){var M=c[w];if(!(M[qt]||M[Ei]||a==="link"&&M.getAttribute("rel")==="stylesheet")&&M.namespaceURI!=="http://www.w3.org/2000/svg"){var k=M.getAttribute(s)||"";k=a+k;var H=g.get(k);H?H.push(M):g.set(k,[M])}}return g}function nd(a,s,c){a=a.ownerDocument||a,a.head.insertBefore(c,s==="title"?a.querySelector("head > title"):null)}function Df(a,s,c){if(c===1||s.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(a=s.disabled,typeof s.precedence=="string"&&a==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function If(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function Op(a,s,c,g){if(c.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var w=nc(g.href),M=s.querySelector(nh(w));if(M){s=M._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(a.count++,a=rd.bind(a),s.then(a,a)),c.state.loading|=4,c.instance=M,dn(M);return}M=s.ownerDocument||s,g=Lp(g),(w=bi.get(w))&&zf(g,w),M=M.createElement("link"),dn(M);var k=M;k._p=new Promise(function(H,fe){k.onload=H,k.onerror=fe}),ia(M,"link",g),c.instance=M}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(a.count++,c=rd.bind(a),s.addEventListener("load",c),s.addEventListener("error",c))}}var ad=0;function Lm(a,s){return a.stylesheets&&a.count===0&&od(a,a.stylesheets),0<a.count||0<a.imgCount?function(c){var g=setTimeout(function(){if(a.stylesheets&&od(a,a.stylesheets),a.unsuspend){var M=a.unsuspend;a.unsuspend=null,M()}},6e4+s);0<a.imgBytes&&ad===0&&(ad=62500*ih());var w=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&od(a,a.stylesheets),a.unsuspend)){var M=a.unsuspend;a.unsuspend=null,M()}},(a.imgBytes>ad?50:800)+s);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(g),clearTimeout(w)}}:null}function rd(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)od(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var sd=null;function od(a,s){a.stylesheets=null,a.unsuspend!==null&&(a.count++,sd=new Map,s.forEach(km,a),sd=null,rd.call(a))}function km(a,s){if(!(s.state.loading&4)){var c=sd.get(a);if(c)var g=c.get(null);else{c=new Map,sd.set(a,c);for(var w=a.querySelectorAll("link[data-precedence],style[data-precedence]"),M=0;M<w.length;M++){var k=w[M];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(c.set(k.dataset.precedence,k),g=k)}g&&c.set(null,g)}w=s.instance,k=w.getAttribute("data-precedence"),M=c.get(k)||g,M===g&&c.set(null,w),c.set(k,w),this.count++,g=rd.bind(this),w.addEventListener("load",g),w.addEventListener("error",g),M?M.parentNode.insertBefore(w,M.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(w,a.firstChild)),s.state.loading|=4}}var ld={$$typeof:pt,Provider:null,Consumer:null,_currentValue:ht,_currentValue2:ht,_threadCount:0};function Om(a,s,c,g,w,M,k,H,fe){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Dt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Dt(0),this.hiddenUpdates=Dt(null),this.identifierPrefix=g,this.onUncaughtError=w,this.onCaughtError=M,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=fe,this.incompleteTransitions=new Map}function Bm(a,s,c,g,w,M,k,H,fe,Re,Ge,Ke){return a=new Om(a,s,c,k,fe,Re,Ge,Ke,H),s=1,M===!0&&(s|=24),M=Ua(3,null,null,s),a.current=M,M.stateNode=a,s=us(),s.refCount++,a.pooledCache=s,s.refCount++,M.memoizedState={element:g,isDehydrated:c,cache:s},Bc(M),a}function Fm(a){return a?(a=Xt,a):Xt}function Pf(a,s,c,g,w,M){w=Fm(w),g.context===null?g.context=w:g.pendingContext=w,g=ps(s),g.payload={element:c},M=M===void 0?null:M,M!==null&&(g.callback=M),c=Ls(a,g,s),c!==null&&(wr(c,a,s),fr(c,a,s))}function Bp(a,s){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var c=a.retryLane;a.retryLane=c!==0&&c<s?c:s}}function Fp(a,s){Bp(a,s),(a=a.alternate)&&Bp(a,s)}function jm(a){if(a.tag===13||a.tag===31){var s=cr(a,67108864);s!==null&&wr(s,a,67108864),Fp(a,67108864)}}function jp(a){if(a.tag===13||a.tag===31){var s=br();s=Qi(s);var c=cr(a,s);c!==null&&wr(c,a,s),Fp(a,s)}}var au=!0;function ng(a,s,c,g){var w=Fe.T;Fe.T=null;var M=nt.p;try{nt.p=2,ud(a,s,c,g)}finally{nt.p=M,Fe.T=w}}function Np(a,s,c,g){var w=Fe.T;Fe.T=null;var M=nt.p;try{nt.p=8,ud(a,s,c,g)}finally{nt.p=M,Fe.T=w}}function ud(a,s,c,g){if(au){var w=Rf(g);if(w===null)wo(a,s,g,hl,c),Um(a,g);else if(ag(w,a,s,c,g))g.stopPropagation();else if(Um(a,g),s&4&&-1<Vm.indexOf(a)){for(;w!==null;){var M=Ss(w);if(M!==null)switch(M.tag){case 3:if(M=M.stateNode,M.current.memoizedState.isDehydrated){var k=le(M.pendingLanes);if(k!==0){var H=M;for(H.pendingLanes|=2,H.entangledLanes|=2;k;){var fe=1<<31-ue(k);H.entanglements[1]|=fe,k&=~fe}Gs(M),(Fi&6)===0&&(qh=Ln()+500,Nr(0))}}break;case 31:case 13:H=cr(M,2),H!==null&&wr(H,M,2),Hh(),Fp(M,2)}if(M=Rf(g),M===null&&wo(a,s,g,hl,c),M===w)break;w=M}w!==null&&g.stopPropagation()}else wo(a,s,g,null,c)}}function Rf(a){return a=fu(a),Lf(a)}var hl=null;function Lf(a){if(hl=null,a=Xr(a),a!==null){var s=ve(a);if(s===null)a=null;else{var c=s.tag;if(c===13){if(a=P(s),a!==null)return a;a=null}else if(c===31){if(a=h(s),a!==null)return a;a=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;a=null}else s!==a&&(a=null)}}return hl=a,null}function Nm(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Oa()){case xl:return 2;case ws:return 8;case Ts:case lu:return 32;case Xs:return 268435456;default:return 32}default:return 32}}var sc=!1,dl=null,fl=null,pl=null,cd=new Map,hd=new Map,Mo=[],Vm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Um(a,s){switch(a){case"focusin":case"focusout":dl=null;break;case"dragenter":case"dragleave":fl=null;break;case"mouseover":case"mouseout":pl=null;break;case"pointerover":case"pointerout":cd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":hd.delete(s.pointerId)}}function dd(a,s,c,g,w,M){return a===null||a.nativeEvent!==M?(a={blockedOn:s,domEventName:c,eventSystemFlags:g,nativeEvent:M,targetContainers:[w]},s!==null&&(s=Ss(s),s!==null&&jm(s)),a):(a.eventSystemFlags|=g,s=a.targetContainers,w!==null&&s.indexOf(w)===-1&&s.push(w),a)}function ag(a,s,c,g,w){switch(s){case"focusin":return dl=dd(dl,a,s,c,g,w),!0;case"dragenter":return fl=dd(fl,a,s,c,g,w),!0;case"mouseover":return pl=dd(pl,a,s,c,g,w),!0;case"pointerover":var M=w.pointerId;return cd.set(M,dd(cd.get(M)||null,a,s,c,g,w)),!0;case"gotpointercapture":return M=w.pointerId,hd.set(M,dd(hd.get(M)||null,a,s,c,g,w)),!0}return!1}function Gm(a){var s=Xr(a.target);if(s!==null){var c=ve(s);if(c!==null){if(s=c.tag,s===13){if(s=P(c),s!==null){a.blockedOn=s,qi(a.priority,function(){jp(c)});return}}else if(s===31){if(s=h(c),s!==null){a.blockedOn=s,qi(a.priority,function(){jp(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){a.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}a.blockedOn=null}function kf(a){if(a.blockedOn!==null)return!1;for(var s=a.targetContainers;0<s.length;){var c=Rf(a.nativeEvent);if(c===null){c=a.nativeEvent;var g=new c.constructor(c.type,c);ch=g,c.target.dispatchEvent(g),ch=null}else return s=Ss(c),s!==null&&jm(s),a.blockedOn=c,!1;s.shift()}return!0}function Vp(a,s,c){kf(a)&&c.delete(s)}function rg(){sc=!1,dl!==null&&kf(dl)&&(dl=null),fl!==null&&kf(fl)&&(fl=null),pl!==null&&kf(pl)&&(pl=null),cd.forEach(Vp),hd.forEach(Vp)}function ru(a,s){a.blockedOn===s&&(a.blockedOn=null,sc||(sc=!0,X.unstable_scheduleCallback(X.unstable_NormalPriority,rg)))}var Of=null;function qm(a){Of!==a&&(Of=a,X.unstable_scheduleCallback(X.unstable_NormalPriority,function(){Of===a&&(Of=null);for(var s=0;s<a.length;s+=3){var c=a[s],g=a[s+1],w=a[s+2];if(typeof g!="function"){if(Lf(g||c)===null)continue;break}var M=Ss(c);M!==null&&(a.splice(s,3),s-=3,gn(M,{pending:!0,data:w,method:c.method,action:g},g,w))}}))}function sh(a){function s(fe){return ru(fe,a)}dl!==null&&ru(dl,a),fl!==null&&ru(fl,a),pl!==null&&ru(pl,a),cd.forEach(s),hd.forEach(s);for(var c=0;c<Mo.length;c++){var g=Mo[c];g.blockedOn===a&&(g.blockedOn=null)}for(;0<Mo.length&&(c=Mo[0],c.blockedOn===null);)Gm(c),c.blockedOn===null&&Mo.shift();if(c=(a.ownerDocument||a).$$reactFormReplay,c!=null)for(g=0;g<c.length;g+=3){var w=c[g],M=c[g+1],k=w[Je]||null;if(typeof M=="function")k||qm(c);else if(k){var H=null;if(M&&M.hasAttribute("formAction")){if(w=M,k=M[Je]||null)H=k.formAction;else if(Lf(w)!==null)continue}else H=k.action;typeof H=="function"?c[g+1]=H:(c.splice(g,3),g-=3),qm(c)}}}function Bf(){function a(M){M.canIntercept&&M.info==="react-transition"&&M.intercept({handler:function(){return new Promise(function(k){return w=k})},focusReset:"manual",scroll:"manual"})}function s(){w!==null&&(w(),w=null),g||setTimeout(c,20)}function c(){if(!g&&!navigation.transition){var M=navigation.currentEntry;M&&M.url!=null&&navigation.navigate(M.url,{state:M.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var g=!1,w=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(c,100),function(){g=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),w!==null&&(w(),w=null)}}}function Ff(a){this._internalRoot=a}jf.prototype.render=Ff.prototype.render=function(a){var s=this._internalRoot;if(s===null)throw Error(Q(409));var c=s.current,g=br();Pf(c,g,a,s,null,null)},jf.prototype.unmount=Ff.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var s=a.containerInfo;Pf(a.current,2,null,a,null,null),Hh(),s[Ct]=null}};function jf(a){this._internalRoot=a}jf.prototype.unstable_scheduleHydration=function(a){if(a){var s=_i();a={blockedOn:null,target:a,priority:s};for(var c=0;c<Mo.length&&s!==0&&s<Mo[c].priority;c++);Mo.splice(c,0,a),c===0&&Gm(a)}};var Zm=ae.version;if(Zm!=="19.2.4")throw Error(Q(527,Zm,"19.2.4"));nt.findDOMNode=function(a){var s=a._reactInternals;if(s===void 0)throw typeof a.render=="function"?Error(Q(188)):(a=Object.keys(a).join(","),Error(Q(268,a)));return a=ke(s),a=a!==null?st(a):null,a=a===null?null:a.stateNode,a};var Hm={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:Fe,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fd.isDisabled&&fd.supportsFiber)try{N=fd.inject(Hm),U=fd}catch{}}return Hp.createRoot=function(a,s){if(!pe(a))throw Error(Q(299));var c=!1,g="",w=Vc,M=js,k=Ns;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(g=s.identifierPrefix),s.onUncaughtError!==void 0&&(w=s.onUncaughtError),s.onCaughtError!==void 0&&(M=s.onCaughtError),s.onRecoverableError!==void 0&&(k=s.onRecoverableError)),s=Bm(a,1,!1,null,null,c,g,null,w,M,k,Bf),a[Ct]=s.current,Tp(a),new Ff(s)},Hp.hydrateRoot=function(a,s,c){if(!pe(a))throw Error(Q(299));var g=!1,w="",M=Vc,k=js,H=Ns,fe=null;return c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(w=c.identifierPrefix),c.onUncaughtError!==void 0&&(M=c.onUncaughtError),c.onCaughtError!==void 0&&(k=c.onCaughtError),c.onRecoverableError!==void 0&&(H=c.onRecoverableError),c.formState!==void 0&&(fe=c.formState)),s=Bm(a,1,!0,s,c??null,g,w,fe,M,k,H,Bf),s.context=Fm(null),c=s.current,g=br(),g=Qi(g),w=ps(g),w.callback=null,Ls(c,w,g),c=g,s.current.lanes=c,Ft(s,c),Gs(s),a[Ct]=s.current,Tp(a),new jf(s)},Hp.version="19.2.4",Hp}var Hg;function B_(){if(Hg)return yg.exports;Hg=1;function X(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(X)}catch(ae){console.error(ae)}}return X(),yg.exports=O_(),yg.exports}var F_=B_();const j_="modulepreload",N_=function(X){return"/MApp/"+X},$g={},V_=function(ae,he,Q){let pe=Promise.resolve();if(he&&he.length>0){let ke=function(st){return Promise.all(st.map(Ye=>Promise.resolve(Ye).then(xt=>({status:"fulfilled",value:xt}),xt=>({status:"rejected",reason:xt}))))};var P=ke;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),ge=h?.nonce||h?.getAttribute("nonce");pe=ke(he.map(st=>{if(st=N_(st),st in $g)return;$g[st]=!0;const Ye=st.endsWith(".css"),xt=Ye?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${st}"]${xt}`))return;const Tt=document.createElement("link");if(Tt.rel=Ye?"stylesheet":j_,Ye||(Tt.as="script"),Tt.crossOrigin="",Tt.href=st,ge&&Tt.setAttribute("nonce",ge),document.head.appendChild(Tt),Ye)return new Promise((ui,bt)=>{Tt.addEventListener("load",ui),Tt.addEventListener("error",()=>bt(new Error(`Unable to preload CSS for ${st}`)))})}))}function ve(h){const ge=new Event("vite:preloadError",{cancelable:!0});if(ge.payload=h,window.dispatchEvent(ge),!ge.defaultPrevented)throw h}return pe.then(h=>{for(const ge of h||[])ge.status==="rejected"&&ve(ge.reason);return ae().catch(ve)})},U_=it.createContext(null);function G_(X,ae){const he=Array.isArray(X)?X[0]:X?X.x:0,Q=Array.isArray(X)?X[1]:X?X.y:0,pe=Array.isArray(ae)?ae[0]:ae?ae.x:0,ve=Array.isArray(ae)?ae[1]:ae?ae.y:0;return he===pe&&Q===ve}function xs(X,ae){if(X===ae)return!0;if(!X||!ae)return!1;if(Array.isArray(X)){if(!Array.isArray(ae)||X.length!==ae.length)return!1;for(let he=0;he<X.length;he++)if(!xs(X[he],ae[he]))return!1;return!0}else if(Array.isArray(ae))return!1;if(typeof X=="object"&&typeof ae=="object"){const he=Object.keys(X),Q=Object.keys(ae);if(he.length!==Q.length)return!1;for(const pe of he)if(!ae.hasOwnProperty(pe)||!xs(X[pe],ae[pe]))return!1;return!0}return!1}function Xg(X){return{longitude:X.center.lng,latitude:X.center.lat,zoom:X.zoom,pitch:X.pitch,bearing:X.bearing,padding:X.padding}}function Yg(X,ae){const he=ae.viewState||ae,Q={};if("longitude"in he&&"latitude"in he&&(he.longitude!==X.center.lng||he.latitude!==X.center.lat)){const pe=X.center.constructor;Q.center=new pe(he.longitude,he.latitude)}return"zoom"in he&&he.zoom!==X.zoom&&(Q.zoom=he.zoom),"bearing"in he&&he.bearing!==X.bearing&&(Q.bearing=he.bearing),"pitch"in he&&he.pitch!==X.pitch&&(Q.pitch=he.pitch),he.padding&&X.padding&&!xs(he.padding,X.padding)&&(Q.padding=he.padding),Q}const q_=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Wg(X){if(!X)return null;if(typeof X=="string"||("toJS"in X&&(X=X.toJS()),!X.layers))return X;const ae={};for(const Q of X.layers)ae[Q.id]=Q;const he=X.layers.map(Q=>{let pe=null;"interactive"in Q&&(pe=Object.assign({},Q),delete pe.interactive);const ve=ae[Q.ref];if(ve){pe=pe||Object.assign({},Q),delete pe.ref;for(const P of q_)P in ve&&(pe[P]=ve[P])}return pe||Q});return{...X,layers:he}}const Kg={version:8,sources:{},layers:[]},Qg={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Jg={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},e_={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Z_=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],H_=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Gf{constructor(ae,he,Q){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=pe=>{const ve=this.props[e_[pe.type]];ve?ve(pe):pe.type==="error"&&console.error(pe.error)},this._onCameraEvent=pe=>{if(this._internalUpdate)return;pe.viewState=this._propsedCameraUpdate||Xg(this._map.transform);const ve=this.props[Jg[pe.type]];ve&&ve(pe)},this._onCameraUpdate=pe=>this._internalUpdate?pe:(this._propsedCameraUpdate=Xg(pe),Yg(pe,this.props)),this._onPointerEvent=pe=>{(pe.type==="mousemove"||pe.type==="mouseout")&&this._updateHover(pe);const ve=this.props[Qg[pe.type]];ve&&(this.props.interactiveLayerIds&&pe.type!=="mouseover"&&pe.type!=="mouseout"&&(pe.features=this._hoveredFeatures||this._queryRenderedFeatures(pe.point)),ve(pe),delete pe.features)},this._MapClass=ae,this.props=he,this._initialize(Q)}get map(){return this._map}setProps(ae){const he=this.props;this.props=ae;const Q=this._updateSettings(ae,he),pe=this._updateSize(ae),ve=this._updateViewState(ae);this._updateStyle(ae,he),this._updateStyleComponents(ae),this._updateHandlers(ae,he),(Q||pe||ve&&!this._map.isMoving())&&this.redraw()}static reuse(ae,he){const Q=Gf.savedMaps.pop();if(!Q)return null;const pe=Q.map,ve=pe.getContainer();for(he.className=ve.className;ve.childNodes.length>0;)he.appendChild(ve.childNodes[0]);pe._container=he;const P=pe._resizeObserver;P&&(P.disconnect(),P.observe(he)),Q.setProps({...ae,styleDiffing:!1}),pe.resize();const{initialViewState:h}=ae;return h&&(h.bounds?pe.fitBounds(h.bounds,{...h.fitBoundsOptions,duration:0}):Q._updateViewState(h)),pe.isStyleLoaded()?pe.fire("load"):pe.once("style.load",()=>pe.fire("load")),pe._update(),Q}_initialize(ae){const{props:he}=this,{mapStyle:Q=Kg}=he,pe={...he,...he.initialViewState,container:ae,style:Wg(Q)},ve=pe.initialViewState||pe.viewState||pe;if(Object.assign(pe,{center:[ve.longitude||0,ve.latitude||0],zoom:ve.zoom||0,pitch:ve.pitch||0,bearing:ve.bearing||0}),he.gl){const h=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=h,he.gl)}const P=new this._MapClass(pe);ve.padding&&P.setPadding(ve.padding),he.cursor&&(P.getCanvas().style.cursor=he.cursor),P.transformCameraUpdate=this._onCameraUpdate,P.on("style.load",()=>{this._styleComponents={light:P.getLight(),sky:P.getSky(),projection:P.getProjection?.(),terrain:P.getTerrain()},this._updateStyleComponents(this.props)}),P.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const h in Qg)P.on(h,this._onPointerEvent);for(const h in Jg)P.on(h,this._onCameraEvent);for(const h in e_)P.on(h,this._onEvent);this._map=P}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),Gf.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const ae=this._map;ae.style&&(ae._frame&&(ae._frame.cancel(),ae._frame=null),ae._render())}_updateSize(ae){const{viewState:he}=ae;if(he){const Q=this._map;if(he.width!==Q.transform.width||he.height!==Q.transform.height)return Q.resize(),!0}return!1}_updateViewState(ae){const he=this._map,Q=he.transform;if(!he.isMoving()){const ve=Yg(Q,ae);if(Object.keys(ve).length>0)return this._internalUpdate=!0,he.jumpTo(ve),this._internalUpdate=!1,!0}return!1}_updateSettings(ae,he){const Q=this._map;let pe=!1;for(const ve of Z_)ve in ae&&!xs(ae[ve],he[ve])&&(pe=!0,Q[`set${ve[0].toUpperCase()}${ve.slice(1)}`]?.call(Q,ae[ve]));return pe}_updateStyle(ae,he){if(ae.cursor!==he.cursor&&(this._map.getCanvas().style.cursor=ae.cursor||""),ae.mapStyle!==he.mapStyle){const{mapStyle:Q=Kg,styleDiffing:pe=!0}=ae,ve={diff:pe};"localIdeographFontFamily"in ae&&(ve.localIdeographFontFamily=ae.localIdeographFontFamily),this._map.setStyle(Wg(Q),ve)}}_updateStyleComponents({light:ae,projection:he,sky:Q,terrain:pe}){const ve=this._map,P=this._styleComponents;ve.style._loaded&&(ae&&!xs(ae,P.light)&&(P.light=ae,ve.setLight(ae)),he&&!xs(he,P.projection)&&he!==P.projection?.type&&(P.projection=typeof he=="string"?{type:he}:he,ve.setProjection?.(P.projection)),Q&&!xs(Q,P.sky)&&(P.sky=Q,ve.setSky(Q)),pe!==void 0&&!xs(pe,P.terrain)&&(!pe||ve.getSource(pe.source))&&(P.terrain=pe,ve.setTerrain(pe)))}_updateHandlers(ae,he){const Q=this._map;for(const pe of H_){const ve=ae[pe]??!0,P=he[pe]??!0;xs(ve,P)||(ve?Q[pe].enable(ve):Q[pe].disable())}}_queryRenderedFeatures(ae){const he=this._map,{interactiveLayerIds:Q=[]}=this.props;try{return he.queryRenderedFeatures(ae,{layers:Q.filter(he.getLayer.bind(he))})}catch{return[]}}_updateHover(ae){const{props:he}=this;if(he.interactiveLayerIds&&(he.onMouseMove||he.onMouseEnter||he.onMouseLeave)){const pe=ae.type,ve=this._hoveredFeatures?.length>0,P=this._queryRenderedFeatures(ae.point),h=P.length>0;!h&&ve&&(ae.type="mouseleave",this._onPointerEvent(ae)),this._hoveredFeatures=P,h&&!ve&&(ae.type="mouseenter",this._onPointerEvent(ae)),ae.type=pe}else this._hoveredFeatures=null}}Gf.savedMaps=[];const $_=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function X_(X){if(!X)return null;const ae=X.map,he={getMap:()=>ae};for(const Q of Y_(ae))!(Q in he)&&!$_.includes(Q)&&(he[Q]=ae[Q].bind(ae));return he}function Y_(X){const ae=new Set;let he=X;for(;he;){for(const Q of Object.getOwnPropertyNames(he))Q[0]!=="_"&&typeof X[Q]=="function"&&Q!=="fire"&&Q!=="setEventedParent"&&ae.add(Q);he=Object.getPrototypeOf(he)}return Array.from(ae)}const W_=typeof document<"u"?it.useLayoutEffect:it.useEffect;function K_(X,ae){const{RTLTextPlugin:he,maxParallelImageRequests:Q,workerCount:pe,workerUrl:ve}=ae;if(he&&X.getRTLTextPluginStatus&&X.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:P,lazy:h=!0}=typeof he=="string"?{pluginUrl:he}:he;X.setRTLTextPlugin(P,ge=>{ge&&console.error(ge)},h)}Q!==void 0&&X.setMaxParallelImageRequests(Q),pe!==void 0&&X.setWorkerCount(pe),ve!==void 0&&X.setWorkerUrl(ve)}const qf=it.createContext(null);function Q_(X,ae){const he=it.useContext(U_),[Q,pe]=it.useState(null),ve=it.useRef(),{current:P}=it.useRef({mapLib:null,map:null});it.useEffect(()=>{const ke=X.mapLib;let st=!0,Ye;return Promise.resolve(ke||V_(()=>Promise.resolve().then(()=>yy),void 0)).then(xt=>{if(!st)return;if(!xt)throw new Error("Invalid mapLib");const Tt="Map"in xt?xt:xt.default;if(!Tt.Map)throw new Error("Invalid mapLib");K_(Tt,X),X.reuseMaps&&(Ye=Gf.reuse(X,ve.current)),Ye||(Ye=new Gf(Tt.Map,X,ve.current)),P.map=X_(Ye),P.mapLib=Tt,pe(Ye),he?.onMapMount(P.map,X.id)}).catch(xt=>{const{onError:Tt}=X;Tt?Tt({type:"error",target:null,originalEvent:null,error:xt}):console.error(xt)}),()=>{st=!1,Ye&&(he?.onMapUnmount(X.id),X.reuseMaps?Ye.recycle():Ye.destroy())}},[]),W_(()=>{Q&&Q.setProps(X)}),it.useImperativeHandle(ae,()=>P.map,[Q]);const h=it.useMemo(()=>({position:"relative",width:"100%",height:"100%",...X.style}),[X.style]),ge={height:"100%"};return it.createElement("div",{id:X.id,ref:ve,style:h},Q&&it.createElement(qf.Provider,{value:P},it.createElement("div",{"mapboxgl-children":"",style:ge},X.children)))}const J_=it.forwardRef(Q_);var o_=s_();const ey=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function uc(X,ae){if(!X||!ae)return;const he=X.style;for(const Q in ae){const pe=ae[Q];Number.isFinite(pe)&&!ey.test(Q)?he[Q]=`${pe}px`:he[Q]=pe}}function l_(X,ae){if(X===ae)return null;const he=t_(X),Q=t_(ae),pe=[];for(const ve of Q)he.has(ve)||pe.push(ve);for(const ve of he)Q.has(ve)||pe.push(ve);return pe.length===0?null:pe}function t_(X){return new Set(X?X.trim().split(/\s+/):[])}const wg=it.memo(it.forwardRef((X,ae)=>{const{map:he,mapLib:Q}=it.useContext(qf),pe=it.useRef({props:X}),ve=it.useMemo(()=>{let di=!1;it.Children.forEach(X.children,si=>{si&&(di=!0)});const ti={...X,element:di?document.createElement("div"):void 0},pt=new Q.Marker(ti);return pt.setLngLat([X.longitude,X.latitude]),pt.getElement().addEventListener("click",si=>{pe.current.props.onClick?.({type:"click",target:pt,originalEvent:si})}),pt.on("dragstart",si=>{const $t=si;$t.lngLat=ve.getLngLat(),pe.current.props.onDragStart?.($t)}),pt.on("drag",si=>{const $t=si;$t.lngLat=ve.getLngLat(),pe.current.props.onDrag?.($t)}),pt.on("dragend",si=>{const $t=si;$t.lngLat=ve.getLngLat(),pe.current.props.onDragEnd?.($t)}),pt},[]);it.useEffect(()=>(ve.addTo(he.getMap()),()=>{ve.remove()}),[]);const{longitude:P,latitude:h,offset:ge,style:ke,draggable:st=!1,popup:Ye=null,rotation:xt=0,rotationAlignment:Tt="auto",pitchAlignment:ui="auto"}=X;it.useEffect(()=>{uc(ve.getElement(),ke)},[ke]),it.useImperativeHandle(ae,()=>ve,[]);const bt=pe.current.props;(ve.getLngLat().lng!==P||ve.getLngLat().lat!==h)&&ve.setLngLat([P,h]),ge&&!G_(ve.getOffset(),ge)&&ve.setOffset(ge),ve.isDraggable()!==st&&ve.setDraggable(st),ve.getRotation()!==xt&&ve.setRotation(xt),ve.getRotationAlignment()!==Tt&&ve.setRotationAlignment(Tt),ve.getPitchAlignment()!==ui&&ve.setPitchAlignment(ui),ve.getPopup()!==Ye&&ve.setPopup(Ye);const Ce=l_(bt.className,X.className);if(Ce)for(const di of Ce)ve.toggleClassName(di);return pe.current.props=X,o_.createPortal(X.children,ve.getElement())})),ty=it.memo(it.forwardRef((X,ae)=>{const{map:he,mapLib:Q}=it.useContext(qf),pe=it.useMemo(()=>document.createElement("div"),[]),ve=it.useRef({props:X}),P=it.useMemo(()=>{const h={...X},ge=new Q.Popup(h);return ge.setLngLat([X.longitude,X.latitude]),ge.once("open",ke=>{ve.current.props.onOpen?.(ke)}),ge},[]);if(it.useEffect(()=>{const h=ge=>{ve.current.props.onClose?.(ge)};return P.on("close",h),P.setDOMContent(pe).addTo(he.getMap()),()=>{P.off("close",h),P.isOpen()&&P.remove()}},[]),it.useEffect(()=>{uc(P.getElement(),X.style)},[X.style]),it.useImperativeHandle(ae,()=>P,[]),P.isOpen()){const h=ve.current.props;(P.getLngLat().lng!==X.longitude||P.getLngLat().lat!==X.latitude)&&P.setLngLat([X.longitude,X.latitude]),X.offset&&!xs(h.offset,X.offset)&&P.setOffset(X.offset),(h.anchor!==X.anchor||h.maxWidth!==X.maxWidth)&&(P.options.anchor=X.anchor,P.setMaxWidth(X.maxWidth));const ge=l_(h.className,X.className);if(ge)for(const ke of ge)P.toggleClassName(ke);ve.current.props=X}return o_.createPortal(X.children,pe)}));function _d(X,ae,he,Q){const pe=it.useContext(qf),ve=it.useMemo(()=>X(pe),[]);return it.useEffect(()=>{const P=ae,h=null,ge=typeof ae=="function"?ae:null,{map:ke}=pe;return ke.hasControl(ve)||(ke.addControl(ve,P?.position),h&&h(pe)),()=>{ge&&ge(pe),ke.hasControl(ve)&&ke.removeControl(ve)}},[]),ve}function iy(X){const ae=_d(({mapLib:he})=>new he.AttributionControl(X),{position:X.position});return it.useEffect(()=>{uc(ae._container,X.style)},[X.style]),null}it.memo(iy);function ny(X){const ae=_d(({mapLib:he})=>new he.FullscreenControl({container:X.containerId&&document.getElementById(X.containerId)}),{position:X.position});return it.useEffect(()=>{uc(ae._controlContainer,X.style)},[X.style]),null}it.memo(ny);function ay(X,ae){const he=it.useRef({props:X}),Q=_d(({mapLib:pe})=>{const ve=new pe.GeolocateControl(X),P=ve._setupUI;return ve._setupUI=()=>{ve._container.hasChildNodes()||P()},ve.on("geolocate",h=>{he.current.props.onGeolocate?.(h)}),ve.on("error",h=>{he.current.props.onError?.(h)}),ve.on("outofmaxbounds",h=>{he.current.props.onOutOfMaxBounds?.(h)}),ve.on("trackuserlocationstart",h=>{he.current.props.onTrackUserLocationStart?.(h)}),ve.on("trackuserlocationend",h=>{he.current.props.onTrackUserLocationEnd?.(h)}),ve},{position:X.position});return he.current.props=X,it.useImperativeHandle(ae,()=>Q,[]),it.useEffect(()=>{uc(Q._container,X.style)},[X.style]),null}it.memo(it.forwardRef(ay));function ry(X){const ae=_d(({mapLib:he})=>new he.NavigationControl(X),{position:X.position});return it.useEffect(()=>{uc(ae._container,X.style)},[X.style]),null}const sy=it.memo(ry);function oy(X){const ae=_d(({mapLib:ve})=>new ve.ScaleControl(X),{position:X.position}),he=it.useRef(X),Q=he.current;he.current=X;const{style:pe}=X;return X.maxWidth!==void 0&&X.maxWidth!==Q.maxWidth&&(ae.options.maxWidth=X.maxWidth),X.unit!==void 0&&X.unit!==Q.unit&&ae.setUnit(X.unit),it.useEffect(()=>{uc(ae._container,pe)},[pe]),null}it.memo(oy);function ly(X){const ae=_d(({mapLib:he})=>new he.TerrainControl(X),{position:X.position});return it.useEffect(()=>{uc(ae._container,X.style)},[X.style]),null}it.memo(ly);function uy(X){const ae=_d(({mapLib:he})=>new he.LogoControl(X),{position:X.position});return it.useEffect(()=>{uc(ae._container,X.style)},[X.style]),null}it.memo(uy);function Km(X,ae){if(!X)throw new Error(ae)}let cy=0;function hy(X,ae,he){if(X.style&&X.style._loaded){const Q={...he};return delete Q.id,delete Q.children,X.addSource(ae,Q),X.getSource(ae)}return null}function dy(X,ae,he){Km(ae.id===he.id,"source id changed"),Km(ae.type===he.type,"source type changed");let Q="",pe=0;for(const P in ae)P!=="children"&&P!=="id"&&!xs(he[P],ae[P])&&(Q=P,pe++);if(!pe)return;const ve=ae.type;if(ve==="geojson")X.setData(ae.data);else if(ve==="image")X.updateImage({url:ae.url,coordinates:ae.coordinates});else switch(Q){case"coordinates":X.setCoordinates?.(ae.coordinates);break;case"url":X.setUrl?.(ae.url);break;case"tiles":X.setTiles?.(ae.tiles);break;default:console.warn(`Unable to update <Source> prop: ${Q}`)}}function i_(X){const ae=it.useContext(qf).map.getMap(),he=it.useRef(X),[,Q]=it.useState(0),pe=it.useMemo(()=>X.id||`jsx-source-${cy++}`,[]);it.useEffect(()=>{if(ae){const P=()=>setTimeout(()=>Q(h=>h+1),0);return ae.on("styledata",P),P(),()=>{if(ae.off("styledata",P),ae.style&&ae.style._loaded&&ae.getSource(pe)){const h=ae.getStyle()?.layers;if(h)for(const ge of h)ge.source===pe&&ae.removeLayer(ge.id);ae.removeSource(pe)}}}},[ae]);let ve=ae&&ae.style&&ae.getSource(pe);return ve?dy(ve,X,he.current):ve=hy(ae,pe,X),he.current=X,ve&&it.Children.map(X.children,P=>P&&it.cloneElement(P,{source:pe}))||null}function fy(X,ae,he,Q){if(Km(he.id===Q.id,"layer id changed"),Km(he.type===Q.type,"layer type changed"),he.type==="custom"||Q.type==="custom")return;const{layout:pe={},paint:ve={},filter:P,minzoom:h,maxzoom:ge,beforeId:ke}=he;if(ke!==Q.beforeId&&X.moveLayer(ae,ke),pe!==Q.layout){const st=Q.layout||{};for(const Ye in pe)xs(pe[Ye],st[Ye])||X.setLayoutProperty(ae,Ye,pe[Ye]);for(const Ye in st)pe.hasOwnProperty(Ye)||X.setLayoutProperty(ae,Ye,void 0)}if(ve!==Q.paint){const st=Q.paint||{};for(const Ye in ve)xs(ve[Ye],st[Ye])||X.setPaintProperty(ae,Ye,ve[Ye]);for(const Ye in st)ve.hasOwnProperty(Ye)||X.setPaintProperty(ae,Ye,void 0)}xs(P,Q.filter)||X.setFilter(ae,P),(h!==Q.minzoom||ge!==Q.maxzoom)&&X.setLayerZoomRange(ae,h,ge)}function py(X,ae,he){if(X.style&&X.style._loaded&&(!("source"in he)||X.getSource(he.source))){const Q={...he,id:ae};delete Q.beforeId,X.addLayer(Q,he.beforeId)}}let my=0;function n_(X){const ae=it.useContext(qf).map.getMap(),he=it.useRef(X),[,Q]=it.useState(0),pe=it.useMemo(()=>X.id||`jsx-layer-${my++}`,[]);if(it.useEffect(()=>{if(ae){const P=()=>Q(h=>h+1);return ae.on("styledata",P),P(),()=>{ae.off("styledata",P),ae.style&&ae.style._loaded&&ae.getLayer(pe)&&ae.removeLayer(pe)}}},[ae]),ae&&ae.style&&ae.getLayer(pe))try{fy(ae,pe,X,he.current)}catch(P){console.warn(P)}else py(ae,pe,X);return he.current=X,null}var Wm={exports:{}};var gy=Wm.exports,a_;function _y(){return a_||(a_=1,(function(X,ae){(function(he,Q){X.exports=Q()})(gy,(function(){var he={},Q={};function pe(P,h,ge){if(Q[P]=ge,P==="index"){var ke="var sharedModule = {}; ("+Q.shared+")(sharedModule); ("+Q.worker+")(sharedModule);",st={};return Q.shared(st),Q.index(he,st),typeof window<"u"&&he.setWorkerUrl(window.URL.createObjectURL(new Blob([ke],{type:"text/javascript"}))),he}}pe("shared",["exports"],(function(P){function h(n,e,i,o){return new(i||(i=Promise))((function(u,f){function p(T){try{x(o.next(T))}catch(E){f(E)}}function y(T){try{x(o.throw(T))}catch(E){f(E)}}function x(T){var E;T.done?u(T.value):(E=T.value,E instanceof i?E:new i((function(A){A(E)}))).then(p,y)}x((o=o.apply(n,e||[])).next())}))}function ge(n,e){this.x=n,this.y=e}function ke(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var st,Ye;typeof SuppressedError=="function"&&SuppressedError,ge.prototype={clone(){return new ge(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround(n,e){const i=Math.cos(n),o=Math.sin(n),u=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ge},ge.convert=function(n){if(n instanceof ge)return n;if(Array.isArray(n))return new ge(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new ge(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var xt=(function(){if(Ye)return st;function n(e,i,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=u}return Ye=1,st=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var f=this.sampleCurveX(o)-e;if(Math.abs(f)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=f/p}var y=0,x=1;for(o=e,u=0;u<20&&(f=this.sampleCurveX(o),!(Math.abs(f-e)<i));u++)e>f?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},st})(),Tt=ke(xt);let ui,bt;function Ce(){return ui==null&&(ui=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ui}function di(){if(bt==null&&(bt=!1,Ce())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const u=4*o;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const i=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&i[o]!==o){bt=!0;break}}}return bt||!1}var ti=1e-6,pt=typeof Float32Array<"u"?Float32Array:Array;function si(){var n=new pt(9);return pt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function $t(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Mi(){var n=new pt(3);return pt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Pt(n){var e=n[0],i=n[1],o=n[2];return Math.sqrt(e*e+i*i+o*o)}function Kt(n,e,i){var o=new pt(3);return o[0]=n,o[1]=e,o[2]=i,o}function Lt(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function ii(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function gi(n,e,i){var o=e[0],u=e[1],f=e[2],p=i[0],y=i[1],x=i[2];return n[0]=u*x-f*y,n[1]=f*p-o*x,n[2]=o*y-u*p,n}var kt,Nt=Pt;function ni(n,e,i){var o=e[0],u=e[1],f=e[2],p=e[3];return n[0]=i[0]*o+i[4]*u+i[8]*f+i[12]*p,n[1]=i[1]*o+i[5]*u+i[9]*f+i[13]*p,n[2]=i[2]*o+i[6]*u+i[10]*f+i[14]*p,n[3]=i[3]*o+i[7]*u+i[11]*f+i[15]*p,n}function Vi(){var n=new pt(4);return pt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Fe(n,e,i,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",f=Math.PI/360;e*=f,o*=f,i*=f;var p=Math.sin(e),y=Math.cos(e),x=Math.sin(i),T=Math.cos(i),E=Math.sin(o),A=Math.cos(o);switch(u){case"xyz":n[0]=p*T*A+y*x*E,n[1]=y*x*A-p*T*E,n[2]=y*T*E+p*x*A,n[3]=y*T*A-p*x*E;break;case"xzy":n[0]=p*T*A-y*x*E,n[1]=y*x*A-p*T*E,n[2]=y*T*E+p*x*A,n[3]=y*T*A+p*x*E;break;case"yxz":n[0]=p*T*A+y*x*E,n[1]=y*x*A-p*T*E,n[2]=y*T*E-p*x*A,n[3]=y*T*A+p*x*E;break;case"yzx":n[0]=p*T*A+y*x*E,n[1]=y*x*A+p*T*E,n[2]=y*T*E-p*x*A,n[3]=y*T*A-p*x*E;break;case"zxy":n[0]=p*T*A-y*x*E,n[1]=y*x*A+p*T*E,n[2]=y*T*E+p*x*A,n[3]=y*T*A-p*x*E;break;case"zyx":n[0]=p*T*A-y*x*E,n[1]=y*x*A+p*T*E,n[2]=y*T*E-p*x*A,n[3]=y*T*A+p*x*E;break;default:throw new Error("Unknown angle order "+u)}return n}function nt(){var n=new pt(2);return pt!=Float32Array&&(n[0]=0,n[1]=0),n}function ht(n,e){var i=new pt(2);return i[0]=n,i[1]=e,i}Mi(),kt=new pt(4),pt!=Float32Array&&(kt[0]=0,kt[1]=0,kt[2]=0,kt[3]=0),Mi(),Kt(1,0,0),Kt(0,1,0),Vi(),Vi(),si(),nt();const _t=8192;function li(n,e,i){return e*(_t/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}function me(n,e){return(n%e+e)%e}function Ze(n,e,i){return n*(1-i)+e*i}function lt(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function dt(n,e,i,o){const u=new Tt(n,e,i,o);return f=>u.solve(f)}const Mt=dt(.25,.1,.25,1);function Ot(n,e,i){return Math.min(i,Math.max(e,n))}function Zt(n,e,i){const o=i-e,u=((n-e)%o+o)%o+e;return u===e?i:u}function Ui(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}let Hi=1;function Mr(n,e,i){const o={};for(const u in n)o[u]=e.call(this,n[u],u,n);return o}function qr(n,e,i){const o={};for(const u in n)e.call(this,n[u],u,n)&&(o[u]=n[u]);return o}function Nn(n){return Array.isArray(n)?n.map(Nn):typeof n=="object"&&n?Mr(n,Nn):n}const ou={};function xn(n){ou[n]||(typeof console<"u"&&console.warn(n),ou[n]=!0)}function ca(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function ar(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let Wi=null;function Zr(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const $s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function bs(n,e,i,o,u){return h(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(n,{timestamp:0});try{const p=f?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const y=p.startsWith("BGR"),x=new Uint8ClampedArray(o*u*4);if(yield f.copyTo(x,(function(T,E,A,D,I){const O=4*Math.max(-E,0),F=(Math.max(0,A)-A)*D*4+O,V=4*D,Z=Math.max(0,E),J=Math.max(0,A);return{rect:{x:Z,y:J,width:Math.min(T.width,E+D)-Z,height:Math.min(T.height,A+I)-J},layout:[{offset:F,stride:V}]}})(n,e,i,o,u)),y)for(let T=0;T<x.length;T+=4){const E=x[T];x[T]=x[T+2],x[T+2]=E}return x}finally{f.close()}}))}let Hr,Er;function vl(n,e,i,o){return n.addEventListener(e,i,o),{unsubscribe:()=>{n.removeEventListener(e,i,o)}}}function Ln(n){return n*Math.PI/180}function Oa(n){return n/Math.PI*180}const xl={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ws={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Ts="AbortError";class lu extends Error{constructor(e=Ts){super(e instanceof Error?e.message:e),this.name=Ts,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function Xs(n){return n.name===Ts}const xe={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function B(n){return xe.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const N="global-dispatcher";class U extends Error{constructor(e,i,o,u){super(`AJAXError: ${i} (${e}): ${o}`),this.status=e,this.statusText=i,this.url=o,this.body=u}}const ie=()=>ar(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ue=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=B(n.url);if(o)return o(n,e);if(ar(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:N},e)}if(!(/^file:/.test(i=n.url)||/^file:/.test(ie())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,u){return h(this,void 0,void 0,(function*(){const f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:ie(),signal:u.signal});let p,y;o.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");try{p=yield fetch(f)}catch(T){throw Xs(T)?T:new U(0,T.message,o.url,new Blob)}if(!p.ok){const T=yield p.blob();throw new U(p.status,p.statusText,o.url,T)}y=o.type==="arrayBuffer"||o.type==="image"?p.arrayBuffer():o.type==="json"?p.json():p.text();const x=yield y;return u.signal.throwIfAborted(),{data:x,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}}))})(n,e);if(ar(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:N},e)}var i;return(function(o,u){return new Promise(((f,p)=>{var y;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const T in o.headers)x.setRequestHeader(T,o.headers[T]);o.type==="json"&&(x.responseType="text",!((y=o.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let T=x.response;if(o.type==="json")try{T=JSON.parse(x.response)}catch(E){return void p(E)}f({data:T,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const T=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});p(new U(x.status,x.statusText,o.url,T))}},u.signal.addEventListener("abort",(()=>{x.abort(),p(new lu(u.signal.reason))})),x.send(o.body)}))})(n,e)};function Me(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const e=new URL(n),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function Te(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function be(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class Se{constructor(e,i={}){Ui(this,i),this.type=e}}class He extends Se{constructor(e,i={}){super("error",Ui({error:e},i))}}class Be{on(e,i){return this._listeners=this._listeners||{},Te(e,i,this._listeners),{unsubscribe:()=>{this.off(e,i)}}}off(e,i){return be(e,i,this._listeners),be(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Te(e,i,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,i){typeof e=="string"&&(e=new Se(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of u)y.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of f)be(o,y,this._oneTimeListeners),y.call(this,e);const p=this._eventedParent;p&&(Ui(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof He&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var le={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const mt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Bt(n,e){const i={};for(const o in n)o!=="ref"&&(i[o]=n[o]);return mt.forEach((o=>{o in e&&(i[o]=e[o])})),i}function Et(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Et(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!Et(n[i],e[i]))return!1;return!0}return n===e}function zt(n,e){n.push(e)}function Dt(n,e,i){zt(i,{command:"addSource",args:[n,e[n]]})}function Ft(n,e,i){zt(e,{command:"removeSource",args:[n]}),i[n]=!0}function Ki(n,e,i,o){Ft(n,i,o),Dt(n,e,i)}function hn(n,e,i){let o;for(o in n[i])if(Object.prototype.hasOwnProperty.call(n[i],o)&&o!=="data"&&!Et(n[i][o],e[i][o]))return!1;for(o in e[i])if(Object.prototype.hasOwnProperty.call(e[i],o)&&o!=="data"&&!Et(n[i][o],e[i][o]))return!1;return!0}function sn(n,e,i,o,u,f){n=n||{},e=e||{};for(const p in n)Object.prototype.hasOwnProperty.call(n,p)&&(Et(n[p],e[p])||i.push({command:f,args:[o,p,e[p],u]}));for(const p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(n,p)&&(Et(n[p],e[p])||i.push({command:f,args:[o,p,e[p],u]}))}function Qn(n){return n.id}function Qi(n,e){return n[e.id]=e,n}class We{constructor(e,i,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function _i(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}class qi extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class ba{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,u]of i)this.bindings[o]=u}concat(e){return new ba(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ei={kind:"null"},Je={kind:"number"},Ct={kind:"string"},Gt={kind:"boolean"},Ba={kind:"color"},hc={kind:"projectionDefinition"},$r={kind:"object"},qt={kind:"value"},Co={kind:"collator"},Xr={kind:"formatted"},Ss={kind:"padding"},Yr={kind:"colorArray"},Wr={kind:"numberArray"},dn={kind:"resolvedImage"},bl={kind:"variableAnchorOffsetCollection"};function na(n,e){return{kind:"array",itemType:n,N:e}}function ci(n){if(n.kind==="array"){const e=ci(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Ms=[Ei,Je,Ct,Gt,Ba,hc,Xr,$r,na(qt),Ss,Wr,Yr,dn,bl];function wl(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!wl(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of Ms)if(!wl(i,e))return null}}return`Expected ${ci(n)} but found ${ci(e)} instead.`}function Tl(n,e){return e.some((i=>i.kind===n.kind))}function Ys(n,e){return e.some((i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n))}function Ar(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const uu=.96422,Kr=.82521,rr=4/29,yi=6/29,lh=3*yi*yi,yd=yi*yi*yi,zo=Math.PI/180,uh=180/Math.PI;function cu(n){return(n%=360)<0&&(n+=360),n}function vd([n,e,i,o]){let u,f;const p=hu((.2225045*(n=ha(n))+.7168786*(e=ha(e))+.0606169*(i=ha(i)))/1);n===e&&e===i?u=f=p:(u=hu((.4360747*n+.3850649*e+.1430804*i)/uu),f=hu((.0139322*n+.0971045*e+.7141733*i)/Kr));const y=116*p-16;return[y<0?0:y,500*(u-p),200*(p-f),o]}function ha(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function hu(n){return n>yd?Math.pow(n,1/3):n/lh+rr}function dc([n,e,i,o]){let u=(n+16)/116,f=isNaN(e)?u:u+e/500,p=isNaN(i)?u:u-i/200;return u=1*Ws(u),f=uu*Ws(f),p=Kr*Ws(p),[du(3.1338561*f-1.6168667*u-.4906146*p),du(-.9787684*f+1.9161415*u+.033454*p),du(.0719453*f-.2289914*u+1.4052427*p),o]}function du(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Ws(n){return n>yi?n*n*n:lh*(n-rr)}const xd=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function Sl(n,e){return xd(n,e)?n[e]:void 0}function Es(n){return parseInt(n.padEnd(2,n),16)/255}function bd(n,e){return Do(e?n/100:n,0,1)}function Do(n,e,i){return Math.min(Math.max(e,n),i)}function fc(n){return!n.some(Number.isNaN)}const Io={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ks(n,e,i){return n+i*(e-n)}function Ml(n,e,i){return n.map(((o,u)=>Ks(o,e[u],i)))}class Yt{constructor(e,i,o,u=1,f=!0){this.r=e,this.g=i,this.b=o,this.a=u,f||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,i,o,u]))}static parse(e){if(e instanceof Yt)return e;if(typeof e!="string")return;const i=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=Sl(Io,o);if(u){const[p,y,x]=u;return[p/255,y/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const p=o.length<6?1:2;let y=1;return[Es(o.slice(y,y+=p)),Es(o.slice(y,y+=p)),Es(o.slice(y,y+=p)),Es(o.slice(y,y+p)||"ff")]}if(o.startsWith("rgb")){const p=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[y,x,T,E,A,D,I,O,F,V,Z,J]=p,q=[E||" ",I||" ",V].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const Y=[T,D,F].join(""),re=Y==="%%%"?100:Y===""?255:0;if(re){const de=[Do(+x/re,0,1),Do(+A/re,0,1),Do(+O/re,0,1),Z?bd(+Z,J):1];if(fc(de))return de}}return}}const f=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[p,y,x,T,E,A,D,I,O]=f,F=[x||" ",E||" ",D].join("");if(F==="  "||F==="  /"||F===",,"||F===",,,"){const V=[+y,Do(+T,0,100),Do(+A,0,100),I?bd(+I,O):1];if(fc(V))return(function([Z,J,q,Y]){function re(de){const Ae=(de+Z/30)%12,Ne=J*Math.min(q,1-q);return q-Ne*Math.max(-1,Math.min(Ae-3,9-Ae,1))}return Z=cu(Z),J/=100,q/=100,[re(0),re(8),re(4),Y]})(V)}}})(e);return i?new Yt(...i,!1):void 0}get rgb(){const{r:e,g:i,b:o,a:u}=this,f=u||1/0;return this.overwriteGetter("rgb",[e/f,i/f,o/f,u])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[i,o,u,f]=vd(e),p=Math.sqrt(o*o+u*u);return[Math.round(1e4*p)?cu(Math.atan2(u,o)*uh):NaN,p,i,f]})(this.rgb))}get lab(){return this.overwriteGetter("lab",vd(this.rgb))}overwriteGetter(e,i){return Object.defineProperty(this,e,{value:i}),i}toString(){const[e,i,o,u]=this.rgb;return`rgba(${[e,i,o].map((f=>Math.round(255*f))).join(",")},${u})`}static interpolate(e,i,o,u="rgb"){switch(u){case"rgb":{const[f,p,y,x]=Ml(e.rgb,i.rgb,o);return new Yt(f,p,y,x,!1)}case"hcl":{const[f,p,y,x]=e.hcl,[T,E,A,D]=i.hcl;let I,O;if(isNaN(f)||isNaN(T))isNaN(f)?isNaN(T)?I=NaN:(I=T,y!==1&&y!==0||(O=E)):(I=f,A!==1&&A!==0||(O=p));else{let q=T-f;T>f&&q>180?q-=360:T<f&&f-T>180&&(q+=360),I=f+o*q}const[F,V,Z,J]=(function([q,Y,re,de]){return q=isNaN(q)?0:q*zo,dc([re,Math.cos(q)*Y,Math.sin(q)*Y,de])})([I,O??Ks(p,E,o),Ks(y,A,o),Ks(x,D,o)]);return new Yt(F,V,Z,J,!1)}case"lab":{const[f,p,y,x]=dc(Ml(e.lab,i.lab,o));return new Yt(f,p,y,x,!1)}}}}Yt.black=new Yt(0,0,0,1),Yt.white=new Yt(1,1,1,1),Yt.transparent=new Yt(0,0,0,0),Yt.red=new Yt(1,0,0,1);class Cr{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const ch=["bottom","center","top"];class fu{constructor(e,i,o,u,f,p){this.text=e,this.image=i,this.scale=o,this.fontStack=u,this.textColor=f,this.verticalAlign=p}}class kn{constructor(e){this.sections=e}static fromString(e){return new kn([new fu(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof kn?e:kn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class En{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof En)return e;if(typeof e=="number")return new En([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new En(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new En(Ml(e.values,i.values,o))}}class Ji{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ji)return e;if(typeof e=="number")return new Ji([e]);if(Array.isArray(e)){for(const i of e)if(typeof i!="number")return;return new Ji(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new Ji(Ml(e.values,i.values,o))}}class It{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof It)return e;if(typeof e=="string"){const o=Yt.parse(e);return o?new It([o]):void 0}if(!Array.isArray(e))return;const i=[];for(const o of e){if(typeof o!="string")return;const u=Yt.parse(o);if(!u)return;i.push(u)}return new It(i)}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o,u="rgb"){const f=[];if(e.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let p=0;p<e.values.length;p++)f.push(Yt.interpolate(e.values[p],i.values[p],o,u));return new It(f)}}class Li extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const sr=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class fn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof fn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let i=0;i<e.length;i+=2){const o=e[i],u=e[i+1];if(typeof o!="string"||!sr.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new fn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){const u=e.values,f=i.values;if(u.length!==f.length)throw new Li(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${i.toString()}`);const p=[];for(let y=0;y<u.length;y+=2){if(u[y]!==f[y])throw new Li(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${u[y]}, to[${y}]: ${f[y]}`);p.push(u[y]);const[x,T]=u[y+1],[E,A]=f[y+1];p.push([Ks(x,E,o),Ks(T,A,o)])}return new fn(p)}}class da{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new da({name:e,available:!1}):null}}class On{constructor(e,i,o){this.from=e,this.to=i,this.transition=o}static interpolate(e,i,o){return new On(e,i,o)}static parse(e){return e instanceof On?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new On(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new On(e.from,e.to,e.transition):typeof e=="string"?new On(e,e,1):void 0}}function Fa(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qr(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof On||n instanceof Yt||n instanceof Cr||n instanceof kn||n instanceof En||n instanceof Ji||n instanceof It||n instanceof fn||n instanceof da)return!0;if(Array.isArray(n)){for(const e of n)if(!Qr(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Qr(n[e]))return!1;return!0}return!1}function en(n){if(n===null)return Ei;if(typeof n=="string")return Ct;if(typeof n=="boolean")return Gt;if(typeof n=="number")return Je;if(n instanceof Yt)return Ba;if(n instanceof On)return hc;if(n instanceof Cr)return Co;if(n instanceof kn)return Xr;if(n instanceof En)return Ss;if(n instanceof Ji)return Wr;if(n instanceof It)return Yr;if(n instanceof fn)return bl;if(n instanceof da)return dn;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const u=en(o);if(i){if(i===u)continue;i=qt;break}i=u}return na(i||qt,e)}return $r}function Qs(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Yt||n instanceof On||n instanceof kn||n instanceof En||n instanceof Ji||n instanceof It||n instanceof fn||n instanceof da?n.toString():JSON.stringify(n)}class ja{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Qr(e[1]))return i.error("invalid value");const o=e[1];let u=en(o);const f=i.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new ja(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Po={string:Ct,number:Je,boolean:Gt,object:$r};class fa{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,u=1;const f=e[0];if(f==="array"){let y,x;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in Po)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=Po[T],u++}else y=qt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],u++}o=na(y,x)}else{if(!Po[f])throw new Error(`Types doesn't contain name = ${f}`);o=Po[f]}const p=[];for(;u<e.length;u++){const y=i.parse(e[u],u,qt);if(!y)return null;p.push(y)}return new fa(o,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!wl(this.type,en(o)))return o;if(i===this.args.length-1)throw new Li(`Expected value to be of type ${ci(this.type)}, but found ${ci(en(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const In={"to-boolean":Gt,"to-color":Ba,"to-number":Je,"to-string":Ct};class pa{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if(!In[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");const u=In[o],f=[];for(let p=1;p<e.length;p++){const y=i.parse(e[p],p,qt);if(!y)return null;f.push(y)}return new pa(u,f)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let i,o;for(const u of this.args){if(i=u.evaluate(e),o=null,i instanceof Yt)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Fa(i[0],i[1],i[2],i[3]),!o))return new Yt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Li(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(e);const u=En.parse(i);if(u)return u}throw new Li(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const o of this.args){i=o.evaluate(e);const u=Ji.parse(i);if(u)return u}throw new Li(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const o of this.args){i=o.evaluate(e);const u=It.parse(i);if(u)return u}throw new Li(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(e);const u=fn.parse(i);if(u)return u}throw new Li(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Li(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return kn.fromString(Qs(this.args[0].evaluate(e)));case"resolvedImage":return da.fromString(Qs(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Qs(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const pu=["Unknown","Point","LineString","Polygon"];class Ro{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?pu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache.get(e);return i||(i=Yt.parse(e),this._parseColorCache.set(e,i)),i}}class Lo{constructor(e,i,o=[],u,f=new ba,p=[]){this.registry=e,this.path=o,this.key=o.map((y=>`[${y}]`)).join(""),this.scope=f,this.errors=p,this.expectedType=u,this._isConstant=i}parse(e,i,o,u,f={}){return i?this.concat(i,o,u)._parse(e,f):this._parse(e,f)}_parse(e,i){function o(u,f,p){return p==="assert"?new fa(f,[u]):p==="coerce"?new pa(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let p=f.parse(e,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,x=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(x.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(x.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(x.kind)||y.kind==="colorArray"&&["value","string","array"].includes(x.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(x.kind))p=o(p,y,i.typeAnnotation||"coerce");else if(this.checkSubtype(y,x))return null}else p=o(p,y,i.typeAnnotation||"assert")}if(!(p instanceof ja)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const y=new Ro;try{p=new ja(p.type,p.evaluate(y))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const u=typeof e=="number"?this.path.concat(e):this.path,f=o?this.scope.concat(o):this.scope;return new Lo(this.registry,this._isConstant,u,i||null,f,this.errors)}error(e,...i){const o=`${this.key}${i.map((u=>`[${u}]`)).join("")}`;this.errors.push(new qi(o,e))}checkSubtype(e,i){const o=wl(e,i);return o&&this.error(o),o}}class Di{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let f=1;f<e.length-1;f+=2){const p=e[f];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,f);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=i.parse(e[f+1],f+1);if(!y)return null;o.push([p,y])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return u?new Di(o,u):null}outputDefined(){return this.result.outputDefined()}}class Js{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new Js(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class ai{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Je),u=i.parse(e[2],2,na(i.expectedType||qt));return o&&u?new ai(u.type.itemType,o,u):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Li(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Li(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Li(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Ht{constructor(e,i){this.type=Gt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,qt),u=i.parse(e[2],2,qt);return o&&u?Tl(o.type,[Gt,Ct,Je,Ei,qt])?new Ht(o,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Ys(i,["boolean","string","number","null"]))throw new Li(`Expected first argument to be of type boolean, string, number or null, but found ${ci(en(i))} instead.`);if(!Ys(o,["string","array"]))throw new Li(`Expected second argument to be of type array or string, but found ${ci(en(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ko{constructor(e,i,o){this.type=Je,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,qt),u=i.parse(e[2],2,qt);if(!o||!u)return null;if(!Tl(o.type,[Gt,Ct,Je,Ei,qt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Je);return f?new ko(o,u,f):null}return new ko(o,u)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ys(i,["boolean","string","number","null"]))throw new Li(`Expected first argument to be of type boolean, string, number or null, but found ${ci(en(i))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(e)),Ys(o,["string"])){const f=o.indexOf(i,u);return f===-1?-1:[...o.slice(0,f)].length}if(Ys(o,["array"]))return o.indexOf(i,u);throw new Li(`Expected second argument to be of type array or string, but found ${ci(en(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class hi{constructor(e,i,o,u,f,p){this.inputType=e,this.type=i,this.input=o,this.cases=u,this.outputs=f,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const f={},p=[];for(let T=2;T<e.length-1;T+=2){let E=e[T];const A=e[T+1];Array.isArray(E)||(E=[E]);const D=i.concat(T);if(E.length===0)return D.error("Expected at least one branch label.");for(const O of E){if(typeof O!="number"&&typeof O!="string")return D.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,en(O)))return null}else o=en(O);if(f[String(O)]!==void 0)return D.error("Branch labels must be unique.");f[String(O)]=p.length}const I=i.parse(A,T,u);if(!I)return null;u=u||I.type,p.push(I)}const y=i.parse(e[1],1,qt);if(!y)return null;const x=i.parse(e[e.length-1],e.length-1,u);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(o,y.type)?null:new hi(o,u,y,f,p,x):null}evaluate(e){const i=this.input.evaluate(e);return(en(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class mu{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const u=[];for(let p=1;p<e.length-1;p+=2){const y=i.parse(e[p],p,Gt);if(!y)return null;const x=i.parse(e[p+1],p+1,o);if(!x)return null;u.push([y,x]),o=o||x.type}const f=i.parse(e[e.length-1],e.length-1,o);if(!f)return null;if(!o)throw new Error("Can't infer output type");return new mu(o,u,f)}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class or{constructor(e,i,o,u){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,qt),u=i.parse(e[2],2,Je);if(!o||!u)return null;if(!Tl(o.type,[na(qt),Ct,qt]))return i.error(`Expected first argument to be of type array or string, but found ${ci(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Je);return f?new or(o.type,o,u,f):null}return new or(o.type,o,u)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let u;if(this.endIndex&&(u=this.endIndex.evaluate(e)),Ys(i,["string"]))return[...i].slice(o,u).join("");if(Ys(i,["array"]))return i.slice(o,u);throw new Li(`Expected first argument to be of type array or string, but found ${ci(en(i))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function eo(n,e){const i=n.length-1;let o,u,f=0,p=i,y=0;for(;f<=p;)if(y=Math.floor((f+p)/2),o=n[y],u=n[y+1],o<=e){if(y===i||e<u)return y;f=y+1}else{if(!(o>e))throw new Li("Input is not a number.");p=y-1}return 0}class to{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of o)this.labels.push(u),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,Je);if(!o)return null;const u=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],x=e[p+1],T=p,E=p+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const A=i.parse(x,E,f);if(!A)return null;f=f||A.type,u.push([y,A])}return new to(f,o,u)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const f=i.length;return u>=i[f-1]?o[f-1].evaluate(e):o[eo(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function wd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var gu,hh,Zf=(function(){if(hh)return gu;function n(e,i,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=u}return hh=1,gu=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var f=this.sampleCurveX(o)-e;if(Math.abs(f)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=f/p}var y=0,x=1;for(o=e,u=0;u<20&&(f=this.sampleCurveX(o),!(Math.abs(f-e)<i));u++)e>f?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},gu})(),dh=wd(Zf);class ma{constructor(e,i,o,u,f){this.type=e,this.operator=i,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[p,y]of f)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,i,o,u){let f=0;if(e.name==="exponential")f=Jr(i,e.base,o,u);else if(e.name==="linear")f=Jr(i,1,o,u);else if(e.name==="cubic-bezier"){const p=e.controlPoints;f=new dh(p[0],p[1],p[2],p[3]).solve(Jr(i,1,o,u))}return f}static parse(e,i){let[o,u,f,...p]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const T=u[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(T.length!==4||T.some((E=>typeof E!="number"||E<0||E>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Je),!f)return null;const y=[];let x=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||i.expectedType==Yr?i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType):x=Ba;for(let T=0;T<p.length;T+=2){const E=p[T],A=p[T+1],D=T+3,I=T+4;if(typeof E!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=E)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const O=i.parse(A,I,x);if(!O)return null;x=x||O.type,y.push([E,O])}return Ar(x,Je)||Ar(x,hc)||Ar(x,Ba)||Ar(x,Ss)||Ar(x,Wr)||Ar(x,Yr)||Ar(x,bl)||Ar(x,na(Je))?new ma(x,o,u,f,y):i.error(`Type ${ci(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const f=i.length;if(u>=i[f-1])return o[f-1].evaluate(e);const p=eo(i,u),y=ma.interpolationFactor(this.interpolation,u,i[p],i[p+1]),x=o[p].evaluate(e),T=o[p+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ks(x,T,y);case"color":return Yt.interpolate(x,T,y);case"padding":return En.interpolate(x,T,y);case"colorArray":return It.interpolate(x,T,y);case"numberArray":return Ji.interpolate(x,T,y);case"variableAnchorOffsetCollection":return fn.interpolate(x,T,y);case"array":return Ml(x,T,y);case"projectionDefinition":return On.interpolate(x,T,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return Yt.interpolate(x,T,y,"hcl");case"colorArray":return It.interpolate(x,T,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Yt.interpolate(x,T,y,"lab");case"colorArray":return It.interpolate(x,T,y,"lab")}}}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Jr(n,e,i,o){const u=o-i,f=n-i;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}const tn={color:Yt.interpolate,number:Ks,padding:En.interpolate,numberArray:Ji.interpolate,colorArray:It.interpolate,variableAnchorOffsetCollection:fn.interpolate,array:Ml};class Oo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=null;const u=i.expectedType;u&&u.kind!=="value"&&(o=u);const f=[];for(const y of e.slice(1)){const x=i.parse(y,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,f.push(x)}if(!o)throw new Error("No output type");const p=u&&f.some((y=>wl(u,y.type)));return new Oo(p?qt:o,f)}evaluate(e){let i,o=null,u=0;for(const f of this.args)if(u++,o=f.evaluate(e),o&&o instanceof da&&!o.available&&(i||(i=o.name),o=null,u===this.args.length&&(o=i)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function _u(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function yu(n,e,i,o){return o.compare(e,i)===0}function pn(n,e,i){const o=n!=="=="&&n!=="!=";return class u_{constructor(f,p,y){this.type=Gt,this.lhs=f,this.rhs=p,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||p.type.kind==="value"}static parse(f,p){if(f.length!==3&&f.length!==4)return p.error("Expected two or three arguments.");const y=f[0];let x=p.parse(f[1],1,qt);if(!x)return null;if(!_u(y,x.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${ci(x.type)}'.`);let T=p.parse(f[2],2,qt);if(!T)return null;if(!_u(y,T.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${ci(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${ci(x.type)}' and '${ci(T.type)}'.`);o&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new fa(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new fa(x.type,[T])));let E=null;if(f.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(f[3],3,Co),!E)return null}return new u_(x,T,E)}evaluate(f){const p=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const x=en(p),T=en(y);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new Li(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=en(p),T=en(y);if(x.kind!=="string"||T.kind!=="string")return e(f,p,y)}return this.collator?i(f,p,y,this.collator.evaluate(f)):e(f,p,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const Td=pn("==",(function(n,e,i){return e===i}),yu),pc=pn("!=",(function(n,e,i){return e!==i}),(function(n,e,i,o){return!yu(0,e,i,o)})),Sd=pn("<",(function(n,e,i){return e<i}),(function(n,e,i,o){return o.compare(e,i)<0})),Hf=pn(">",(function(n,e,i){return e>i}),(function(n,e,i,o){return o.compare(e,i)>0})),El=pn("<=",(function(n,e,i){return e<=i}),(function(n,e,i,o){return o.compare(e,i)<=0})),mc=pn(">=",(function(n,e,i){return e>=i}),(function(n,e,i,o){return o.compare(e,i)>=0}));class Al{constructor(e,i,o){this.type=Co,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const u=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Gt);if(!u)return null;const f=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Gt);if(!f)return null;let p=null;return o.locale&&(p=i.parse(o.locale,1,Ct),!p)?null:new Al(u,f,p)}evaluate(e){return new Cr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class fh{constructor(e,i,o,u,f){this.type=Ct,this.number=e,this.locale=i,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Je);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parse(u.locale,1,Ct),!f))return null;let p=null;if(u.currency&&(p=i.parse(u.currency,1,Ct),!p))return null;let y=null;if(u["min-fraction-digits"]&&(y=i.parse(u["min-fraction-digits"],1,Je),!y))return null;let x=null;return u["max-fraction-digits"]&&(x=i.parse(u["max-fraction-digits"],1,Je),!x)?null:new fh(o,f,p,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class vu{constructor(e){this.type=Xr,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let x=null;if(y["font-scale"]&&(x=i.parse(y["font-scale"],1,Je),!x))return null;let T=null;if(y["text-font"]&&(T=i.parse(y["text-font"],1,na(Ct)),!T))return null;let E=null;if(y["text-color"]&&(E=i.parse(y["text-color"],1,Ba),!E))return null;let A=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!ch.includes(y["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(A=i.parse(y["vertical-align"],1,Ct),!A)return null}const D=u[u.length-1];D.scale=x,D.font=T,D.textColor=E,D.verticalAlign=A}else{const x=i.parse(e[p],1,qt);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:x,scale:null,font:null,textColor:null,verticalAlign:null})}}return new vu(u)}evaluate(e){return new kn(this.sections.map((i=>{const o=i.content.evaluate(e);return en(o)===dn?new fu("",o,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(e):null):new fu(Qs(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null,i.verticalAlign?i.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor),i.verticalAlign&&e(i.verticalAlign)}outputDefined(){return!1}}class Cl{constructor(e){this.type=dn,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Ct);return o?new Cl(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=da.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class zl{constructor(e){this.type=Je,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${ci(o.type)} instead.`):new zl(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Li(`Expected value to be of type string or array, but found ${ci(en(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const bn=8192;function Dl(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*bn),Math.round(o*u*bn)]}function Il(n,e){const i=Math.pow(2,e.z);return[(u=(n[0]/bn+e.x)/i,360*u-180),(o=(n[1]/bn+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Pl(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function io(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Md(n,e,i){const o=n[0]-e[0],u=n[1]-e[1],f=n[0]-i[0],p=n[1]-i[1];return o*p-f*u==0&&o*f<=0&&u*p<=0}function xu(n,e,i,o){return(u=[o[0]-i[0],o[1]-i[1]])[0]*(f=[e[0]-n[0],e[1]-n[1]])[1]-u[1]*f[0]!=0&&!(!_c(n,e,i,o)||!_c(i,o,n,e));var u,f}function Ed(n,e,i){for(const o of i)for(let u=0;u<o.length-1;++u)if(xu(n,e,o[u],o[u+1]))return!0;return!1}function zr(n,e,i=!1){let o=!1;for(const y of e)for(let x=0;x<y.length-1;x++){if(Md(n,y[x],y[x+1]))return i;(f=y[x])[1]>(u=n)[1]!=(p=y[x+1])[1]>u[1]&&u[0]<(p[0]-f[0])*(u[1]-f[1])/(p[1]-f[1])+f[0]&&(o=!o)}var u,f,p;return o}function gc(n,e){for(const i of e)if(zr(n,i))return!0;return!1}function Ad(n,e){for(const i of n)if(!zr(i,e))return!1;for(let i=0;i<n.length-1;++i)if(Ed(n[i],n[i+1],e))return!1;return!0}function Cd(n,e){for(const i of e)if(Ad(n,i))return!0;return!1}function _c(n,e,i,o){const u=o[0]-i[0],f=o[1]-i[1],p=(n[0]-i[0])*f-u*(n[1]-i[1]),y=(e[0]-i[0])*f-u*(e[1]-i[1]);return p>0&&y<0||p<0&&y>0}function yc(n,e,i){const o=[];for(let u=0;u<n.length;u++){const f=[];for(let p=0;p<n[u].length;p++){const y=Dl(n[u][p],i);Pl(e,y),f.push(y)}o.push(f)}return o}function Bo(n,e,i){const o=[];for(let u=0;u<n.length;u++){const f=yc(n[u],e,i);o.push(f)}return o}function Rl(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const u=.5*o;let f=n[0]-i[0]>u?-o:i[0]-n[0]>u?o:0;f===0&&(f=n[0]-i[2]>u?-o:i[2]-n[0]>u?o:0),n[0]+=f}Pl(e,n)}function zd(n,e,i,o){const u=Math.pow(2,o.z)*bn,f=[o.x*bn,o.y*bn],p=[];for(const y of n)for(const x of y){const T=[x.x+f[0],x.y+f[1]];Rl(T,e,i,u),p.push(T)}return p}function bu(n,e,i,o){const u=Math.pow(2,o.z)*bn,f=[o.x*bn,o.y*bn],p=[];for(const x of n){const T=[];for(const E of x){const A=[E.x+f[0],E.y+f[1]];Pl(e,A),T.push(A)}p.push(T)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of p)for(const T of x)Rl(T,e,i,u)}var y;return p}class no{constructor(e,i){this.type=Gt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Qr(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const u=[];for(const f of o.features){const{type:p,coordinates:y}=f.geometry;p==="Polygon"&&u.push(y),p==="MultiPolygon"&&u.push(...y)}if(u.length)return new no(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new no(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new no(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=yc(o.coordinates,f,p),x=zd(i.geometry(),u,f,p);if(!io(u,f))return!1;for(const T of x)if(!zr(T,y))return!1}if(o.type==="MultiPolygon"){const y=Bo(o.coordinates,f,p),x=zd(i.geometry(),u,f,p);if(!io(u,f))return!1;for(const T of x)if(!gc(T,y))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=yc(o.coordinates,f,p),x=bu(i.geometry(),u,f,p);if(!io(u,f))return!1;for(const T of x)if(!Ad(T,y))return!1}if(o.type==="MultiPolygon"){const y=Bo(o.coordinates,f,p),x=bu(i.geometry(),u,f,p);if(!io(u,f))return!1;for(const T of x)if(!Cd(T,y))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ph=class{constructor(n=[],e=(i,o)=>i<o?-1:i>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:i}=this,o=e[n];for(;n>0;){const u=n-1>>1,f=e[u];if(i(o,f)>=0)break;e[n]=f,n=u}e[n]=o}_down(n){const{data:e,compare:i}=this,o=this.length>>1,u=e[n];for(;n<o;){let f=1+(n<<1);const p=f+1;if(p<this.length&&i(e[p],e[f])<0&&(f=p),i(e[f],u)>=0)break;e[n]=e[f],n=f}e[n]=u}};function wu(n,e,i=0,o=n.length-1,u=mh){for(;o>i;){if(o-i>600){const x=o-i+1,T=e-i+1,E=Math.log(x),A=.5*Math.exp(2*E/3),D=.5*Math.sqrt(E*A*(x-A)/x)*(T-x/2<0?-1:1);wu(n,e,Math.max(i,Math.floor(e-T*A/x+D)),Math.min(o,Math.floor(e+(x-T)*A/x+D)),u)}const f=n[e];let p=i,y=o;for(ao(n,i,e),u(n[o],f)>0&&ao(n,i,o);p<y;){for(ao(n,p,y),p++,y--;u(n[p],f)<0;)p++;for(;u(n[y],f)>0;)y--}u(n[i],f)===0?ao(n,i,y):(y++,ao(n,y,o)),y<=e&&(i=y+1),e<=y&&(o=y-1)}}function ao(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function mh(n,e){return n<e?-1:n>e?1:0}function Tu(n,e){if(n.length<=1)return[n];const i=[];let o,u;for(const f of n){const p=$f(f);p!==0&&(f.area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(o&&i.push(o),o=[f]):o.push(f))}if(o&&i.push(o),e>1)for(let f=0;f<i.length;f++)i[f].length<=e||(wu(i[f],e,1,i[f].length-1,Dd),i[f]=i[f].slice(0,e));return i}function Dd(n,e){return e.area-n.area}function $f(n){let e=0;for(let i,o,u=0,f=n.length,p=f-1;u<f;p=u++)i=n[u],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}const Id=1/298.257223563,Su=Id*(2-Id),Pd=Math.PI/180;class gh{constructor(e){const i=6378.137*Pd*1e3,o=Math.cos(e*Pd),u=1/(1-Su*(1-o*o)),f=Math.sqrt(u);this.kx=i*f*o,this.ky=i*f*u*(1-Su)}distance(e,i){const o=this.wrap(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(e,i){let o,u,f,p,y=1/0;for(let x=0;x<e.length-1;x++){let T=e[x][0],E=e[x][1],A=this.wrap(e[x+1][0]-T)*this.kx,D=(e[x+1][1]-E)*this.ky,I=0;A===0&&D===0||(I=(this.wrap(i[0]-T)*this.kx*A+(i[1]-E)*this.ky*D)/(A*A+D*D),I>1?(T=e[x+1][0],E=e[x+1][1]):I>0&&(T+=A/this.kx*I,E+=D/this.ky*I)),A=this.wrap(i[0]-T)*this.kx,D=(i[1]-E)*this.ky;const O=A*A+D*D;O<y&&(y=O,o=T,u=E,f=x,p=I)}return{point:[o,u],index:f,t:Math.max(0,Math.min(1,p))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function wa(n,e){return e[0]-n[0]}function ro(n){return n[1]-n[0]+1}function lr(n,e){return n[1]>=n[0]&&n[1]<e}function Mu(n,e){if(n[0]>n[1])return[null,null];const i=ro(n);if(e){if(i===2)return[n,null];const u=Math.floor(i/2);return[[n[0],n[0]+u],[n[0]+u,n[1]]]}if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function vc(n,e){if(!lr(e,n.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Pl(i,n[o]);return i}function xc(n){const e=[1/0,1/0,-1/0,-1/0];for(const i of n)for(const o of i)Pl(e,o);return e}function Eu(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function bc(n,e,i){if(!Eu(n)||!Eu(e))return NaN;let o=0,u=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(u=n[1]-e[3]),n[3]<e[1]&&(u=e[1]-n[3]),i.distance([0,0],[o,u])}function ur(n,e,i){const o=i.pointOnLine(e,n);return i.distance(n,o.point)}function Au(n,e,i,o,u){const f=Math.min(ur(n,[i,o],u),ur(e,[i,o],u)),p=Math.min(ur(i,[n,e],u),ur(o,[n,e],u));return Math.min(f,p)}function Cu(n,e,i,o,u){if(!lr(e,n.length)||!lr(o,i.length))return 1/0;let f=1/0;for(let p=e[0];p<e[1];++p){const y=n[p],x=n[p+1];for(let T=o[0];T<o[1];++T){const E=i[T],A=i[T+1];if(xu(y,x,E,A))return 0;f=Math.min(f,Au(y,x,E,A,u))}}return f}function wc(n,e,i,o,u){if(!lr(e,n.length)||!lr(o,i.length))return NaN;let f=1/0;for(let p=e[0];p<=e[1];++p)for(let y=o[0];y<=o[1];++y)if(f=Math.min(f,u.distance(n[p],i[y])),f===0)return f;return f}function Rd(n,e,i){if(zr(n,e,!0))return 0;let o=1/0;for(const u of e){const f=u[0],p=u[u.length-1];if(f!==p&&(o=Math.min(o,ur(n,[p,f],i)),o===0))return o;const y=i.pointOnLine(u,n);if(o=Math.min(o,i.distance(n,y.point)),o===0)return o}return o}function Fo(n,e,i,o){if(!lr(e,n.length))return NaN;for(let f=e[0];f<=e[1];++f)if(zr(n[f],i,!0))return 0;let u=1/0;for(let f=e[0];f<e[1];++f){const p=n[f],y=n[f+1];for(const x of i)for(let T=0,E=x.length,A=E-1;T<E;A=T++){const D=x[A],I=x[T];if(xu(p,y,D,I))return 0;u=Math.min(u,Au(p,y,D,I,o))}}return u}function jo(n,e){for(const i of n)for(const o of i)if(zr(o,e,!0))return!0;return!1}function _h(n,e,i,o=1/0){const u=xc(n),f=xc(e);if(o!==1/0&&bc(u,f,i)>=o)return o;if(io(u,f)){if(jo(n,e))return 0}else if(jo(e,n))return 0;let p=1/0;for(const y of n)for(let x=0,T=y.length,E=T-1;x<T;E=x++){const A=y[E],D=y[x];for(const I of e)for(let O=0,F=I.length,V=F-1;O<F;V=O++){const Z=I[V],J=I[O];if(xu(A,D,Z,J))return 0;p=Math.min(p,Au(A,D,Z,J,i))}}return p}function vi(n,e,i,o,u,f){if(!f)return;const p=bc(vc(o,f),u,i);p<e&&n.push([p,f,[0,0]])}function es(n,e,i,o,u,f,p){if(!f||!p)return;const y=bc(vc(o,f),vc(u,p),i);y<e&&n.push([y,f,p])}function zu(n,e,i,o,u=1/0){let f=Math.min(o.distance(n[0],i[0][0]),u);if(f===0)return f;const p=new ph([[0,[0,n.length-1],[0,0]]],wa),y=xc(i);for(;p.length>0;){const x=p.pop();if(x[0]>=f)continue;const T=x[1],E=e?50:100;if(ro(T)<=E){if(!lr(T,n.length))return NaN;if(e){const A=Fo(n,T,i,o);if(isNaN(A)||A===0)return A;f=Math.min(f,A)}else for(let A=T[0];A<=T[1];++A){const D=Rd(n[A],i,o);if(f=Math.min(f,D),f===0)return 0}}else{const A=Mu(T,e);vi(p,f,o,n,y,A[0]),vi(p,f,o,n,y,A[1])}}return f}function Du(n,e,i,o,u,f=1/0){let p=Math.min(f,u.distance(n[0],i[0]));if(p===0)return p;const y=new ph([[0,[0,n.length-1],[0,i.length-1]]],wa);for(;y.length>0;){const x=y.pop();if(x[0]>=p)continue;const T=x[1],E=x[2],A=e?50:100,D=o?50:100;if(ro(T)<=A&&ro(E)<=D){if(!lr(T,n.length)&&lr(E,i.length))return NaN;let I;if(e&&o)I=Cu(n,T,i,E,u),p=Math.min(p,I);else if(e&&!o){const O=n.slice(T[0],T[1]+1);for(let F=E[0];F<=E[1];++F)if(I=ur(i[F],O,u),p=Math.min(p,I),p===0)return p}else if(!e&&o){const O=i.slice(E[0],E[1]+1);for(let F=T[0];F<=T[1];++F)if(I=ur(n[F],O,u),p=Math.min(p,I),p===0)return p}else I=wc(n,T,i,E,u),p=Math.min(p,I)}else{const I=Mu(T,e),O=Mu(E,o);es(y,p,u,n,i,I[0],O[0]),es(y,p,u,n,i,I[0],O[1]),es(y,p,u,n,i,I[1],O[0]),es(y,p,u,n,i,I[1],O[1])}}return p}function Tc(n){return n.type==="MultiPolygon"?n.coordinates.map((e=>({type:"Polygon",coordinates:e}))):n.type==="MultiLineString"?n.coordinates.map((e=>({type:"LineString",coordinates:e}))):n.type==="MultiPoint"?n.coordinates.map((e=>({type:"Point",coordinates:e}))):[n]}class No{constructor(e,i){this.type=Je,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Qr(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new No(o,o.features.map((u=>Tc(u.geometry))).flat());if(o.type==="Feature")return new No(o,Tc(o.geometry));if("type"in o&&"coordinates"in o)return new No(o,Tc(o))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const u=i.geometry(),f=u.flat().map((x=>Il([x.x,x.y],i.canonical)));if(u.length===0)return NaN;const p=new gh(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Du(f,!1,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Du(f,!1,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,zu(f,!1,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const u=i.geometry(),f=u.flat().map((x=>Il([x.x,x.y],i.canonical)));if(u.length===0)return NaN;const p=new gh(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Du(f,!0,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Du(f,!0,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,zu(f,!0,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(i,o){const u=i.geometry();if(u.length===0||u[0].length===0)return NaN;const f=Tu(u,0).map((x=>x.map((T=>T.map((E=>Il([E.x,E.y],i.canonical))))))),p=new gh(f[0][0][0][1]);let y=1/0;for(const x of o)for(const T of f){switch(x.type){case"Point":y=Math.min(y,zu([x.coordinates],!1,T,p,y));break;case"LineString":y=Math.min(y,zu(x.coordinates,!0,T,p,y));break;case"Polygon":y=Math.min(y,_h(T,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Iu{constructor(e){this.type=qt,this.key=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?i.error("Global state property must be defined."):typeof o!="string"?i.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Iu(o)}evaluate(e){var i;const o=(i=e.globals)===null||i===void 0?void 0:i.globalState;return o&&Object.keys(o).length!==0?Sl(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Ll={"==":Td,"!=":pc,">":Hf,"<":Sd,">=":mc,"<=":El,array:fa,at:ai,boolean:fa,case:mu,coalesce:Oo,collator:Al,format:vu,image:Cl,in:Ht,"index-of":ko,interpolate:ma,"interpolate-hcl":ma,"interpolate-lab":ma,length:zl,let:Di,literal:ja,match:hi,number:fa,"number-format":fh,object:fa,slice:or,step:to,string:fa,"to-boolean":pa,"to-color":pa,"to-number":pa,"to-string":pa,var:Js,within:no,distance:No,"global-state":Iu};class Na{constructor(e,i,o,u){this.name=e,this.type=i,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const o=e[0],u=Na.definitions[o];if(!u)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=p.filter((([T])=>!Array.isArray(T)||T.length===e.length-1));let x=null;for(const[T,E]of y){x=new Lo(i.registry,ga,i.path,null,i.scope);const A=[];let D=!1;for(let I=1;I<e.length;I++){const O=e[I],F=Array.isArray(T)?T[I-1]:T.type,V=x.parse(O,1+A.length,F);if(!V){D=!0;break}A.push(V)}if(!D)if(Array.isArray(T)&&T.length!==A.length)x.error(`Expected ${T.length} arguments, but found ${A.length} instead.`);else{for(let I=0;I<A.length;I++){const O=Array.isArray(T)?T[I]:T.type,F=A[I];x.concat(I+1).checkSubtype(O,F.type)}if(x.errors.length===0)return new Na(o,f,E,A)}}if(y.length===1)i.errors.push(...x.errors);else{const T=(y.length?y:p).map((([A])=>{return D=A,Array.isArray(D)?`(${D.map(ci).join(", ")})`:`(${ci(D.type)}...)`;var D})).join(" | "),E=[];for(let A=1;A<e.length;A++){const D=i.parse(e[A],1+E.length);if(!D)return null;E.push(ci(D.type))}i.error(`Expected arguments of type ${T}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){Na.definitions=i;for(const o in i)e[o]=Na}}function yh(n,[e,i,o,u]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const f=u?u.evaluate(n):1,p=Fa(e,i,o,f);if(p)throw new Li(p);return new Yt(e/255,i/255,o/255,f,!1)}function Sc(n,e){return n in e}function Va(n,e){const i=e[n];return i===void 0?null:i}function ts(n){return{type:n}}function ga(n){if(n instanceof Js)return ga(n.boundExpression);if(n instanceof Na&&n.name==="error"||n instanceof Al||n instanceof no||n instanceof No||n instanceof Iu)return!1;const e=n instanceof pa||n instanceof fa;let i=!0;return n.eachChild((o=>{i=e?i&&ga(o):i&&o instanceof ja})),!!i&&As(n)&&Uo(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function As(n){if(n instanceof Na&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof no||n instanceof No)return!1;let e=!0;return n.eachChild((i=>{e&&!As(i)&&(e=!1)})),e}function Vo(n){if(n instanceof Na&&n.name==="feature-state")return!1;let e=!0;return n.eachChild((i=>{e&&!Vo(i)&&(e=!1)})),e}function Uo(n,e){if(n instanceof Na&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild((o=>{i&&!Uo(o,e)&&(i=!1)})),i}function Pu(n){return{result:"success",value:n}}function so(n){return{result:"error",value:n}}function cr(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function vh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function kl(n){return!!n.expression&&n.expression.interpolated}function Xt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Mc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&en(n)===$r}function Ua(n){return n}function Ec(n,e){const i=n.stops&&typeof n.stops[0][0]=="object",o=i||!(i||n.property!==void 0),u=n.type||(kl(e)?"exponential":"interval"),f=(function(E){switch(E.type){case"color":return Yt.parse;case"padding":return En.parse;case"numberArray":return Ji.parse;case"colorArray":return It.parse;default:return null}})(e);if(f&&((n=_i({},n)).stops&&(n.stops=n.stops.map((E=>[E[0],f(E[1])]))),n.default=f(n.default?n.default:e.default)),n.colorSpace&&(p=n.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var p;const y=(function(E){switch(E){case"exponential":return oo;case"interval":return Ac;case"categorical":return Ld;case"identity":return xh;default:throw new Error(`Unknown function type "${E}"`)}})(u);let x,T;if(u==="categorical"){x=Object.create(null);for(const E of n.stops)x[E[0]]=E[1];T=typeof n.stops[0][0]}if(i){const E={},A=[];for(let O=0;O<n.stops.length;O++){const F=n.stops[O],V=F[0].zoom;E[V]===void 0&&(E[V]={zoom:V,type:n.type,property:n.property,default:n.default,stops:[]},A.push(V)),E[V].stops.push([F[0].value,F[1]])}const D=[];for(const O of A)D.push([E[O].zoom,Ec(E[O],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:ma.interpolationFactor.bind(void 0,I),zoomStops:D.map((O=>O[0])),evaluate:({zoom:O},F)=>oo({stops:D,base:n.base},e,O).evaluate(O,F)}}if(o){const E=u==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:ma.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map((A=>A[0])),evaluate:({zoom:A})=>y(n,e,A,x,T)}}return{kind:"source",evaluate(E,A){const D=A&&A.properties?A.properties[n.property]:void 0;return D===void 0?Ga(n.default,e.default):y(n,e,D,x,T)}}}function Ga(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function Ld(n,e,i,o,u){return Ga(typeof i===u?o[i]:void 0,n.default,e.default)}function Ac(n,e,i){if(Xt(i)!=="number")return Ga(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const u=eo(n.stops.map((f=>f[0])),i);return n.stops[u][1]}function oo(n,e,i){const o=n.base!==void 0?n.base:1;if(Xt(i)!=="number")return Ga(n.default,e.default);const u=n.stops.length;if(u===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const f=eo(n.stops.map((E=>E[0])),i),p=(function(E,A,D,I){const O=I-D,F=E-D;return O===0?0:A===1?F/O:(Math.pow(A,F)-1)/(Math.pow(A,O)-1)})(i,o,n.stops[f][0],n.stops[f+1][0]),y=n.stops[f][1],x=n.stops[f+1][1],T=tn[e.type]||Ua;return typeof y.evaluate=="function"?{evaluate(...E){const A=y.evaluate.apply(void 0,E),D=x.evaluate.apply(void 0,E);if(A!==void 0&&D!==void 0)return T(A,D,p,n.colorSpace)}}:T(y,x,p,n.colorSpace)}function xh(n,e,i){switch(e.type){case"color":i=Yt.parse(i);break;case"formatted":i=kn.fromString(i.toString());break;case"resolvedImage":i=da.fromString(i.toString());break;case"padding":i=En.parse(i);break;case"colorArray":i=It.parse(i);break;case"numberArray":i=Ji.parse(i);break;default:Xt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0)}return Ga(i,n.default,e.default)}Na.register(Ll,{error:[{kind:"error"},[Ct],(n,[e])=>{throw new Li(e.evaluate(n))}],typeof:[Ct,[qt],(n,[e])=>ci(en(e.evaluate(n)))],"to-rgba":[na(Je,4),[Ba],(n,[e])=>{const[i,o,u,f]=e.evaluate(n).rgb;return[255*i,255*o,255*u,f]}],rgb:[Ba,[Je,Je,Je],yh],rgba:[Ba,[Je,Je,Je,Je],yh],has:{type:Gt,overloads:[[[Ct],(n,[e])=>Sc(e.evaluate(n),n.properties())],[[Ct,$r],(n,[e,i])=>Sc(e.evaluate(n),i.evaluate(n))]]},get:{type:qt,overloads:[[[Ct],(n,[e])=>Va(e.evaluate(n),n.properties())],[[Ct,$r],(n,[e,i])=>Va(e.evaluate(n),i.evaluate(n))]]},"feature-state":[qt,[Ct],(n,[e])=>Va(e.evaluate(n),n.featureState||{})],properties:[$r,[],n=>n.properties()],"geometry-type":[Ct,[],n=>n.geometryType()],id:[qt,[],n=>n.id()],zoom:[Je,[],n=>n.globals.zoom],"heatmap-density":[Je,[],n=>n.globals.heatmapDensity||0],elevation:[Je,[],n=>n.globals.elevation||0],"line-progress":[Je,[],n=>n.globals.lineProgress||0],accumulated:[qt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Je,ts(Je),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[Je,ts(Je),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:Je,overloads:[[[Je,Je],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Je],(n,[e])=>-e.evaluate(n)]]},"/":[Je,[Je,Je],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Je,[Je,Je],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Je,[],()=>Math.LN2],pi:[Je,[],()=>Math.PI],e:[Je,[],()=>Math.E],"^":[Je,[Je,Je],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Je,[Je],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Je,[Je],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Je,[Je],(n,[e])=>Math.log(e.evaluate(n))],log2:[Je,[Je],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Je,[Je],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Je,[Je],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Je,[Je],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Je,[Je],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Je,[Je],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Je,[Je],(n,[e])=>Math.atan(e.evaluate(n))],min:[Je,ts(Je),(n,e)=>Math.min(...e.map((i=>i.evaluate(n))))],max:[Je,ts(Je),(n,e)=>Math.max(...e.map((i=>i.evaluate(n))))],abs:[Je,[Je],(n,[e])=>Math.abs(e.evaluate(n))],round:[Je,[Je],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Je,[Je],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Je,[Je],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Gt,[Ct,qt],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Gt,[qt],(n,[e])=>n.id()===e.value],"filter-type-==":[Gt,[Ct],(n,[e])=>n.geometryType()===e.value],"filter-<":[Gt,[Ct,qt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Gt,[qt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Gt,[Ct,qt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>u}],"filter-id->":[Gt,[qt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Gt,[Ct,qt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Gt,[qt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Gt,[Ct,qt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Gt,[qt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Gt,[qt],(n,[e])=>e.value in n.properties()],"filter-has-id":[Gt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Gt,[na(Ct)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Gt,[na(qt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Gt,[Ct,na(qt)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Gt,[Ct,na(qt)],(n,[e,i])=>(function(o,u,f,p){for(;f<=p;){const y=f+p>>1;if(u[y]===o)return!0;u[y]>o?p=y-1:f=y+1}return!1})(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Gt,overloads:[[[Gt,Gt],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[ts(Gt),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Gt,overloads:[[[Gt,Gt],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[ts(Gt),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Gt,[Gt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Gt,[Ct],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Ct,[Ct],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Ct,[Ct],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Ct,ts(qt),(n,e)=>e.map((i=>Qs(i.evaluate(n)))).join("")],"resolved-locale":[Ct,[Co],(n,[e])=>e.evaluate(n).resolvedLocale()]});class Cc{constructor(e,i,o){this.expression=e,this._warningHistory={},this._evaluator=new Ro,this._defaultValue=i?(function(u){if(u.type==="color"&&Mc(u.default))return new Yt(0,0,0,0);switch(u.type){case"color":return Yt.parse(u.default)||null;case"padding":return En.parse(u.default)||null;case"numberArray":return Ji.parse(u.default)||null;case"colorArray":return It.parse(u.default)||null;case"variableAnchorOffsetCollection":return fn.parse(u.default)||null;case"projectionDefinition":return On.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,i,o,u,f,p){return this._globalState&&(e=Vn(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,u,f,p){this._globalState&&(e=Vn(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Li(`Expected value to be one of ${Object.keys(this._enumValues).map((x=>JSON.stringify(x))).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function lo(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Ll}function Ol(n,e,i){const o=new Lo(Ll,ga,[],e?(function(f){const p={color:Ba,string:Ct,number:Je,enum:Ct,boolean:Gt,formatted:Xr,padding:Ss,numberArray:Wr,colorArray:Yr,projectionDefinition:hc,resolvedImage:dn,variableAnchorOffsetCollection:bl};return f.type==="array"?na(p[f.value]||qt,f.length):p[f.type]})(e):void 0),u=o.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Pu(new Cc(u,e,i)):so(o.errors)}class _a{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Vo(i.expression),this.globalStateRefs=Bn(i.expression),this._globalState=o}evaluateWithoutErrorHandling(e,i,o,u,f,p){return this._globalState&&(e=Vn(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,f,p)}evaluate(e,i,o,u,f,p){return this._globalState&&(e=Vn(e,this._globalState)),this._styleExpression.evaluate(e,i,o,u,f,p)}}class uo{constructor(e,i,o,u,f){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Vo(i.expression),this.globalStateRefs=Bn(i.expression),this.interpolationType=u,this._globalState=f}evaluateWithoutErrorHandling(e,i,o,u,f,p){return this._globalState&&(e=Vn(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,f,p)}evaluate(e,i,o,u,f,p){return this._globalState&&(e=Vn(e,this._globalState)),this._styleExpression.evaluate(e,i,o,u,f,p)}interpolationFactor(e,i,o){return this.interpolationType?ma.interpolationFactor(this.interpolationType,e,i,o):0}}function co(n,e,i){const o=Ol(n,e,i);if(o.result==="error")return o;const u=o.value.expression,f=As(u);if(!f&&!cr(e))return so([new qi("","data expressions not supported")]);const p=Uo(u,["zoom"]);if(!p&&!vh(e))return so([new qi("","zoom expressions not supported")]);const y=ho(u);return y||p?y instanceof qi?so([y]):y instanceof ma&&!kl(e)?so([new qi("",'"interpolate" expressions cannot be used with this property')]):Pu(y?new uo(f?"camera":"composite",o.value,y.labels,y instanceof ma?y.interpolation:void 0,i):new _a(f?"constant":"source",o.value,i)):so([new qi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Go{constructor(e,i){this._parameters=e,this._specification=i,_i(this,Ec(this._parameters,this._specification))}static deserialize(e){return new Go(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ho(n){let e=null;if(n instanceof Di)e=ho(n.result);else if(n instanceof Oo){for(const i of n.args)if(e=ho(i),e)break}else(n instanceof to||n instanceof ma)&&n.input instanceof Na&&n.input.name==="zoom"&&(e=n);return e instanceof qi||n.eachChild((i=>{const o=ho(i);o instanceof qi?e=o:!e&&o?e=new qi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new qi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Bn(n,e=new Set){return n instanceof Iu&&e.add(n.key),n.eachChild((i=>{Bn(i,e)})),e}function Vn(n,e){const{zoom:i,heatmapDensity:o,elevation:u,lineProgress:f,isSupportedScript:p,accumulated:y}=n??{};return{zoom:i,heatmapDensity:o,elevation:u,lineProgress:f,isSupportedScript:p,accumulated:y,globalState:e}}function is(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!is(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const ns={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ta(n,e){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};is(n)||(n=qo(n));const i=Ol(n,ns,e);if(i.result==="error")throw new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,u,f)=>i.value.evaluate(o,u,{},f),needGeometry:bh(n),getGlobalStateRefs:()=>Bn(i.value.expression)}}function Cs(n,e){return n<e?-1:n>e?1:0}function bh(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(bh(n[e]))return!0;return!1}function qo(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Bl(n[1],n[2],"=="):e==="!="?ki(Bl(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Bl(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(qo))):e==="all"?["all"].concat(n.slice(1).map(qo)):e==="none"?["all"].concat(n.slice(1).map(qo).map(ki)):e==="in"?wh(n[1],n.slice(2)):e==="!in"?ki(wh(n[1],n.slice(2))):e==="has"?Un(n[1]):e!=="!has"||ki(Un(n[1]));var i}function Bl(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function wh(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",n,["literal",e.sort(Cs)]]:["filter-in-small",n,["literal",e]]}}function Un(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function ki(n){return["!",n]}function oi(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let u="[";for(const f of n)u+=`${oi(f)},`;return`${u}]`}const i=Object.keys(n).sort();let o="{";for(let u=0;u<i.length;u++)o+=`${JSON.stringify(i[u])}:${oi(n[i[u]])},`;return`${o}}`}function zs(n){let e="";for(const i of mt)e+=`/${oi(n[i])}`;return e}function qa(n){const e=n.value;return e?[new We(n.key,e,"constants have been deprecated as of v8")]:[]}function on(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Sa(n){if(Array.isArray(n))return n.map(Sa);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Sa(n[i]);return e}return on(n)}function Ma(n){const e=n.key,i=n.value,o=n.valueSpec||{},u=n.objectElementValidators||{},f=n.style,p=n.styleSpec,y=n.validateSpec;let x=[];const T=Xt(i);if(T!=="object")return[new We(e,i,`object expected, ${T} found`)];for(const E in i){const A=E.split(".")[0],D=Sl(o,A)||o["*"];let I;if(Sl(u,A))I=u[A];else if(Sl(o,A)){if(i[E]===void 0)continue;I=y}else if(u["*"])I=u["*"];else{if(!o["*"]){x.push(new We(e,i[E],`unknown property "${E}"`));continue}I=y}x=x.concat(I({key:(e&&`${e}.`)+E,value:i[E],valueSpec:D,style:f,styleSpec:p,object:i,objectKey:E,validateSpec:y},i))}for(const E in o)u[E]||o[E].required&&o[E].default===void 0&&i[E]===void 0&&x.push(new We(e,i,`missing required property "${E}"`));return x}function Ru(n){const e=n.value,i=n.valueSpec,o=n.style,u=n.styleSpec,f=n.key,p=n.arrayElementValidator||n.validateSpec;if(Xt(e)!=="array")return[new We(f,e,`array expected, ${Xt(e)} found`)];if(i.length&&e.length!==i.length)return[new We(f,e,`array length ${i.length} expected, length ${e.length} found`)];let y={type:i.value,values:i.values};u.$version<7&&(y.function=i.function),Xt(i.value)==="object"&&(y=i.value);let x=[];for(let T=0;T<e.length;T++)x=x.concat(p({array:e,arrayIndex:T,value:e[T],valueSpec:y,validateSpec:n.validateSpec,style:o,styleSpec:u,key:`${f}[${T}]`}));return x}function as(n){const e=n.key,i=n.value,o=n.valueSpec;let u=Xt(i);return u==="number"&&i!=i&&(u="NaN"),u!=="number"?[new We(e,i,`number expected, ${u} found`)]:"minimum"in o&&i<o.minimum?[new We(e,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new We(e,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function rs(n){const e=n.valueSpec,i=on(n.value.type);let o,u,f,p={};const y=i!=="categorical"&&n.value.property===void 0,x=!y,T=Xt(n.value.stops)==="array"&&Xt(n.value.stops[0])==="array"&&Xt(n.value.stops[0][0])==="object",E=Ma({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(I){if(i==="identity")return[new We(I.key,I.value,'identity function may not have a "stops" property')];let O=[];const F=I.value;return O=O.concat(Ru({key:I.key,value:F,valueSpec:I.valueSpec,validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec,arrayElementValidator:A})),Xt(F)==="array"&&F.length===0&&O.push(new We(I.key,F,"array must have at least one stop")),O},default:function(I){return I.validateSpec({key:I.key,value:I.value,valueSpec:e,validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec})}}});return i==="identity"&&y&&E.push(new We(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||E.push(new We(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!kl(n.valueSpec)&&E.push(new We(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(x&&!cr(n.valueSpec)?E.push(new We(n.key,n.value,"property functions not supported")):y&&!vh(n.valueSpec)&&E.push(new We(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!T||n.value.property!==void 0||E.push(new We(n.key,n.value,'"property" property is required')),E;function A(I){let O=[];const F=I.value,V=I.key;if(Xt(F)!=="array")return[new We(V,F,`array expected, ${Xt(F)} found`)];if(F.length!==2)return[new We(V,F,`array length 2 expected, length ${F.length} found`)];if(T){if(Xt(F[0])!=="object")return[new We(V,F,`object expected, ${Xt(F[0])} found`)];if(F[0].zoom===void 0)return[new We(V,F,"object stop key must have zoom")];if(F[0].value===void 0)return[new We(V,F,"object stop key must have value")];if(f&&f>on(F[0].zoom))return[new We(V,F[0].zoom,"stop zoom values must appear in ascending order")];on(F[0].zoom)!==f&&(f=on(F[0].zoom),u=void 0,p={}),O=O.concat(Ma({key:`${V}[0]`,value:F[0],valueSpec:{zoom:{}},validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec,objectElementValidators:{zoom:as,value:D}}))}else O=O.concat(D({key:`${V}[0]`,value:F[0],validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec},F));return lo(Sa(F[1]))?O.concat([new We(`${V}[1]`,F[1],"expressions are not allowed in function stops.")]):O.concat(I.validateSpec({key:`${V}[1]`,value:F[1],valueSpec:e,validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec}))}function D(I,O){const F=Xt(I.value),V=on(I.value),Z=I.value!==null?I.value:O;if(o){if(F!==o)return[new We(I.key,Z,`${F} stop domain type must match previous stop domain type ${o}`)]}else o=F;if(F!=="number"&&F!=="string"&&F!=="boolean")return[new We(I.key,Z,"stop domain value must be a number, string, or boolean")];if(F!=="number"&&i!=="categorical"){let J=`number expected, ${F} found`;return cr(e)&&i===void 0&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(I.key,Z,J)]}return i!=="categorical"||F!=="number"||isFinite(V)&&Math.floor(V)===V?i!=="categorical"&&F==="number"&&u!==void 0&&V<u?[new We(I.key,Z,"stop domain values must appear in ascending order")]:(u=V,i==="categorical"&&V in p?[new We(I.key,Z,"stop domain values must be unique")]:(p[V]=!0,[])):[new We(I.key,Z,`integer expected, found ${V}`)]}}function ss(n){const e=(n.expressionContext==="property"?co:Ol)(Sa(n.value),n.valueSpec);if(e.result==="error")return e.value.map((o=>new We(`${n.key}${o.key}`,n.value,o.message)));const i=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new We(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Vo(i))return[new We(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Vo(i))return[new We(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Uo(i,["zoom","feature-state"]))return[new We(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!As(i))return[new We(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ds(n){const e=n.key,i=n.value,o=Xt(i);return o!=="string"?[new We(e,i,`color expected, ${o} found`)]:Yt.parse(String(i))?[]:[new We(e,i,`color expected, "${i}" found`)]}function Is(n){const e=n.key,i=n.value,o=n.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(on(i))===-1&&u.push(new We(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(on(i))===-1&&u.push(new We(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function hr(n){return is(Sa(n.value))?ss(_i({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):os(n)}function os(n){const e=n.value,i=n.key;if(Xt(e)!=="array")return[new We(i,e,`array expected, ${Xt(e)} found`)];const o=n.styleSpec;let u,f=[];if(e.length<1)return[new We(i,e,"filter array must have at least 1 element")];switch(f=f.concat(Is({key:`${i}[0]`,value:e[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),on(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&on(e[1])==="$type"&&f.push(new We(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new We(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Xt(e[1]),u!=="string"&&f.push(new We(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let p=2;p<e.length;p++)u=Xt(e[p]),on(e[1])==="$type"?f=f.concat(Is({key:`${i}[${p}]`,value:e[p],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new We(`${i}[${p}]`,e[p],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)f=f.concat(os({key:`${i}[${p}]`,value:e[p],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=Xt(e[1]),e.length!==2?f.push(new We(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new We(`${i}[1]`,e[1],`string expected, ${u} found`))}return f}function Ps(n,e){const i=n.key,o=n.validateSpec,u=n.style,f=n.styleSpec,p=n.value,y=n.objectKey,x=f[`${e}_${n.layerType}`];if(!x)return[];const T=y.match(/^(.*)-transition$/);if(e==="paint"&&T&&x[T[1]]&&x[T[1]].transition)return o({key:i,value:p,valueSpec:f.transition,style:u,styleSpec:f});const E=n.valueSpec||x[y];if(!E)return[new We(i,p,`unknown property "${y}"`)];let A;if(Xt(p)==="string"&&cr(E)&&!E.tokens&&(A=/^{([^}]+)}$/.exec(p)))return[new We(i,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const D=[];return n.layerType==="symbol"&&y==="text-font"&&Mc(Sa(p))&&on(p.type)==="identity"&&D.push(new We(i,p,'"text-font" does not support identity functions')),D.concat(o({key:n.key,value:p,valueSpec:E,style:u,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:y}))}function ls(n){return Ps(n,"paint")}function zc(n){return Ps(n,"layout")}function Dc(n){let e=[];const i=n.value,o=n.key,u=n.style,f=n.styleSpec;if(Xt(i)!=="object")return[new We(o,i,`object expected, ${Xt(i)} found`)];i.type||i.ref||e.push(new We(o,i,'either "type" or "ref" is required'));let p=on(i.type);const y=on(i.ref);if(i.id){const x=on(i.id);for(let T=0;T<n.arrayIndex;T++){const E=u.layers[T];on(E.id)===x&&e.push(new We(o,i.id,`duplicate layer id "${i.id}", previously used at line ${E.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach((T=>{T in i&&e.push(new We(o,i[T],`"${T}" is prohibited for ref layers`))})),u.layers.forEach((T=>{on(T.id)===y&&(x=T)})),x?x.ref?e.push(new We(o,i.ref,"ref cannot reference another ref layer")):p=on(x.type):e.push(new We(o,i.ref,`ref layer "${y}" not found`))}else if(p!=="background")if(i.source){const x=u.sources&&u.sources[i.source],T=x&&on(x.type);x?T==="vector"&&p==="raster"?e.push(new We(o,i.source,`layer "${i.id}" requires a raster source`)):T!=="raster-dem"&&p==="hillshade"||T!=="raster-dem"&&p==="color-relief"?e.push(new We(o,i.source,`layer "${i.id}" requires a raster-dem source`)):T==="raster"&&p!=="raster"?e.push(new We(o,i.source,`layer "${i.id}" requires a vector source`)):T!=="vector"||i["source-layer"]?T==="raster-dem"&&p!=="hillshade"&&p!=="color-relief"?e.push(new We(o,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):p!=="line"||!i.paint||!i.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||e.push(new We(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new We(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new We(o,i.source,`source "${i.source}" not found`))}else e.push(new We(o,i,'missing required property "source"'));return e=e.concat(Ma({key:o,value:i,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:i.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:i,objectKey:"type"}),filter:hr,layout:x=>Ma({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>zc(_i({layerType:p},T))}}),paint:x=>Ma({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>ls(_i({layerType:p},T))}})}})),e}function Za(n){const e=n.value,i=n.key,o=Xt(e);return o!=="string"?[new We(i,e,`string expected, ${o} found`)]:[]}const Fl={promoteId:function({key:n,value:e}){if(Xt(e)==="string")return Za({key:n,value:e});{const i=[];for(const o in e)i.push(...Za({key:`${n}.${o}`,value:e[o]}));return i}}};function Rs(n){const e=n.value,i=n.key,o=n.styleSpec,u=n.style,f=n.validateSpec;if(!e.type)return[new We(i,e,'"type" is required')];const p=on(e.type);let y;switch(p){case"vector":case"raster":return y=Ma({key:i,value:e,valueSpec:o[`source_${p.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:Fl,validateSpec:f}),y;case"raster-dem":return y=(function(x){var T;const E=(T=x.sourceName)!==null&&T!==void 0?T:"",A=x.value,D=x.styleSpec,I=D.source_raster_dem,O=x.style;let F=[];const V=Xt(A);if(A===void 0)return F;if(V!=="object")return F.push(new We("source_raster_dem",A,`object expected, ${V} found`)),F;const Z=on(A.encoding)==="custom",J=["redFactor","greenFactor","blueFactor","baseShift"],q=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const Y in A)!Z&&J.includes(Y)?F.push(new We(Y,A[Y],`In "${E}": "${Y}" is only valid when "encoding" is set to "custom". ${q} encoding found`)):I[Y]?F=F.concat(x.validateSpec({key:Y,value:A[Y],valueSpec:I[Y],validateSpec:x.validateSpec,style:O,styleSpec:D})):F.push(new We(Y,A[Y],`unknown property "${Y}"`));return F})({sourceName:i,value:e,style:n.style,styleSpec:o,validateSpec:f}),y;case"geojson":if(y=Ma({key:i,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:f,objectElementValidators:Fl}),e.cluster)for(const x in e.clusterProperties){const[T,E]=e.clusterProperties[x],A=typeof T=="string"?[T,["accumulated"],["get",x]]:T;y.push(...ss({key:`${i}.${x}.map`,value:E,expressionContext:"cluster-map"})),y.push(...ss({key:`${i}.${x}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return y;case"video":return Ma({key:i,value:e,valueSpec:o.source_video,style:u,validateSpec:f,styleSpec:o});case"image":return Ma({key:i,value:e,valueSpec:o.source_image,style:u,validateSpec:f,styleSpec:o});case"canvas":return[new We(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Is({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function An(n){const e=n.value,i=n.styleSpec,o=i.light,u=n.style;let f=[];const p=Xt(e);if(e===void 0)return f;if(p!=="object")return f=f.concat([new We("light",e,`object expected, ${p} found`)]),f;for(const y in e){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&o[x[1]]&&o[x[1]].transition?n.validateSpec({key:y,value:e[y],valueSpec:i.transition,validateSpec:n.validateSpec,style:u,styleSpec:i}):o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:n.validateSpec,style:u,styleSpec:i}):[new We(y,e[y],`unknown property "${y}"`)])}return f}function Lu(n){const e=n.value,i=n.styleSpec,o=i.sky,u=n.style,f=Xt(e);if(e===void 0)return[];if(f!=="object")return[new We("sky",e,`object expected, ${f} found`)];let p=[];for(const y in e)p=p.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}):[new We(y,e[y],`unknown property "${y}"`)]);return p}function Ic(n){const e=n.value,i=n.styleSpec,o=i.terrain,u=n.style;let f=[];const p=Xt(e);if(e===void 0)return f;if(p!=="object")return f=f.concat([new We("terrain",e,`object expected, ${p} found`)]),f;for(const y in e)f=f.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:n.validateSpec,style:u,styleSpec:i}):[new We(y,e[y],`unknown property "${y}"`)]);return f}function Th(n){let e=[];const i=n.value,o=n.key;if(Array.isArray(i)){const u=[],f=[];for(const p in i)i[p].id&&u.includes(i[p].id)&&e.push(new We(o,i,`all the sprites' ids must be unique, but ${i[p].id} is duplicated`)),u.push(i[p].id),i[p].url&&f.includes(i[p].url)&&e.push(new We(o,i,`all the sprites' URLs must be unique, but ${i[p].url} is duplicated`)),f.push(i[p].url),e=e.concat(Ma({key:`${o}[${p}]`,value:i[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return Za({key:o,value:i})}function kd(n){return!!n&&n.constructor===Object}function Sh(n){return kd(n.value)?[]:[new We(n.key,n.value,`object expected, ${Xt(n.value)} found`)]}const wn={"*":()=>[],array:Ru,boolean:function(n){const e=n.value,i=n.key,o=Xt(e);return o!=="boolean"?[new We(i,e,`boolean expected, ${o} found`)]:[]},number:as,color:Ds,constants:qa,enum:Is,filter:hr,function:rs,layer:Dc,object:Ma,source:Rs,light:An,sky:Lu,terrain:Ic,projection:function(n){const e=n.value,i=n.styleSpec,o=i.projection,u=n.style,f=Xt(e);if(e===void 0)return[];if(f!=="object")return[new We("projection",e,`object expected, ${f} found`)];let p=[];for(const y in e)p=p.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}):[new We(y,e[y],`unknown property "${y}"`)]);return p},projectionDefinition:function(n){const e=n.key;let i=n.value;i=i instanceof String?i.valueOf():i;const o=Xt(i);return o!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(i)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(i)?["array","string"].includes(o)?[]:[new We(e,i,`projection expected, invalid type "${o}" found`)]:[new We(e,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:Za,formatted:function(n){return Za(n).length===0?[]:ss(n)},resolvedImage:function(n){return Za(n).length===0?[]:ss(n)},padding:function(n){const e=n.key,i=n.value;if(Xt(i)==="array"){if(i.length<1||i.length>4)return[new We(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let u=[];for(let f=0;f<i.length;f++)u=u.concat(n.validateSpec({key:`${e}[${f}]`,value:i[f],validateSpec:n.validateSpec,valueSpec:o}));return u}return as({key:e,value:i,valueSpec:{}})},numberArray:function(n){const e=n.key,i=n.value;if(Xt(i)==="array"){const o={type:"number"};if(i.length<1)return[new We(e,i,"array length at least 1 expected, length 0 found")];let u=[];for(let f=0;f<i.length;f++)u=u.concat(n.validateSpec({key:`${e}[${f}]`,value:i[f],validateSpec:n.validateSpec,valueSpec:o}));return u}return as({key:e,value:i,valueSpec:{}})},colorArray:function(n){const e=n.key,i=n.value;if(Xt(i)==="array"){if(i.length<1)return[new We(e,i,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<i.length;u++)o=o.concat(Ds({key:`${e}[${u}]`,value:i[u]}));return o}return Ds({key:e,value:i})},variableAnchorOffsetCollection:function(n){const e=n.key,i=n.value,o=Xt(i),u=n.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new We(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let p=0;p<i.length;p+=2)f=f.concat(Is({key:`${e}[${p}]`,value:i[p],valueSpec:u.layout_symbol["text-anchor"]})),f=f.concat(Ru({key:`${e}[${p+1}]`,value:i[p+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:u}));return f},sprite:Th,state:Sh,fontFaces:function(n){const e=n.key,i=n.value,o=n.validateSpec,u=n.styleSpec,f=n.style;if(!kd(i))return[new We(e,i,`object expected, ${Xt(i)} found`)];const p=[];for(const y in i){const x=i[y],T=Xt(x);if(T==="string")p.push(...Za({key:`${e}.${y}`,value:x}));else if(T==="array"){const E={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[A,D]of x.entries())p.push(...Ma({key:`${e}.${y}[${A}]`,value:D,valueSpec:E,styleSpec:u,style:f,validateSpec:o}))}else p.push(new We(`${e}.${y}`,x,`string or array expected, ${T} found`))}return p}};function us(n){const e=n.value,i=n.valueSpec,o=n.styleSpec;return n.validateSpec=us,i.expression&&Mc(on(e))?rs(n):i.expression&&lo(Sa(e))?ss(n):i.type&&wn[i.type]?wn[i.type](n):Ma(_i({},n,{valueSpec:i.type?o[i.type]:i}))}function jl(n){const e=n.value,i=n.key,o=Za(n);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new We(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new We(i,e,'"glyphs" url must include a "{range}" token'))),o}function aa(n,e=le){let i=[];return i=i.concat(us({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:us,objectElementValidators:{glyphs:jl,"*":()=>[]}})),n.constants&&(i=i.concat(qa({key:"constants",value:n.constants}))),Zo(i)}function Ha(n){return function(e){return n(Object.assign({},e,{validateSpec:us}))}}function Zo(n){return[].concat(n).sort(((e,i)=>e.line-i.line))}function ra(n){return function(...e){return Zo(n.apply(this,e))}}aa.source=ra(Ha(Rs)),aa.sprite=ra(Ha(Th)),aa.glyphs=ra(Ha(jl)),aa.light=ra(Ha(An)),aa.sky=ra(Ha(Lu)),aa.terrain=ra(Ha(Ic)),aa.state=ra(Ha(Sh)),aa.layer=ra(Ha(Dc)),aa.filter=ra(Ha(hr)),aa.paintProperty=ra(Ha(ls)),aa.layoutProperty=ra(Ha(zc));const Xf={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class Nl{constructor(e,i){this._globalState=i,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const i=Ol(e,Xf,this._globalState);if(i.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=i.value,this._globalStateRefs=Bn(i.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const ku=le,Fn=aa,Dr=Fn.light,Pc=Fn.sky,Rc=Fn.paintProperty,Od=Fn.layoutProperty;function Ir(n,e){let i=!1;if(e&&e.length)for(const o of e)n.fire(new He(new Error(o.message))),i=!0;return i}class fo{constructor(e,i,o){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(i=p[1])+2*(o=p[2]);for(let x=0;x<this.d*this.d;x++){const T=p[3+x],E=p[3+x+1];u.push(T===E?null:p.subarray(T,E))}const y=p[3+u.length+1];this.keys=p.subarray(p[3+u.length],y),this.bboxes=p.subarray(y),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let p=0;p<this.d*this.d;p++)u.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=o,this.scale=i/e,this.uid=0;const f=o/i*e;this.min=-f,this.max=e+f}insert(e,i,o,u,f){this._forEachCell(i,o,u,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,i,o,u,f,p){this.cells[f].push(p)}query(e,i,o,u,f){const p=this.min,y=this.max;if(e<=p&&i<=p&&y<=o&&y<=u&&!f)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(e,i,o,u,this._queryCell,x,{},f),x}}_queryCell(e,i,o,u,f,p,y,x){const T=this.cells[f];if(T!==null){const E=this.keys,A=this.bboxes;for(let D=0;D<T.length;D++){const I=T[D];if(y[I]===void 0){const O=4*I;(x?x(A[O+0],A[O+1],A[O+2],A[O+3]):e<=A[O+2]&&i<=A[O+3]&&o>=A[O+0]&&u>=A[O+1])?(y[I]=!0,p.push(E[I])):y[I]=!1}}}}_forEachCell(e,i,o,u,f,p,y,x){const T=this._convertToCellCoord(e),E=this._convertToCellCoord(i),A=this._convertToCellCoord(o),D=this._convertToCellCoord(u);for(let I=T;I<=A;I++)for(let O=E;O<=D;O++){const F=this.d*O+I;if((!x||x(this._convertFromCellCoord(I),this._convertFromCellCoord(O),this._convertFromCellCoord(I+1),this._convertFromCellCoord(O+1)))&&f.call(this,e,i,o,u,F,p,y,x))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,i=3+this.cells.length+1+1;let o=0;for(let p=0;p<this.cells.length;p++)o+=this.cells[p].length;const u=new Int32Array(i+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let f=i;for(let p=0;p<e.length;p++){const y=e[p];u[3+p]=f,u.set(y,f),f+=y.length}return u[3+e.length]=f,u.set(this.keys,f),f+=this.keys.length,u[3+e.length+1]=f,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer}static serialize(e,i){const o=e.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(e){return new fo(e.buffer)}}const Ea={};function ut(n,e,i={}){if(Ea[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),Ea[n]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}ut("Object",Object),ut("Set",Set),ut("TransferableGridIndex",fo),ut("Color",Yt),ut("Error",Error),ut("AJAXError",U),ut("ResolvedImage",da),ut("StylePropertyFunction",Go),ut("StyleExpression",Cc,{omit:["_evaluator"]}),ut("ZoomDependentExpression",uo),ut("ZoomConstantExpression",_a),ut("CompoundExpression",Na,{omit:["_evaluate"]});for(const n in Ll)Ll[n]._classRegistryKey||ut(`Expression_${n}`,Ll[n]);function Ou(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Lc(n){return n.$name||n.constructor._classRegistryKey}function dr(n){return!(function(e){if(e===null||typeof e!="object")return!1;const i=Lc(e);return!(!i||i==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Ou(n)||Zr(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Pr(n,e){if(dr(n))return(Ou(n)||Zr(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const f=[];for(const p of n)f.push(Pr(p,e));return f}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const i=Lc(n);if(!i)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Ea[i])throw new Error(`${i} is not registered.`);const{klass:o}=Ea[i],u=o.serialize?o.serialize(n,e):{};if(o.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in n){if(!n.hasOwnProperty(f)||Ea[i].omit.indexOf(f)>=0)continue;const p=n[f];u[f]=Ea[i].shallow.indexOf(f)>=0?p:Pr(p,e)}n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(u.$name=i),u}function Vl(n){if(dr(n))return n;if(Array.isArray(n))return n.map(Vl);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const e=Lc(n)||"Object";if(!Ea[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=Ea[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const u of Object.keys(n)){if(u==="$name")continue;const f=n[u];o[u]=Ea[e].shallow.indexOf(u)>=0?f:Vl(f)}return o}class kc{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function cs(n){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function Ho(n){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function Bu(n){return/\s/u.test(String.fromCodePoint(n))}function hs(n){for(const e of n)if(Ho(e.codePointAt(0)))return!0;return!1}function Oc(n){for(const e of n)if(!Mh(e.codePointAt(0)))return!1;return!0}function Fu(n){const e=n.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(e.join("|"),"u")}const ds=Fu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Mh(n){return!ds.test(String.fromCodePoint(n))}function fs(n){return!(Ho(n)||(e=n,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const Bc=Fu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ju(n){return Bc.test(String.fromCodePoint(n))}function ps(n,e){return!(!e&&ju(n)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(n)))}function Ls(n){for(const e of n)if(ju(e.codePointAt(0)))return!0;return!1}const fr=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(fr.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,e){return h(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const i=n.pluginURL,o=new Promise((f=>{this.loadScriptResolve=f}));e(i);const u=new Promise((f=>setTimeout((()=>f()),this.TIMEOUT)));if(yield Promise.race([o,u]),this.isParsed()){const f={pluginStatus:"loaded",pluginURL:i};return this.setState(f),f}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)}))}};class Ai{constructor(e,i){this.isSupportedScript=Eh,this.zoom=e,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new kc,this.transition=i.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new kc,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}function Eh(n){return(function(e,i){for(const o of e)if(!ps(o.codePointAt(0),i))return!1;return!0})(n,fr.getRTLTextPluginStatus()==="loaded")}const ks="-transition";class po{constructor(e,i,o){this.property=e,this.value=i,this.expression=(function(u,f,p){if(Mc(u))return new Go(u,f);if(lo(u)){const y=co(u,f,p);if(y.result==="error")throw new Error(y.value.map((x=>`${x.key}: ${x.message}`)).join(", "));return y.value}{let y=u;return f.type==="color"&&typeof u=="string"?y=Yt.parse(u):f.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?f.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?f.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?y=fn.parse(u):f.type==="projectionDefinition"&&typeof u=="string"&&(y=On.parse(u)):y=It.parse(u):y=Ji.parse(u):y=En.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>y}}})(i===void 0?e.specification.default:i,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class Nu{constructor(e,i){this.property=e,this.value=new po(e,void 0,i)}transitioned(e,i){return new $o(this.property,this.value,i,Ui({},e.transition,this.transition),e.now)}untransitioned(){return new $o(this.property,this.value,null,{},0)}}class Fc{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=i}getValue(e){return Nn(this._values[e].value.value)}setValue(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Nu(this._values[e].property,this._globalState)),this._values[e].value=new po(this._values[e].property,i===null?void 0:Nn(i),this._globalState)}getTransition(e){return Nn(this._values[e].transition)}setTransition(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Nu(this._values[e].property,this._globalState)),this._values[e].transition=Nn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const u=this.getTransition(i);u!==void 0&&(e[`${i}${ks}`]=u)}return e}transitioned(e,i){const o=new Vu(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,i._values[u]);return o}untransitioned(){const e=new Vu(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class $o{constructor(e,i,o,u,f){this.property=e,this.value=i,this.begin=f+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const u=e.now||0,f=this.value.possiblyEvaluate(e,i,o),p=this.prior;if(p){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return p.possiblyEvaluate(e,i,o);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,o),f,lt(y))}}return f}}class Vu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const u=new Xo(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ah{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=i}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Nn(this._values[e].value)}setValue(e,i){this._values[e]=new po(this._values[e].property,i===null?void 0:Nn(i),this._globalState)}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const u=new Xo(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,o);return u}}class $a{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,u){return this.property.evaluate(this.value,this.parameters,e,i,o,u)}}class Xo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ct{constructor(e){this.specification=e}possiblyEvaluate(e,i){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(i)}interpolate(e,i,o){const u=tn[this.specification.type];return u?u(e,i,o):e}}class yt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,u){return new $a(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,u)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new $a(this,{kind:"constant",value:void 0},e.parameters);const u=tn[this.specification.type];if(u){const f=u(e.value.value,i.value.value,o);return new $a(this,{kind:"constant",value:f},e.parameters)}return e}evaluate(e,i,o,u,f,p){return e.kind==="constant"?e.value:e.evaluate(i,o,u,f,p)}}class pr extends yt{possiblyEvaluate(e,i,o,u){if(e.value===void 0)return new $a(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const f=e.expression.evaluate(i,null,{},o,u),p=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,y=this._calculate(p,p,p,i);return new $a(this,{kind:"constant",value:y},i)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new $a(this,{kind:"constant",value:f},i)}return new $a(this,e.expression,i)}evaluate(e,i,o,u,f,p){if(e.kind==="source"){const y=e.evaluate(i,o,u,f,p);return this._calculate(y,y,y,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,u),e.evaluate({zoom:Math.floor(i.zoom)},o,u),e.evaluate({zoom:Math.floor(i.zoom)+1},o,u),i):e.value}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class Ul{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(i,null,{},o,u);return this._calculate(f,f,f,i)}return this._calculate(e.expression.evaluate(new Ai(Math.floor(i.zoom-1),i)),e.expression.evaluate(new Ai(Math.floor(i.zoom),i)),e.expression.evaluate(new Ai(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class Uu{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){return!!e.expression.evaluate(i,null,{},o,u)}interpolate(){return!1}}class Tn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const o=e[i];o.specification.overridable&&this.overridableProperties.push(i);const u=this.defaultPropertyValues[i]=new po(o,void 0,void 0),f=this.defaultTransitionablePropertyValues[i]=new Nu(o,void 0);this.defaultTransitioningPropertyValues[i]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=u.possiblyEvaluate({})}}}ut("DataDrivenProperty",yt),ut("DataConstantProperty",ct),ut("CrossFadedDataDrivenProperty",pr),ut("CrossFadedProperty",Ul),ut("ColorRampProperty",Uu);class ln extends Be{constructor(e,i,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=(function(u,f){return new Nl(u,f)})(this.visibility,o),e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Ta(e.filter,o)),i.layout&&(this._unevaluatedLayout=new Ah(i.layout,o)),i.paint)){this._transitionablePaint=new Fc(i.paint,o);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xo(i.paint)}}setFilter(e){this.filter=e,this._featureFilter=Ta(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const i of this._visibilityExpression.getGlobalStateRefs())e.add(i);if(this._unevaluatedLayout)for(const i in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[i];for(const u of o.getGlobalStateRefs())e.add(u)}for(const i of this._featureFilter.getGlobalStateRefs())e.add(i);return e}getPaintAffectingGlobalStateRefs(){var e;const i=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const f of u.getGlobalStateRefs()){const p=(e=i.get(f))!==null&&e!==void 0?e:[];p.push({name:o,value:u.value}),i.set(f,p)}}return i}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,i,o={}){if(i==null||!this._validate(Od,`layers.${this.id}.layout.${e}`,e,i,o))return e==="visibility"?(this.visibility=i,this._visibilityExpression.setValue(i),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,i)}getPaintProperty(e){return e.endsWith(ks)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(i!=null&&this._validate(Rc,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(e.endsWith(ks))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const u=this._transitionablePaint._values[e],f=u.property.specification["property-type"]==="cross-faded-data-driven",p=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||p||f||this._handleOverridablePaintPropertyUpdate(e,y,x)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e=this.minzoom,i=!1){return!!(this.minzoom&&e<(i?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),qr(e,((i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length)))}_validate(e,i,o,u,f={}){return(!f||f.validate!==!1)&&Ir(this,e.call(Fn,{key:i,layerType:this.type,objectKey:o,value:u,styleSpec:le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof $a&&cr(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let mn;var Gu={get paint(){return mn=mn||new Tn({"raster-opacity":new ct(le.paint_raster["raster-opacity"]),"raster-hue-rotate":new ct(le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ct(le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ct(le.paint_raster["raster-brightness-max"]),"raster-saturation":new ct(le.paint_raster["raster-saturation"]),"raster-contrast":new ct(le.paint_raster["raster-contrast"]),"raster-resampling":new ct(le.paint_raster["raster-resampling"]),"raster-fade-duration":new ct(le.paint_raster["raster-fade-duration"])})}};class Os extends ln{constructor(e,i){super(e,Gu,i)}}const ei={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wi{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Qt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function nn(n,e=1){let i=0,o=0;return{members:n.map((u=>{const f=ei[u.type].BYTES_PER_ELEMENT,p=i=mr(i,Math.max(e,f)),y=u.components||1;return o=Math.max(o,f),i+=f*y,{name:u.name,type:u.type,components:y,offset:p}})),size:mr(i,Math.max(o,e)),alignment:e}}function mr(n,e){return Math.ceil(n/e)*e}class Rr extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=o,e}}Rr.prototype.bytesPerElement=4,ut("StructArrayLayout2i4",Rr);class Yo extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=u,e}}Yo.prototype.bytesPerElement=6,ut("StructArrayLayout3i6",Yo);class Wo extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,u)}emplace(e,i,o,u,f){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=u,this.int16[p+3]=f,e}}Wo.prototype.bytesPerElement=8,ut("StructArrayLayout4i8",Wo);class Bs extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=p,this.int16[x+5]=y,e}}Bs.prototype.bytesPerElement=12,ut("StructArrayLayout2i4i12",Bs);class Ch extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=4*e,T=8*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.uint8[T+4]=u,this.uint8[T+5]=f,this.uint8[T+6]=p,this.uint8[T+7]=y,e}}Ch.prototype.bytesPerElement=8,ut("StructArrayLayout2i4ub8",Ch);class $i extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=o,e}}$i.prototype.bytesPerElement=8,ut("StructArrayLayout2f8",$i);class Lr extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E){const A=this.length;return this.resize(A+1),this.emplace(A,e,i,o,u,f,p,y,x,T,E)}emplace(e,i,o,u,f,p,y,x,T,E,A){const D=10*e;return this.uint16[D+0]=i,this.uint16[D+1]=o,this.uint16[D+2]=u,this.uint16[D+3]=f,this.uint16[D+4]=p,this.uint16[D+5]=y,this.uint16[D+6]=x,this.uint16[D+7]=T,this.uint16[D+8]=E,this.uint16[D+9]=A,e}}Lr.prototype.bytesPerElement=20,ut("StructArrayLayout10ui20",Lr);class Gl extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,o,u,f,p,y,x)}emplace(e,i,o,u,f,p,y,x,T){const E=8*e;return this.uint16[E+0]=i,this.uint16[E+1]=o,this.uint16[E+2]=u,this.uint16[E+3]=f,this.uint16[E+4]=p,this.uint16[E+5]=y,this.uint16[E+6]=x,this.uint16[E+7]=T,e}}Gl.prototype.bytesPerElement=16,ut("StructArrayLayout8ui16",Gl);class ql extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E,A,D){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,o,u,f,p,y,x,T,E,A,D)}emplace(e,i,o,u,f,p,y,x,T,E,A,D,I){const O=12*e;return this.int16[O+0]=i,this.int16[O+1]=o,this.int16[O+2]=u,this.int16[O+3]=f,this.uint16[O+4]=p,this.uint16[O+5]=y,this.uint16[O+6]=x,this.uint16[O+7]=T,this.int16[O+8]=E,this.int16[O+9]=A,this.int16[O+10]=D,this.int16[O+11]=I,e}}ql.prototype.bytesPerElement=24,ut("StructArrayLayout4i4ui4i24",ql);class qu extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=u,e}}qu.prototype.bytesPerElement=12,ut("StructArrayLayout3f12",qu);class Zu extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Zu.prototype.bytesPerElement=4,ut("StructArrayLayout1ul4",Zu);class Hu extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,o,u,f,p,y,x,T)}emplace(e,i,o,u,f,p,y,x,T,E){const A=10*e,D=5*e;return this.int16[A+0]=i,this.int16[A+1]=o,this.int16[A+2]=u,this.int16[A+3]=f,this.int16[A+4]=p,this.int16[A+5]=y,this.uint32[D+3]=x,this.uint16[A+8]=T,this.uint16[A+9]=E,e}}Hu.prototype.bytesPerElement=20,ut("StructArrayLayout6i1ul2ui20",Hu);class mo extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=p,this.int16[x+5]=y,e}}mo.prototype.bytesPerElement=12,ut("StructArrayLayout2i2i2i12",mo);class Fs extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,u,f)}emplace(e,i,o,u,f,p){const y=4*e,x=8*e;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=u,this.int16[x+6]=f,this.int16[x+7]=p,e}}Fs.prototype.bytesPerElement=16,ut("StructArrayLayout2f1f2i16",Fs);class Jn extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=16*e,T=4*e,E=8*e;return this.uint8[x+0]=i,this.uint8[x+1]=o,this.float32[T+1]=u,this.float32[T+2]=f,this.int16[E+6]=p,this.int16[E+7]=y,e}}Jn.prototype.bytesPerElement=16,ut("StructArrayLayout2ub2f2i16",Jn);class an extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=u,e}}an.prototype.bytesPerElement=6,ut("StructArrayLayout3ui6",an);class ms extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E,A,D,I,O,F,V,Z){const J=this.length;return this.resize(J+1),this.emplace(J,e,i,o,u,f,p,y,x,T,E,A,D,I,O,F,V,Z)}emplace(e,i,o,u,f,p,y,x,T,E,A,D,I,O,F,V,Z,J){const q=24*e,Y=12*e,re=48*e;return this.int16[q+0]=i,this.int16[q+1]=o,this.uint16[q+2]=u,this.uint16[q+3]=f,this.uint32[Y+2]=p,this.uint32[Y+3]=y,this.uint32[Y+4]=x,this.uint16[q+10]=T,this.uint16[q+11]=E,this.uint16[q+12]=A,this.float32[Y+7]=D,this.float32[Y+8]=I,this.uint8[re+36]=O,this.uint8[re+37]=F,this.uint8[re+38]=V,this.uint32[Y+10]=Z,this.int16[q+22]=J,e}}ms.prototype.bytesPerElement=48,ut("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ms);class Ko extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E,A,D,I,O,F,V,Z,J,q,Y,re,de,Ae,Ne,Ve,Xe,at,Qe){const Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,e,i,o,u,f,p,y,x,T,E,A,D,I,O,F,V,Z,J,q,Y,re,de,Ae,Ne,Ve,Xe,at,Qe)}emplace(e,i,o,u,f,p,y,x,T,E,A,D,I,O,F,V,Z,J,q,Y,re,de,Ae,Ne,Ve,Xe,at,Qe,Ue){const Oe=32*e,ft=16*e;return this.int16[Oe+0]=i,this.int16[Oe+1]=o,this.int16[Oe+2]=u,this.int16[Oe+3]=f,this.int16[Oe+4]=p,this.int16[Oe+5]=y,this.int16[Oe+6]=x,this.int16[Oe+7]=T,this.uint16[Oe+8]=E,this.uint16[Oe+9]=A,this.uint16[Oe+10]=D,this.uint16[Oe+11]=I,this.uint16[Oe+12]=O,this.uint16[Oe+13]=F,this.uint16[Oe+14]=V,this.uint16[Oe+15]=Z,this.uint16[Oe+16]=J,this.uint16[Oe+17]=q,this.uint16[Oe+18]=Y,this.uint16[Oe+19]=re,this.uint16[Oe+20]=de,this.uint16[Oe+21]=Ae,this.uint16[Oe+22]=Ne,this.uint32[ft+12]=Ve,this.float32[ft+13]=Xe,this.float32[ft+14]=at,this.uint16[Oe+30]=Qe,this.uint16[Oe+31]=Ue,e}}Ko.prototype.bytesPerElement=64,ut("StructArrayLayout8i15ui1ul2f2ui64",Ko);class Qo extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Qo.prototype.bytesPerElement=4,ut("StructArrayLayout1f4",Qo);class Zl extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.uint16[6*e+0]=i,this.float32[f+1]=o,this.float32[f+2]=u,e}}Zl.prototype.bytesPerElement=12,ut("StructArrayLayout1ui2f12",Zl);class kr extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=4*e;return this.uint32[2*e+0]=i,this.uint16[f+2]=o,this.uint16[f+3]=u,e}}kr.prototype.bytesPerElement=8,ut("StructArrayLayout1ul2ui8",kr);class m extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=o,e}}m.prototype.bytesPerElement=4,ut("StructArrayLayout2ui4",m);class t extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}t.prototype.bytesPerElement=2,ut("StructArrayLayout1ui2",t);class r extends Qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,u)}emplace(e,i,o,u,f){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=u,this.float32[p+3]=f,e}}r.prototype.bytesPerElement=16,ut("StructArrayLayout4f16",r);class l extends wi{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ge(this.anchorPointX,this.anchorPointY)}}l.prototype.size=20;class d extends Hu{get(e){return new l(this,e)}}ut("CollisionBoxArray",d);class _ extends wi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}_.prototype.size=48;class v extends ms{get(e){return new _(this,e)}}ut("PlacedSymbolArray",v);class b extends wi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}b.prototype.size=64;class S extends Ko{get(e){return new b(this,e)}}ut("SymbolInstanceArray",S);class C extends Qo{getoffsetX(e){return this.float32[1*e+0]}}ut("GlyphOffsetArray",C);class z extends Yo{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ut("SymbolLineVertexArray",z);class L extends wi{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}L.prototype.size=12;class R extends Zl{get(e){return new L(this,e)}}ut("TextAnchorOffsetArray",R);class j extends wi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}j.prototype.size=8;class G extends kr{get(e){return new j(this,e)}}ut("FeatureIndexArray",G);class $ extends Rr{}class K extends Rr{}class W extends Rr{}class te extends Bs{}class oe extends Ch{}class ee extends $i{}class se extends Lr{}class ce extends Gl{}class ne extends ql{}class _e extends qu{}class Ie extends Zu{}class Ee extends mo{}class ze extends Jn{}class De extends an{}class et extends m{}const tt=nn([{name:"a_pos",components:2,type:"Int16"}],4),{members:qe}=tt;class rt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,i,o,u){const f=this.segments[this.segments.length-1];return e>rt.MAX_VERTEX_ARRAY_LENGTH&&xn(`Max vertices per segment is ${rt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${rt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!f||f.vertexLength+e>rt.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u?this.createNewSegment(i,o,u):f}createNewSegment(e,i,o){const u={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(e,i,o){return this.prepareSegment(0,e,i,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,u){return new rt([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function Vt(n,e){return 256*(n=Ot(Math.floor(n),0,255))+Ot(Math.floor(e),0,255)}rt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ut("SegmentVector",rt);const Ti=nn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Gi=nn([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Oi,Xi,Ii,un={exports:{}},Yi={exports:{}},Gn={exports:{}},gn=(function(){if(Ii)return un.exports;Ii=1;var n=(Oi||(Oi=1,Yi.exports=function(i,o){var u,f,p,y,x,T,E,A;for(f=i.length-(u=3&i.length),p=o,x=3432918353,T=461845907,A=0;A<f;)E=255&i.charCodeAt(A)|(255&i.charCodeAt(++A))<<8|(255&i.charCodeAt(++A))<<16|(255&i.charCodeAt(++A))<<24,++A,p=27492+(65535&(y=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(E=0,u){case 3:E^=(255&i.charCodeAt(A+2))<<16;case 2:E^=(255&i.charCodeAt(A+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&i.charCodeAt(A)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),Yi.exports),e=(Xi||(Xi=1,Gn.exports=function(i,o){for(var u,f=i.length,p=o^f,y=0;f>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Gn.exports);return un.exports=n,un.exports.murmur3=n,un.exports.murmur2=e,un.exports})(),_n=ke(gn);class qn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,u){this.ids.push(gs(e)),this.positions.push(i,o,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=gs(e);let o=0,u=this.ids.length-1;for(;o<u;){const p=o+u>>1;this.ids[p]>=i?u=p:o=p+1}const f=[];for(;this.ids[o]===i;)f.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return f}static serialize(e,i){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return _s(o,u,0,o.length-1),i&&i.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const i=new qn;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function gs(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:_n(String(n))}function _s(n,e,i,o){for(;i<o;){const u=n[i+o>>1];let f=i-1,p=o+1;for(;;){do f++;while(n[f]<u);do p--;while(n[p]>u);if(f>=p)break;Or(n,f,p),Or(e,3*f,3*p),Or(e,3*f+1,3*p+1),Or(e,3*f+2,3*p+2)}p-i<o-p?(_s(n,e,i,p),i=p+1):(_s(n,e,p+1,o),o=p)}}function Or(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}ut("FeaturePositionMap",qn);class Aa{constructor(e,i){this.gl=e.gl,this.location=i}}class Jo extends Aa{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Hl extends Aa{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Br extends Aa{constructor(e,i){super(e,i),this.current=Yt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Ca=new Float32Array(16);function Xa(n){return[Vt(255*n.r,255*n.g),Vt(255*n.b,255*n.a)]}class gr{constructor(e,i,o){this.value=e,this.uniformNames=i.map((u=>`u_${u}`)),this.type=o}setUniform(e,i,o){e.set(o.constantOr(this.value))}getBinding(e,i,o){return this.type==="color"?new Br(e,i):new Jo(e,i)}}class _r{constructor(e,i){this.uniformNames=i.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,i){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,i.y,i.height,i.width]}setUniform(e,i,o,u){let f=null;u==="u_pattern_to"?f=this.patternTo:u==="u_pattern_from"?f=this.patternFrom:u==="u_dasharray_to"?f=this.dashTo:u==="u_dasharray_from"?f=this.dashFrom:u==="u_pixel_ratio_to"?f=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(f=this.pixelRatioFrom),f!==null&&e.set(f)}getBinding(e,i,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new Hl(e,i):new Jo(e,i)}}class Ci{constructor(e,i,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map((f=>({name:`a_${f}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,i,o){const u=this.paintVertexArray.length,f=this.expression.evaluate(new Ai(0,o),i,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(u,e,f)}updatePaintArray(e,i,o,u,f){const p=this.expression.evaluate(new Ai(0,f),o,u);this._setPaintValue(e,i,p)}_setPaintValue(e,i,o){if(this.type==="color"){const u=Xa(o);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bi{constructor(e,i,o,u,f,p){this.expression=e,this.uniformNames=i.map((y=>`u_${y}_t`)),this.type=o,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map((y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new p}populatePaintArray(e,i,o){const u=this.expression.evaluate(new Ai(this.zoom,o),i,{},o.canonical,[],o.formattedSection),f=this.expression.evaluate(new Ai(this.zoom+1,o),i,{},o.canonical,[],o.formattedSection),p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(p,e,u,f)}updatePaintArray(e,i,o,u,f){const p=this.expression.evaluate(new Ai(this.zoom,f),o,u),y=this.expression.evaluate(new Ai(this.zoom+1,f),o,u);this._setPaintValue(e,i,p,y)}_setPaintValue(e,i,o,u){if(this.type==="color"){const f=Xa(o),p=Xa(u);for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,f[0],f[1],p[0],p[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,u=Ot(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,i,o){return new Jo(e,i)}}class Cn{constructor(e,i,o,u,f,p){this.expression=e,this.type=i,this.useIntegerZoom=o,this.zoom=u,this.layerId=p,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,i,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,this.getPositionIds(i),o)}updatePaintArray(e,i,o,u,f){this._setPaintValues(e,i,this.getPositionIds(o),f)}_setPaintValues(e,i,o,u){const f=this.getPositions(u);if(!f||!o)return;const p=f[o.min],y=f[o.mid],x=f[o.max];if(p&&y&&x)for(let T=e;T<i;T++)this.emplace(this.zoomInPaintVertexArray,T,y,p),this.emplace(this.zoomOutPaintVertexArray,T,y,x)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const i=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,i,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,i,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Pn extends Cn{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Ti.members}emplace(e,i,o,u){e.emplace(i,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],o.pixelRatio,u.pixelRatio)}}class jc extends Cn{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return Gi.members}emplace(e,i,o,u){e.emplace(i,0,o.y,o.height,o.width,0,u.y,u.height,u.width)}}class Nc{constructor(e,i,o){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!o(f))continue;const p=e.paint.get(f);if(!(p instanceof $a&&cr(p.property.specification)))continue;const y=Bd(f,e.type),x=p.value,T=p.property.specification.type,E=p.property.useIntegerZoom,A=p.property.specification["property-type"],D=A==="cross-faded"||A==="cross-faded-data-driven";if(x.kind==="constant")this.binders[f]=D?new _r(x.value,y):new gr(x.value,y,T),u.push(`/u_${f}`);else if(x.kind==="source"||D){const I=_o(f,T,"source");this.binders[f]=D?f==="line-dasharray"?new jc(x,T,E,i,I,e.id):new Pn(x,T,E,i,I,e.id):new Ci(x,y,T,I),u.push(`/a_${f}`)}else{const I=_o(f,T,"composite");this.binders[f]=new Bi(x,y,T,E,i,I),u.push(`/z_${f}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Ci||i instanceof Bi?i.maxValue:0}populatePaintArrays(e,i,o){for(const u in this.binders){const f=this.binders[u];(f instanceof Ci||f instanceof Bi||f instanceof Cn)&&f.populatePaintArray(e,i,o)}}setConstantPatternPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof _r&&u.setConstantPatternPositions(e,i)}}setConstantDashPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof _r&&u.setConstantDashPositions(e,i)}}updatePaintArrays(e,i,o,u,f){let p=!1;for(const y in e){const x=i.getPositions(y);for(const T of x){const E=o.feature(T.index);for(const A in this.binders){const D=this.binders[A];if((D instanceof Ci||D instanceof Bi||D instanceof Cn)&&D.expression.isStateDependent===!0){const I=u.paint.get(A);D.expression=I.value,D.updatePaintArray(T.start,T.end,E,e[y],f),p=!0}}}}return p}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof gr||o instanceof _r)&&e.push(...o.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Ci||o instanceof Bi)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name);else if(o instanceof Cn){const u=o.getVertexAttributes();for(const f of u)e.push(f.name)}}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof gr||o instanceof _r||o instanceof Bi)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof gr||f instanceof _r||f instanceof Bi){for(const p of f.uniformNames)if(i[p]){const y=f.getBinding(e,i[p],p);o.push({name:p,property:u,binding:y})}}}return o}setUniforms(e,i,o,u){for(const{name:f,property:p,binding:y}of i)this.binders[p].setUniform(y,u,o.get(p),f)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof Cn){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Ci||o instanceof Bi)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Ci||o instanceof Bi||o instanceof Cn)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Ci||i instanceof Bi||i instanceof Cn)&&i.destroy()}}}class go{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Nc(u,i,o);this.needsUpload=!1,this._featureMap=new qn,this._bufferOffset=0}populatePaintArrays(e,i,o,u){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,i,u);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,u){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,i,f,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Bd(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function _o(n,e,i){const o={color:{source:$i,composite:r},number:{source:Qo,composite:$i}},u=(function(f){return{"line-pattern":{source:se,composite:se},"fill-pattern":{source:se,composite:se},"fill-extrusion-pattern":{source:se,composite:se},"line-dasharray":{source:ce,composite:ce}}[f]})(n);return u&&u[i]||o[e][i]}ut("ConstantBinder",gr),ut("CrossFadedConstantBinder",_r),ut("SourceExpressionBinder",Ci),ut("CrossFadedPatternBinder",Pn),ut("CrossFadedDasharrayBinder",jc),ut("CompositeExpressionBinder",Bi),ut("ProgramConfiguration",Nc,{omit:["_buffers"]}),ut("ProgramConfigurationSet",go);const Vc=Math.pow(2,14)-1,js=-Vc-1;function Ns(n){const e=_t/n.extent,i=n.loadGeometry();for(let o=0;o<i.length;o++){const u=i[o];for(let f=0;f<u.length;f++){const p=u[f],y=Math.round(p.x*e),x=Math.round(p.y*e);p.x=Ot(y,js,Vc),p.y=Ot(x,js,Vc),(y<p.x||y>p.x+1||x<p.y||x>p.y+1)&&xn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Fr(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Ns(n):[]}}const Uc=-32768;function $u(n,e,i,o,u){n.emplaceBack(Uc+8*e+o,Uc+8*i+u)}class Xu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new K,this.indexArray=new De,this.segments=new rt,this.programConfigurations=new go(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){const u=this.layers[0],f=[];let p=null,y=!1,x=u.type==="heatmap";if(u.type==="circle"){const E=u;p=E.layout.get("circle-sort-key"),y=!p.isConstant(),x=x||E.paint.get("circle-pitch-alignment")==="map"}const T=x?i.subdivisionGranularity.circle:1;for(const{feature:E,id:A,index:D,sourceLayerIndex:I}of e){const O=this.layers[0]._featureFilter.needGeometry,F=Fr(E,O);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),F,o))continue;const V=y?p.evaluate(F,{},o):void 0,Z={id:A,properties:E.properties,type:E.type,sourceLayerIndex:I,index:D,geometry:O?F.geometry:Ns(E),patterns:{},sortKey:V};f.push(Z)}y&&f.sort(((E,A)=>E.sortKey-A.sortKey));for(const E of f){const{geometry:A,index:D,sourceLayerIndex:I}=E,O=e[D].feature;this.addFeature(E,A,D,o,T),i.featureIndex.insert(O,A,D,I,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qe),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,u,f=1){let p;switch(f){case 1:p=[0,7];break;case 3:p=[0,2,5,7];break;case 5:p=[0,1,3,4,6,7];break;case 7:p=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${f}; valid values are 1, 3, 5, 7.`)}const y=p.length;for(const x of i)for(const T of x){const E=T.x,A=T.y;if(E<0||E>=_t||A<0||A>=_t)continue;const D=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,e.sortKey),I=D.vertexLength;for(let O=0;O<y;O++)for(let F=0;F<y;F++)$u(this.layoutVertexArray,E,A,p[F],p[O]);for(let O=0;O<y-1;O++)for(let F=0;F<y-1;F++){const V=I+O*y+F,Z=I+(O+1)*y+F;this.indexArray.emplaceBack(V,Z+1,V+1),this.indexArray.emplaceBack(V,Z,Z+1)}D.vertexLength+=y*y,D.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:u})}}function Yu(n,e){for(let i=0;i<n.length;i++)if(yo(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(yo(n,e[i]))return!0;return!!ea(n,e)}function Fd(n,e,i){return!!yo(n,e)||!!Nd(e,n,i)}function jd(n,e){if(n.length===1)return Wf(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let u=0;u<o.length;u++)if(yo(n,o[u]))return!0}for(let i=0;i<n.length;i++)if(Wf(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(ea(n,e[i]))return!0;return!1}function Zn(n,e,i){if(n.length>1){if(ea(n,e))return!0;for(let o=0;o<e.length;o++)if(Nd(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(Nd(n[o],e,i))return!0;return!1}function ea(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],u=n[i+1];for(let f=0;f<e.length-1;f++)if($p(o,u,e[f],e[f+1]))return!0}return!1}function $p(n,e,i,o){return ca(n,i,o)!==ca(e,i,o)&&ca(n,e,i)!==ca(n,e,o)}function Nd(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(Yf(n,e[u-1],e[u])<o)return!0;return!1}function Yf(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function Wf(n,e){let i,o,u,f=!1;for(let p=0;p<n.length;p++){i=n[p];for(let y=0,x=i.length-1;y<i.length;x=y++)o=i[y],u=i[x],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(f=!f)}return f}function yo(n,e){let i=!1;for(let o=0,u=n.length-1;o<n.length;u=o++){const f=n[o],p=n[u];f.y>e.y!=p.y>e.y&&e.x<(p.x-f.x)*(e.y-f.y)/(p.y-f.y)+f.x&&(i=!i)}return i}function Xp(n,e,i){const o=i[0],u=i[2];if(n.x<o.x&&e.x<o.x||n.x>u.x&&e.x>u.x||n.y<o.y&&e.y<o.y||n.y>u.y&&e.y>u.y)return!1;const f=ca(n,e,i[0]);return f!==ca(n,e,i[1])||f!==ca(n,e,i[2])||f!==ca(n,e,i[3])}function el(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function zh(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Vd(n,e,i,o,u){if(!e[0]&&!e[1])return n;const f=ge.convert(e)._mult(u);i==="viewport"&&f._rotate(-o);const p=[];for(let y=0;y<n.length;y++)p.push(n[y].sub(f));return p}function Ud(n){const e=[];for(let i=0;i<n.length;i++){const o=n[i],u=e.at(-1);(i===0||u&&!o.equals(u))&&e.push(o)}return e}function Kf({queryGeometry:n,size:e},i){return Fd(n,i,e)}function Yp({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},f){return Fd(n,f,e*(i.projectTileCoordinates(f.x,f.y,o,u).signedDistanceFromCamera/i.cameraToCenterDistance))}function Wp({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},f){const p=i.projectTileCoordinates(f.x,f.y,o,u).signedDistanceFromCamera,y=e*(i.cameraToCenterDistance/p);return Fd(n,Dh(f,i,o,u),y)}function Kp({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},f){return Fd(n,Dh(f,i,o,u),e)}function Gd({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u,pitchAlignment:f="map",pitchScale:p="map"},y){const x=f==="map"?p==="map"?Kf:Yp:p==="map"?Wp:Kp,T={queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u};for(const E of y)for(const A of E)if(x(T,A))return!0;return!1}function Dh(n,e,i,o){const u=e.projectTileCoordinates(n.x,n.y,i,o).point;return new ge((.5*u.x+.5)*e.width,(.5*-u.y+.5)*e.height)}let qd,Qf;ut("CircleBucket",Xu,{omit:["layers"]});var Jf={get paint(){return Qf=Qf||new Tn({"circle-radius":new yt(le.paint_circle["circle-radius"]),"circle-color":new yt(le.paint_circle["circle-color"]),"circle-blur":new yt(le.paint_circle["circle-blur"]),"circle-opacity":new yt(le.paint_circle["circle-opacity"]),"circle-translate":new ct(le.paint_circle["circle-translate"]),"circle-translate-anchor":new ct(le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ct(le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ct(le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yt(le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yt(le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yt(le.paint_circle["circle-stroke-opacity"])})},get layout(){return qd=qd||new Tn({"circle-sort-key":new yt(le.layout_circle["circle-sort-key"])})}};class Zd extends ln{constructor(e,i){super(e,Jf,i)}createBucket(e){return new Xu(e)}queryRadius(e){const i=e;return el("circle-radius",this,i)+el("circle-stroke-width",this,i)+zh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){const T=Vd(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-f.bearingInRadians,p),E=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),A=this.paint.get("circle-pitch-scale"),D=this.paint.get("circle-pitch-alignment");let I,O;return D==="map"?(I=T,O=E*p):(I=(function(F,V,Z,J){return F.map((q=>Dh(q,V,Z,J)))})(T,f,y,x),O=E),Gd({queryGeometry:I,size:O,transform:f,unwrappedTileID:y,getElevation:x,pitchAlignment:D,pitchScale:A},u)}}class Hd extends Xu{}let ep;ut("HeatmapBucket",Hd,{omit:["layers"]});var tp={get paint(){return ep=ep||new Tn({"heatmap-radius":new yt(le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yt(le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ct(le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Uu(le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ct(le.paint_heatmap["heatmap-opacity"])})}};function $d(n,{width:e,height:i},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*i*o}`)}else u=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=u,n}function vo(n,{width:e,height:i},o){if(e===n.width&&i===n.height)return;const u=$d({},{width:e,height:i},o);Ih(n,u,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,i)},o),n.width=e,n.height=i,n.data=u.data}function Ih(n,e,i,o,u,f){if(u.width===0||u.height===0)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const p=n.data,y=e.data;if(p===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const T=((i.y+x)*n.width+i.x)*f,E=((o.y+x)*e.width+o.x)*f;for(let A=0;A<u.width*f;A++)y[E+A]=p[T+A]}return e}class Ph{constructor(e,i){$d(this,e,1,i)}resize(e){vo(this,e,1)}clone(){return new Ph({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,f){Ih(e,i,o,u,f,1)}}class za{constructor(e,i){$d(this,e,4,i)}resize(e){vo(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new za({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,f){Ih(e,i,o,u,f,4)}setPixel(e,i,o){const u=4*(e*this.width+i);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function xo(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,u=n.image||new za({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const f=(p,y,x)=>{e[n.evaluationKey]=x;const T=n.expression.evaluate(e);u.setPixel(p/4/i,y/4,T)};if(n.clips)for(let p=0,y=0;p<o;++p,y+=4*i)for(let x=0,T=0;x<i;x++,T+=4){const E=x/(i-1),{start:A,end:D}=n.clips[p];f(y,T,A*(1-E)+D*E)}else for(let p=0,y=0;p<i;p++,y+=4)f(0,y,p/(i-1));return u}ut("AlphaImage",Ph),ut("RGBAImage",za);const Rh="big-fb";class Qp extends ln{createBucket(e){return new Hd(e)}constructor(e,i){super(e,tp,i),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=xo({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Rh)&&this.heatmapFbos.delete(Rh)}queryRadius(e){return el("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){return Gd({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(i,o)*p,transform:f,unwrappedTileID:y,getElevation:x},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let Lh;var kh={get paint(){return Lh=Lh||new Tn({"hillshade-illumination-direction":new ct(le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new ct(le.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new ct(le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ct(le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ct(le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ct(le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ct(le.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new ct(le.paint_hillshade["hillshade-method"])})}};class yn extends ln{constructor(e,i){super(e,kh,i),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const f=Math.max(e.length,i.length,o.length,u.length);e=e.concat(Array(f-e.length).fill(e.at(-1))),i=i.concat(Array(f-i.length).fill(i.at(-1))),o=o.concat(Array(f-o.length).fill(o.at(-1))),u=u.concat(Array(f-u.length).fill(u.at(-1)));const p=i.map(Ln);return{directionRadians:e.map(Ln),altitudeRadians:p,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let Jp;var Qm={get paint(){return Jp=Jp||new Tn({"color-relief-opacity":new ct(le["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Uu(le["paint_color-relief"]["color-relief-color"])})}};class Xd{constructor(e,i,o,u){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,o){const{width:u,height:f}=e,p=!(this.size&&this.size[0]===u&&this.size[1]===f||o),{context:y}=this,{gl:x}=y;if(this.useMipmap=!!(i&&i.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),p)this.size=[u,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Zr(e)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,f,0,this.format,x.UNSIGNED_BYTE,e.data);else{const{x:T,y:E}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Zr(e)?x.texSubImage2D(x.TEXTURE_2D,0,T,E,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,T,E,u,f,x.RGBA,x.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,i,o){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),o!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,o||e),this.filter=e),i!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Gc{constructor(e,i,o,u=1,f=1,p=1,y=0){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void xn(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const x=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=f,this.blueFactor=p,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<x;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(x,T)]=this.data[this._idx(x-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,x)]=this.data[this._idx(T,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<x;T++)for(let E=0;E<x;E++){const A=this.get(T,E);A>this.max&&(this.max=A),A<this.min&&(this.min=A)}}get(e,i){const o=new Uint8Array(this.data.buffer),u=4*this._idx(e,i);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${i}, dim: ${this.dim}`);return(i+1)*this.stride+(e+1)}unpack(e,i,o){return e*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return tl(e,this.getUnpackVector())}getPixels(){return new za({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,p=o*this.dim,y=o*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(o){case-1:p=y-1;break;case 1:y=p+1}const x=-i*this.dim,T=-o*this.dim;for(let E=p;E<y;E++)for(let A=u;A<f;A++)this.data[this._idx(A,E)]=e.data[this._idx(A+x,E+T)]}}function tl(n,e){const i=e[0],o=e[1],u=e[2],f=e[3],p=Math.min(i,o,u),y=Math.round((n+f)/p);return{r:Math.floor(y*p/i)%256,g:Math.floor(y*p/o)%256,b:Math.floor(y*p/u)%256}}ut("DEMData",Gc);class em extends ln{constructor(e,i){super(e,Qm,i)}_createColorRamp(e){const i={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof _a&&o._styleExpression.expression instanceof ma){this.colorRampExpression=o;const p=o._styleExpression.expression;i.elevationStops=p.labels,i.colorStops=[];for(const y of i.elevationStops)i.colorStops.push(p.evaluate({globals:{elevation:y}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[Yt.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=e)return i;const u={elevationStops:[],colorStops:[]},f=(i.elevationStops.length-1)/(e-1);for(let p=0;p<i.elevationStops.length-.5;p+=f)u.elevationStops.push(i.elevationStops[Math.round(p)]),u.colorStops.push(i.colorStops[Math.round(p)]);return xn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${i.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,i,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(i),f=new za({width:u.colorStops.length,height:1}),p=new za({width:u.colorStops.length,height:1});for(let y=0;y<u.elevationStops.length;y++){const x=tl(u.elevationStops[y],o);p.setPixel(0,y,new Yt(x.r/255,x.g/255,x.b/255,1)),f.setPixel(0,y,u.colorStops[y])}return this.colorRampTextures={elevationTexture:new Xd(e,p,e.gl.RGBA),colorTexture:new Xd(e,f,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const tm=nn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Oh}=tm;function jr(n,e,i){const o=i.patternDependencies;let u=!1;for(const f of e){const p=f.paint.get(`${n}-pattern`);p.isConstant()||(u=!0);const y=p.constantOr(null);y&&(u=!0,o[y.to]=!0,o[y.from]=!0)}return u}function Yd(n,e,i,o,u){const{zoom:f}=o,p=u.patternDependencies;for(const y of e){const x=y.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:f-1},i,{},u.availableImages),E=x.evaluate({zoom:f},i,{},u.availableImages),A=x.evaluate({zoom:f+1},i,{},u.availableImages);T=T&&T.name?T.name:T,E=E&&E.name?E.name:E,A=A&&A.name?A.name:A,p[T]=!0,p[E]=!0,p[A]=!0,i.patterns[y.id]={min:T,mid:E,max:A}}}return i}function Wd(n,e,i,o,u){let f;if(u===(function(p,y,x,T){let E=0;for(let A=y,D=x-T;A<x;A+=T)E+=(p[D]-p[A])*(p[A+1]+p[D+1]),D=A;return E})(n,e,i,o)>0)for(let p=e;p<i;p+=o)f=Ya(p/o|0,n[p],n[p+1],f);else for(let p=i-o;p>=e;p-=o)f=Ya(p/o|0,n[p],n[p+1],f);return f&&yr(f,f.next)&&(Wa(f),f=f.next),f}function $l(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!yr(o,o.next)&&xi(o.prev,o,o.next)!==0)o=o.next;else{if(Wa(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Wu(n,e,i,o,u,f,p){if(!n)return;!p&&f&&(function(x,T,E,A){let D=x;do D.z===0&&(D.z=$n(D.x,D.y,T,E,A)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,(function(I){let O,F=1;do{let V,Z=I;I=null;let J=null;for(O=0;Z;){O++;let q=Z,Y=0;for(let de=0;de<F&&(Y++,q=q.nextZ,q);de++);let re=F;for(;Y>0||re>0&&q;)Y!==0&&(re===0||!q||Z.z<=q.z)?(V=Z,Z=Z.nextZ,Y--):(V=q,q=q.nextZ,re--),J?J.nextZ=V:I=V,V.prevZ=J,J=V;Z=q}J.nextZ=null,F*=2}while(O>1)})(D)})(n,o,u,f);let y=n;for(;n.prev!==n.next;){const x=n.prev,T=n.next;if(f?Kd(n,o,u,f):ip(n))e.push(x.i,n.i,T.i),Wa(n),n=T.next,y=T.next;else if((n=T)===y){p?p===1?Wu(n=im($l(n),e),e,i,o,u,f,2):p===2&&il(n,e,i,o,u,f):Wu($l(n),e,i,o,u,f,1);break}}}function ip(n){const e=n.prev,i=n,o=n.next;if(xi(e,i,o)>=0)return!1;const u=e.x,f=i.x,p=o.x,y=e.y,x=i.y,T=o.y,E=Math.min(u,f,p),A=Math.min(y,x,T),D=Math.max(u,f,p),I=Math.max(y,x,T);let O=o.next;for(;O!==e;){if(O.x>=E&&O.x<=D&&O.y>=A&&O.y<=I&&qc(u,y,f,x,p,T,O.x,O.y)&&xi(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function Kd(n,e,i,o){const u=n.prev,f=n,p=n.next;if(xi(u,f,p)>=0)return!1;const y=u.x,x=f.x,T=p.x,E=u.y,A=f.y,D=p.y,I=Math.min(y,x,T),O=Math.min(E,A,D),F=Math.max(y,x,T),V=Math.max(E,A,D),Z=$n(I,O,e,i,o),J=$n(F,V,e,i,o);let q=n.prevZ,Y=n.nextZ;for(;q&&q.z>=Z&&Y&&Y.z<=J;){if(q.x>=I&&q.x<=F&&q.y>=O&&q.y<=V&&q!==u&&q!==p&&qc(y,E,x,A,T,D,q.x,q.y)&&xi(q.prev,q,q.next)>=0||(q=q.prevZ,Y.x>=I&&Y.x<=F&&Y.y>=O&&Y.y<=V&&Y!==u&&Y!==p&&qc(y,E,x,A,T,D,Y.x,Y.y)&&xi(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;q&&q.z>=Z;){if(q.x>=I&&q.x<=F&&q.y>=O&&q.y<=V&&q!==u&&q!==p&&qc(y,E,x,A,T,D,q.x,q.y)&&xi(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;Y&&Y.z<=J;){if(Y.x>=I&&Y.x<=F&&Y.y>=O&&Y.y<=V&&Y!==u&&Y!==p&&qc(y,E,x,A,T,D,Y.x,Y.y)&&xi(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function im(n,e){let i=n;do{const o=i.prev,u=i.next.next;!yr(o,u)&&rp(o,i,i.next,u)&&jh(o,u)&&jh(u,o)&&(e.push(o.i,i.i,u.i),Wa(i),Wa(i.next),i=n=u),i=i.next}while(i!==n);return $l(i)}function il(n,e,i,o,u,f){let p=n;do{let y=p.next.next;for(;y!==p.prev;){if(p.i!==y.i&&Sn(p,y)){let x=Nh(p,y);return p=$l(p,p.next),x=$l(x,x.next),Wu(p,e,i,o,u,f,0),void Wu(x,e,i,o,u,f,0)}y=y.next}p=p.next}while(p!==n)}function Hn(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function np(n,e){const i=(function(u,f){let p=f;const y=u.x,x=u.y;let T,E=-1/0;if(yr(u,p))return p;do{if(yr(u,p.next))return p.next;if(x<=p.y&&x>=p.next.y&&p.next.y!==p.y){const F=p.x+(x-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(F<=y&&F>E&&(E=F,T=p.x<p.next.x?p:p.next,F===y))return T}p=p.next}while(p!==f);if(!T)return null;const A=T,D=T.x,I=T.y;let O=1/0;p=T;do{if(y>=p.x&&p.x>=D&&y!==p.x&&ap(x<I?y:E,x,D,I,x<I?E:y,x,p.x,p.y)){const F=Math.abs(x-p.y)/(y-p.x);jh(p,u)&&(F<O||F===O&&(p.x>T.x||p.x===T.x&&nm(T,p)))&&(T=p,O=F)}p=p.next}while(p!==A);return T})(n,e);if(!i)return e;const o=Nh(i,n);return $l(o,o.next),$l(i,i.next)}function nm(n,e){return xi(n.prev,n,e.prev)<0&&xi(e.next,n,n.next)<0}function $n(n,e,i,o,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Jm(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function ap(n,e,i,o,u,f,p,y){return(u-p)*(e-y)>=(n-p)*(f-y)&&(n-p)*(o-y)>=(i-p)*(e-y)&&(i-p)*(f-y)>=(u-p)*(o-y)}function qc(n,e,i,o,u,f,p,y){return!(n===p&&e===y)&&ap(n,e,i,o,u,f,p,y)}function Sn(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!(function(i,o){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==o.i&&u.next.i!==o.i&&rp(u,u.next,i,o))return!0;u=u.next}while(u!==i);return!1})(n,e)&&(jh(n,e)&&jh(e,n)&&(function(i,o){let u=i,f=!1;const p=(i.x+o.x)/2,y=(i.y+o.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&p<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==i);return f})(n,e)&&(xi(n.prev,n,e.prev)||xi(n,e.prev,e))||yr(n,e)&&xi(n.prev,n,n.next)>0&&xi(e.prev,e,e.next)>0)}function xi(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function yr(n,e){return n.x===e.x&&n.y===e.y}function rp(n,e,i,o){const u=Fh(xi(n,e,i)),f=Fh(xi(n,e,o)),p=Fh(xi(i,o,n)),y=Fh(xi(i,o,e));return u!==f&&p!==y||!(u!==0||!Bh(n,i,e))||!(f!==0||!Bh(n,o,e))||!(p!==0||!Bh(i,n,o))||!(y!==0||!Bh(i,e,o))}function Bh(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Fh(n){return n>0?1:n<0?-1:0}function jh(n,e){return xi(n.prev,n,n.next)<0?xi(n,e,n.next)>=0&&xi(n,n.prev,e)>=0:xi(n,e,n.prev)<0||xi(n,n.next,e)<0}function Nh(n,e){const i=Qd(n.i,n.x,n.y),o=Qd(e.i,e.x,e.y),u=n.next,f=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,o.next=i,i.prev=o,f.next=o,o.prev=f,o}function Ya(n,e,i,o){const u=Qd(n,e,i);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function Wa(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Qd(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ta{constructor(e,i){if(i>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=i}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Vh{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Vh.noSubdivision=new Vh({fill:new ta(0,0),line:new ta(0,0),tile:new ta(0,0),stencil:new ta(0,0),circle:1}),ut("SubdivisionGranularityExpression",ta),ut("SubdivisionGranularitySetting",Vh);const vr=-32768,Vs=32767;class nl{constructor(e,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=_t/e,this._canonical=i}_getKey(e,i){return(e+=32768)<<16|i+32768}_vertexToIndex(e,i){if(e<-32768||i<-32768||e>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),u=0|Math.round(i),f=this._getKey(o,u);if(this._vertexDictionary.has(f))return this._vertexDictionary.get(f);const p=this._vertexBuffer.length/2;return this._vertexDictionary.set(f,p),this._vertexBuffer.push(o,u),p}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(u,f){const p=[];for(let y=0;y<f.length;y+=3){const x=f[y],T=f[y+1],E=f[y+2],A=u[2*x],D=u[2*x+1];(u[2*T]-A)*(u[2*E+1]-D)-(u[2*T+1]-D)*(u[2*E]-A)>0?(p.push(x),p.push(E),p.push(T)):(p.push(x),p.push(T),p.push(E))}return p})(this._vertexBuffer,e);const i=[],o=e.length;for(let u=0;u<o;u+=3){const f=[e[u+0],e[u+1],e[u+2]],p=[this._vertexBuffer[2*e[u+0]+0],this._vertexBuffer[2*e[u+0]+1],this._vertexBuffer[2*e[u+1]+0],this._vertexBuffer[2*e[u+1]+1],this._vertexBuffer[2*e[u+2]+0],this._vertexBuffer[2*e[u+2]+1]];let y=1/0,x=1/0,T=-1/0,E=-1/0;for(let F=0;F<3;F++){const V=p[2*F],Z=p[2*F+1];y=Math.min(y,V),T=Math.max(T,V),x=Math.min(x,Z),E=Math.max(E,Z)}if(y===T||x===E)continue;const A=Math.floor(y/this._granularityCellSize),D=Math.ceil(T/this._granularityCellSize),I=Math.floor(x/this._granularityCellSize),O=Math.ceil(E/this._granularityCellSize);if(A!==D||I!==O)for(let F=I;F<O;F++){const V=this._scanlineGenerateVertexRingForCellRow(F,p,f);Us(this._vertexBuffer,V,i)}else i.push(...f)}return i}_scanlineGenerateVertexRingForCellRow(e,i,o){const u=e*this._granularityCellSize,f=u+this._granularityCellSize,p=[];for(let y=0;y<3;y++){const x=i[2*y],T=i[2*y+1],E=i[2*(y+1)%6],A=i[(2*(y+1)+1)%6],D=i[2*(y+2)%6],I=i[(2*(y+2)+1)%6],O=E-x,F=A-T,V=O===0,Z=F===0,J=(u-T)/F,q=(f-T)/F,Y=Math.min(J,q),re=Math.max(J,q);if(!Z&&(Y>=1||re<=0)||Z&&(T<u||T>f)){A>=u&&A<=f&&p.push(o[(y+1)%3]);continue}!Z&&Y>0&&p.push(this._vertexToIndex(x+O*Y,T+F*Y));const de=x+O*Math.max(Y,0),Ae=x+O*Math.min(re,1);V||this._generateIntraEdgeVertices(p,x,T,E,A,de,Ae),!Z&&re<1&&p.push(this._vertexToIndex(x+O*re,T+F*re)),(Z||A>=u&&A<=f)&&p.push(o[(y+1)%3]),!Z&&(A<=u||A>=f)&&this._generateInterEdgeVertices(p,x,T,E,A,D,I,Ae,u,f)}return p}_generateIntraEdgeVertices(e,i,o,u,f,p,y){const x=u-i,T=f-o,E=T===0,A=E?Math.min(i,u):Math.min(p,y),D=E?Math.max(i,u):Math.max(p,y),I=Math.floor(A/this._granularityCellSize)+1,O=Math.ceil(D/this._granularityCellSize)-1;if(E?i<u:p<y)for(let F=I;F<=O;F++){const V=F*this._granularityCellSize;e.push(this._vertexToIndex(V,o+T*(V-i)/x))}else for(let F=O;F>=I;F--){const V=F*this._granularityCellSize;e.push(this._vertexToIndex(V,o+T*(V-i)/x))}}_generateInterEdgeVertices(e,i,o,u,f,p,y,x,T,E){const A=f-o,D=p-u,I=y-f,O=(T-f)/I,F=(E-f)/I,V=Math.min(O,F),Z=Math.max(O,F),J=u+D*V;let q=Math.floor(Math.min(J,x)/this._granularityCellSize)+1,Y=Math.ceil(Math.max(J,x)/this._granularityCellSize)-1,re=x<J;const de=I===0;if(de&&(y===T||y===E))return;if(de||V>=1||Z<=0){const Ne=o-y,Ve=p+(i-p)*Math.min((T-y)/Ne,(E-y)/Ne);q=Math.floor(Math.min(Ve,x)/this._granularityCellSize)+1,Y=Math.ceil(Math.max(Ve,x)/this._granularityCellSize)-1,re=x<Ve}const Ae=A>0?E:T;if(re)for(let Ne=q;Ne<=Y;Ne++)e.push(this._vertexToIndex(Ne*this._granularityCellSize,Ae));else for(let Ne=Y;Ne>=q;Ne--)e.push(this._vertexToIndex(Ne*this._granularityCellSize,Ae))}_generateOutline(e){const i=[];for(const o of e){const u=al(o,this._granularity,!0),f=this._pointArrayToIndices(u),p=[];for(let y=1;y<f.length;y++)p.push(f[y-1]),p.push(f[y]);i.push(p)}return i}_handlePoles(e){let i=!1,o=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(i||o)&&this._fillPoles(e,i,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let i=0;i<e.length;i+=2){const o=e[i+1];o===vr&&(e[i+1]=-32767),o===Vs&&(e[i+1]=32766)}}_generatePoleQuad(e,i,o,u,f,p){u>f!=(p===vr)?(e.push(i),e.push(o),e.push(this._vertexToIndex(u,p)),e.push(o),e.push(this._vertexToIndex(f,p)),e.push(this._vertexToIndex(u,p))):(e.push(o),e.push(i),e.push(this._vertexToIndex(u,p)),e.push(this._vertexToIndex(f,p)),e.push(o),e.push(this._vertexToIndex(u,p)))}_fillPoles(e,i,o){const u=this._vertexBuffer,f=_t,p=e.length;for(let y=2;y<p;y+=3){const x=e[y-2],T=e[y-1],E=e[y],A=u[2*x],D=u[2*x+1],I=u[2*T],O=u[2*T+1],F=u[2*E],V=u[2*E+1];i&&(D===0&&O===0&&this._generatePoleQuad(e,x,T,A,I,vr),O===0&&V===0&&this._generatePoleQuad(e,T,E,I,F,vr),V===0&&D===0&&this._generatePoleQuad(e,E,x,F,A,vr)),o&&(D===f&&O===f&&this._generatePoleQuad(e,x,T,A,I,Vs),O===f&&V===f&&this._generatePoleQuad(e,T,E,I,F,Vs),V===f&&D===f&&this._generatePoleQuad(e,E,x,F,A,Vs))}}_initializeVertices(e){for(let i=0;i<e.length;i+=2)this._vertexToIndex(e[i],e[i+1])}subdividePolygonInternal(e,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=(function(y){const x=[],T=[];for(const E of y)if(E.length!==0){E!==y[0]&&x.push(T.length/2);for(let A=0;A<E.length;A++)T.push(E[A].x),T.push(E[A].y)}return{flattened:T,holeIndices:x}})(e);let f;this._initializeVertices(o);try{const y=(function(T,E,A=2){const D=E&&E.length,I=D?E[0]*A:T.length;let O=Wd(T,0,I,A,!0);const F=[];if(!O||O.next===O.prev)return F;let V,Z,J;if(D&&(O=(function(q,Y,re,de){const Ae=[];for(let Ne=0,Ve=Y.length;Ne<Ve;Ne++){const Xe=Wd(q,Y[Ne]*de,Ne<Ve-1?Y[Ne+1]*de:q.length,de,!1);Xe===Xe.next&&(Xe.steiner=!0),Ae.push(Jm(Xe))}Ae.sort(Hn);for(let Ne=0;Ne<Ae.length;Ne++)re=np(Ae[Ne],re);return re})(T,E,O,A)),T.length>80*A){V=T[0],Z=T[1];let q=V,Y=Z;for(let re=A;re<I;re+=A){const de=T[re],Ae=T[re+1];de<V&&(V=de),Ae<Z&&(Z=Ae),de>q&&(q=de),Ae>Y&&(Y=Ae)}J=Math.max(q-V,Y-Z),J=J!==0?32767/J:0}return Wu(O,F,A,V,Z,J,0),F})(o,u),x=this._convertIndices(o,y);f=this._subdivideTrianglesScanline(x)}catch(y){console.error(y)}let p=[];return i&&(p=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(f),{verticesFlattened:this._vertexBuffer,indicesTriangles:f,indicesLineList:p}}_convertIndices(e,i){const o=[];for(let u=0;u<i.length;u++)o.push(this._vertexToIndex(e[2*i[u]],e[2*i[u]+1]));return o}_pointArrayToIndices(e){const i=[];for(let o=0;o<e.length;o++){const u=e[o];i.push(this._vertexToIndex(u.x,u.y))}return i}}function Jd(n,e,i,o=!0){return new nl(i,e).subdividePolygonInternal(n,o)}function al(n,e,i=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],u=n[n.length-1],f=i&&(o.x!==u.x||o.y!==u.y);if(e<2)return f?[...n,n[0]]:[...n];const p=Math.floor(_t/e),y=[];y.push(new ge(n[0].x,n[0].y));const x=n.length,T=f?x:x-1;for(let E=0;E<T;E++){const A=n[E],D=E<x-1?n[E+1]:n[0],I=A.x,O=A.y,F=D.x,V=D.y,Z=I!==F,J=O!==V;if(!Z&&!J)continue;const q=F-I,Y=V-O,re=Math.abs(q),de=Math.abs(Y);let Ae=I,Ne=O;for(;;){const Xe=q>0?(Math.floor(Ae/p)+1)*p:(Math.ceil(Ae/p)-1)*p,at=Y>0?(Math.floor(Ne/p)+1)*p:(Math.ceil(Ne/p)-1)*p,Qe=Math.abs(Ae-Xe),Ue=Math.abs(Ne-at),Oe=Math.abs(Ae-F),ft=Math.abs(Ne-V),gt=Z?Qe/re:Number.POSITIVE_INFINITY,St=J?Ue/de:Number.POSITIVE_INFINITY;if((Oe<=Qe||!Z)&&(ft<=Ue||!J))break;if(gt<St&&Z||!J){Ae=Xe,Ne+=Y*gt;const vt=new ge(Ae,Math.round(Ne));y[y.length-1].x===vt.x&&y[y.length-1].y===vt.y||y.push(vt)}else{Ae+=q*St,Ne=at;const vt=new ge(Math.round(Ae),Ne);y[y.length-1].x===vt.x&&y[y.length-1].y===vt.y||y.push(vt)}}const Ve=new ge(F,V);y[y.length-1].x===Ve.x&&y[y.length-1].y===Ve.y||y.push(Ve)}return y}function Us(n,e,i){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=n[2*e[0]];for(let x=1;x<e.length;x++){const T=n[2*e[x]];T<u&&(u=T,o=x)}const f=e.length;let p=o,y=(p+1)%f;for(;;){const x=p-1>=0?p-1:f-1,T=(y+1)%f,E=n[2*e[x]],A=n[2*e[T]],D=n[2*e[p]],I=n[2*e[p]+1],O=n[2*e[y]+1];let F=!1;if(E<A)F=!0;else if(E>A)F=!1;else{const V=O-I,Z=-(n[2*e[y]]-D),J=I<O?1:-1;((E-D)*V+(n[2*e[x]+1]-I)*Z)*J>((A-D)*V+(n[2*e[T]+1]-I)*Z)*J&&(F=!0)}if(F){const V=e[x],Z=e[p],J=e[y];V!==Z&&V!==J&&Z!==J&&i.push(J,Z,V),p--,p<0&&(p=f-1)}else{const V=e[T],Z=e[p],J=e[y];V!==Z&&V!==J&&Z!==J&&i.push(J,Z,V),y++,y>=f&&(y=0)}if(x===T)break}}function sp(n,e,i,o,u,f,p,y,x){const T=u.length/2,E=p&&y&&x;if(T<rt.MAX_VERTEX_ARRAY_LENGTH){const A=e.prepareSegment(T,i,o),D=A.vertexLength;for(let F=0;F<f.length;F+=3)o.emplaceBack(D+f[F],D+f[F+1],D+f[F+2]);let I,O;A.vertexLength+=T,A.primitiveLength+=f.length/3,E&&(O=p.prepareSegment(T,i,y),I=O.vertexLength,O.vertexLength+=T);for(let F=0;F<u.length;F+=2)n(u[F],u[F+1]);if(E)for(let F=0;F<x.length;F++){const V=x[F];for(let Z=1;Z<V.length;Z+=2)y.emplaceBack(I+V[Z-1],I+V[Z]);O.primitiveLength+=V.length/2}}else(function(A,D,I,O,F,V){const Z=[];for(let de=0;de<O.length/2;de++)Z.push(-1);const J={count:0};let q=0,Y=A.getOrCreateLatestSegment(D,I),re=Y.vertexLength;for(let de=2;de<F.length;de+=3){const Ae=F[de-2],Ne=F[de-1],Ve=F[de];let Xe=Z[Ae]<q,at=Z[Ne]<q,Qe=Z[Ve]<q;Y.vertexLength+((Xe?1:0)+(at?1:0)+(Qe?1:0))>rt.MAX_VERTEX_ARRAY_LENGTH&&(Y=A.createNewSegment(D,I),q=J.count,Xe=!0,at=!0,Qe=!0,re=0);const Ue=bo(Z,O,V,J,Ae,Xe,Y),Oe=bo(Z,O,V,J,Ne,at,Y),ft=bo(Z,O,V,J,Ve,Qe,Y);I.emplaceBack(re+Ue-q,re+Oe-q,re+ft-q),Y.primitiveLength++}})(e,i,o,u,f,n),E&&(function(A,D,I,O,F,V){const Z=[];for(let de=0;de<O.length/2;de++)Z.push(-1);const J={count:0};let q=0,Y=A.getOrCreateLatestSegment(D,I),re=Y.vertexLength;for(let de=0;de<F.length;de++){const Ae=F[de];for(let Ne=1;Ne<F[de].length;Ne+=2){const Ve=Ae[Ne-1],Xe=Ae[Ne];let at=Z[Ve]<q,Qe=Z[Xe]<q;Y.vertexLength+((at?1:0)+(Qe?1:0))>rt.MAX_VERTEX_ARRAY_LENGTH&&(Y=A.createNewSegment(D,I),q=J.count,at=!0,Qe=!0,re=0);const Ue=bo(Z,O,V,J,Ve,at,Y),Oe=bo(Z,O,V,J,Xe,Qe,Y);I.emplaceBack(re+Ue-q,re+Oe-q),Y.primitiveLength++}}})(p,i,y,u,x,n),e.forceNewSegmentOnNextPrepare(),p?.forceNewSegmentOnNextPrepare()}function bo(n,e,i,o,u,f,p){if(f){const y=o.count;return i(e[2*u],e[2*u+1]),n[u]=o.count,o.count++,p.vertexLength++,y}return n[u]}class Ku{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new W,this.indexArray=new De,this.indexArray2=new et,this.programConfigurations=new go(e.layers,e.zoom),this.segments=new rt,this.segments2=new rt,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=jr("fill",this.layers,i);const u=this.layers[0].layout.get("fill-sort-key"),f=!u.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of e){const A=this.layers[0]._featureFilter.needGeometry,D=Fr(y,A);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),D,o))continue;const I=f?u.evaluate(D,{},o,i.availableImages):void 0,O={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:A?D.geometry:Ns(y),patterns:{},sortKey:I};p.push(O)}f&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:E}=y;if(this.hasDependencies){const A=Yd("fill",this.layers,y,{zoom:this.zoom},i);this.patternFeatures.push(A)}else this.addFeature(y,x,T,o,{},i.subdivisionGranularity);i.featureIndex.insert(e[T].feature,x,T,E,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,i,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Oh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,u,f,p){for(const y of Tu(i,500)){const x=Jd(y,u,p.fill.getGranularityForZoomLevel(u.z)),T=this.layoutVertexArray;sp(((E,A)=>{T.emplaceBack(E,A)}),this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles,this.segments2,this.indexArray2,x.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,canonical:u})}}let Zc,Qu;ut("FillBucket",Ku,{omit:["layers","patternFeatures"]});var am={get paint(){return Qu=Qu||new Tn({"fill-antialias":new ct(le.paint_fill["fill-antialias"]),"fill-opacity":new yt(le.paint_fill["fill-opacity"]),"fill-color":new yt(le.paint_fill["fill-color"]),"fill-outline-color":new yt(le.paint_fill["fill-outline-color"]),"fill-translate":new ct(le.paint_fill["fill-translate"]),"fill-translate-anchor":new ct(le.paint_fill["fill-translate-anchor"]),"fill-pattern":new pr(le.paint_fill["fill-pattern"])})},get layout(){return Zc=Zc||new Tn({"fill-sort-key":new yt(le.layout_fill["fill-sort-key"])})}};class rm extends ln{constructor(e,i){super(e,am,i)}recalculate(e,i){super.recalculate(e,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Ku(e)}queryRadius(){return zh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:i,transform:o,pixelsToTileUnits:u}){return jd(Vd(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),i)}isTileClipped(){return!0}}const Uh=nn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),sm=nn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ef}=Uh;class Hc{constructor(e,i,o,u,f){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=f,e.readFields(eg,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,o=[];let u,f=1,p=0,y=0,x=0;for(;e.pos<i;){if(p<=0){const T=e.readVarint();f=7&T,p=T>>3}if(p--,f===1||f===2)y+=e.readSVarint(),x+=e.readSVarint(),f===1&&(u&&o.push(u),u=[]),u&&u.push(new ge(y,x));else{if(f!==7)throw new Error(`unknown command ${f}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let o=1,u=0,f=0,p=0,y=1/0,x=-1/0,T=1/0,E=-1/0;for(;e.pos<i;){if(u<=0){const A=e.readVarint();o=7&A,u=A>>3}if(u--,o===1||o===2)f+=e.readSVarint(),p+=e.readSVarint(),f<y&&(y=f),f>x&&(x=f),p<T&&(T=p),p>E&&(E=p);else if(o!==7)throw new Error(`unknown command ${o}`)}return[y,T,x,E]}toGeoJSON(e,i,o){const u=this.extent*Math.pow(2,o),f=this.extent*e,p=this.extent*i,y=this.loadGeometry();function x(D){return[360*(D.x+f)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+p)/u)*Math.PI))-90]}function T(D){return D.map(x)}let E;if(this.type===1){const D=[];for(const O of y)D.push(O[0]);const I=T(D);E=D.length===1?{type:"Point",coordinates:I[0]}:{type:"MultiPoint",coordinates:I}}else if(this.type===2){const D=y.map(T);E=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=om(y),I=[];for(const O of D)I.push(O.map(T));E=I.length===1?{type:"Polygon",coordinates:I[0]}:{type:"MultiPolygon",coordinates:I}}}const A={type:"Feature",geometry:E,properties:this.properties};return this.id!=null&&(A.id=this.id),A}}function eg(n,e,i){n===1?e.id=i.readVarint():n===2?(function(o,u){const f=o.readVarint()+o.pos;for(;o.pos<f;){const p=u._keys[o.readVarint()],y=u._values[o.readVarint()];u.properties[p]=y}})(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function om(n){const e=n.length;if(e<=1)return[n];const i=[];let o,u;for(let f=0;f<e;f++){const p=Fi(n[f]);p!==0&&(u===void 0&&(u=p<0),u===p<0?(o&&i.push(o),o=[n[f]]):o&&o.push(n[f]))}return o&&i.push(o),i}function Fi(n){let e=0;for(let i,o,u=0,f=n.length,p=f-1;u<f;p=u++)i=n[u],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}Hc.types=["Unknown","Point","LineString","Polygon"];class rn{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(fi,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new Hc(this._pbf,i,this.extent,this._keys,this._values)}}function fi(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push((function(o){let u=null;const f=o.readVarint()+o.pos;for(;o.pos<f;){const p=o.readVarint()>>3;u=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(i))}class pi{constructor(e,i){this.layers=e.readFields(Zi,{},i)}}function Zi(n,e,i){if(n===3){const o=new rn(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}const Ka=Math.pow(2,13);function ys(n,e,i,o,u,f,p,y){n.emplaceBack(e,i,2*Math.floor(o*Ka)+p,u*Ka*2,f*Ka*2,Math.round(y))}class Xl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new te,this.centroidVertexArray=new $,this.indexArray=new De,this.programConfigurations=new go(e.layers,e.zoom),this.segments=new rt,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.features=[],this.hasDependencies=jr("fill-extrusion",this.layers,i);for(const{feature:u,id:f,index:p,sourceLayerIndex:y}of e){const x=this.layers[0]._featureFilter.needGeometry,T=Fr(u,x);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),T,o))continue;const E={id:f,sourceLayerIndex:y,index:p,geometry:x?T.geometry:Ns(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(Yd("fill-extrusion",this.layers,E,{zoom:this.zoom},i)):this.addFeature(E,E.geometry,p,o,{},i.subdivisionGranularity),i.featureIndex.insert(u,E.geometry,p,y,this.index,!0)}}addFeatures(e,i,o){for(const u of this.features){const{geometry:f}=u;this.addFeature(u,f,u.index,i,o,e.subdivisionGranularity)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ef),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,sm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,i,o,u,f,p){for(const y of Tu(i,500)){const x={x:0,y:0,sampleCount:0},T=this.layoutVertexArray.length;this.processPolygon(x,u,e,y,p);const E=this.layoutVertexArray.length-T,A=Math.floor(x.x/x.sampleCount),D=Math.floor(x.y/x.sampleCount);for(let I=0;I<E;I++)this.centroidVertexArray.emplaceBack(A,D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,canonical:u})}processPolygon(e,i,o,u,f){if(u.length<1||zn(u[0]))return;for(const A of u)A.length!==0&&op(e,A);const p={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=f.fill.getGranularityForZoomLevel(i.z),x=Hc.types[o.type]==="Polygon";for(const A of u){if(A.length===0||zn(A))continue;const D=al(A,y,x);this._generateSideFaces(D,p)}if(!x)return;const T=Jd(u,i,y,!1),E=this.layoutVertexArray;sp(((A,D)=>{ys(E,A,D,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles)}_generateSideFaces(e,i){let o=0;for(let u=1;u<e.length;u++){const f=e[u],p=e[u-1];if(rl(f,p))continue;i.segment.vertexLength+4>rt.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=f.sub(p)._perp()._unit(),x=p.dist(f);o+x>32768&&(o=0),ys(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,0,o),ys(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,1,o),o+=x,ys(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,0,o),ys(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,1,o);const T=i.segment.vertexLength;this.indexArray.emplaceBack(T,T+2,T+1),this.indexArray.emplaceBack(T+1,T+2,T+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function op(n,e){for(let i=0;i<e.length;i++){const o=e[i];i===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function rl(n,e){return n.x===e.x&&(n.x<0||n.x>_t)||n.y===e.y&&(n.y<0||n.y>_t)}function zn(n){return n.every((e=>e.x<0))||n.every((e=>e.x>_t))||n.every((e=>e.y<0))||n.every((e=>e.y>_t))}let sl;ut("FillExtrusionBucket",Xl,{omit:["layers","features"]});var Ju={get paint(){return sl=sl||new Tn({"fill-extrusion-opacity":new ct(le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yt(le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ct(le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ct(le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new pr(le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yt(le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yt(le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ct(le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class lp extends ln{constructor(e,i){super(e,Ju,i)}createBucket(e){return new Xl(e)}queryRadius(){return zh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p,pixelPosMatrix:y}){const x=Vd(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-f.bearingInRadians,p),T=this.paint.get("fill-extrusion-height").evaluate(i,o),E=this.paint.get("fill-extrusion-base").evaluate(i,o),A=(function(I,O){const F=[];for(const V of I){const Z=[V.x,V.y,0,1];ni(Z,Z,O),F.push(new ge(Z[0]/Z[3],Z[1]/Z[3]))}return F})(x,y),D=(function(I,O,F,V){const Z=[],J=[],q=V[8]*O,Y=V[9]*O,re=V[10]*O,de=V[11]*O,Ae=V[8]*F,Ne=V[9]*F,Ve=V[10]*F,Xe=V[11]*F;for(const at of I){const Qe=[],Ue=[];for(const Oe of at){const ft=Oe.x,gt=Oe.y,St=V[0]*ft+V[4]*gt+V[12],vt=V[1]*ft+V[5]*gt+V[13],Jt=V[2]*ft+V[6]*gt+V[14],vn=V[3]*ft+V[7]*gt+V[15],Wn=Jt+re,Ra=vn+de,Eo=St+Ae,Tr=vt+Ne,va=Jt+Ve,La=vn+Xe,Rn=new ge((St+q)/Ra,(vt+Y)/Ra);Rn.z=Wn/Ra,Qe.push(Rn);const xa=new ge(Eo/La,Tr/La);xa.z=va/La,Ue.push(xa)}Z.push(Qe),J.push(Ue)}return[Z,J]})(u,E,T,y);return(function(I,O,F){let V=1/0;jd(F,O)&&(V=ec(F,O[0]));for(let Z=0;Z<O.length;Z++){const J=O[Z],q=I[Z];for(let Y=0;Y<J.length-1;Y++){const re=J[Y],de=[re,J[Y+1],q[Y+1],q[Y],re];Yu(F,de)&&(V=Math.min(V,ec(F,de)))}}return V!==1/0&&V})(D[0],D[1],A)}}function ya(n,e){return n.x*e.x+n.y*e.y}function ec(n,e){if(n.length===1){let i=0;const o=e[i++];let u;for(;!u||o.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const f=e[i],p=n[0],y=u.sub(o),x=f.sub(o),T=p.sub(o),E=ya(y,y),A=ya(y,x),D=ya(x,x),I=ya(T,y),O=ya(T,x),F=E*D-A*A,V=(D*I-A*O)/F,Z=(E*O-A*I)/F,J=o.z*(1-V-Z)+u.z*V+f.z*Z;if(isFinite(J))return J}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}const Gh=nn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:xr}=Gh,up=nn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:tf}=up,lm=Math.cos(Math.PI/180*37.5),qh=Math.pow(2,14)/.5;class $c{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new oe,this.layoutVertexArray2=new ee,this.indexArray=new De,this.programConfigurations=new go(e.layers,e.zoom),this.segments=new rt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=jr("line",this.layers,i)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),f=!u.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of e){const A=this.layers[0]._featureFilter.needGeometry,D=Fr(y,A);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),D,o))continue;const I=f?u.evaluate(D,{},o):void 0,O={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:A?D.geometry:Ns(y),patterns:{},dashes:{},sortKey:I};p.push(O)}f&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:E}=y;this.hasDependencies?(jr("line",this.layers,i)?Yd("line",this.layers,y,{zoom:this.zoom},i):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,y,this.zoom,i),this.patternFeatures.push(y)):this.addFeature(y,x,T,o,{},{},i.subdivisionGranularity),i.featureIndex.insert(e[T].feature,x,T,E,this.index)}}update(e,i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o,dashPositions:u})}addFeatures(e,i,o,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,o,u,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,tf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xr),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,u,f,p,y){const x=this.layers[0].layout,T=x.get("line-join").evaluate(e,{}),E=x.get("line-cap"),A=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const I of i)this.addLine(I,e,T,E,A,D,u,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,dashPositions:p,canonical:u})}addLine(e,i,o,u,f,p,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=al(e,y?x.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let q=0;q<e.length-1;q++)this.totalDistance+=e[q].dist(e[q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=Hc.types[i.type]==="Polygon";let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let A=0;for(;A<E-1&&e[A].equals(e[A+1]);)A++;if(E<(T?3:2))return;o==="bevel"&&(f=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let O,F,V,Z,J;this.e1=this.e2=-1,T&&(O=e[E-2],J=e[A].sub(O)._unit()._perp());for(let q=A;q<E;q++){if(V=q===E-1?T?e[A+1]:void 0:e[q+1],V&&e[q].equals(V))continue;J&&(Z=J),O&&(F=O),O=e[q],J=V?V.sub(O)._unit()._perp():Z,Z=Z||J;let Y=Z.add(J);Y.x===0&&Y.y===0||Y._unit();const re=Z.x*J.x+Z.y*J.y,de=Y.x*J.x+Y.y*J.y,Ae=de!==0?1/de:1/0,Ne=2*Math.sqrt(2-2*de),Ve=de<lm&&F&&V,Xe=Z.x*J.y-Z.y*J.x>0;if(Ve&&q>A){const Ue=O.dist(F);if(Ue>2*D){const Oe=O.sub(O.sub(F)._mult(D/Ue)._round());this.updateDistance(F,Oe),this.addCurrentVertex(Oe,Z,0,0,I),F=Oe}}const at=F&&V;let Qe=at?o:T?"butt":u;if(at&&Qe==="round"&&(Ae<p?Qe="miter":Ae<=2&&(Qe="fakeround")),Qe==="miter"&&Ae>f&&(Qe="bevel"),Qe==="bevel"&&(Ae>2&&(Qe="flipbevel"),Ae<f&&(Qe="miter")),F&&this.updateDistance(F,O),Qe==="miter")Y._mult(Ae),this.addCurrentVertex(O,Y,0,0,I);else if(Qe==="flipbevel"){if(Ae>100)Y=J.mult(-1);else{const Ue=Ae*Z.add(J).mag()/Z.sub(J).mag();Y._perp()._mult(Ue*(Xe?-1:1))}this.addCurrentVertex(O,Y,0,0,I),this.addCurrentVertex(O,Y.mult(-1),0,0,I)}else if(Qe==="bevel"||Qe==="fakeround"){const Ue=-Math.sqrt(Ae*Ae-1),Oe=Xe?Ue:0,ft=Xe?0:Ue;if(F&&this.addCurrentVertex(O,Z,Oe,ft,I),Qe==="fakeround"){const gt=Math.round(180*Ne/Math.PI/20);for(let St=1;St<gt;St++){let vt=St/gt;if(vt!==.5){const vn=vt-.5;vt+=vt*vn*(vt-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*vn*vn+(.848013+re*(.215638*re-1.06021)))}const Jt=J.sub(Z)._mult(vt)._add(Z)._unit()._mult(Xe?-1:1);this.addHalfVertex(O,Jt.x,Jt.y,!1,Xe,0,I)}}V&&this.addCurrentVertex(O,J,-Oe,-ft,I)}else if(Qe==="butt")this.addCurrentVertex(O,Y,0,0,I);else if(Qe==="square"){const Ue=F?1:-1;this.addCurrentVertex(O,Y,Ue,Ue,I)}else Qe==="round"&&(F&&(this.addCurrentVertex(O,Z,0,0,I),this.addCurrentVertex(O,Z,1,1,I,!0)),V&&(this.addCurrentVertex(O,J,-1,-1,I,!0),this.addCurrentVertex(O,J,0,0,I)));if(Ve&&q<E-1){const Ue=O.dist(V);if(Ue>2*D){const Oe=O.add(V.sub(O)._mult(D/Ue)._round());this.updateDistance(O,Oe),this.addCurrentVertex(Oe,J,0,0,I),O=Oe}}}}addCurrentVertex(e,i,o,u,f,p=!1){const y=i.y*u-i.x,x=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,p,!1,o,f),this.addHalfVertex(e,y,x,p,!0,-u,f),this.distance>qh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,i,o,u,f,p))}addHalfVertex({x:e,y:i},o,u,f,p,y,x){const T=.5*(this.lineClips?this.scaledDistance*(qh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,E,this.e2),x.primitiveLength++),p?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}hasLineDasharray(e){for(const i of e){const o=i.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,i,o,u){for(const f of e){const p=f.paint.get("line-dasharray");if(!p||p.value.kind==="constant")continue;const y=f.layout.get("line-cap")==="round",x={dasharray:p.value.evaluate({zoom:o-1},i,{}),round:y},T={dasharray:p.value.evaluate({zoom:o},i,{}),round:y},E={dasharray:p.value.evaluate({zoom:o+1},i,{}),round:y},A=`${x.dasharray.join(",")},${x.round}`,D=`${T.dasharray.join(",")},${T.round}`,I=`${E.dasharray.join(",")},${E.round}`;u.dashDependencies[A]=x,u.dashDependencies[D]=T,u.dashDependencies[I]=E,i.dashes[f.id]={min:A,mid:D,max:I}}}}let ol,Xn;ut("LineBucket",$c,{omit:["layers","patternFeatures"]});var ll={get paint(){return Xn=Xn||new Tn({"line-opacity":new yt(le.paint_line["line-opacity"]),"line-color":new yt(le.paint_line["line-color"]),"line-translate":new ct(le.paint_line["line-translate"]),"line-translate-anchor":new ct(le.paint_line["line-translate-anchor"]),"line-width":new yt(le.paint_line["line-width"]),"line-gap-width":new yt(le.paint_line["line-gap-width"]),"line-offset":new yt(le.paint_line["line-offset"]),"line-blur":new yt(le.paint_line["line-blur"]),"line-dasharray":new pr(le.paint_line["line-dasharray"]),"line-pattern":new pr(le.paint_line["line-pattern"]),"line-gradient":new Uu(le.paint_line["line-gradient"])})},get layout(){return ol=ol||new Tn({"line-cap":new ct(le.layout_line["line-cap"]),"line-join":new yt(le.layout_line["line-join"]),"line-miter-limit":new ct(le.layout_line["line-miter-limit"]),"line-round-limit":new ct(le.layout_line["line-round-limit"]),"line-sort-key":new yt(le.layout_line["line-sort-key"])})}};class Xc extends yt{possiblyEvaluate(e,i){return i=new Ai(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,u){return i=Ui({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,u)}}let vs;class cp extends ln{constructor(e,i){super(e,ll,i),this.gradientVersion=0,vs||(vs=new Xc(ll.paint.properties["line-width"].specification),vs.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof to,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,i){super.recalculate(e,i),this.paint._values["line-floorwidth"]=vs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new $c(e)}queryRadius(e){const i=e,o=nf(el("line-width",this,i),el("line-gap-width",this,i)),u=el("line-offset",this,i);return o/2+Math.abs(u)+zh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p}){const y=Vd(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-f.bearingInRadians,p),x=p/2*nf(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),T=this.paint.get("line-offset").evaluate(i,o);return T&&(u=(function(E,A){const D=[];for(let I=0;I<E.length;I++){const O=Ud(E[I]),F=[];for(let V=0;V<O.length;V++){const Z=O[V],J=O[V-1],q=O[V+1],Y=V===0?new ge(0,0):Z.sub(J)._unit()._perp(),re=V===O.length-1?new ge(0,0):q.sub(Z)._unit()._perp(),de=Y._add(re)._unit(),Ae=de.x*re.x+de.y*re.y;Ae!==0&&de._mult(1/Ae),F.push(de._mult(A)._add(Z))}D.push(F)}return D})(u,T*p)),(function(E,A,D){for(let I=0;I<A.length;I++){const O=A[I];if(E.length>=3){for(let F=0;F<O.length;F++)if(yo(E,O[F]))return!0}if(Zn(E,O,D))return!0}return!1})(y,u,x)}isTileClipped(){return!0}}function nf(n,e){return e>0?e+2*n:n}const um=nn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Zh=nn([{name:"a_projected_pos",components:3,type:"Float32"}],4);nn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const hp=nn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);nn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const br=nn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cm=nn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function wr(n,e,i){return n.sections.forEach((o=>{o.text=(function(u,f,p){const y=f.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),fr.applyArabicShaping&&(u=fr.applyArabicShaping(u)),u})(o.text,e,i)})),n}nn([{name:"triangle",components:3,type:"Uint16"}]),nn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),nn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),nn([{type:"Float32",name:"offsetX"}]),nn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),nn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var jn=24;const Yc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},tg={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Yl={40:!0};function Hh(n,e,i,o,u,f){if("fontStack"in e){const p=i[e.fontStack],y=p&&p[n];return y?y.metrics.advance*e.scale+u:0}{const p=o[e.imageName];return p?p.displaySize[0]*e.scale*jn/f+u:0}}function af(n,e,i,o){const u=Math.pow(n-e,2);return o?n<e?u/2:2*u:u+Math.abs(i)*i}function Wc(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function dp(n,e,i,o,u,f){let p=null,y=af(e,i,u,f);for(const x of o){const T=af(e-x.x,i,u,f)+x.badness;T<=y&&(p=x,y=T)}return{index:n,x:e,priorBreak:p,badness:y}}function fp(n){return n?fp(n.priorBreak).concat(n.index):[]}class tc{constructor(e="",i=[],o=[]){this.text=e,this.sections=i,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,i){const o=new tc;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?o.addImageSection(f):o.addTextSection(f,i)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let i="",o={premature:!0,value:void 0};const u=e[Symbol.iterator]();let f=u.next();const p=e[Symbol.iterator]();p.next();let y=p.next();for(;!f.done;)i+=!y.done&&fs(y.value.codePointAt(0))&&!Yc[y.value]||!o.premature&&fs(o.value.codePointAt(0))&&!Yc[o.value]||!Yc[f.value]?f.value:Yc[f.value],o={value:f.value,premature:!1},f=u.next(),y=p.next();return i})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),i=e?e[0].length:0,o=this.text.match(/\S\s*$/),u=o?o[0].length-1:0;this.text=this.text.substring(i,this.text.length-u),this.sectionIndex=this.sectionIndex.slice(i,this.sectionIndex.length-u)}substring(e,i){const o=[...this.text].slice(e,i).join(""),u=this.sectionIndex.slice(e,i);return new tc(o,this.sections,u)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}getMaxImageSize(e){let i=0,o=0;for(let u=0;u<this.length();u++){const f=this.getSection(u);if("imageName"in f){const p=e[f.imageName];if(!p)continue;const y=p.displaySize;i=Math.max(i,y[0]),o=Math.max(o,y[1])}}return{maxImageWidth:i,maxImageHeight:o}}addTextSection(e,i){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||i});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void xn("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:i}),this.sectionIndex.push(this.sections.length-1)):xn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,i,o,u,f){const p=[],y=this.determineAverageLineWidth(e,i,o,u,f),x=this.hasZeroWidthSpaces();let T=0,E=0;const A=this.text[Symbol.iterator]();let D=A.next();const I=this.text[Symbol.iterator]();I.next();let O=I.next();const F=this.text[Symbol.iterator]();F.next(),F.next();let V=F.next();for(;!D.done;){const Z=this.getSection(E),J=D.value.codePointAt(0);if(Bu(J)||(T+=Hh(J,Z,o,u,e,f)),!O.done){const q=cs(J),Y=O.value.codePointAt(0);(tg[J]||q||"imageName"in Z||!V.done&&Yl[Y])&&p.push(dp(E+1,T,y,p,Wc(J,Y,q&&x),!1))}E++,D=A.next(),O=I.next(),V=F.next()}return fp(dp(this.length(),T,y,p,0,!0))}determineAverageLineWidth(e,i,o,u,f){let p=0,y=0;for(const x of this.text){const T=this.getSection(y);p+=Hh(x.codePointAt(0),T,o,u,e,f),y++}return p/Math.max(1,Math.ceil(p/i))}}const rf=4294967296,$h=1/rf,sf=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class of{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,i,o=this.length){for(;this.pos<o;){const u=this.readVarint(),f=u>>3,p=this.pos;this.type=7&u,e(f,i,this),this.pos===p&&this.skip(u)}return i}readMessage(e,i){return this.readFields(e,i,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*rf;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*rf;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const i=this.buf;let o,u;return u=i[this.pos++],o=127&u,u<128?o:(u=i[this.pos++],o|=(127&u)<<7,u<128?o:(u=i[this.pos++],o|=(127&u)<<14,u<128?o:(u=i[this.pos++],o|=(127&u)<<21,u<128?o:(u=i[this.pos],o|=(15&u)<<28,(function(f,p,y){const x=y.buf;let T,E;if(E=x[y.pos++],T=(112&E)>>4,E<128||(E=x[y.pos++],T|=(127&E)<<3,E<128)||(E=x[y.pos++],T|=(127&E)<<10,E<128)||(E=x[y.pos++],T|=(127&E)<<17,E<128)||(E=x[y.pos++],T|=(127&E)<<24,E<128)||(E=x[y.pos++],T|=(1&E)<<31,E<128))return Kc(f,T,p);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,i=this.pos;return this.pos=e,e-i>=12&&sf?sf.decode(this.buf.subarray(i,e)):(function(o,u,f){let p="",y=u;for(;y<f;){const x=o[y];let T,E,A,D=null,I=x>239?4:x>223?3:x>191?2:1;if(y+I>f)break;I===1?x<128&&(D=x):I===2?(T=o[y+1],(192&T)==128&&(D=(31&x)<<6|63&T,D<=127&&(D=null))):I===3?(T=o[y+1],E=o[y+2],(192&T)==128&&(192&E)==128&&(D=(15&x)<<12|(63&T)<<6|63&E,(D<=2047||D>=55296&&D<=57343)&&(D=null))):I===4&&(T=o[y+1],E=o[y+2],A=o[y+3],(192&T)==128&&(192&E)==128&&(192&A)==128&&(D=(15&x)<<18|(63&T)<<12|(63&E)<<6|63&A,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,I=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=I}return p})(this.buf,i,e)}readBytes(){const e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i}readPackedVarint(e=[],i){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(i));return e}readPackedSVarint(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const i=7&e;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(e,i){this.writeVarint(e<<3|i)}realloc(e){let i=this.length||16;for(;i<this.pos+e;)i*=2;if(i!==this.length){const o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*$h),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*$h),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(i,o){let u,f;if(i>=0?(u=i%4294967296|0,f=i/4294967296|0):(u=~(-i%4294967296),f=~(-i/4294967296),4294967295^u?u=u+1|0:(u=0,f=f+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(p,y,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)})(u,0,o),(function(p,y){const x=(7&p)<<4;y.buf[y.pos++]|=x|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))})(f,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const i=this.pos;this.pos=(function(u,f,p){for(let y,x,T=0;T<f.length;T++){if(y=f.charCodeAt(T),y>55295&&y<57344){if(!x){y>56319||T+1===f.length?(u[p++]=239,u[p++]=191,u[p++]=189):x=y;continue}if(y<56320){u[p++]=239,u[p++]=191,u[p++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(u[p++]=239,u[p++]=191,u[p++]=189,x=null);y<128?u[p++]=y:(y<2048?u[p++]=y>>6|192:(y<65536?u[p++]=y>>12|224:(u[p++]=y>>18|240,u[p++]=y>>12&63|128),u[p++]=y>>6&63|128),u[p++]=63&y|128)}return p})(this.buf,e,this.pos);const o=this.pos-i;o>=128&&hm(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const i=e.length;this.writeVarint(i),this.realloc(i);for(let o=0;o<i;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,i){this.pos++;const o=this.pos;e(i,this);const u=this.pos-o;u>=128&&hm(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(e,i,o){this.writeTag(e,2),this.writeRawMessage(i,o)}writePackedVarint(e,i){i.length&&this.writeMessage(e,dm,i)}writePackedSVarint(e,i){i.length&&this.writeMessage(e,fm,i)}writePackedBoolean(e,i){i.length&&this.writeMessage(e,pm,i)}writePackedFloat(e,i){i.length&&this.writeMessage(e,Qc,i)}writePackedDouble(e,i){i.length&&this.writeMessage(e,lf,i)}writePackedFixed32(e,i){i.length&&this.writeMessage(e,mm,i)}writePackedSFixed32(e,i){i.length&&this.writeMessage(e,gm,i)}writePackedFixed64(e,i){i.length&&this.writeMessage(e,_m,i)}writePackedSFixed64(e,i){i.length&&this.writeMessage(e,ym,i)}writeBytesField(e,i){this.writeTag(e,2),this.writeBytes(i)}writeFixed32Field(e,i){this.writeTag(e,5),this.writeFixed32(i)}writeSFixed32Field(e,i){this.writeTag(e,5),this.writeSFixed32(i)}writeFixed64Field(e,i){this.writeTag(e,1),this.writeFixed64(i)}writeSFixed64Field(e,i){this.writeTag(e,1),this.writeSFixed64(i)}writeVarintField(e,i){this.writeTag(e,0),this.writeVarint(i)}writeSVarintField(e,i){this.writeTag(e,0),this.writeSVarint(i)}writeStringField(e,i){this.writeTag(e,2),this.writeString(i)}writeFloatField(e,i){this.writeTag(e,5),this.writeFloat(i)}writeDoubleField(e,i){this.writeTag(e,1),this.writeDouble(i)}writeBooleanField(e,i){this.writeVarintField(e,+i)}}function Kc(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function hm(n,e,i){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(let u=i.pos-1;u>=n;u--)i.buf[u+o]=i.buf[u]}function dm(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function fm(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function Qc(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function lf(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function pm(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function mm(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function gm(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function _m(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function ym(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}function vm(n,e,i){n===1&&i.readMessage(uf,e)}function uf(n,e,i){if(n===3){const{id:o,bitmap:u,width:f,height:p,left:y,top:x,advance:T}=i.readMessage(xm,{});e.push({id:o,bitmap:new Ph({width:f+6,height:p+6},u),metrics:{width:f,height:p,left:y,top:x,advance:T}})}}function xm(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}function pp(n){let e=0,i=0;for(const p of n)e+=p.w*p.h,i=Math.max(i,p.w);n.sort(((p,y)=>y.h-p.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,f=0;for(const p of n)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,f=Math.max(f,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===x.w&&p.h===x.h){const T=o.pop();T&&y<o.length&&(o[y]=T)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(o.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}class ji{constructor(e,{pixelRatio:i,version:o,stretchX:u,stretchY:f,content:p,textFitWidth:y,textFitHeight:x}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=f,this.content=p,this.version=o,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class cf{constructor(e,i){const o={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,o,f),this.addImages(i,u,f);const{w:p,h:y}=pp(f),x=new za({width:p||1,height:y||1});for(const T in e){const E=e[T],A=o[T].paddedRect;za.copy(E.data,x,{x:0,y:0},{x:A.x+1,y:A.y+1},E.data)}for(const T in i){const E=i[T],A=u[T].paddedRect,D=A.x+1,I=A.y+1,O=E.data.width,F=E.data.height;za.copy(E.data,x,{x:0,y:0},{x:D,y:I},E.data),za.copy(E.data,x,{x:0,y:F-1},{x:D,y:I-1},{width:O,height:1}),za.copy(E.data,x,{x:0,y:0},{x:D,y:I+F},{width:O,height:1}),za.copy(E.data,x,{x:O-1,y:0},{x:D-1,y:I},{width:1,height:F}),za.copy(E.data,x,{x:0,y:0},{x:D+O,y:I},{width:1,height:F})}this.image=x,this.iconPositions=o,this.patternPositions=u}addImages(e,i,o){for(const u in e){const f=e[u],p={x:0,y:0,w:f.data.width+2,h:f.data.height+2};o.push(p),i[u]=new ji(p,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,f]=e.tl;o.update(i.data,void 0,{x:u,y:f})}}var Wl;function Xh(n,e,i,o,u,f,p,y,x,T,E,A,D,I,O){const F=tc.fromFeature(n,u);let V;A===P.az.vertical&&F.verticalizePunctuation();let Z=F.determineLineBreaks(T,f,e,o,I);const{processBidirectionalText:J,processStyledBidirectionalText:q}=fr;if(J&&F.sections.length===1){V=[],Z=Z.map((Ae=>F.toCodeUnitIndex(Ae)));const de=J(F.toString(),Z);for(const Ae of de){const Ne=[...Ae].map((()=>0));V.push(new tc(Ae,F.sections,Ne))}}else if(q){V=[],Z=Z.map((Ve=>F.toCodeUnitIndex(Ve)));let de=0;const Ae=[];for(const Ve of F.text)Ae.push(...Array(Ve.length).fill(F.sectionIndex[de])),de++;const Ne=q(F.text,Ae,Z);for(const Ve of Ne){const Xe=[];let at="";for(const Qe of Ve[0])Xe.push(Ve[1][at.length]),at+=Qe;V.push(new tc(Ve[0],F.sections,Xe))}}else V=(function(de,Ae){const Ne=[];let Ve=0;for(const Xe of Ae)Ne.push(de.substring(Ve,Xe)),Ve=Xe;return Ve<de.length()&&Ne.push(de.substring(Ve,de.length())),Ne})(F,Z);const Y=[],re={positionedLines:Y,text:F.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:A,iconsInText:!1,verticalizable:!1};return(function(de,Ae,Ne,Ve,Xe,at,Qe,Ue,Oe,ft,gt,St){let vt=0,Jt=0,vn=0,Wn=0;const Ra=Ue==="right"?1:Ue==="left"?0:.5,Eo=jn/St;let Tr=0;for(const Rn of Xe){Rn.trim();const xa=Rn.getMaxScale(),tr={positionedGlyphs:[],lineOffset:0};de.positionedLines[Tr]=tr;const ir=tr.positionedGlyphs;let Ur=0;if(!Rn.length()){Jt+=at,++Tr;continue}const ka=ig(Ve,Rn,Eo);let Gr=0;for(const la of Rn.text){const Mn=Rn.getSection(Gr),Kn=la.codePointAt(0),Dn=hf(Oe,gt,Kn),ua={glyph:Kn,imageName:null,x:vt,y:Jt+-17,vertical:Dn,scale:1,fontStack:"",sectionIndex:Rn.getSectionIndex(Gr),metrics:null,rect:null};let oc;if("fontStack"in Mn){if(oc=Jc(Mn,Kn,Dn,ka,Ae,Ne),!oc)continue;ua.fontStack=Mn.fontStack}else{if(de.iconsInText=!0,Mn.scale*=Eo,oc=gp(Mn,Dn,xa,ka,Ve),!oc)continue;Ur=Math.max(Ur,oc.imageOffset),ua.imageName=Mn.imageName}const{rect:gl,metrics:qp,baselineOffset:oh}=oc;ua.y+=oh,ua.scale=Mn.scale,ua.metrics=qp,ua.rect=gl,ir.push(ua),Dn?(de.verticalizable=!0,vt+=("imageName"in Mn?qp.advance:jn)*Mn.scale+ft):vt+=qp.advance*Mn.scale+ft,Gr++}ir.length!==0&&(vn=Math.max(vt-ft,vn),df(ir,0,ir.length-1,Ra)),vt=0,tr.lineOffset=Math.max(Ur,(xa-1)*jn);const Ao=at*xa+Ur;Jt+=Ao,Wn=Math.max(Ao,Wn),++Tr}const{horizontalAlign:va,verticalAlign:La}=mp(Qe);(function(Rn,xa,tr,ir,Ur,ka,Gr,Ao,la){const Mn=(xa-tr)*Ur;let Kn=0;Kn=ka!==Gr?-Ao*ir- -17:-ir*la*Gr+.5*Gr;for(const Dn of Rn)for(const ua of Dn.positionedGlyphs)ua.x+=Mn,ua.y+=Kn})(de.positionedLines,Ra,va,La,vn,Wn,at,Jt,Xe.length),de.top+=-La*Jt,de.bottom=de.top+Jt,de.left+=-va*vn,de.right=de.left+vn})(re,e,i,o,V,p,y,x,A,T,D,O),!(function(de){for(const Ae of de)if(Ae.positionedGlyphs.length!==0)return!1;return!0})(Y)&&re}function mp(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function ig(n,e,i){const o=e.getMaxScale()*jn,{maxImageWidth:u,maxImageHeight:f}=e.getMaxImageSize(n),p=Math.max(o,f*i);return{verticalLineContentWidth:Math.max(o,u*i),horizontalLineContentHeight:p}}function bm(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function hf(n,e,i){return!(n===P.az.horizontal||!e&&!Ho(i)||e&&(Bu(i)||(o=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Jc(n,e,i,o,u,f){const p=f[n.fontStack],y=(function(T,E,A,D){if(T&&T.rect)return T;const I=E[A.fontStack],O=I&&I[D];return O?{rect:null,metrics:O.metrics}:null})(p&&p[e],u,n,e);if(y===null)return null;let x;if(i)x=o.verticalLineContentWidth-n.scale*jn;else{const T=bm(n.verticalAlign);x=(o.horizontalLineContentHeight-n.scale*jn)*T}return{rect:y.rect,metrics:y.metrics,baselineOffset:x}}function gp(n,e,i,o,u){const f=u[n.imageName];if(!f)return null;const p=f.paddedRect,y=f.displaySize,x={width:y[0],height:y[1],left:1,top:-3,advance:e?y[1]:y[0]};let T;if(e)T=o.verticalLineContentWidth-y[1]*n.scale;else{const E=bm(n.verticalAlign);T=(o.horizontalLineContentHeight-y[1]*n.scale)*E}return{rect:p,metrics:x,baselineOffset:T,imageOffset:(e?y[0]:y[1])*n.scale-jn*i}}function df(n,e,i,o){if(o===0)return;const u=n[i],f=(n[i].x+u.metrics.advance*u.scale)*o;for(let p=e;p<=i;p++)n[p].x-=f}function _p(n,e,i){const{horizontalAlign:o,verticalAlign:u}=mp(i),f=e[0]-n.displaySize[0]*o,p=e[1]-n.displaySize[1]*u;return{image:n,top:p,bottom:p+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function ul(n){var e,i;let o=n.left,u=n.top,f=n.right-o,p=n.bottom-u;const y=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",x=(i=n.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",T=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&f/p<T||y==="proportional"){const E=Math.ceil(p*T);o*=E/f,f=E}}else if(y==="proportional"&&x==="stretchOnly"&&T!==0&&f/p>T){const E=Math.ceil(f/T);u*=E/p,p=E}return{x1:o,y1:u,x2:o+f,y2:u+p}}function Gs(n,e,i,o,u,f){const p=n.image;let y;if(p.content){const V=p.content,Z=p.pixelRatio||1;y=[V[0]/Z,V[1]/Z,p.displaySize[0]-V[2]/Z,p.displaySize[1]-V[3]/Z]}const x=e.left*f,T=e.right*f;let E,A,D,I;i==="width"||i==="both"?(I=u[0]+x-o[3],A=u[0]+T+o[1]):(I=u[0]+(x+T-p.displaySize[0])/2,A=I+p.displaySize[0]);const O=e.top*f,F=e.bottom*f;return i==="height"||i==="both"?(E=u[1]+O-o[0],D=u[1]+F+o[2]):(E=u[1]+(O+F-p.displaySize[1])/2,D=E+p.displaySize[1]),{image:p,top:E,right:A,bottom:D,left:I,collisionPadding:y}}ut("ImagePosition",ji),ut("ImageAtlas",cf),P.az=void 0,(Wl=P.az||(P.az={}))[Wl.none=0]="none",Wl[Wl.horizontal=1]="horizontal",Wl[Wl.vertical=2]="vertical",Wl[Wl.horizontalOnly=3]="horizontalOnly";const Nr=128,Kl=32640;function yp(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Ai(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=i;let f=0;for(;f<o.length&&o[f]<=n;)f++;f=Math.max(0,f-1);let p=f;for(;p<o.length&&o[p]<n+1;)p++;p=Math.min(o.length-1,p);const y=o[f],x=o[p];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new Ai(y)),maxSize:i.evaluate(new Ai(x)),interpolationType:u}}}function ff(n,e,i){let o="never";const u=n.get(e);return u?o=u:n.get(i)&&(o="always"),o}const wm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Yh(n,e,i,o,u,f,p,y,x,T,E,A,D){const I=y?Math.min(Kl,Math.round(y[0])):0,O=y?Math.min(Kl,Math.round(y[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*u),f,p,(I<<1)+(x?1:0),O,16*T,16*E,256*A,256*D)}function vp(n,e,i){n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i)}function xp(n){for(const e of n.sections)if(Ls(e.text))return!0;return!1}class pf{constructor(e){this.layoutVertexArray=new ne,this.indexArray=new De,this.programConfigurations=e,this.segments=new rt,this.dynamicLayoutVertexArray=new _e,this.opacityVertexArray=new Ie,this.hasVisibleVertices=!1,this.placedSymbolArray=new v}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,um.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Zh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,wm,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ut("SymbolBuffers",pf);class mf{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new rt,this.collisionVertexArray=new ze}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,hp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ut("CollisionBuffers",mf);class eh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((p=>p.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yp(this.zoom,i["text-size"]),this.iconSizeData=yp(this.zoom,i["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.canOverlap=ff(o,"text-overlap","text-allow-overlap")!=="never"||ff(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((p=>P.az[p]))),this.stateDependentLayerIds=this.layers.filter((p=>p.isStateDependent())).map((p=>p.id)),this.sourceID=e.sourceID}createArrays(){this.text=new pf(new go(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new pf(new go(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new C,this.lineVertexArray=new z,this.symbolInstances=new S,this.textAnchorOffsets=new R}calculateGlyphDependencies(e,i,o,u,f){for(const p of e)if(i[p.codePointAt(0)]=!0,(o||u)&&f){const y=Yc[p];y&&(i[y.codePointAt(0)]=!0)}}populate(e,i,o){const u=this.layers[0],f=u.layout,p=f.get("text-font"),y=f.get("text-field"),x=f.get("icon-image"),T=(y.value.kind!=="constant"||y.value.value instanceof kn&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,A=f.get("symbol-sort-key");if(this.features=[],!T&&!E)return;const D=i.iconDependencies,I=i.glyphDependencies,O=i.availableImages,F=new Ai(this.zoom);for(const{feature:V,id:Z,index:J,sourceLayerIndex:q}of e){const Y=u._featureFilter.needGeometry,re=Fr(V,Y);if(!u._featureFilter.filter(F,re,o))continue;let de,Ae;if(Y||(re.geometry=Ns(V)),T){const Ve=u.getValueAndResolveTokens("text-field",re,o,O),Xe=kn.factory(Ve),at=this.hasRTLText=this.hasRTLText||xp(Xe);(!at||fr.getRTLTextPluginStatus()==="unavailable"||at&&fr.isParsed())&&(de=wr(Xe,u,re))}if(E){const Ve=u.getValueAndResolveTokens("icon-image",re,o,O);Ae=Ve instanceof da?Ve:da.fromString(Ve)}if(!de&&!Ae)continue;const Ne=this.sortFeaturesByKey?A.evaluate(re,{},o):void 0;if(this.features.push({id:Z,text:de,icon:Ae,index:J,sourceLayerIndex:q,geometry:re.geometry,properties:V.properties,type:Hc.types[V.type],sortKey:Ne}),Ae&&(D[Ae.name]=!0),de){const Ve=p.evaluate(re,{},o).join(","),Xe=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(P.az.vertical)>=0;for(const at of de.sections)if(at.image)D[at.image.name]=!0;else{const Qe=hs(de.toString()),Ue=at.fontStack||Ve,Oe=I[Ue]=I[Ue]||{};this.calculateGlyphDependencies(at.text,Oe,Xe,this.allowVerticalPlacement,Qe)}}}f.get("symbol-placement")==="line"&&(this.features=(function(V){const Z={},J={},q=[];let Y=0;function re(Ve){q.push(V[Ve]),Y++}function de(Ve,Xe,at){const Qe=J[Ve];return delete J[Ve],J[Xe]=Qe,q[Qe].geometry[0].pop(),q[Qe].geometry[0]=q[Qe].geometry[0].concat(at[0]),Qe}function Ae(Ve,Xe,at){const Qe=Z[Xe];return delete Z[Xe],Z[Ve]=Qe,q[Qe].geometry[0].shift(),q[Qe].geometry[0]=at[0].concat(q[Qe].geometry[0]),Qe}function Ne(Ve,Xe,at){const Qe=at?Xe[0][Xe[0].length-1]:Xe[0][0];return`${Ve}:${Qe.x}:${Qe.y}`}for(let Ve=0;Ve<V.length;Ve++){const Xe=V[Ve],at=Xe.geometry,Qe=Xe.text?Xe.text.toString():null;if(!Qe){re(Ve);continue}const Ue=Ne(Qe,at),Oe=Ne(Qe,at,!0);if(Ue in J&&Oe in Z&&J[Ue]!==Z[Oe]){const ft=Ae(Ue,Oe,at),gt=de(Ue,Oe,q[ft].geometry);delete Z[Ue],delete J[Oe],J[Ne(Qe,q[gt].geometry,!0)]=gt,q[ft].geometry=null}else Ue in J?de(Ue,Oe,at):Oe in Z?Ae(Ue,Oe,at):(re(Ve),Z[Ue]=Y-1,J[Oe]=Y-1)}return q.filter((Ve=>Ve.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((V,Z)=>V.sortKey-Z.sortKey))}update(e,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(i[e.segment+1]),f=e.dist(i[e.segment]);const p={};for(let y=e.segment+1;y<i.length;y++)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:u},y<i.length-1&&(u+=i[y+1].dist(i[y]));for(let y=e.segment||0;y>=0;y--)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:f},y>0&&(f+=i[y-1].dist(i[y]));for(let y=0;y<i.length;y++){const x=p[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,u,f,p,y,x,T,E,A,D){const I=e.indexArray,O=e.layoutVertexArray,F=e.segments.prepareSegment(4*i.length,O,I,this.canOverlap?p.sortKey:void 0),V=this.glyphOffsetArray.length,Z=F.vertexLength,J=this.allowVerticalPlacement&&y===P.az.vertical?Math.PI/2:0,q=p.text&&p.text.sections;for(let Y=0;Y<i.length;Y++){const{tl:re,tr:de,bl:Ae,br:Ne,tex:Ve,pixelOffsetTL:Xe,pixelOffsetBR:at,minFontScaleX:Qe,minFontScaleY:Ue,glyphOffset:Oe,isSDF:ft,sectionIndex:gt}=i[Y],St=F.vertexLength,vt=Oe[1];Yh(O,x.x,x.y,re.x,vt+re.y,Ve.x,Ve.y,o,ft,Xe.x,Xe.y,Qe,Ue),Yh(O,x.x,x.y,de.x,vt+de.y,Ve.x+Ve.w,Ve.y,o,ft,at.x,Xe.y,Qe,Ue),Yh(O,x.x,x.y,Ae.x,vt+Ae.y,Ve.x,Ve.y+Ve.h,o,ft,Xe.x,at.y,Qe,Ue),Yh(O,x.x,x.y,Ne.x,vt+Ne.y,Ve.x+Ve.w,Ve.y+Ve.h,o,ft,at.x,at.y,Qe,Ue),vp(e.dynamicLayoutVertexArray,x,J),I.emplaceBack(St,St+2,St+1),I.emplaceBack(St+1,St+2,St+3),F.vertexLength+=4,F.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Oe[0]),Y!==i.length-1&&gt===i[Y+1].sectionIndex||e.programConfigurations.populatePaintArrays(O.length,p,p.index,{imagePositions:{},canonical:D,formattedSection:q&&q[gt]})}e.placedSymbolArray.emplaceBack(x.x,x.y,V,this.glyphOffsetArray.length-V,Z,T,E,x.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],y,0,!1,0,A)}_addCollisionDebugVertex(e,i,o,u,f,p){return i.emplaceBack(0,0),e.emplaceBack(o.x,o.y,u,f,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,i,o,u,f,p,y){const x=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),T=x.vertexLength,E=f.layoutVertexArray,A=f.collisionVertexArray,D=y.anchorX,I=y.anchorY;this._addCollisionDebugVertex(E,A,p,D,I,new ge(e,i)),this._addCollisionDebugVertex(E,A,p,D,I,new ge(o,i)),this._addCollisionDebugVertex(E,A,p,D,I,new ge(o,u)),this._addCollisionDebugVertex(E,A,p,D,I,new ge(e,u)),x.vertexLength+=4;const O=f.indexArray;O.emplaceBack(T,T+1),O.emplaceBack(T+1,T+2),O.emplaceBack(T+2,T+3),O.emplaceBack(T+3,T),x.primitiveLength+=4}addDebugCollisionBoxes(e,i,o,u){for(let f=e;f<i;f++){const p=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,u?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new mf(Ee,br.members,et),this.iconCollisionBox=new mf(Ee,br.members,et);for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(e,i,o,u,f,p,y,x,T){const E={};for(let A=i;A<o;A++){const D=e.get(A);E.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.textFeatureIndex=D.featureIndex;break}for(let A=u;A<f;A++){const D=e.get(A);E.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalTextFeatureIndex=D.featureIndex;break}for(let A=p;A<y;A++){const D=e.get(A);E.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.iconFeatureIndex=D.featureIndex;break}for(let A=x;A<T;A++){const D=e.get(A);E.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalIconFeatureIndex=D.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),u=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+2,f+1),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),u=[],f=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const x=this.symbolInstances.get(y);u.push(0|Math.round(i*x.anchorX+o*x.anchorY)),f.push(x.featureIndex)}return p.sort(((y,x)=>u[y]-u[x]||f[x]-f[y])),p}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((u,f,p)=>{u>=0&&p.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let gf,_f;ut("SymbolBucket",eh,{omit:["layers","collisionBoxArray","features","compareText"]}),eh.MAX_GLYPHS=65535,eh.addDynamicAttributes=vp;var bp={get paint(){return _f=_f||new Tn({"icon-opacity":new yt(le.paint_symbol["icon-opacity"]),"icon-color":new yt(le.paint_symbol["icon-color"]),"icon-halo-color":new yt(le.paint_symbol["icon-halo-color"]),"icon-halo-width":new yt(le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yt(le.paint_symbol["icon-halo-blur"]),"icon-translate":new ct(le.paint_symbol["icon-translate"]),"icon-translate-anchor":new ct(le.paint_symbol["icon-translate-anchor"]),"text-opacity":new yt(le.paint_symbol["text-opacity"]),"text-color":new yt(le.paint_symbol["text-color"],{runtimeType:Ba,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new yt(le.paint_symbol["text-halo-color"]),"text-halo-width":new yt(le.paint_symbol["text-halo-width"]),"text-halo-blur":new yt(le.paint_symbol["text-halo-blur"]),"text-translate":new ct(le.paint_symbol["text-translate"]),"text-translate-anchor":new ct(le.paint_symbol["text-translate-anchor"])})},get layout(){return gf=gf||new Tn({"symbol-placement":new ct(le.layout_symbol["symbol-placement"]),"symbol-spacing":new ct(le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ct(le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yt(le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ct(le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ct(le.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ct(le.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ct(le.layout_symbol["icon-ignore-placement"]),"icon-optional":new ct(le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ct(le.layout_symbol["icon-rotation-alignment"]),"icon-size":new yt(le.layout_symbol["icon-size"]),"icon-text-fit":new ct(le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ct(le.layout_symbol["icon-text-fit-padding"]),"icon-image":new yt(le.layout_symbol["icon-image"]),"icon-rotate":new yt(le.layout_symbol["icon-rotate"]),"icon-padding":new yt(le.layout_symbol["icon-padding"]),"icon-keep-upright":new ct(le.layout_symbol["icon-keep-upright"]),"icon-offset":new yt(le.layout_symbol["icon-offset"]),"icon-anchor":new yt(le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ct(le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ct(le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ct(le.layout_symbol["text-rotation-alignment"]),"text-field":new yt(le.layout_symbol["text-field"]),"text-font":new yt(le.layout_symbol["text-font"]),"text-size":new yt(le.layout_symbol["text-size"]),"text-max-width":new yt(le.layout_symbol["text-max-width"]),"text-line-height":new ct(le.layout_symbol["text-line-height"]),"text-letter-spacing":new yt(le.layout_symbol["text-letter-spacing"]),"text-justify":new yt(le.layout_symbol["text-justify"]),"text-radial-offset":new yt(le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ct(le.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new yt(le.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new yt(le.layout_symbol["text-anchor"]),"text-max-angle":new ct(le.layout_symbol["text-max-angle"]),"text-writing-mode":new ct(le.layout_symbol["text-writing-mode"]),"text-rotate":new yt(le.layout_symbol["text-rotate"]),"text-padding":new ct(le.layout_symbol["text-padding"]),"text-keep-upright":new ct(le.layout_symbol["text-keep-upright"]),"text-transform":new yt(le.layout_symbol["text-transform"]),"text-offset":new yt(le.layout_symbol["text-offset"]),"text-allow-overlap":new ct(le.layout_symbol["text-allow-overlap"]),"text-overlap":new ct(le.layout_symbol["text-overlap"]),"text-ignore-placement":new ct(le.layout_symbol["text-ignore-placement"]),"text-optional":new ct(le.layout_symbol["text-optional"])})}};class Tm{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Ei,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ut("FormatSectionOverride",Tm,{omit:["defaultValue"]});class Ql extends ln{constructor(e,i){super(e,bp,i)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const f of o)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,u){const f=this.layout.get(e).evaluate(i,{},o,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||lo(p.value)||!f?f:(function(y,x){return x.replace(/{([^{}]+)}/g,((T,E)=>y&&E in y?String(y[E]):""))})(i.properties,f)}createBucket(e){return new eh(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of bp.paint.overridableProperties){if(!Ql.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new Tm(i),u=new Cc(o,i.property.specification);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new _a("source",u):new uo("composite",u,i.value.zoomStops),this.paint._values[e]=new $a(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Ql.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),u=bp.paint.properties[i];let f=!1;const p=y=>{for(const x of y)if(u.overrides&&u.overrides.hasOverride(x))return void(f=!0)};if(o.value.kind==="constant"&&o.value.value instanceof kn)p(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const y=T=>{f||(T instanceof ja&&en(T.value)===Xr?p(T.value.sections):T instanceof vu?p(T.sections):T.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return f}}let Sm;var Mm={get paint(){return Sm=Sm||new Tn({"background-color":new ct(le.paint_background["background-color"]),"background-pattern":new Ul(le.paint_background["background-pattern"]),"background-opacity":new ct(le.paint_background["background-opacity"])})}};class mi extends ln{constructor(e,i){super(e,Mm,i)}}class wp extends ln{constructor(e,i){super(e,{},i),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class yf{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Tp={once:!0},vf=63710088e-1;class wo{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new wo(Zt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,u=e.lat*i,f=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return vf*Math.acos(Math.min(f,1))}static convert(e){if(e instanceof wo)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new wo(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new wo(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const th=2*Math.PI*vf;function Wh(n){return th*Math.cos(n*Math.PI/180)}function Em(n){return(180+n)/360}function Sp(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Am(n,e){return n/Wh(e)}function Cm(n){return 360*n-180}function Kh(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Mp(n,e){return n*Wh(Kh(e))}class Pi{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=wo.convert(e);return new Pi(Em(o.lng),Sp(o.lat),Am(i,o.lat))}toLngLat(){return new wo(Cm(this.x),Kh(this.y))}toAltitude(){return Mp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/th*(e=Kh(this.y),1/Math.cos(e*Math.PI/180));var e}}function xf(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class ia{constructor(e,i,o){if(!(function(u,f,p){return!(u<0||u>25||p<0||p>=Math.pow(2,u)||f<0||f>=Math.pow(2,u))})(e,i,o))throw new Error(`x=${i}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=i,this.y=o,this.key=ih(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i,o){const u=(p=this.y,y=this.z,x=xf(256*(f=this.x),256*(p=Math.pow(2,y)-p-1),y),T=xf(256*(f+1),256*(p+1),y),x[0]+","+x[1]+","+T[0]+","+T[1]);var f,p,y,x,T;const E=(function(A,D,I){let O,F="";for(let V=A;V>0;V--)O=1<<V-1,F+=(D&O?1:0)+(I&O?2:0);return F})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const i=this.z-e.z;return i>0&&e.x===this.x>>i&&e.y===this.y>>i}getTilePoint(e){const i=Math.pow(2,this.z);return new ge((e.x*i-this.x)*_t,(e.y*i-this.y)*_t)}toString(){return`${this.z}/${this.x}/${this.y}`}}class zm{constructor(e,i){this.wrap=e,this.canonical=i,this.key=ih(e,i.z,i.z,i.x,i.y)}}class Qa{constructor(e,i,o,u,f){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=i,this.canonical=new ia(o,+u,+f),this.key=ih(i,e,o,u,f)}clone(){return new Qa(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?new Qa(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qa(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,i){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?ih(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y):ih(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const i=this.canonical.z-e.canonical.z;return!(i<0)&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Qa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new Qa(i,this.wrap,i,o,u),new Qa(i,this.wrap,i,o+1,u),new Qa(i,this.wrap,i,o,u+1),new Qa(i,this.wrap,i,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Qa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Qa(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new zm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Pi(e.x-this.wrap,e.y))}normalizeCoordinates(e,i,o=8192){if(e>=0&&e<o&&i>=0&&i<o)return{tileID:this,x:e,y:i};const u=Math.floor(e/o),f=Math.floor(i/o),p=e-u*o,y=i-f*o,x=this.canonical.z,T=1<<x,E=this.canonical.y+f;if(E<0||E>=T)return null;let A=this.canonical.x+u,D=this.wrap;return A<0?(D-=Math.ceil(-A/T),A=(A%T+T)%T):A>=T&&(D+=Math.floor(A/T),A%=T),{tileID:new Qa(this.overscaledZ,D,x,A,E),x:p,y}}}function ih(n,e,i,o,u){(n*=2)<0&&(n=-1*n-1);const f=1<<i;return(f*f*n+f*u+o).toString(36)+i.toString(36)+e.toString(36)}function Qh(n,e){return e?n.properties[e]:n.id}function Ep(n,e){const i={id:n.id};if(e.removeAllProperties&&(delete n.removeProperties,delete n.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const u=n.addOrUpdateProperties.findIndex((f=>f.key===o));u>-1&&n.addOrUpdateProperties.splice(u,1)}return(n.removeAllProperties||e.removeAllProperties)&&(i.removeAllProperties=!0),(n.removeProperties||e.removeProperties)&&(i.removeProperties=[...n.removeProperties||[],...e.removeProperties||[]]),(n.addOrUpdateProperties||e.addOrUpdateProperties)&&(i.addOrUpdateProperties=[...n.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(n.newGeometry||e.newGeometry)&&(i.newGeometry=e.newGeometry||n.newGeometry),i}function Jh(n){var e,i;if(!n)return{};const o={};return o.removeAll=n.removeAll,o.remove=new Set(n.remove||[]),o.add=new Map((e=n.add)===null||e===void 0?void 0:e.map((u=>[u.id,u]))),o.update=new Map((i=n.update)===null||i===void 0?void 0:i.map((u=>[u.id,u]))),o}ut("CanonicalTileID",ia),ut("OverscaledTileID",Qa,{omit:["terrainRttPosMatrix32f"]});class Jl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const i=new Jl;return i.extend(e(new ge(this.minX,this.minY))),i.extend(e(new ge(this.maxX,this.minY))),i.extend(e(new ge(this.minX,this.maxY))),i.extend(e(new ge(this.maxX,this.maxY))),i}static fromPoints(e){const i=new Jl;for(const o of e)i.extend(o);return i}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Ap{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class bf{constructor(e,i,o,u,f){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=u,this._z=i,this.properties=e.properties,this.id=f}projectPoint(e,i,o,u){return[360*(e.x+i)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/u)*Math.PI))-90]}projectLine(e,i,o,u){return e.map((f=>this.projectPoint(f,i,o,u)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,i=e.extent*Math.pow(2,this._z),o=e.extent*this._x,u=e.extent*this._y,f=e.loadGeometry();switch(e.type){case 1:{const p=[];for(const x of f)p.push(x[0]);const y=this.projectLine(p,o,u,i);this._geometry=p.length===1?{type:"Point",coordinates:y[0]}:{type:"MultiPoint",coordinates:y};break}case 2:{const p=f.map((y=>this.projectLine(y,o,u,i)));this._geometry=p.length===1?{type:"LineString",coordinates:p[0]}:{type:"MultiLineString",coordinates:p};break}case 3:{const p=om(f),y=[];for(const x of p)y.push(x.map((T=>this.projectLine(T,o,u,i))));this._geometry=y.length===1?{type:"Polygon",coordinates:y[0]}:{type:"MultiPolygon",coordinates:y};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&i!=="_x"&&i!=="_y"&&i!=="_z"&&(e[i]=this[i]);return e}}class eu{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,i,o){this._name=e,this.dataBuffer=i,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class wf extends eu{}class Tf extends wf{getValueFromBuffer(e){return this.dataBuffer[e]}}class Cp extends wf{getValueFromBuffer(e){return this.dataBuffer[e]}}class zp extends eu{delta;constructor(e,i,o,u){super(e,i,u),this.delta=o}}class Dp extends zp{constructor(e,i,o,u){super(e,Int32Array.of(i),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Ip extends eu{constructor(e,i,o){super(e,Int32Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class tu{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,i,o,u,f=4096){this._name=e,this._geometryVector=i,this._idVector=o,this._propertyVectors=u,this._extent=f}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((i=>[i.name,i])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let i=0;for(;i<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(i)):this.idVector.getValue(i));const u=e?.next().value,f={};for(const p of this.propertyVectors){if(!p)continue;const y=p.name,x=p.getValue(i);x!==null&&(f[y]=x)}i++,yield{id:o,geometry:u,properties:f}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],i=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const f={coordinates:i[o],type:this.geometryVector.geometryType(o)},p={};for(const y of this.propertyVectors){if(!y)continue;const x=y.name,T=y.getValue(o);T!==null&&(p[x]=T)}e.push({id:u,geometry:f,properties:p})}return e}containsMaxSaveIntegerValues(e){return e instanceof Tf||e instanceof Ip&&e instanceof Dp||e instanceof Cp}}class Dm{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var zi,To,sa,qs,iu,Da,cn,Yn,Vr,Ja;function oa(n,e,i){const o=new Int32Array(i);let u=0,f=e.get();for(let p=0;p<o.length;p++){let y=n[f++],x=127&y;y<128||(y=n[f++],x|=(127&y)<<7,y<128||(y=n[f++],x|=(127&y)<<14,y<128||(y=n[f++],x|=(127&y)<<21,y<128||(y=n[f++],x|=(15&y)<<28)))),o[u++]=x}return e.set(f),o}function Sf(n,e,i){const o=new BigInt64Array(i);for(let u=0;u<o.length;u++)o[u]=Im(n,e);return o}function Im(n,e){let i=0n,o=0,u=e.get();for(;u<n.length;){const f=n[u++];if(i|=BigInt(127&f)<<BigInt(o),!(128&f))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(u),i}function ed(n,e){let i,o;return o=n[e.get()],e.increment(),i=127&o,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<7,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<14,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<21,o<128?i:(o=n[e.get()],i|=(15&o)<<28,(function(u,f,p){let y,x;if(x=f[p.get()],p.increment(),y=(112&x)>>4,x<128||(x=f[p.get()],p.increment(),y|=(127&x)<<3,x<128)||(x=f[p.get()],p.increment(),y|=(127&x)<<10,x<128)||(x=f[p.get()],p.increment(),y|=(127&x)<<17,x<128)||(x=f[p.get()],p.increment(),y|=(127&x)<<24,x<128)||(x=f[p.get()],p.increment(),y|=(1&x)<<31,x<128))return 4294967296*y+(u>>>0);throw new Error("Expected varint not more than 10 bytes")})(i,n,e)))))}function bi(n){return n>>>1^-(1&n)}function er(n){return n>>1n^-(1n&n)}function cl(n){return n%2==1?(n+1)/-2:n/2}function So(n,e,i){if(i===void 0){i=0;for(let f=0;f<e;f++)i+=n[f]}const o=new Int32Array(i);let u=0;for(let f=0;f<e;f++){const p=n[f];o.fill(n[f+e],u,u+p),u+=p}return o}function Pm(n,e,i){if(i===void 0){i=0;for(let f=0;f<e;f++)i+=Number(n[f])}const o=new BigInt64Array(i);let u=0;for(let f=0;f<e;f++){const p=Number(n[f]);o.fill(n[f+e],u,u+p),u+=p}return o}function Rm(n,e,i){const o=new Float64Array(i);let u=0;for(let f=0;f<e;f++){const p=n[f];o.fill(n[f+e],u,u+p),u+=p}return o}function ic(n){const e=n.length/4*4;let i=1;if(e>=4)for(let o=n[0];i<e-4;i+=4)o=n[i]+=o,o=n[i+1]+=o,o=n[i+2]+=o,o=n[i+3]+=o;for(;i!=n.length;)n[i]+=n[i-1],++i}(function(n){n.NONE="NONE",n.DELTA="DELTA",n.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",n.RLE="RLE",n.MORTON="MORTON",n.PDE="PDE"})(zi||(zi={})),(function(n){n.NONE="NONE",n.FAST_PFOR="FAST_PFOR",n.VARINT="VARINT",n.ALP="ALP"})(To||(To={})),(function(n){n.PRESENT="PRESENT",n.DATA="DATA",n.OFFSET="OFFSET",n.LENGTH="LENGTH"})(sa||(sa={}));class Mf{_dictionaryType;_offsetType;_lengthType;constructor(e,i,o){this._dictionaryType=e,this._offsetType=i,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Ia(n,e){const i=(function(o,u){const f=o[u.get()],p=Object.values(sa)[f>>4];let y=null;switch(p){case sa.DATA:y=new Mf(Object.values(qs)[15&f]);break;case sa.OFFSET:y=new Mf(null,Object.values(iu)[15&f]);break;case sa.LENGTH:y=new Mf(null,null,Object.values(Da)[15&f])}u.increment();const x=o[u.get()],T=Object.values(zi)[x>>5],E=Object.values(zi)[x>>2&7],A=Object.values(To)[3&x];u.increment();const D=oa(o,u,2),I=D[0];return{physicalStreamType:p,logicalStreamType:y,logicalLevelTechnique1:T,logicalLevelTechnique2:E,physicalLevelTechnique:A,numValues:I,byteLength:D[1],decompressedCount:I}})(n,e);return i.logicalLevelTechnique1===zi.MORTON?(function(o,u,f){const p=oa(u,f,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:p[0],coordinateShift:p[1]}})(i,n,e):zi.RLE!==i.logicalLevelTechnique1&&zi.RLE!==i.logicalLevelTechnique2||To.NONE===i.physicalLevelTechnique?i:(function(o,u,f){const p=oa(u,f,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:p[1],runs:p[0],numRleValues:p[1]}})(i,n,e)}(function(n){n.NONE="NONE",n.SINGLE="SINGLE",n.SHARED="SHARED",n.VERTEX="VERTEX",n.MORTON="MORTON",n.FSST="FSST"})(qs||(qs={})),(function(n){n.VERTEX="VERTEX",n.INDEX="INDEX",n.STRING="STRING",n.KEY="KEY"})(iu||(iu={})),(function(n){n.VAR_BINARY="VAR_BINARY",n.GEOMETRIES="GEOMETRIES",n.PARTS="PARTS",n.RINGS="RINGS",n.TRIANGLES="TRIANGLES",n.SYMBOL="SYMBOL",n.DICTIONARY="DICTIONARY"})(Da||(Da={})),(function(n){n[n.FLAT=0]="FLAT",n[n.CONST=1]="CONST",n[n.SEQUENCE=2]="SEQUENCE",n[n.DICTIONARY=3]="DICTIONARY",n[n.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(cn||(cn={}));class Zs{values;_size;constructor(e,i){this.values=e,this._size=i}get(e){const i=Math.floor(e/8);return(this.values[i]>>e%8&1)==1}set(e,i){const o=Math.floor(e/8);this.values[o]=this.values[o]|(i?1:0)<<e%8}getInt(e){const i=Math.floor(e/8);return this.values[i]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Ef(n,e,i){if(!e)return n;const o=e.size(),u=new n.constructor(o);let f=0;for(let p=0;p<o;p++)u[p]=e.get(p)?n[f++]:i;return u}function Pa(n,e,i,o,u,f){return(function(p,y,x,T,E){switch(y.logicalLevelTechnique1){case zi.DELTA:if(y.logicalLevelTechnique2===zi.RLE){const A=y;if(!E)return(function(D,I,O){const F=new Int32Array(O);let V=0,Z=0;for(let J=0;J<I;J++){const q=D[J],Y=bi(D[J+I]);for(let re=0;re<q;re++)Z+=Y,F[V++]=Z}return F})(p,A.runs,A.numRleValues);p=So(p,A.runs,A.numRleValues)}(function(A){A[0]=bi(A[0]);const D=A.length/4*4;let I=1;if(D>=4)for(;I<D-4;I+=4){const O=A[I+1],F=A[I+2],V=A[I+3];A[I]=bi(A[I])+A[I-1],A[I+1]=bi(O)+A[I],A[I+2]=bi(F)+A[I+1],A[I+3]=bi(V)+A[I+2]}for(;I!=A.length;++I)A[I]=bi(A[I])+A[I-1]})(p);break;case zi.RLE:p=(function(A,D,I){return I?(function(O,F,V){if(V===void 0){V=0;for(let q=0;q<F;q++)V+=O[q]}const Z=new Int32Array(V);let J=0;for(let q=0;q<F;q++){const Y=O[q];let re=O[q+F];re=bi(re),Z.fill(re,J,J+Y),J+=Y}return Z})(A,D.runs,D.numRleValues):So(A,D.runs,D.numRleValues)})(p,y,x);break;case zi.MORTON:ic(p);break;case zi.COMPONENTWISE_DELTA:(function(A){if(A.length<2)return;A[0]=bi(A[0]),A[1]=bi(A[1]);const D=A.length/4*4;let I=2;if(D>=4)for(;I<D-4;I+=4){const O=A[I+1],F=A[I+2],V=A[I+3];A[I]=bi(A[I])+A[I-2],A[I+1]=bi(O)+A[I-1],A[I+2]=bi(F)+A[I],A[I+3]=bi(V)+A[I+1]}for(;I!=A.length;I+=2)A[I]=bi(A[I])+A[I-2],A[I+1]=bi(A[I+1])+A[I-1]})(p);break;case zi.NONE:x&&(function(A){for(let D=0;D<A.length;D++)A[D]=bi(A[D])})(p);break;default:throw new Error(`The specified Logical level technique is not supported: ${y.logicalLevelTechnique1}`)}return E?Ef(p,E,0):p})(Af(n,e,i),i,o,0,f)}function nu(n,e,i){return(function(o,u){if(u.logicalLevelTechnique1===zi.DELTA&&u.logicalLevelTechnique2===zi.NONE)return(function(f){const p=new Int32Array(f.length+1);p[0]=0,p[1]=bi(f[0]);let y=p[1];for(let x=2;x!=p.length;++x)y+=bi(f[x-1]),p[x]=p[x-1]+y;return new Uint32Array(p)})(o);if(u.logicalLevelTechnique1===zi.RLE&&u.logicalLevelTechnique2===zi.NONE)return(function(f,p,y){const x=new Int32Array(y+1);x[0]=0;let T=1,E=x[0];for(let A=0;A<p;A++){const D=f[A],I=f[A+p];for(let O=T;O<T+D;O++)x[O]=I+E,E=x[O];T+=D}return new Uint32Array(x)})(o,u.runs,u.numRleValues);if(u.logicalLevelTechnique1===zi.NONE&&u.logicalLevelTechnique2===zi.NONE){(function(p){let y=0;for(let x=0;x<p.length;x++)p[x]+=y,y=p[x]})(o);const f=new Uint32Array(u.numValues+1);return f[0]=0,f.set(o,1),f}if(u.logicalLevelTechnique1===zi.DELTA&&u.logicalLevelTechnique2===zi.RLE){const f=(function(p,y,x){const T=new Int32Array(x+1);T[0]=0;let E=1,A=T[0];for(let D=0;D<y;D++){const I=p[D];let O=p[D+y];O=bi(O);for(let F=E;F<E+I;F++)T[F]=O+A,A=T[F];E+=I}return new Uint32Array(T)})(o,u.runs,u.numRleValues);return ic(f),f}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Af(n,e,i),i)}function Af(n,e,i){const o=i.physicalLevelTechnique;if(o===To.FAST_PFOR)return(function(){throw new Error("FastPFor is not implemented yet.")})();if(o===To.VARINT)return oa(n,e,i.numValues);if(o===To.NONE){const u=e.get();e.add(i.byteLength);const f=n.subarray(u,e.get());return new Int32Array(f)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Pp(n,e,i,o){const u=Af(n,e,i);if(u.length===1){const f=u[0];return o?bi(f):f}return o?(function(f){return bi(f[1])})(u):(function(f){return f[1]})(u)}function Rp(n,e,i){return(function(o){if(o.length==2){const u=bi(o[1]);return[u,u]}return[bi(o[2]),bi(o[3])]})(Af(n,e,i))}function nc(n,e,i){return(function(o){if(o.length==2){const u=er(o[1]);return[u,u]}return[er(o[2]),er(o[3])]})(Sf(n,e,i.numValues))}function nh(n,e,i,o,u){return(function(f,p,y,x){switch(p.logicalLevelTechnique1){case zi.DELTA:if(p.logicalLevelTechnique2===zi.RLE){const T=p;if(!x)return(function(E,A,D){const I=new BigInt64Array(D);let O=0,F=0n;for(let V=0;V<A;V++){const Z=Number(E[V]),J=er(E[V+A]);for(let q=0;q<Z;q++)F+=J,I[O++]=F}return I})(f,T.runs,T.numRleValues);f=Pm(f,T.runs,T.numRleValues)}(function(T){T[0]=er(T[0]);const E=T.length/4*4;let A=1;if(E>=4)for(;A<E-4;A+=4){const D=T[A+1],I=T[A+2],O=T[A+3];T[A]=er(T[A])+T[A-1],T[A+1]=er(D)+T[A],T[A+2]=er(I)+T[A+1],T[A+3]=er(O)+T[A+2]}for(;A!=T.length;++A)T[A]=er(T[A])+T[A-1]})(f);break;case zi.RLE:f=(function(T,E,A){return A?(function(D,I,O){if(O===void 0){O=0;for(let Z=0;Z<I;Z++)O+=Number(D[Z])}const F=new BigInt64Array(O);let V=0;for(let Z=0;Z<I;Z++){const J=Number(D[Z]);let q=D[Z+I];q=er(q),F.fill(q,V,V+J),V+=J}return F})(T,E.runs,E.numRleValues):Pm(T,E.runs,E.numRleValues)})(f,p,y);break;case zi.NONE:y&&(function(T){for(let E=0;E<T.length;E++)T[E]=er(T[E])})(f);break;default:throw new Error(`The specified Logical level technique is not supported: ${p.logicalLevelTechnique1}`)}return x?Ef(f,x,0n):f})(Sf(n,e,i.numValues),i,o,u)}function Lp(n,e,i,o){const u=Sf(n,e,i.numValues);if(u.length===1){const f=u[0];return o?er(f):f}return o?(function(f){return er(f[1])})(u):(function(f){return f[1]})(u)}function Cf(n,e,i,o){const u=n.logicalLevelTechnique1;if(u===zi.RLE)return n.runs===1?cn.CONST:cn.FLAT;if(u!==zi.DELTA||n.logicalLevelTechnique2!==zi.RLE)return n.numValues===1?cn.CONST:cn.FLAT;const f=e instanceof Zs?e.size():e;if(n.numRleValues!==f)return cn.FLAT;if(n.runs===1)return cn.SEQUENCE;if(n.runs!==2)return n.numValues===1?cn.CONST:cn.FLAT;const p=o.get();let y;if(n.physicalLevelTechnique===To.VARINT)y=oa(i,o,4);else{const x=o.get();y=new Int32Array(i.buffer,i.byteOffset+x,4)}return o.set(p),y[2]===2&&y[3]===2?cn.SEQUENCE:n.numValues===1?cn.CONST:cn.FLAT}class ac extends wf{getValueFromBuffer(e){return this.dataBuffer[e]}}class ah extends zp{constructor(e,i,o,u){super(e,BigInt64Array.of(i),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class rc{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,i,o){this._geometryOffsets=e,this._partOffsets=i,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function rh(n,e,i){return{x:zf(n,e)-i,y:zf(n>>1,e)-i}}function zf(n,e){let i=0;for(let o=0;o<e;o++)i|=(n&1<<2*o)>>o;return i}(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON",n[n.MULTIPOINT=3]="MULTIPOINT",n[n.MULTILINESTRING=4]="MULTILINESTRING",n[n.MULTIPOLYGON=5]="MULTIPOLYGON"})(Yn||(Yn={})),(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON"})(Vr||(Vr={})),(function(n){n[n.MORTON=0]="MORTON",n[n.VEC_2=1]="VEC_2",n[n.VEC_3=2]="VEC_3"})(Ja||(Ja={}));class kp{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((i=>[i]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,i){return[e].concat(i)}createMultiPolygon(e){return e.flat()}}function td(n){const e=new Array(n.numGeometries);let i=1,o=1,u=1,f=0;const p=new kp;let y=0,x=0;const T=n.mortonSettings,E=n.topologyVector,A=E.geometryOffsets,D=E.partOffsets,I=E.ringOffsets,O=n.vertexOffsets,F=n.containsPolygonGeometry(),V=n.vertexBuffer;for(let Z=0;Z<n.numGeometries;Z++){const J=n.geometryType(Z);if(J===Yn.POINT){if(O&&O.length!==0)if(n.vertexBufferType===Ja.VEC_2){const q=2*O[x++],Y=new ge(V[q],V[q+1]);e[f++]=p.createPoint(Y)}else{const q=rh(V[O[x++]],T.numBits,T.coordinateShift),Y=new ge(q.x,q.y);e[f++]=p.createPoint(Y)}else{const q=new ge(V[y++],V[y++]);e[f++]=p.createPoint(q)}A&&u++,D&&i++,I&&o++}else if(J===Yn.MULTIPOINT){const q=A[u]-A[u-1];u++;const Y=new Array(q);if(O&&O.length!==0){for(let re=0;re<q;re++){const de=2*O[x++];Y[re]=new ge(V[de],V[de+1])}e[f++]=p.createMultiPoint(Y)}else{for(let re=0;re<q;re++){const de=V[y++],Ae=V[y++];Y[re]=new ge(de,Ae)}e[f++]=p.createMultiPoint(Y)}}else if(J===Yn.LINESTRING){let q,Y=0;F?(Y=I[o]-I[o-1],o++):Y=D[i]-D[i-1],i++,O&&O.length!==0?(q=n.vertexBufferType===Ja.VEC_2?Op(V,O,x,Y,!1):ad(V,O,x,Y,!1,T),x+=Y):(q=If(V,y,Y,!1),y+=2*Y),e[f++]=p.createLineString(q),A&&u++}else if(J===Yn.POLYGON){const q=D[i]-D[i-1];i++;const Y=new Array(q-1);let re=I[o]-I[o-1];if(o++,O&&O.length!==0){const de=n.vertexBufferType===Ja.VEC_2?nd(V,O,x,re):Df(V,O,x,re,0,T);x+=re;for(let Ae=0;Ae<Y.length;Ae++)re=I[o]-I[o-1],o++,Y[Ae]=n.vertexBufferType===Ja.VEC_2?nd(V,O,x,re):Df(V,O,x,re,0,T),x+=re;e[f++]=p.createPolygon(de,Y)}else{const de=id(V,y,re);y+=2*re;for(let Ae=0;Ae<Y.length;Ae++)re=I[o]-I[o-1],o++,Y[Ae]=id(V,y,re),y+=2*re;e[f++]=p.createPolygon(de,Y)}A&&u++}else if(J===Yn.MULTILINESTRING){const q=A[u]-A[u-1];u++;const Y=new Array(q);if(O&&O.length!==0){for(let re=0;re<q;re++){let de=0;F?(de=I[o]-I[o-1],o++):de=D[i]-D[i-1],i++;const Ae=n.vertexBufferType===Ja.VEC_2?Op(V,O,x,de,!1):ad(V,O,x,de,!1,T);Y[re]=Ae,x+=de}e[f++]=p.createMultiLineString(Y)}else{for(let re=0;re<q;re++){let de=0;F?(de=I[o]-I[o-1],o++):de=D[i]-D[i-1],i++,Y[re]=If(V,y,de,!1),y+=2*de}e[f++]=p.createMultiLineString(Y)}}else{if(J!==Yn.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const q=A[u]-A[u-1];u++;const Y=new Array(q);let re=0;if(O&&O.length!==0){for(let de=0;de<q;de++){const Ae=D[i]-D[i-1];i++;const Ne=new Array(Ae-1);re=I[o]-I[o-1],o++;const Ve=n.vertexBufferType===Ja.VEC_2?nd(V,O,x,re):Df(V,O,x,re,0,T);x+=re;for(let Xe=0;Xe<Ne.length;Xe++)re=I[o]-I[o-1],o++,Ne[Xe]=n.vertexBufferType===Ja.VEC_2?nd(V,O,x,re):Df(V,O,x,re,0,T),x+=re;Y[de]=p.createPolygon(Ve,Ne)}e[f++]=p.createMultiPolygon(Y)}else{for(let de=0;de<q;de++){const Ae=D[i]-D[i-1];i++;const Ne=new Array(Ae-1);re=I[o]-I[o-1],o++;const Ve=id(V,y,re);y+=2*re;for(let Xe=0;Xe<Ne.length;Xe++){const at=I[o]-I[o-1];o++,Ne[Xe]=id(V,y,at),y+=2*at}Y[de]=p.createPolygon(Ve,Ne)}e[f++]=p.createMultiPolygon(Y)}}}}return e}function id(n,e,i){return If(n,e,i,!0)}function nd(n,e,i,o){return Op(n,e,i,o,!0)}function Df(n,e,i,o,u,f){return ad(n,e,i,o,!0,f)}function If(n,e,i,o){const u=new Array(o?i+1:i);for(let f=0;f<2*i;f+=2)u[f/2]=new ge(n[e+f],n[e+f+1]);return o&&(u[u.length-1]=u[0]),u}function Op(n,e,i,o,u){const f=new Array(u?o+1:o);for(let p=0;p<2*o;p+=2){const y=2*e[i+p/2];f[p/2]=new ge(n[y],n[y+1])}return u&&(f[f.length-1]=f[0]),f}function ad(n,e,i,o,u,f){const p=new Array(u?o+1:o);for(let y=0;y<o;y++){const x=rh(n[e[i+y]],f.numBits,f.coordinateShift);p[y]=new ge(x.x,x.y)}return u&&(p[p.length-1]=p[0]),p}class Lm{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,i,o,u,f){this._vertexBufferType=e,this._topologyVector=i,this._vertexOffsets=o,this._vertexBuffer=u,this._mortonSettings=f}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=td(this);let i=0;for(;i<this.numGeometries;)yield{coordinates:e[i],type:this.geometryType(i)},i++}getSimpleEncodedVertex(e){const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=rh(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getGeometries(){return td(this)}get mortonSettings(){return this._mortonSettings}}class rd extends Lm{_numGeometries;_geometryType;constructor(e,i,o,u,f,p,y){super(o,u,f,p,y),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Yn.POLYGON||this._geometryType===Yn.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class sd extends Lm{_geometryTypes;constructor(e,i,o,u,f,p){super(e,o,u,f,p),this._geometryTypes=i}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===Yn.POLYGON||this.geometryType(e)===Yn.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class od{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,i,o,u){this._triangleOffsets=e,this._indexBuffer=i,this._vertexBuffer=o,this._topologyVector=u}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),i=this._topologyVector,o=i.partOffsets,u=i.ringOffsets,f=i.geometryOffsets;let p=0,y=1,x=1,T=1;for(let E=0;E<this.numGeometries;E++)switch(this.geometryType(E)){case Yn.POLYGON:{const A=o[y]-o[y-1];y++;const D=[];for(let I=0;I<A;I++){const O=u[x]-u[x-1];x++;const F=[];for(let V=0;V<O;V++){const Z=this._vertexBuffer[p++],J=this._vertexBuffer[p++];F.push(new ge(Z,J))}F.length>0&&F.push(F[0]),D.push(F)}e[E]=D,f&&T++}break;case Yn.MULTIPOLYGON:{const A=f[T]-f[T-1];T++;const D=[];for(let I=0;I<A;I++){const O=o[y]-o[y-1];y++;for(let F=0;F<O;F++){const V=u[x]-u[x-1];x++;const Z=[];for(let J=0;J<V;J++){const q=this._vertexBuffer[p++],Y=this._vertexBuffer[p++];Z.push(new ge(q,Y))}Z.length>0&&Z.push(Z[0]),D.push(Z)}}e[E]=D}}return e}[Symbol.iterator](){return null}}function km(n,e,i,o,u,f){return new ld(n,e,i,o,u,f)}class ld extends od{_numGeometries;_geometryType;constructor(e,i,o,u,f,p){super(o,u,f,p),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Om(n,e,i,o,u){return new Bm(n,e,i,o,u)}class Bm extends od{_geometryTypes;constructor(e,i,o,u,f){super(i,o,u,f),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function Fm(n,e,i,o,u){const f=Ia(n,i);let p=null,y=null,x=null,T=null;if(Cf(f,o,n,i)===cn.CONST){const J=Pp(n,i,f,!1);let q=null,Y=null,re=null,de=null;for(let Ae=0;Ae<e-1;Ae++){const Ne=Ia(n,i);switch(Ne.physicalStreamType){case sa.LENGTH:switch(Ne.logicalStreamType.lengthType){case Da.GEOMETRIES:q=nu(n,i,Ne);break;case Da.PARTS:Y=nu(n,i,Ne);break;case Da.RINGS:re=nu(n,i,Ne);break;case Da.TRIANGLES:de=nu(n,i,Ne)}break;case sa.OFFSET:switch(Ne.logicalStreamType.offsetType){case iu.VERTEX:p=Pa(n,i,Ne,!1);break;case iu.INDEX:T=Pa(n,i,Ne,!1)}break;case sa.DATA:qs.VERTEX===Ne.logicalStreamType.dictionaryType?y=Pa(n,i,Ne,!0):(x={numBits:Ne.numBits,coordinateShift:Ne.coordinateShift},y=Pa(n,i,Ne,!1))}}return T!==null?q!=null||Y!=null?km(o,J,de,T,y,new rc(q,Y,re)):km(o,J,de,T,y):x===null?(function(Ae,Ne,Ve,Xe,at){return new rd(Ae,Ne,Ja.VEC_2,Ve,Xe,at)})(o,J,new rc(q,Y,re),p,y):(function(Ae,Ne,Ve,Xe,at,Qe){return new rd(Ae,Ne,Ja.MORTON,Ve,Xe,at,Qe)})(o,J,new rc(q,Y,re),p,y,x)}const E=Pa(n,i,f,!1);let A=null,D=null,I=null,O=null;for(let J=0;J<e-1;J++){const q=Ia(n,i);switch(q.physicalStreamType){case sa.LENGTH:switch(q.logicalStreamType.lengthType){case Da.GEOMETRIES:A=Pa(n,i,q,!1);break;case Da.PARTS:D=Pa(n,i,q,!1);break;case Da.RINGS:I=Pa(n,i,q,!1);break;case Da.TRIANGLES:O=nu(n,i,q)}break;case sa.OFFSET:switch(q.logicalStreamType.offsetType){case iu.VERTEX:p=Pa(n,i,q,!1);break;case iu.INDEX:T=Pa(n,i,q,!1)}break;case sa.DATA:qs.VERTEX===q.logicalStreamType.dictionaryType?y=Pa(n,i,q,!0):(x={numBits:q.numBits,coordinateShift:q.coordinateShift},y=Pa(n,i,q,!1))}}let F=null,V=null,Z=null;return A!==null?(F=Pf(E,A,2),D!==null&&I!==null?(V=Bp(E,F,D,!1),Z=(function(J,q,Y,re){const de=new Uint32Array(Y[Y.length-1]+1);let Ae=0;de[0]=Ae;let Ne=1,Ve=1,Xe=0;for(let at=0;at<J.length;at++){const Qe=J[at],Ue=q[at+1]-q[at];if(Qe!==0&&Qe!==3)for(let Oe=0;Oe<Ue;Oe++){const ft=Y[Ne]-Y[Ne-1];Ne++;for(let gt=0;gt<ft;gt++)Ae=de[Ve++]=Ae+re[Xe++]}else for(let Oe=0;Oe<Ue;Oe++)de[Ve++]=++Ae,Ne++}return de})(E,F,V,I)):D!==null&&(V=(function(J,q,Y){const re=new Uint32Array(q[q.length-1]+1);let de=0;re[0]=de;let Ae=1,Ne=0;for(let Ve=0;Ve<J.length;Ve++){const Xe=J[Ve],at=q[Ve+1]-q[Ve];if(Xe===4||Xe===1)for(let Qe=0;Qe<at;Qe++)de=re[Ae++]=de+Y[Ne++];else for(let Qe=0;Qe<at;Qe++)re[Ae++]=++de}return re})(E,F,D))):D!==null&&I!==null?(V=Pf(E,D,1),Z=Bp(E,V,I,!0)):D!==null&&(V=Pf(E,D,0)),T!==null&&V===null?Om(E,O,T,y):T!==null?Om(E,O,T,y,new rc(F,V,Z)):x===null?(function(J,q,Y,re){return new sd(Ja.VEC_2,J,q,Y,re)})(E,new rc(F,V,Z),p,y):(function(J,q,Y,re,de){return new sd(Ja.MORTON,J,q,Y,re,de)})(E,new rc(F,V,Z),p,y,x)}function Pf(n,e,i){const o=new Uint32Array(n.length+1);let u=0;o[0]=u;let f=0;for(let p=0;p<n.length;p++)u=o[p+1]=u+(n[p]>i?e[f++]:1);return o}function Bp(n,e,i,o){const u=new Uint32Array(e[e.length-1]+1);let f=0;u[0]=f;let p=1,y=0;for(let x=0;x<n.length;x++){const T=n[x],E=e[x+1]-e[x];if(T===5||T===2||o&&(T===4||T===1))for(let A=0;A<E;A++)f=u[p++]=f+i[y++];else for(let A=0;A<E;A++)u[p++]=++f}return u}class Fp extends eu{dataVector;constructor(e,i,o){super(e,i.getBuffer(),o),this.dataVector=i}getValueFromBuffer(e){return this.dataVector.get(e)}}class jm extends wf{getValueFromBuffer(e){return this.dataBuffer[e]}}class jp extends eu{constructor(e,i,o){super(e,BigInt64Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function au(n,e,i,o,u){const f=(function(p,y,x,T){const E=new Uint8Array(y);let A=0;const D=T.get()+x;for(;A<y&&!(T.get()>=D);){const I=p[T.increment()];if(I<=127){const O=I+3,F=p[T.increment()],V=Math.min(A+O,y);E.fill(F,A,V),A=V}else{const O=256-I;for(let F=0;F<O&&A<y;F++)E[A++]=p[T.increment()]}}return T.set(D),E})(n,Math.ceil(e/8),i,o);return u?(function(p,y,x){if(!x)return p;const T=x.size(),E=new Zs(p,y),A=new Zs(new Uint8Array(Math.ceil(T/8)),T);let D=0;for(let I=0;I<T;I++){const O=!!x.get(I)&&E.get(D++);A.set(I,O)}return A.getBuffer()})(f,e,u):f}const ng=new TextDecoder;function Np(n,e,i){return i-e>=12?ng.decode(n.subarray(e,i)):(function(o,u,f){let p="",y=u;for(;y<f;){const x=o[y];let T,E,A,D=null,I=x>239?4:x>223?3:x>191?2:1;if(y+I>f)break;I===1?x<128&&(D=x):I===2?(T=o[y+1],(192&T)==128&&(D=(31&x)<<6|63&T,D<=127&&(D=null))):I===3?(T=o[y+1],E=o[y+2],(192&T)==128&&(192&E)==128&&(D=(15&x)<<12|(63&T)<<6|63&E,(D<=2047||D>=55296&&D<=57343)&&(D=null))):I===4&&(T=o[y+1],E=o[y+2],A=o[y+3],(192&T)==128&&(192&E)==128&&(192&A)==128&&(D=(15&x)<<18|(63&T)<<12|(63&E)<<6|63&A,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,I=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=I}return p})(n,e,i)}class ud extends eu{offsetBuffer;constructor(e,i,o,u){super(e,o,u),this.offsetBuffer=i}}class Rf extends ud{textEncoder;constructor(e,i,o,u){super(e,i,o,u??i.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Np(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class hl extends ud{indexBuffer;textEncoder;constructor(e,i,o,u,f){super(e,o,u,f??i.length),this.indexBuffer=i,this.indexBuffer=i,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const i=this.indexBuffer[e];return Np(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class Lf extends ud{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,i,o,u,f,p,y){super(e,o,u,y),this.indexBuffer=i,this.symbolOffsetBuffer=f,this.symbolTableBuffer=p,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,u,f){const p=[],y=new Array(u.length).fill(0);for(let x=1;x<u.length;x++)y[x]=y[x-1]+u[x-1];for(let x=0;x<f.length;x++)if(f[x]===255)p.push(f[++x]);else{const T=u[f[x]],E=y[f[x]];for(let A=0;A<T;A++)p.push(o[E+A])}return new Uint8Array(p)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const i=this.indexBuffer[e];return Np(this.decodedDictionary,this.offsetBuffer[i],this.offsetBuffer[i+1])}offsetToLengthBuffer(e){const i=new Uint32Array(e.length-1);let o=e[0];for(let u=1;u<e.length;u++){const f=e[u];i[u-1]=f-o,o=f}return i}}function Nm(n,e,i,o,u,f){return i.type==="scalarType"?(function(p,y,x,T,E,A){let D=null,I=0;if(p===0)return null;if(A.nullable){const F=Ia(y,x);I=F.numValues;const V=x.get(),Z=au(y,I,F.byteLength,x);x.set(V+F.byteLength),D=new Zs(Z,F.numValues)}const O=D??T;switch(E.physicalType){case 4:case 3:return(function(F,V,Z,J,q){const Y=Ia(F,V),re=Cf(Y,q,F,V),de=J.physicalType===3;if(re===cn.FLAT){const Ae=Pa(F,V,Y,de,0,sc(q)?q:void 0);return new Tf(Z.name,Ae,q)}if(re===cn.SEQUENCE){const Ae=Rp(F,V,Y);return new Dp(Z.name,Ae[0],Ae[1],Y.numRleValues)}{const Ae=Pp(F,V,Y,de);return new Ip(Z.name,Ae,q)}})(y,x,A,E,O);case 9:return(function(F,V,Z,J,q){let Y=null,re=null,de=null,Ae=null,Ne=null,Ve=null,Xe=null,at=null;for(let Qe=0;Qe<J;Qe++){const Ue=Ia(V,Z);if(Ue.byteLength!==0)switch(Ue.physicalStreamType){case sa.PRESENT:{const Oe=au(V,Ue.numValues,Ue.byteLength,Z);Ve=new Zs(Oe,Ue.numValues);break}case sa.OFFSET:re=Pa(V,Z,Ue,!1,0,q!=null||Ve!=null?q??Ve:void 0);break;case sa.LENGTH:{const Oe=nu(V,Z,Ue);Da.DICTIONARY===Ue.logicalStreamType.lengthType?Y=Oe:Da.SYMBOL===Ue.logicalStreamType.lengthType?Ae=Oe:Xe=Oe;break}case sa.DATA:{const Oe=V.subarray(Z.get(),Z.get()+Ue.byteLength);Z.add(Ue.byteLength);const ft=Ue.logicalStreamType.dictionaryType;qs.FSST===ft?Ne=Oe:qs.SINGLE===ft||qs.SHARED===ft?de=Oe:qs.NONE===ft&&(at=Oe);break}}}return(function(Qe,Ue,Oe,ft,gt,St,vt){return Ue?new Lf(Qe,Oe,ft,gt,St,Ue,vt):null})(F,Ne,re,Y,de,Ae,q??Ve)??(function(Qe,Ue,Oe,ft,gt){return Ue?gt?new hl(Qe,Oe,ft,Ue,gt):new hl(Qe,Oe,ft,Ue):null})(F,de,re,Y,q??Ve)??(function(Qe,Ue,Oe,ft,gt){if(!Ue||!Oe)return null;if(ft)return gt?new hl(Qe,ft,Ue,Oe,gt):new hl(Qe,ft,Ue,Oe);if(gt&&gt.size()!==Ue.length-1){const St=new Int32Array(gt.size());let vt=0;for(let Jt=0;Jt<gt.size();Jt++)St[Jt]=gt.get(Jt)?vt++:0;return new hl(Qe,St,Ue,Oe,gt)}return gt?new Rf(Qe,Ue,Oe,gt):new Rf(Qe,Ue,Oe)})(F,Xe,at,re,q??Ve)})(A.name,y,x,A.nullable?p-1:p,D);case 0:return(function(F,V,Z,J,q){const Y=Ia(F,V),re=Y.numValues,de=V.get(),Ae=sc(q)?q:void 0,Ne=au(F,re,Y.byteLength,V,Ae);V.set(de+Y.byteLength);const Ve=new Zs(Ne,re);return new Fp(Z.name,Ve,q)})(y,x,A,0,O);case 6:case 5:return(function(F,V,Z,J,q){const Y=Ia(F,V),re=Cf(Y,J,F,V),de=q.physicalType===5;if(re===cn.FLAT){const Ae=nh(F,V,Y,de,sc(J)?J:void 0);return new ac(Z.name,Ae,J)}if(re===cn.SEQUENCE){const Ae=nc(F,V,Y);return new ah(Z.name,Ae[0],Ae[1],Y.numRleValues)}{const Ae=Lp(F,V,Y,de);return new jp(Z.name,Ae,J)}})(y,x,A,O,E);case 7:return(function(F,V,Z,J){const q=Ia(F,V),Y=sc(J)?J:void 0,re=(function(de,Ae,Ne,Ve){const Xe=Ae.get(),at=Xe+Ne*Float32Array.BYTES_PER_ELEMENT,Qe=new Uint8Array(de.subarray(Xe,at)).buffer,Ue=new Float32Array(Qe);return Ae.set(at),Ve?Ef(Ue,Ve,0):Ue})(F,V,q.numValues,Y);return new jm(Z.name,re,J)})(y,x,A,O);case 8:return(function(F,V,Z,J){const q=Ia(F,V),Y=sc(J)?J:void 0,re=(function(de,Ae,Ne,Ve){const Xe=Ae.get(),at=Xe+Ne*Float64Array.BYTES_PER_ELEMENT,Qe=new Uint8Array(de.subarray(Xe,at)).buffer,Ue=new Float64Array(Qe);return Ae.set(at),Ve?Ef(Ue,Ve,0):Ue})(F,V,q.numValues,Y);return new Cp(Z.name,re,J)})(y,x,A,O);default:throw new Error(`The specified data type for the field is currently not supported: ${E}`)}})(o,n,e,u,i.scalarType,i):o===0?null:(function(p,y,x,T){let E=null,A=null,D=null,I=null,O=!1;for(;!O;){const J=Ia(p,y);switch(J.physicalStreamType){case sa.LENGTH:Da.DICTIONARY===J.logicalStreamType.lengthType?E=nu(p,y,J):D=nu(p,y,J);break;case sa.DATA:qs.SINGLE===J.logicalStreamType.dictionaryType||qs.SHARED===J.logicalStreamType.dictionaryType?(A=p.subarray(y.get(),y.get()+J.byteLength),O=!0):I=p.subarray(y.get(),y.get()+J.byteLength),y.add(J.byteLength)}}const F=x.complexType.children,V=[];let Z=0;for(const J of F){const q=oa(p,y,1)[0];if(q==0)continue;const Y=J.name?`${x.name}${J.name}`:x.name;if(q!==2||J.type!=="scalarField"||J.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const re=Ia(p,y),de=au(p,re.numValues,re.byteLength,y),Ae=Ia(p,y),Ne=Pa(p,y,Ae,!1,0,Ae.decompressedCount!==T?new Zs(de,re.numValues):void 0);V[Z++]=I?new Lf(Y,Ne,E,A,D,I,new Zs(de,re.numValues)):new hl(Y,Ne,E,A,new Zs(de,re.numValues))}return V})(n,e,i,u)}function sc(n){return n instanceof Zs}function dl(n){switch(n){case 0:case 1:case 2:case 3:{const e={};e.nullable=!!(1&n),e.columnScope=0;const i={};return i.physicalType=n>1?6:4,i.type="physicalType",e.scalarType=i,e.type="scalarType",e}case 4:{const e={nullable:!1,columnScope:0},i={type:"physicalType",physicalType:0};return e.type="complexType",e.complexType=i,e}case 30:{const e={nullable:!1,columnScope:0},i={type:"physicalType",physicalType:1};return e.type="complexType",e.complexType=i,e}default:return(function(e){let i=null;switch(e){case 10:case 11:i=0;break;case 12:case 13:i=1;break;case 14:case 15:i=2;break;case 16:case 17:i=3;break;case 18:case 19:i=4;break;case 20:case 21:i=5;break;case 22:case 23:i=6;break;case 24:case 25:i=7;break;case 26:case 27:i=8;break;case 28:case 29:i=9;break;default:return null}const o={};o.nullable=!!(1&e),o.columnScope=0;const u={type:"physicalType"};return u.physicalType=i,o.type="scalarType",o.scalarType=u,o})(n)}}function fl(n){return n>=10}function pl(n){return n===30}function cd(n){if(n.name==="id")return!1;if(n.type==="scalarType"){const e=n.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(n.type==="complexType"){const e=n.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",n),!1}const hd=new TextDecoder;function Mo(n,e){const i=oa(n,e,1)[0];if(i===0)return"";const o=e.get(),u=n.subarray(o,o+i);return e.add(i),hd.decode(u)}function Vm(n,e){const i=oa(n,e,1)[0]>>>0;if(i<10||i>30)throw new Error(`Unsupported field type code ${i}. Supported: 10-29(scalars), 30(STRUCT)`);const o=dl(i);if(fl(i)&&(o.name=Mo(n,e)),pl(i)){const u=oa(n,e,1)[0]>>>0;o.complexType.children=new Array(u);for(let f=0;f<u;f++)o.complexType.children[f]=Vm(n,e)}return(function(u){return{name:u.name,nullable:u.nullable,scalarField:u.scalarType,complexField:u.complexType,type:u.type==="scalarType"?"scalarField":"complexField"}})(o)}function Um(n,e){const i=oa(n,e,1)[0]>>>0,o=dl(i);if(!o)throw new Error(`Unsupported column type code ${i}. Supported: 0-3(ID), 4(GEOMETRY), 10-29(scalars), 30(STRUCT)`);if(fl(i)?o.name=Mo(n,e):i>=0&&i<=3?o.name="id":i===4&&(o.name="geometry"),pl(i)){const u=oa(n,e,1)[0]>>>0,f=o.complexType;f.children=new Array(u);for(let p=0;p<u;p++)f.children[p]=Vm(n,e)}return o}function dd(n,e){const i={featureTables:[]},o={};o.name=Mo(n,e);const u=oa(n,e,1)[0]>>>0,f=oa(n,e,1)[0]>>>0;o.columns=new Array(f);for(let p=0;p<f;p++)o.columns[p]=Um(n,e);return i.featureTables.push(o),[i,u]}function ag(n,e,i,o,u,f,p=!1){const y=e.scalarType.physicalType,x=Cf(u,f,n,i);if(y===4)switch(x){case cn.FLAT:{const T=Pa(n,i,u,!1);return new Tf(o,T,f)}case cn.SEQUENCE:{const T=Rp(n,i,u);return new Dp(o,T[0],T[1],u.numRleValues)}case cn.CONST:{const T=Pp(n,i,u,!1);return new Ip(o,T,f)}}else switch(x){case cn.FLAT:{if(p){const E=(function(A,D,I){const O=(function(F,V,Z){const J=new Float64Array(Z);for(let q=0;q<Z;q++)J[q]=ed(F,V);return J})(A,D,I.numValues);return(function(F,V){switch(V.logicalLevelTechnique1){case zi.DELTA:return V.logicalLevelTechnique2===zi.RLE&&(F=Rm(F,V.runs,V.numRleValues)),(function(Z){Z[0]=cl(Z[0]);const J=Z.length/4*4;let q=1;if(J>=4)for(;q<J-4;q+=4){const Y=Z[q+1],re=Z[q+2],de=Z[q+3];Z[q]=cl(Z[q])+Z[q-1],Z[q+1]=cl(Y)+Z[q],Z[q+2]=cl(re)+Z[q+1],Z[q+3]=cl(de)+Z[q+2]}for(;q!=Z.length;++q)Z[q]=cl(Z[q])+Z[q-1]})(F),F;case zi.RLE:return(function(Z,J){return Rm(Z,J.runs,J.numRleValues)})(F,V);case zi.NONE:return F;default:throw new Error(`The specified Logical level technique is not supported: ${V.logicalLevelTechnique1}`)}})(O,I)})(n,i,u);return new Cp(o,E,f)}const T=nh(n,i,u,!1);return new ac(o,T,f)}case cn.SEQUENCE:{const T=nc(n,i,u);return new ah(o,T[0],T[1],u.numRleValues)}case cn.CONST:{const T=Lp(n,i,u,!1);return new jp(o,T,f)}}throw new Error("Vector type not supported for id column.")}class Gm{constructor(e,i){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case Yn.POINT:case Yn.MULTIPOINT:this.type=1;break;case Yn.LINESTRING:case Yn.MULTILINESTRING:this.type=2;break;case Yn.POLYGON:case Yn.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=i,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const i of this._featureData.geometry.coordinates){const o=[];for(const u of i)o.push(new ge(u.x,u.y));e.push(o)}return e}}class kf{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new Gm(this.features[e],this.extent)}}class Vp{constructor(e){this.layers={};const i=(function(o,u,f=!0){const p=new Dm(0),y=[];for(;p.get()<o.length;){const x=oa(o,p,1)[0]>>>0,T=p.get()+x;if(T>o.length)throw new Error(`Block overruns tile: ${T} > ${o.length}`);if(oa(o,p,1)[0]>>>0!=1){p.set(T);continue}const E=dd(o,p),A=E[1],D=E[0].featureTables[0];let I=null,O=null;const F=[];let V=0;for(const J of D.columns){const q=J.name;if(q==="id"){let Y=null;if(J.nullable){const de=Ia(o,p),Ae=p.get(),Ne=au(o,de.numValues,de.byteLength,p);p.set(Ae+de.byteLength),Y=new Zs(Ne,de.numValues)}const re=Ia(o,p);V=re.decompressedCount,I=ag(o,J,p,q,re,Y??V,f)}else if(q==="geometry"){const Y=oa(o,p,1)[0];if(V===0){const re=p.get();V=Ia(o,p).decompressedCount,p.set(re)}O=Fm(o,Y,p,V)}else{const Y=cd(J)?oa(o,p,1)[0]:1;if(Y===0)continue;const re=Nm(o,p,J,Y,V);if(re)if(Array.isArray(re))for(const de of re)F.push(de);else F.push(re)}}const Z=new tu(D.name,O,I,F,A);y.push(Z),p.set(T)}return y})(new Uint8Array(e));this.layers=i.reduce(((o,u)=>Object.assign(Object.assign({},o),{[u.name]:new kf(u)})),{})}}class rg{constructor(e,i){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=i,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],i=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of i){const u=[];for(const f of o)u.push(new ge(f[0],f[1]));e.push(u)}return e}}const ru="_geojsonTileLayer";function Of(n,e){e.writeVarintField(15,n.version||1),e.writeStringField(1,n.name||""),e.writeVarintField(5,n.extent||4096);const i={keys:[],values:[],keycache:{},valuecache:{}};for(let f=0;f<n.length;f++)i.feature=n.feature(f),e.writeMessage(2,qm,i);const o=i.keys;for(const f of o)e.writeStringField(3,f);const u=i.values;for(const f of u)e.writeMessage(4,Zm,f)}function qm(n,e){if(!n.feature)return;const i=n.feature;i.id!==void 0&&e.writeVarintField(1,i.id),e.writeMessage(2,sh,n),e.writeVarintField(3,i.type),e.writeMessage(4,jf,i)}function sh(n,e){for(const i in n.feature?.properties){let o=n.feature.properties[i],u=n.keycache[i];if(o==null)continue;u===void 0&&(n.keys.push(i),u=n.keys.length-1,n.keycache[i]=u),e.writeVarint(u),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const f=typeof o+":"+o;let p=n.valuecache[f];p===void 0&&(n.values.push(o),p=n.values.length-1,n.valuecache[f]=p),e.writeVarint(p)}}function Bf(n,e){return(e<<3)+(7&n)}function Ff(n){return n<<1^n>>31}function jf(n,e){const i=n.loadGeometry(),o=n.type;let u=0,f=0;for(const p of i){let y=1;o===1&&(y=p.length),e.writeVarint(Bf(1,y));const x=o===3?p.length-1:p.length;for(let T=0;T<x;T++){T===1&&o!==1&&e.writeVarint(Bf(2,x-1));const E=p[T].x-u,A=p[T].y-f;e.writeVarint(Ff(E)),e.writeVarint(Ff(A)),u+=E,f+=A}n.type===3&&e.writeVarint(Bf(7,1))}}function Zm(n,e){const i=typeof n;i==="string"?e.writeStringField(1,n):i==="boolean"?e.writeBooleanField(7,n):i==="number"&&(n%1!=0?e.writeDoubleField(3,n):n<0?e.writeSVarintField(6,n):e.writeVarintField(5,n))}class Hm{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new fo(_t,16,0),this.grid3D=new fo(_t,16,0),this.featureIndexArray=new G,this.promoteId=i}insert(e,i,o,u,f,p){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,f);const x=p?this.grid3D:this.grid;for(let T=0;T<i.length;T++){const E=i[T],A=[1/0,1/0,-1/0,-1/0];for(let D=0;D<E.length;D++){const I=E[D];A[0]=Math.min(A[0],I.x),A[1]=Math.min(A[1],I.y),A[2]=Math.max(A[2],I.x),A[3]=Math.max(A[3],I.y)}A[0]<_t&&A[1]<_t&&A[2]>=0&&A[3]>=0&&x.insert(y,A[0],A[1],A[2],A[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new pi(new of(this.rawTileData)).layers:new Vp(this.rawTileData).layers,this.sourceLayerCoder=new Ap(this.vtLayers?Object.keys(this.vtLayers).sort():[ru])),this.vtLayers}query(e,i,o,u){this.loadVTLayers();const f=e.params,p=_t/e.tileSize/e.scale,y=Ta(f.filter,f.globalState),x=e.queryGeometry,T=e.queryPadding*p,E=Jl.fromPoints(x),A=this.grid.query(E.minX-T,E.minY-T,E.maxX+T,E.maxY+T),D=Jl.fromPoints(e.cameraQueryGeometry).expandBy(T),I=this.grid3D.query(D.minX,D.minY,D.maxX,D.maxY,((V,Z,J,q)=>(function(Y,re,de,Ae,Ne){for(const Xe of Y)if(re<=Xe.x&&de<=Xe.y&&Ae>=Xe.x&&Ne>=Xe.y)return!0;const Ve=[new ge(re,de),new ge(re,Ne),new ge(Ae,Ne),new ge(Ae,de)];if(Y.length>2){for(const Xe of Ve)if(yo(Y,Xe))return!0}for(let Xe=0;Xe<Y.length-1;Xe++)if(Xp(Y[Xe],Y[Xe+1],Ve))return!0;return!1})(e.cameraQueryGeometry,V-T,Z-T,J+T,q+T)));for(const V of I)A.push(V);A.sort(a);const O={};let F;for(let V=0;V<A.length;V++){const Z=A[V];if(Z===F)continue;F=Z;const J=this.featureIndexArray.get(Z);let q=null;this.loadMatchingFeature(O,J.bucketIndex,J.sourceLayerIndex,J.featureIndex,y,f.layers,f.availableImages,i,o,u,((Y,re,de)=>(q||(q=Ns(Y)),re.queryIntersectsFeature({queryGeometry:x,feature:Y,featureState:de,geometry:q,zoom:this.z,transform:e.transform,pixelsToTileUnits:p,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return O}loadMatchingFeature(e,i,o,u,f,p,y,x,T,E,A){const D=this.bucketLayerIDs[i];if(p&&!D.some((V=>p.has(V))))return;const I=this.sourceLayerCoder.decode(o),O=this.vtLayers[I].feature(u);if(f.needGeometry){const V=Fr(O,!0);if(!f.filter(new Ai(this.tileID.overscaledZ),V,this.tileID.canonical))return}else if(!f.filter(new Ai(this.tileID.overscaledZ),O))return;const F=this.getId(O,I);for(let V=0;V<D.length;V++){const Z=D[V];if(p&&!p.has(Z))continue;const J=x[Z];if(!J)continue;let q={};F&&E&&(q=E.getState(J.sourceLayer||ru,F));const Y=Ui({},T[Z]);Y.paint=fd(Y.paint,J.paint,O,q,y),Y.layout=fd(Y.layout,J.layout,O,q,y);const re=!A||A(O,J,q);if(!re)continue;const de=new bf(O,this.z,this.x,this.y,F);de.layer=Y;let Ae=e[Z];Ae===void 0&&(Ae=e[Z]=[]),Ae.push({featureIndex:u,feature:de,intersectionZ:re})}}lookupSymbolFeatures(e,i,o,u,f,p,y,x){const T={};this.loadVTLayers();const E=Ta(f.filterSpec,f.globalState);for(const A of e)this.loadMatchingFeature(T,o,u,A,E,p,y,x,i);return T}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){var o;let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(e.properties.cluster_id))),u}}function fd(n,e,i,o,u){return Mr(n,((f,p)=>{const y=e instanceof Xo?e.get(p):null;return y&&y.evaluate?y.evaluate(i,o,u):y}))}function a(n,e){return e-n}function s(n,e,i,o,u){const f=[];for(let p=0;p<n.length;p++){const y=n[p];let x;for(let T=0;T<y.length-1;T++){let E=y[T],A=y[T+1];E.x<e&&A.x<e||(E.x<e?E=new ge(e,E.y+(e-E.x)/(A.x-E.x)*(A.y-E.y))._round():A.x<e&&(A=new ge(e,E.y+(e-E.x)/(A.x-E.x)*(A.y-E.y))._round()),E.y<i&&A.y<i||(E.y<i?E=new ge(E.x+(i-E.y)/(A.y-E.y)*(A.x-E.x),i)._round():A.y<i&&(A=new ge(E.x+(i-E.y)/(A.y-E.y)*(A.x-E.x),i)._round()),E.x>=o&&A.x>=o||(E.x>=o?E=new ge(o,E.y+(o-E.x)/(A.x-E.x)*(A.y-E.y))._round():A.x>=o&&(A=new ge(o,E.y+(o-E.x)/(A.x-E.x)*(A.y-E.y))._round()),E.y>=u&&A.y>=u||(E.y>=u?E=new ge(E.x+(u-E.y)/(A.y-E.y)*(A.x-E.x),u)._round():A.y>=u&&(A=new ge(E.x+(u-E.y)/(A.y-E.y)*(A.x-E.x),u)._round()),x&&E.equals(x[x.length-1])||(x=[E],f.push(x)),x.push(A)))))}}return f}function c(n,e,i,o,u){switch(e){case 1:return(function(f,p,y,x){const T=[];for(const E of f)for(const A of E){const D=x===0?A.x:A.y;D>=p&&D<=y&&T.push([A])}return T})(n,i,o,u);case 2:return w(n,i,o,u,!1);case 3:return w(n,i,o,u,!0)}return[]}function g(n,e,i,o,u){const f=o===0?M:k;let p=[];const y=[];for(let E=0;E<n.length-1;E++){const A=n[E],D=n[E+1],I=o===0?A.x:A.y,O=o===0?D.x:D.y;let F=!1;I<e?O>e&&p.push(f(A,D,e)):I>i?O<i&&p.push(f(A,D,i)):p.push(A),O<e&&I>=e&&(p.push(f(A,D,e)),F=!0),O>i&&I<=i&&(p.push(f(A,D,i)),F=!0),!u&&F&&(y.push(p),p=[])}const x=n.length-1,T=o===0?n[x].x:n[x].y;return T>=e&&T<=i&&p.push(n[x]),u&&p.length>0&&!p[0].equals(p[p.length-1])&&p.push(new ge(p[0].x,p[0].y)),p.length>0&&y.push(p),y}function w(n,e,i,o,u){const f=[];for(const p of n){const y=g(p,e,i,o,u);y.length>0&&f.push(...y)}return f}function M(n,e,i){return new ge(i,n.y+(i-n.x)/(e.x-n.x)*(e.y-n.y))}function k(n,e,i){return new ge(n.x+(i-n.y)/(e.y-n.y)*(e.x-n.x),i)}ut("FeatureIndex",Hm,{omit:["rawTileData","sourceLayerCoder"]});class H extends ge{constructor(e,i,o,u){super(e,i),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new H(this.x,this.y,this.angle,this.segment)}}function fe(n,e,i,o,u){if(e.segment===void 0||i===0)return!0;let f=e,p=e.segment+1,y=0;for(;y>-i/2;){if(p--,p<0)return!1;y-=n[p].dist(f),f=n[p]}y+=n[p].dist(n[p+1]),p++;const x=[];let T=0;for(;y<i/2;){const E=n[p],A=n[p+1];if(!A)return!1;let D=n[p-1].angleTo(E)-E.angleTo(A);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:D}),T+=D;y-x[0].distance>o;)T-=x.shift().angleDelta;if(T>u)return!1;p++,y+=E.dist(A)}return!0}function Re(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function Ge(n,e,i){return n?.6*e*i:0}function Ke(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Le(n,e,i,o,u,f){const p=Ge(i,u,f),y=Ke(i,o)*f;let x=0;const T=Re(n)/2;for(let E=0;E<n.length-1;E++){const A=n[E],D=n[E+1],I=A.dist(D);if(x+I>T){const O=(T-x)/I,F=tn.number(A.x,D.x,O),V=tn.number(A.y,D.y,O),Z=new H(F,V,D.angleTo(A),E);return Z._round(),!p||fe(n,Z,y,p,e)?Z:void 0}x+=I}}function je(n,e,i,o,u,f,p,y,x){const T=Ge(o,f,p),E=Ke(o,u),A=E*p,D=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-A<e/4&&(e=A+e/4),wt(n,D?e/2*y%e:(E/2+2*f)*p*y%e,e,T,i,A,D,!1,x)}function wt(n,e,i,o,u,f,p,y,x){const T=f/2,E=Re(n);let A=0,D=e-i,I=[];for(let O=0;O<n.length-1;O++){const F=n[O],V=n[O+1],Z=F.dist(V),J=V.angleTo(F);for(;D+i<A+Z;){D+=i;const q=(D-A)/Z,Y=tn.number(F.x,V.x,q),re=tn.number(F.y,V.y,q);if(Y>=0&&Y<x&&re>=0&&re<x&&D-T>=0&&D+T<=E){const de=new H(Y,re,J,O);de._round(),o&&!fe(n,de,f,o,u)||I.push(de)}}A+=Z}return y||I.length||p||(I=wt(n,A/2,i,o,u,f,p,!0,x)),I}function Ut(n,e,i,o){const u=[],f=n.image,p=f.pixelRatio,y=f.paddedRect.w-2,x=f.paddedRect.h-2;let T={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const E=f.stretchX||[[0,y]],A=f.stretchY||[[0,x]],D=(Oe,ft)=>Oe+ft[1]-ft[0],I=E.reduce(D,0),O=A.reduce(D,0),F=y-I,V=x-O;let Z=0,J=I,q=0,Y=O,re=0,de=F,Ae=0,Ne=V;if(f.content&&o){const Oe=f.content,ft=Oe[2]-Oe[0],gt=Oe[3]-Oe[1];(f.textFitWidth||f.textFitHeight)&&(T=ul(n)),Z=Ni(E,0,Oe[0]),q=Ni(A,0,Oe[1]),J=Ni(E,Oe[0],Oe[2]),Y=Ni(A,Oe[1],Oe[3]),re=Oe[0]-Z,Ae=Oe[1]-q,de=ft-J,Ne=gt-Y}const Ve=T.x1,Xe=T.y1,at=T.x2-Ve,Qe=T.y2-Xe,Ue=(Oe,ft,gt,St)=>{const vt=ye(Oe.stretch-Z,J,at,Ve),Jt=Pe(Oe.fixed-re,de,Oe.stretch,I),vn=ye(ft.stretch-q,Y,Qe,Xe),Wn=Pe(ft.fixed-Ae,Ne,ft.stretch,O),Ra=ye(gt.stretch-Z,J,at,Ve),Eo=Pe(gt.fixed-re,de,gt.stretch,I),Tr=ye(St.stretch-q,Y,Qe,Xe),va=Pe(St.fixed-Ae,Ne,St.stretch,O),La=new ge(vt,vn),Rn=new ge(Ra,vn),xa=new ge(Ra,Tr),tr=new ge(vt,Tr),ir=new ge(Jt/p,Wn/p),Ur=new ge(Eo/p,va/p),ka=e*Math.PI/180;if(ka){const la=Math.sin(ka),Mn=Math.cos(ka),Kn=[Mn,-la,la,Mn];La._matMult(Kn),Rn._matMult(Kn),tr._matMult(Kn),xa._matMult(Kn)}const Gr=Oe.stretch+Oe.fixed,Ao=ft.stretch+ft.fixed;return{tl:La,tr:Rn,bl:tr,br:xa,tex:{x:f.paddedRect.x+1+Gr,y:f.paddedRect.y+1+Ao,w:gt.stretch+gt.fixed-Gr,h:St.stretch+St.fixed-Ao},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ir,pixelOffsetBR:Ur,minFontScaleX:de/p/at,minFontScaleY:Ne/p/Qe,isSDF:i}};if(o&&(f.stretchX||f.stretchY)){const Oe=we(E,F,I),ft=we(A,V,O);for(let gt=0;gt<Oe.length-1;gt++){const St=Oe[gt],vt=Oe[gt+1];for(let Jt=0;Jt<ft.length-1;Jt++)u.push(Ue(St,ft[Jt],vt,ft[Jt+1]))}}else u.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function Ni(n,e,i){let o=0;for(const u of n)o+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return o}function we(n,e,i){const o=[{fixed:-1,stretch:0}];for(const[u,f]of n){const p=o[o.length-1];o.push({fixed:u-p.stretch,stretch:p.stretch}),o.push({fixed:u-p.stretch,stretch:p.stretch+(f-u)})}return o.push({fixed:e+1,stretch:i}),o}function ye(n,e,i,o){return n/e*i+o}function Pe(n,e,i,o){return n-e*i/o}ut("Anchor",H);class $e{constructor(e,i,o,u,f,p,y,x,T,E){var A;if(this.boxStartIndex=e.length,T){let D=p.top,I=p.bottom;const O=p.collisionPadding;O&&(D-=O[1],I+=O[3]);let F=I-D;F>0&&(F=Math.max(10,F),this.circleDiameter=F)}else{const D=!((A=p.image)===null||A===void 0)&&A.content&&(p.image.textFitWidth||p.image.textFitHeight)?ul(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};D.y1=D.y1*y-x[0],D.y2=D.y2*y+x[2],D.x1=D.x1*y-x[3],D.x2=D.x2*y+x[1];const I=p.collisionPadding;if(I&&(D.x1-=I[0]*y,D.y1-=I[1]*y,D.x2+=I[2]*y,D.y2+=I[3]*y),E){const O=new ge(D.x1,D.y1),F=new ge(D.x2,D.y1),V=new ge(D.x1,D.y2),Z=new ge(D.x2,D.y2),J=E*Math.PI/180;O._rotate(J),F._rotate(J),V._rotate(J),Z._rotate(J),D.x1=Math.min(O.x,F.x,V.x,Z.x),D.x2=Math.max(O.x,F.x,V.x,Z.x),D.y1=Math.min(O.y,F.y,V.y,Z.y),D.y2=Math.max(O.y,F.y,V.y,Z.y)}e.emplaceBack(i.x,i.y,D.x1,D.y1,D.x2,D.y2,o,u,f)}this.boxEndIndex=e.length}}class Rt{constructor(e=[],i=(o,u)=>o<u?-1:o>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,u=i[e];for(;e>0;){const f=e-1>>1,p=i[f];if(o(u,p)>=0)break;i[e]=p,e=f}i[e]=u}_down(e){const{data:i,compare:o}=this,u=this.length>>1,f=i[e];for(;e<u;){let p=1+(e<<1);const y=p+1;if(y<this.length&&o(i[y],i[p])<0&&(p=y),o(i[p],f)>=0)break;i[e]=i[p],e=p}i[e]=f}}function Ri(n,e=1,i=!1){const o=Jl.fromPoints(n[0]),u=Math.min(o.width(),o.height());let f=u/2;const p=new Rt([],At),{minX:y,minY:x,maxX:T,maxY:E}=o;if(u===0)return new ge(y,x);for(let I=y;I<T;I+=u)for(let O=x;O<E;O+=u)p.push(new Wt(I+f,O+f,f,n));let A=(function(I){let O=0,F=0,V=0;const Z=I[0];for(let J=0,q=Z.length,Y=q-1;J<q;Y=J++){const re=Z[J],de=Z[Y],Ae=re.x*de.y-de.x*re.y;F+=(re.x+de.x)*Ae,V+=(re.y+de.y)*Ae,O+=3*Ae}return new Wt(F/O,V/O,0,I)})(n),D=p.length;for(;p.length;){const I=p.pop();(I.d>A.d||!A.d)&&(A=I,i&&console.log("found best %d after %d probes",Math.round(1e4*I.d)/1e4,D)),I.max-A.d<=e||(f=I.h/2,p.push(new Wt(I.p.x-f,I.p.y-f,f,n)),p.push(new Wt(I.p.x+f,I.p.y-f,f,n)),p.push(new Wt(I.p.x-f,I.p.y+f,f,n)),p.push(new Wt(I.p.x+f,I.p.y+f,f,n)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${A.d}`)),A.p}function At(n,e){return e.max-n.max}function Wt(n,e,i,o){this.p=new ge(n,e),this.h=i,this.d=(function(u,f){let p=!1,y=1/0;for(let x=0;x<f.length;x++){const T=f[x];for(let E=0,A=T.length,D=A-1;E<A;D=E++){const I=T[E],O=T[D];I.y>u.y!=O.y>u.y&&u.x<(O.x-I.x)*(u.y-I.y)/(O.y-I.y)+I.x&&(p=!p),y=Math.min(y,Yf(u,I,O))}}return(p?1:-1)*Math.sqrt(y)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var jt;P.aP=void 0,(jt=P.aP||(P.aP={}))[jt.center=1]="center",jt[jt.left=2]="left",jt[jt.right=3]="right",jt[jt.top=4]="top",jt[jt.bottom=5]="bottom",jt[jt["top-left"]=6]="top-left",jt[jt["top-right"]=7]="top-right",jt[jt["bottom-left"]=8]="bottom-left",jt[jt["bottom-right"]=9]="bottom-right";const Si=Number.POSITIVE_INFINITY;function ml(n,e){return e[1]!==Si?(function(i,o,u){let f=0,p=0;switch(o=Math.abs(o),u=Math.abs(u),i){case"top-right":case"top-left":case"top":p=u-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-u}switch(i){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}return[f,p]})(n,e[0],e[1]):(function(i,o){let u=0,f=0;o<0&&(o=0);const p=o/Math.SQRT2;switch(i){case"top-right":case"top-left":f=p-7;break;case"bottom-right":case"bottom-left":f=7-p;break;case"bottom":f=7-o;break;case"top":f=o-7}switch(i){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=o;break;case"right":u=-o}return[u,f]})(n,e[0])}function $m(n,e,i){var o;const u=n.layout,f=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},i);if(f){const y=f.values,x=[];for(let T=0;T<y.length;T+=2){const E=x[T]=y[T],A=y[T+1].map((D=>D*jn));E.startsWith("top")?A[1]-=7:E.startsWith("bottom")&&(A[1]+=7),x[T+1]=A}return new fn(x)}const p=u.get("text-variable-anchor");if(p){let y;y=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},i)*jn,Si]:u.get("text-offset").evaluate(e,{},i).map((T=>T*jn));const x=[];for(const T of p)x.push(T,ml(T,y));return new fn(x)}return null}function sg(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function p_(n,e,i,o,u,f,p,y,x,T,E,A){let D=f.textMaxSize.evaluate(e,{});D===void 0&&(D=p);const I=n.layers[0].layout,O=I.get("icon-offset").evaluate(e,{},E),F=Eg(i.horizontal),V=p/24,Z=n.tilePixelRatio*V,J=n.tilePixelRatio*D/24,q=n.tilePixelRatio*y,Y=n.tilePixelRatio*I.get("symbol-spacing"),re=I.get("text-padding")*n.tilePixelRatio,de=(function(gt,St,vt,Jt=1){const vn=gt.get("icon-padding").evaluate(St,{},vt),Wn=vn&&vn.values;return[Wn[0]*Jt,Wn[1]*Jt,Wn[2]*Jt,Wn[3]*Jt]})(I,e,E,n.tilePixelRatio),Ae=I.get("text-max-angle")/180*Math.PI,Ne=I.get("text-rotation-alignment")!=="viewport"&&I.get("symbol-placement")!=="point",Ve=I.get("icon-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",Xe=I.get("symbol-placement"),at=Y/2,Qe=I.get("icon-text-fit");let Ue;o&&Qe!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(Ue=Gs(o,i.vertical,Qe,I.get("icon-text-fit-padding"),O,V)),F&&(o=Gs(o,F,Qe,I.get("icon-text-fit-padding"),O,V)));const Oe=E?A.line.getGranularityForZoomLevel(E.z):1,ft=(gt,St)=>{St.x<0||St.x>=_t||St.y<0||St.y>=_t||(function(vt,Jt,vn,Wn,Ra,Eo,Tr,va,La,Rn,xa,tr,ir,Ur,ka,Gr,Ao,la,Mn,Kn,Dn,ua,oc,gl,qp){const oh=vt.addToLineVertexArray(Jt,vn);let pd,Nf,Vf,Uf,Dg=0,Ig=0,Pg=0,Rg=0,pg=-1,mg=-1;const lc={};let Lg=_n("");if(vt.allowVerticalPlacement&&Wn.vertical){const nr=va.layout.get("text-rotate").evaluate(Dn,{},gl)+90;Vf=new $e(La,Jt,Rn,xa,tr,Wn.vertical,ir,Ur,ka,nr),Tr&&(Uf=new $e(La,Jt,Rn,xa,tr,Tr,Ao,la,ka,nr))}if(Ra){const nr=va.layout.get("icon-rotate").evaluate(Dn,{}),Hs=va.layout.get("icon-text-fit")!=="none",md=Ut(Ra,nr,oc,Hs),yl=Tr?Ut(Tr,nr,oc,Hs):void 0;Nf=new $e(La,Jt,Rn,xa,tr,Ra,Ao,la,!1,nr),Dg=4*md.length;const gd=vt.iconSizeData;let su=null;gd.kind==="source"?(su=[Nr*va.layout.get("icon-size").evaluate(Dn,{})],su[0]>Kl&&xn(`${vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):gd.kind==="composite"&&(su=[Nr*ua.compositeIconSizes[0].evaluate(Dn,{},gl),Nr*ua.compositeIconSizes[1].evaluate(Dn,{},gl)],(su[0]>Kl||su[1]>Kl)&&xn(`${vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),vt.addSymbols(vt.icon,md,su,Kn,Mn,Dn,P.az.none,Jt,oh.lineStartIndex,oh.lineLength,-1,gl),pg=vt.icon.placedSymbolArray.length-1,yl&&(Ig=4*yl.length,vt.addSymbols(vt.icon,yl,su,Kn,Mn,Dn,P.az.vertical,Jt,oh.lineStartIndex,oh.lineLength,-1,gl),mg=vt.icon.placedSymbolArray.length-1)}const kg=Object.keys(Wn.horizontal);for(const nr of kg){const Hs=Wn.horizontal[nr];if(!pd){Lg=_n(Hs.text);const yl=va.layout.get("text-rotate").evaluate(Dn,{},gl);pd=new $e(La,Jt,Rn,xa,tr,Hs,ir,Ur,ka,yl)}const md=Hs.positionedLines.length===1;if(Pg+=Mg(vt,Jt,Hs,Eo,va,ka,Dn,Gr,oh,Wn.vertical?P.az.horizontal:P.az.horizontalOnly,md?kg:[nr],lc,pg,ua,gl),md)break}Wn.vertical&&(Rg+=Mg(vt,Jt,Wn.vertical,Eo,va,ka,Dn,Gr,oh,P.az.vertical,["vertical"],lc,mg,ua,gl));const __=pd?pd.boxStartIndex:vt.collisionBoxArray.length,y_=pd?pd.boxEndIndex:vt.collisionBoxArray.length,v_=Vf?Vf.boxStartIndex:vt.collisionBoxArray.length,x_=Vf?Vf.boxEndIndex:vt.collisionBoxArray.length,b_=Nf?Nf.boxStartIndex:vt.collisionBoxArray.length,w_=Nf?Nf.boxEndIndex:vt.collisionBoxArray.length,T_=Uf?Uf.boxStartIndex:vt.collisionBoxArray.length,S_=Uf?Uf.boxEndIndex:vt.collisionBoxArray.length;let _l=-1;const Ym=(nr,Hs)=>nr&&nr.circleDiameter?Math.max(nr.circleDiameter,Hs):Hs;_l=Ym(pd,_l),_l=Ym(Vf,_l),_l=Ym(Nf,_l),_l=Ym(Uf,_l);const Og=_l>-1?1:0;Og&&(_l*=qp/jn),vt.glyphOffsetArray.length>=eh.MAX_GLYPHS&&xn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Dn.sortKey!==void 0&&vt.addToSortKeyRanges(vt.symbolInstances.length,Dn.sortKey);const M_=$m(va,Dn,gl),[E_,A_]=(function(nr,Hs){const md=nr.length,yl=Hs?.values;if(yl?.length>0)for(let gd=0;gd<yl.length;gd+=2){const su=yl[gd+1];nr.emplaceBack(P.aP[yl[gd]],su[0],su[1])}return[md,nr.length]})(vt.textAnchorOffsets,M_);vt.symbolInstances.emplaceBack(Jt.x,Jt.y,lc.right>=0?lc.right:-1,lc.center>=0?lc.center:-1,lc.left>=0?lc.left:-1,lc.vertical||-1,pg,mg,Lg,__,y_,v_,x_,b_,w_,T_,S_,Rn,Pg,Rg,Dg,Ig,Og,0,ir,_l,E_,A_)})(n,St,gt,i,o,u,Ue,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Z,[re,re,re,re],Ne,x,q,de,Ve,O,e,f,T,E,p)};if(Xe==="line")for(const gt of s(e.geometry,0,0,_t,_t)){const St=al(gt,Oe),vt=je(St,Y,Ae,i.vertical||F,o,24,J,n.overscaling,_t);for(const Jt of vt)F&&m_(n,F.text,at,Jt)||ft(St,Jt)}else if(Xe==="line-center"){for(const gt of e.geometry)if(gt.length>1){const St=al(gt,Oe),vt=Le(St,Ae,i.vertical||F,o,24,J);vt&&ft(St,vt)}}else if(e.type==="Polygon")for(const gt of Tu(e.geometry,0)){const St=Ri(gt,16);ft(al(gt[0],Oe,!0),new H(St.x,St.y,0))}else if(e.type==="LineString")for(const gt of e.geometry){const St=al(gt,Oe);ft(St,new H(St[0].x,St[0].y,0))}else if(e.type==="Point")for(const gt of e.geometry)for(const St of gt)ft([St],new H(St.x,St.y,0))}function Mg(n,e,i,o,u,f,p,y,x,T,E,A,D,I,O){const F=(function(J,q,Y,re,de,Ae,Ne,Ve){const Xe=re.layout.get("text-rotate").evaluate(Ae,{})*Math.PI/180,at=[];for(const Qe of q.positionedLines)for(const Ue of Qe.positionedGlyphs){if(!Ue.rect)continue;const Oe=Ue.rect||{};let ft=4,gt=!0,St=1,vt=0;const Jt=(de||Ve)&&Ue.vertical,vn=Ue.metrics.advance*Ue.scale/2;if(Ve&&q.verticalizable&&(vt=Qe.lineOffset/2-(Ue.imageName?-(jn-Ue.metrics.width*Ue.scale)/2:(Ue.scale-1)*jn)),Ue.imageName){const la=Ne[Ue.imageName];gt=la.sdf,St=la.pixelRatio,ft=1/St}const Wn=de?[Ue.x+vn,Ue.y]:[0,0];let Ra=de?[0,0]:[Ue.x+vn+Y[0],Ue.y+Y[1]-vt],Eo=[0,0];Jt&&(Eo=Ra,Ra=[0,0]);const Tr=Ue.metrics.isDoubleResolution?2:1,va=(Ue.metrics.left-ft)*Ue.scale-vn+Ra[0],La=(-Ue.metrics.top-ft)*Ue.scale+Ra[1],Rn=va+Oe.w/Tr*Ue.scale/St,xa=La+Oe.h/Tr*Ue.scale/St,tr=new ge(va,La),ir=new ge(Rn,La),Ur=new ge(va,xa),ka=new ge(Rn,xa);if(Jt){const la=new ge(-vn,vn- -17),Mn=-Math.PI/2,Kn=12-vn,Dn=new ge(22-Kn,-(Ue.imageName?Kn:0)),ua=new ge(...Eo);tr._rotateAround(Mn,la)._add(Dn)._add(ua),ir._rotateAround(Mn,la)._add(Dn)._add(ua),Ur._rotateAround(Mn,la)._add(Dn)._add(ua),ka._rotateAround(Mn,la)._add(Dn)._add(ua)}if(Xe){const la=Math.sin(Xe),Mn=Math.cos(Xe),Kn=[Mn,-la,la,Mn];tr._matMult(Kn),ir._matMult(Kn),Ur._matMult(Kn),ka._matMult(Kn)}const Gr=new ge(0,0),Ao=new ge(0,0);at.push({tl:tr,tr:ir,bl:Ur,br:ka,tex:Oe,writingMode:q.writingMode,glyphOffset:Wn,sectionIndex:Ue.sectionIndex,isSDF:gt,pixelOffsetTL:Gr,pixelOffsetBR:Ao,minFontScaleX:0,minFontScaleY:0})}return at})(0,i,y,u,f,p,o,n.allowVerticalPlacement),V=n.textSizeData;let Z=null;V.kind==="source"?(Z=[Nr*u.layout.get("text-size").evaluate(p,{})],Z[0]>Kl&&xn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):V.kind==="composite"&&(Z=[Nr*I.compositeTextSizes[0].evaluate(p,{},O),Nr*I.compositeTextSizes[1].evaluate(p,{},O)],(Z[0]>Kl||Z[1]>Kl)&&xn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,F,Z,y,f,p,T,e,x.lineStartIndex,x.lineLength,D,O);for(const J of E)A[J]=n.text.placedSymbolArray.length-1;return 4*F.length}function Eg(n){for(const e in n)return n[e];return null}function m_(n,e,i,o){const u=n.compareText;if(e in u){const f=u[e];for(let p=f.length-1;p>=0;p--)if(o.dist(f[p])<i)return!0}else u[e]=[];return u[e].push(o),!1}const Ag=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class og{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=Ag[15&o];if(!f)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new og(y,p,f,e)}constructor(e,i=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=Ag.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return lg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:p,nodeSize:y}=this,x=[0,f.length-1,0],T=[];for(;x.length;){const E=x.pop()||0,A=x.pop()||0,D=x.pop()||0;if(A-D<=y){for(let V=D;V<=A;V++){const Z=p[2*V],J=p[2*V+1];Z>=e&&Z<=o&&J>=i&&J<=u&&T.push(f[V])}continue}const I=D+A>>1,O=p[2*I],F=p[2*I+1];O>=e&&O<=o&&F>=i&&F<=u&&T.push(f[I]),(E===0?e<=O:i<=F)&&(x.push(D),x.push(I-1),x.push(1-E)),(E===0?o>=O:u>=F)&&(x.push(I+1),x.push(A),x.push(1-E))}return T}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:p}=this,y=[0,u.length-1,0],x=[],T=o*o;for(;y.length;){const E=y.pop()||0,A=y.pop()||0,D=y.pop()||0;if(A-D<=p){for(let V=D;V<=A;V++)zg(f[2*V],f[2*V+1],e,i)<=T&&x.push(u[V]);continue}const I=D+A>>1,O=f[2*I],F=f[2*I+1];zg(O,F,e,i)<=T&&x.push(u[I]),(E===0?e-o<=O:i-o<=F)&&(y.push(D),y.push(I-1),y.push(1-E)),(E===0?e+o>=O:i+o>=F)&&(y.push(I+1),y.push(A),y.push(1-E))}return x}}function lg(n,e,i,o,u,f){if(u-o<=i)return;const p=o+u>>1;Cg(n,e,p,o,u,f),lg(n,e,i,o,p-1,1-f),lg(n,e,i,p+1,u,1-f)}function Cg(n,e,i,o,u,f){for(;u>o;){if(u-o>600){const T=u-o+1,E=i-o+1,A=Math.log(T),D=.5*Math.exp(2*A/3),I=.5*Math.sqrt(A*D*(T-D)/T)*(E-T/2<0?-1:1);Cg(n,e,i,Math.max(o,Math.floor(i-E*D/T+I)),Math.min(u,Math.floor(i+(T-E)*D/T+I)),f)}const p=e[2*i+f];let y=o,x=u;for(Up(n,e,o,i),e[2*u+f]>p&&Up(n,e,o,u);y<x;){for(Up(n,e,y,x),y++,x--;e[2*y+f]<p;)y++;for(;e[2*x+f]>p;)x--}e[2*o+f]===p?Up(n,e,o,x):(x++,Up(n,e,x,u)),x<=i&&(o=x+1),i<=x&&(u=x-1)}}function Up(n,e,i,o){ug(n,i,o),ug(e,2*i,2*o),ug(e,2*i+1,2*o+1)}function ug(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function zg(n,e,i,o){const u=n-i,f=e-o;return u*u+f*f}var cg;P.cI=void 0,(cg=P.cI||(P.cI={})).create="create",cg.load="load",cg.fullLoad="fullLoad";let Xm=null,Gp=[];const hg=1e3/60,dg="loadTime",fg="fullLoadTime",g_={mark(n){performance.mark(n)},recordStartOfFrameAt(n){Xm!=null&&Gp.push(n-Xm),Xm=n},resetRuntimeMetrics(){Xm=null,Gp=[]},clearInitializationMetrics(){performance.clearMeasures(dg),performance.clearMeasures(fg);for(const n in P.cI)performance.clearMarks(P.cI[n])},remove(){this.resetRuntimeMetrics(),this.clearInitializationMetrics()},getPerformanceMetrics(){performance.measure(dg,P.cI.create,P.cI.load),performance.measure(fg,P.cI.create,P.cI.fullLoad);const n=performance.getEntriesByName(dg)[0].duration,e=performance.getEntriesByName(fg)[0].duration,i=Gp.length;return{loadTimeMs:n,fullLoadTimeMs:e,averageFramesPerSecond:1/(Gp.reduce(((o,u)=>o+u),0)/i/1e3),virtualDroppedFramesCount:Gp.filter((o=>o>hg)).reduce(((o,u)=>o+(u-hg)/hg),0),totalFramesCount:i}}};P.$=Ce,P.A=pt,P.B=Ir,P.C=Fn,P.D=ct,P.E=Be,P.F=function([n,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(i),y:n*Math.sin(e)*Math.sin(i),z:n*Math.cos(i)}},P.G=tn,P.H=Ai,P.I=ji,P.J=Pc,P.K=function(n){if(Wi==null){const e=n.navigator?n.navigator.userAgent:null;Wi=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Wi},P.L=class{constructor(n,e){this.target=n,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new yf((()=>this.process())),this.subscription=vl(this.target,"message",(i=>this.receive(i)),!1),this.globalScope=ar(self)?n:window}registerMessageHandler(n,e){this.messageHandlers[n]=e}unregisterMessageHandler(n){delete this.messageHandlers[n]}sendAsync(n,e){return new Promise(((i,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),f=e?vl(e.signal,"abort",(()=>{f?.unsubscribe(),delete this.resolveRejects[u];const x={id:u,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)}),Tp):null;this.resolveRejects[u]={resolve:x=>{f?.unsubscribe(),i(x)},reject:x=>{f?.unsubscribe(),o(x)}};const p=[],y=Object.assign(Object.assign({},n),{id:u,sourceMapId:this.mapId,origin:location.origin,data:Pr(n.data,p)});this.target.postMessage(y,{transfer:p})}))}receive(n){const e=n.data,i=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[i];const o=this.abortControllers[i];return delete this.abortControllers[i],void(o&&o.abort())}if(ar(self)||e.mustQueue)return this.tasks[i]=e,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,e)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),e=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(n,e)}processTask(n,e){return h(this,void 0,void 0,(function*(){if(e.type==="<response>"){const u=this.resolveRejects[n];return delete this.resolveRejects[n],u?void(e.error?u.reject(Vl(e.error)):u.resolve(Vl(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=Vl(e.data),o=new AbortController;this.abortControllers[n]=o;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,i,o);this.completeTask(n,null,u)}catch(u){this.completeTask(n,u)}}))}completeTask(n,e,i){const o=[];delete this.abortControllers[n];const u={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Pr(e):null,data:Pr(i,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},P.M=N,P.N=function(){var n=new pt(16);return pt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},P.O=function(n,e,i){var o,u,f,p,y,x,T,E,A,D,I,O,F=i[0],V=i[1],Z=i[2];return e===n?(n[12]=e[0]*F+e[4]*V+e[8]*Z+e[12],n[13]=e[1]*F+e[5]*V+e[9]*Z+e[13],n[14]=e[2]*F+e[6]*V+e[10]*Z+e[14],n[15]=e[3]*F+e[7]*V+e[11]*Z+e[15]):(u=e[1],f=e[2],p=e[3],y=e[4],x=e[5],T=e[6],E=e[7],A=e[8],D=e[9],I=e[10],O=e[11],n[0]=o=e[0],n[1]=u,n[2]=f,n[3]=p,n[4]=y,n[5]=x,n[6]=T,n[7]=E,n[8]=A,n[9]=D,n[10]=I,n[11]=O,n[12]=o*F+y*V+A*Z+e[12],n[13]=u*F+x*V+D*Z+e[13],n[14]=f*F+T*V+I*Z+e[14],n[15]=p*F+E*V+O*Z+e[15]),n},P.P=ge,P.Q=function(n,e,i){var o=i[0],u=i[1],f=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},P.R=za,P.S=function(n,e,i){var o=e[0],u=e[1],f=e[2],p=e[3],y=e[4],x=e[5],T=e[6],E=e[7],A=e[8],D=e[9],I=e[10],O=e[11],F=e[12],V=e[13],Z=e[14],J=e[15],q=i[0],Y=i[1],re=i[2],de=i[3];return n[0]=q*o+Y*y+re*A+de*F,n[1]=q*u+Y*x+re*D+de*V,n[2]=q*f+Y*T+re*I+de*Z,n[3]=q*p+Y*E+re*O+de*J,n[4]=(q=i[4])*o+(Y=i[5])*y+(re=i[6])*A+(de=i[7])*F,n[5]=q*u+Y*x+re*D+de*V,n[6]=q*f+Y*T+re*I+de*Z,n[7]=q*p+Y*E+re*O+de*J,n[8]=(q=i[8])*o+(Y=i[9])*y+(re=i[10])*A+(de=i[11])*F,n[9]=q*u+Y*x+re*D+de*V,n[10]=q*f+Y*T+re*I+de*Z,n[11]=q*p+Y*E+re*O+de*J,n[12]=(q=i[12])*o+(Y=i[13])*y+(re=i[14])*A+(de=i[15])*F,n[13]=q*u+Y*x+re*D+de*V,n[14]=q*f+Y*T+re*I+de*Z,n[15]=q*p+Y*E+re*O+de*J,n},P.T=Xd,P.U=function(n,e){const i={};for(let o=0;o<e.length;o++){const u=e[o];u in n&&(i[u]=n[u])}return i},P.V=wo,P.W=Zt,P.X=Sp,P.Y=Em,P.Z=Xs,P._=h,P.a=lu,P.a$=ii,P.a0=di,P.a1=bs,P.a2=Qa,P.a3=Cm,P.a4=Kh,P.a5=_t,P.a6=function(n,e,i){if(!n)return e||{};if(!e)return n||{};const o=Jh(n),u=Jh(e);(function(p,y){y.removeAll&&(p.add.clear(),p.update.clear(),p.remove.clear(),y.remove.clear());for(const x of y.remove)p.add.delete(x),p.update.delete(x);for(const[x,T]of y.update){const E=p.update.get(x);E&&(y.update.set(x,Ep(E,T)),p.update.delete(x))}})(o,u);const f={};if((o.removeAll||u.removeAll)&&(f.removeAll=!0),f.remove=new Set([...o.remove,...u.remove]),f.add=new Map([...o.add,...u.add]),f.update=new Map([...o.update,...u.update]),f.remove.size&&f.add.size)for(const p of f.add.keys())f.remove.delete(p);return(function(p){const y={};return p.removeAll&&(y.removeAll=p.removeAll),p.remove&&(y.remove=Array.from(p.remove)),p.add&&(y.add=Array.from(p.add.values())),p.update&&(y.update=Array.from(p.update.values())),y})(f)},P.a7=function(n,e){const i=new Map;if(n==null||n.type==null)return i;if(n.type==="Feature"){const o=Qh(n,e);return o==null?void 0:(i.set(o,n),i)}if(n.type==="FeatureCollection"){const o=new Set;for(const u of n.features){const f=Qh(u,e);if(f==null||o.has(f))return;o.add(f),i.set(f,u)}return i}},P.a8=function(n,e,i){var o,u;const f=[];if(e.removeAll)n.clear();else if(e.remove)for(const p of e.remove){const y=n.get(p);y&&(f.push(y.geometry),n.delete(p))}if(e.add)for(const p of e.add){const y=Qh(p,i);if(y==null)continue;const x=n.get(y);x&&f.push(x.geometry),f.push(p.geometry),n.set(y,p)}if(e.update)for(const p of e.update){const y=n.get(p.id);if(!y)continue;const x=!!p.newGeometry,T=p.removeAllProperties||((o=p.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=p.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0;if(!x&&!T)continue;f.push(y.geometry);const E=Object.assign({},y);if(n.set(p.id,E),x&&(f.push(p.newGeometry),E.geometry=p.newGeometry),T){if(E.properties=p.removeAllProperties?{}:Object.assign({},E.properties||{}),p.removeProperties)for(const A of p.removeProperties)delete E.properties[A];if(p.addOrUpdateProperties)for(const{key:A,value:D}of p.addOrUpdateProperties)E.properties[A]=D}}return f},P.a9=Pi,P.aA=function(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:u}){return n.kind==="source"?o/Nr:n.kind==="composite"?tn.number(o/Nr,u/Nr,i):e},P.aB=function(n,e){var i=e[0],o=e[1],u=e[2],f=e[3],p=e[4],y=e[5],x=e[6],T=e[7],E=e[8],A=e[9],D=e[10],I=e[11],O=e[12],F=e[13],V=e[14],Z=e[15],J=i*y-o*p,q=i*x-u*p,Y=i*T-f*p,re=o*x-u*y,de=o*T-f*y,Ae=u*T-f*x,Ne=E*F-A*O,Ve=E*V-D*O,Xe=E*Z-I*O,at=A*V-D*F,Qe=A*Z-I*F,Ue=D*Z-I*V,Oe=J*Ue-q*Qe+Y*at+re*Xe-de*Ve+Ae*Ne;return Oe?(n[0]=(y*Ue-x*Qe+T*at)*(Oe=1/Oe),n[1]=(u*Qe-o*Ue-f*at)*Oe,n[2]=(F*Ae-V*de+Z*re)*Oe,n[3]=(D*de-A*Ae-I*re)*Oe,n[4]=(x*Xe-p*Ue-T*Ve)*Oe,n[5]=(i*Ue-u*Xe+f*Ve)*Oe,n[6]=(V*Y-O*Ae-Z*q)*Oe,n[7]=(E*Ae-D*Y+I*q)*Oe,n[8]=(p*Qe-y*Xe+T*Ne)*Oe,n[9]=(o*Xe-i*Qe-f*Ne)*Oe,n[10]=(O*de-F*Y+Z*J)*Oe,n[11]=(A*Y-E*de-I*J)*Oe,n[12]=(y*Ve-p*at-x*Ne)*Oe,n[13]=(i*at-o*Ve+u*Ne)*Oe,n[14]=(F*q-O*re-V*J)*Oe,n[15]=(E*re-A*q+D*J)*Oe,n):null},P.aC=nt,P.aD=function(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)},P.aE=function(n){return n[0]=0,n[1]=0,n},P.aF=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n},P.aG=vp,P.aH=ni,P.aI=function(n,e,i,o){const u=e.y-n.y,f=e.x-n.x,p=o.y-i.y,y=o.x-i.x,x=p*f-y*u;if(x===0)return null;const T=(y*(n.y-i.y)-p*(n.x-i.x))/x;return new ge(n.x+T*f,n.y+T*u)},P.aJ=s,P.aK=Yu,P.aL=function(n){let e=1/0,i=1/0,o=-1/0,u=-1/0;for(const f of n)e=Math.min(e,f.x),i=Math.min(i,f.y),o=Math.max(o,f.x),u=Math.max(u,f.y);return[e,i,o,u]},P.aM=jn,P.aN=li,P.aO=function(n,e,i,o,u=!1){if(!i[0]&&!i[1])return[0,0];const f=u?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(f){const p=Math.sin(f),y=Math.cos(f);i=[i[0]*y-i[1]*p,i[0]*p+i[1]*y]}return[u?i[0]:li(e,i[0],n.zoom),u?i[1]:li(e,i[1],n.zoom)]},P.aQ=ff,P.aR=sg,P.aS=mp,P.aT=og,P.aU=nn,P.aV=Vh,P.aW=$,P.aX=rt,P.aY=De,P.aZ=Oa,P.a_=Mp,P.aa=Jl,P.ab=25,P.ac=ia,P.ad=n=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((i=>{e.onloadstart=()=>{i(e)};for(const o of n){const u=window.document.createElement("source");Me(o)||(e.crossOrigin="Anonymous"),u.src=o,e.appendChild(u)}}))},P.ae=We,P.af=function(){return Hi++},P.ag=d,P.ah=eh,P.ai=ru,P.aj=Ta,P.ak=Fr,P.al=bf,P.am=function(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,o,u,f)=>{const p=u||f;return e[o]=!p||p.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e},P.an=Ot,P.ao=85.051129,P.ap=Ln,P.aq=function(n){return Math.pow(2,n)},P.ar=$t,P.as=Am,P.at=function(n){return Math.log(n)/Math.LN2},P.au=function(n){var e=n[0],i=n[1];return e*e+i*i},P.av=function(n){if(!n.length)return new Set;const e=Math.max(...n.map((x=>x.canonical.z)));let i=1/0,o=-1/0,u=1/0,f=-1/0;const p=[];for(const x of n){const{x:T,y:E,z:A}=x.canonical,D=Math.pow(2,e-A),I=T*D,O=E*D;p.push({id:x,x:I,y:O}),I<i&&(i=I),I>o&&(o=I),O<u&&(u=O),O>f&&(f=O)}const y=new Set;for(const x of p)x.x!==i&&x.x!==o&&x.y!==u&&x.y!==f||y.add(x.id);return y},P.aw=function(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||o-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x},P.ax=class{constructor(n,e){this.max=n,this.onRemove=e,this.reset()}reset(){for(const n in this.data)for(const e of this.data[n])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(n,e,i){const o=n.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const u={value:e,timeout:void 0};if(i!==void 0&&(u.timeout=setTimeout((()=>{this.remove(n,u)}),i)),this.data[o].push(u),this.order.push(o),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const e=this.data[n].shift();return e.timeout&&clearTimeout(e.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),e.value}getByKey(n){const e=this.data[n];return e?e[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,e){if(!this.has(n))return this;const i=n.wrapped().key,o=e===void 0?0:this.data[i].indexOf(e),u=this.data[i][o];return this.data[i].splice(o,1),u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(u.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(n){const e=[];for(const i in this.data)for(const o of this.data[i])n(o.value)||e.push(o);for(const i of e)this.remove(i.value.tileID,i)}},P.ay=function(n,e){let i=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:p}=n,y=u?Ot(ma.interpolationFactor(u,e,f,p),0,1):0;n.kind==="camera"?o=tn.number(n.minSize,n.maxSize,y):i=y}return{uSizeT:i,uSize:o}},P.b=Zr,P.b$=Br,P.b0=Lt,P.b1=function(n){var e=new pt(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},P.b2=function(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n},P.b3=function(n,e){var i=e[0],o=e[1],u=e[2],f=i*i+o*o+u*u;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n},P.b4=gi,P.b5=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},P.b6=function(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n[3]=e[3]*i[3],n},P.b7=Pt,P.b8=function(n,e,i){const o=e[0]*i[0]+e[1]*i[1]+e[2]*i[2];return o===0?null:(-(n[0]*i[0]+n[1]*i[1]+n[2]*i[2])-i[3])/o},P.b9=Nt,P.bA=function(){return new Float64Array(3)},P.bB=Fe,P.bC=function(n,e,i){var o=i[0],u=i[1],f=i[2],p=i[3],y=e[0],x=e[1],T=e[2],E=u*T-f*x,A=f*y-o*T,D=o*x-u*y;return n[0]=y+p*(E+=E)+u*(D+=D)-f*(A+=A),n[1]=x+p*A+f*E-o*D,n[2]=T+p*D+o*A-u*E,n},P.bD=function(n,e,i){const o=(u=[n[0],n[1],n[2],e[0],e[1],e[2],i[0],i[1],i[2]])[0]*((E=u[8])*(p=u[4])-(y=u[5])*(T=u[7]))+u[1]*(-E*(f=u[3])+y*(x=u[6]))+u[2]*(T*f-p*x);var u,f,p,y,x,T,E;if(o===0)return null;const A=gi([],[e[0],e[1],e[2]],[i[0],i[1],i[2]]),D=gi([],[i[0],i[1],i[2]],[n[0],n[1],n[2]]),I=gi([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),O=ii([],A,-n[3]);return Lt(O,O,ii([],D,-e[3])),Lt(O,O,ii([],I,-i[3])),ii(O,O,1/o),O},P.bE=vf,P.bF=function(){return new Float64Array(4)},P.bG=function(n,e,i,o){var u=[],f=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],f[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),f[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),f[2]=u[2],n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},P.bH=function(n,e,i,o){var u=[],f=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],f[0]=u[0],f[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),f[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},P.bI=function(n,e,i,o){var u=[],f=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],f[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),f[1]=u[1],f[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},P.bJ=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[0],p=e[1],y=e[2],x=e[3],T=e[8],E=e[9],A=e[10],D=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u-T*o,n[1]=p*u-E*o,n[2]=y*u-A*o,n[3]=x*u-D*o,n[8]=f*o+T*u,n[9]=p*o+E*u,n[10]=y*o+A*u,n[11]=x*o+D*u,n},P.bK=function(n,e){const i=me(n,360),o=me(e,360),u=o-i,f=o>i?u-360:u+360;return Math.abs(u)<Math.abs(f)?u:f},P.bL=function(n){return n[0]=0,n[1]=0,n[2]=0,n},P.bM=function(n,e,i,o){const u=Math.sqrt(n*n+e*e),f=Math.sqrt(i*i+o*o);n/=u,e/=u,i/=f,o/=f;const p=Math.acos(n*i+e*o);return-e*i+n*o>0?p:-p},P.bN=function(n,e){const i=me(n,2*Math.PI),o=me(e,2*Math.PI);return Math.min(Math.abs(i-o),Math.abs(i-o+2*Math.PI),Math.abs(i-o-2*Math.PI))},P.bO=function(){const n={},e=le.$version;for(const i in le.$root){const o=le.$root[i];if(o.required){let u=null;u=i==="version"?e:o.type==="array"?[]:{},u!=null&&(n[i]=u)}}return n},P.bP=ie,P.bQ=kc,P.bR=function n(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(!n(e[o],i[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&i!==null){if(typeof i!="object"||Object.keys(e).length!==Object.keys(i).length)return!1;for(const o in e)if(!n(e[o],i[o]))return!1;return!0}return e===i},P.bS=function(n){n=n.slice();const e=Object.create(null);for(let i=0;i<n.length;i++)e[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=Bt(n[i],e[n[i].ref]));return n},P.bT=function(n,e){if(n.type==="custom")return new wp(n,e);switch(n.type){case"background":return new mi(n,e);case"circle":return new Zd(n,e);case"color-relief":return new em(n,e);case"fill":return new rm(n,e);case"fill-extrusion":return new lp(n,e);case"heatmap":return new Qp(n,e);case"hillshade":return new yn(n,e);case"line":return new cp(n,e);case"raster":return new Os(n,e);case"symbol":return new Ql(n,e)}},P.bU=n=>n.type==="raster",P.bV=Nn,P.bW=function(n,e){if(!n)return[{command:"setStyle",args:[e]}];let i=[];try{if(!Et(n.version,e.version))return[{command:"setStyle",args:[e]}];Et(n.center,e.center)||i.push({command:"setCenter",args:[e.center]}),Et(n.state,e.state)||i.push({command:"setGlobalState",args:[e.state]}),Et(n.centerAltitude,e.centerAltitude)||i.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Et(n.zoom,e.zoom)||i.push({command:"setZoom",args:[e.zoom]}),Et(n.bearing,e.bearing)||i.push({command:"setBearing",args:[e.bearing]}),Et(n.pitch,e.pitch)||i.push({command:"setPitch",args:[e.pitch]}),Et(n.roll,e.roll)||i.push({command:"setRoll",args:[e.roll]}),Et(n.sprite,e.sprite)||i.push({command:"setSprite",args:[e.sprite]}),Et(n.glyphs,e.glyphs)||i.push({command:"setGlyphs",args:[e.glyphs]}),Et(n.transition,e.transition)||i.push({command:"setTransition",args:[e.transition]}),Et(n.light,e.light)||i.push({command:"setLight",args:[e.light]}),Et(n.terrain,e.terrain)||i.push({command:"setTerrain",args:[e.terrain]}),Et(n.sky,e.sky)||i.push({command:"setSky",args:[e.sky]}),Et(n.projection,e.projection)||i.push({command:"setProjection",args:[e.projection]});const o={},u=[];(function(p,y,x,T){let E;for(E in y=y||{},p=p||{})Object.prototype.hasOwnProperty.call(p,E)&&(Object.prototype.hasOwnProperty.call(y,E)||Ft(E,x,T));for(E in y)Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(p,E)?Et(p[E],y[E])||(p[E].type==="geojson"&&y[E].type==="geojson"&&hn(p,y,E)?zt(x,{command:"setGeoJSONSourceData",args:[E,y[E].data]}):Ki(E,y,x,T)):Dt(E,y,x))})(n.sources,e.sources,u,o);const f=[];n.layers&&n.layers.forEach((p=>{"source"in p&&o[p.source]?i.push({command:"removeLayer",args:[p.id]}):f.push(p)})),i=i.concat(u),(function(p,y,x){y=y||[];const T=(p=p||[]).map(Qn),E=y.map(Qn),A=p.reduce(Qi,{}),D=y.reduce(Qi,{}),I=T.slice(),O=Object.create(null);let F,V,Z,J,q;for(let Y=0,re=0;Y<T.length;Y++)F=T[Y],Object.prototype.hasOwnProperty.call(D,F)?re++:(zt(x,{command:"removeLayer",args:[F]}),I.splice(I.indexOf(F,re),1));for(let Y=0,re=0;Y<E.length;Y++)F=E[E.length-1-Y],I[I.length-1-Y]!==F&&(Object.prototype.hasOwnProperty.call(A,F)?(zt(x,{command:"removeLayer",args:[F]}),I.splice(I.lastIndexOf(F,I.length-re),1)):re++,J=I[I.length-Y],zt(x,{command:"addLayer",args:[D[F],J]}),I.splice(I.length-Y,0,F),O[F]=!0);for(let Y=0;Y<E.length;Y++)if(F=E[Y],V=A[F],Z=D[F],!O[F]&&!Et(V,Z))if(Et(V.source,Z.source)&&Et(V["source-layer"],Z["source-layer"])&&Et(V.type,Z.type)){for(q in sn(V.layout,Z.layout,x,F,null,"setLayoutProperty"),sn(V.paint,Z.paint,x,F,null,"setPaintProperty"),Et(V.filter,Z.filter)||zt(x,{command:"setFilter",args:[F,Z.filter]}),Et(V.minzoom,Z.minzoom)&&Et(V.maxzoom,Z.maxzoom)||zt(x,{command:"setLayerZoomRange",args:[F,Z.minzoom,Z.maxzoom]}),V)Object.prototype.hasOwnProperty.call(V,q)&&q!=="layout"&&q!=="paint"&&q!=="filter"&&q!=="metadata"&&q!=="minzoom"&&q!=="maxzoom"&&(q.indexOf("paint.")===0?sn(V[q],Z[q],x,F,q.slice(6),"setPaintProperty"):Et(V[q],Z[q])||zt(x,{command:"setLayerProperty",args:[F,q,Z[q]]}));for(q in Z)Object.prototype.hasOwnProperty.call(Z,q)&&!Object.prototype.hasOwnProperty.call(V,q)&&q!=="layout"&&q!=="paint"&&q!=="filter"&&q!=="metadata"&&q!=="minzoom"&&q!=="maxzoom"&&(q.indexOf("paint.")===0?sn(V[q],Z[q],x,F,q.slice(6),"setPaintProperty"):Et(V[q],Z[q])||zt(x,{command:"setLayerProperty",args:[F,q,Z[q]]}))}else zt(x,{command:"removeLayer",args:[F]}),J=I[I.lastIndexOf(F)+1],zt(x,{command:"addLayer",args:[Z,J]})})(f,e.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:"setStyle",args:[e]}]}return i},P.bX=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},P.bY=Mr,P.bZ=qr,P.b_=class extends Aa{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},P.ba=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n},P.bb=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]},P.bc=zm,P.bd=ih,P.be=function(n,e,i,o,u){var f=1/Math.tan(e/2);if(n[0]=f/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,u!=null&&u!==1/0){var p=1/(o-u);n[10]=(u+o)*p,n[14]=2*u*o*p}else n[10]=-1,n[14]=-2*o;return n},P.bf=function(n){var e=new pt(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},P.bg=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[0],p=e[1],y=e[2],x=e[3],T=e[4],E=e[5],A=e[6],D=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u+T*o,n[1]=p*u+E*o,n[2]=y*u+A*o,n[3]=x*u+D*o,n[4]=T*u-f*o,n[5]=E*u-p*o,n[6]=A*u-y*o,n[7]=D*u-x*o,n},P.bh=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[4],p=e[5],y=e[6],x=e[7],T=e[8],E=e[9],A=e[10],D=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*u+T*o,n[5]=p*u+E*o,n[6]=y*u+A*o,n[7]=x*u+D*o,n[8]=T*u-f*o,n[9]=E*u-p*o,n[10]=A*u-y*o,n[11]=D*u-x*o,n},P.bi=function(){const n=new Float32Array(16);return $t(n),n},P.bj=function(){const n=new Float64Array(16);return $t(n),n},P.bk=function(){return new Float64Array(16)},P.bl=function(n,e,i){const o=new Float64Array(4);return Fe(o,n,e-90,i),o},P.bm=function(n,e,i,o){var u,f,p,y,x,T=e[0],E=e[1],A=e[2],D=e[3],I=i[0],O=i[1],F=i[2],V=i[3];return(f=T*I+E*O+A*F+D*V)<0&&(f=-f,I=-I,O=-O,F=-F,V=-V),1-f>ti?(u=Math.acos(f),p=Math.sin(u),y=Math.sin((1-o)*u)/p,x=Math.sin(o*u)/p):(y=1-o,x=o),n[0]=y*T+x*I,n[1]=y*E+x*O,n[2]=y*A+x*F,n[3]=y*D+x*V,n},P.bn=function(n){const e=new Float64Array(9);var i,o,u,f,p,y,x,T,E,A,D,I,O,F,V,Z,J,q;A=(u=(o=n)[0])*(x=u+u),D=(f=o[1])*x,O=(p=o[2])*x,F=p*(T=f+f),Z=(y=o[3])*x,J=y*T,q=y*(E=p+p),(i=e)[0]=1-(I=f*T)-(V=p*E),i[3]=D-q,i[6]=O+J,i[1]=D+q,i[4]=1-A-V,i[7]=F-Z,i[2]=O-J,i[5]=F+Z,i[8]=1-A-I;const Y=Oa(-Math.asin(Ot(e[2],-1,1)));let re,de;return Math.hypot(e[5],e[8])<.001?(re=0,de=-Oa(Math.atan2(e[3],e[4]))):(re=Oa(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),de=Oa(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:re,pitch:Y+90,bearing:de}},P.bo=function(n,e){return n.roll==e.roll&&n.pitch==e.pitch&&n.bearing==e.bearing},P.bp=Yt,P.bq=Jo,P.br=vr,P.bs=Vs,P.bt=ta,P.bu=Ze,P.bv=lt,P.bw=On,P.bx=function(n,e,i,o,u){return Ze(o,u,Ot((n-e)/(i-e),0,1))},P.by=function(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n},P.bz=me,P.c=xe,P.c$=class{constructor(n){this.start=`${n}#start`,this.end=`${n}#end`,this.measure=n,performance.mark(this.start)}finish(){performance.mark(this.end);let n=performance.getEntriesByName(this.measure);return n.length===0&&(performance.measure(this.measure,this.start,this.end),n=performance.getEntriesByName(this.measure),performance.clearMarks(this.start),performance.clearMarks(this.end),performance.clearMeasures(this.measure)),n}},P.c0=class extends Aa{constructor(n,e){super(n,e),this.current=Ca}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},P.c1=Hl,P.c2=class extends Aa{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},P.c3=class extends Aa{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},P.c4=si,P.c5=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},P.c6=function(n,e,i){var o=e[0],u=e[1],f=e[2];return n[0]=o*i[0]+u*i[3]+f*i[6],n[1]=o*i[1]+u*i[4]+f*i[7],n[2]=o*i[2]+u*i[5]+f*i[8],n},P.c7=function(n,e,i,o,u,f,p){var y=1/(e-i),x=1/(o-u),T=1/(f-p);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*T,n[11]=0,n[12]=(e+i)*y,n[13]=(u+o)*x,n[14]=(p+f)*T,n[15]=1,n},P.c8=class extends Aa{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(4*n.length);for(let i=0;i<n.length;i++)e[4*i]=n[i].r,e[4*i+1]=n[i].g,e[4*i+2]=n[i].b,e[4*i+3]=n[i].a;this.gl.uniform4fv(this.location,e)}}},P.c9=class extends Aa{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(n);this.gl.uniform1fv(this.location,e)}}},P.cA=function(n,e){var i;if(!ws[e])return!1;const o=n?.target,u=((i=o?.ownerDocument)===null||i===void 0?void 0:i.defaultView)||window;return n instanceof u.MouseEvent||n instanceof u.WheelEvent},P.cB=function(n,e){return xl[e]&&"touches"in n},P.cC=function(n){return xl[n]||ws[n]},P.cD=function(n,e,i){var o=e[0],u=e[1];return n[0]=i[0]*o+i[4]*u+i[12],n[1]=i[1]*o+i[5]*u+i[13],n},P.cE=function(n,e){const{x:i,y:o}=Pi.fromLngLat(e);return!(n<0||n>25||o<0||o>=1||i<0||i>=1)},P.cF=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},P.cG=class extends Yo{},P.cH=g_,P.cJ=U,P.cK=function(n,e){xe.REGISTERED_PROTOCOLS[n]=e},P.cL=function(n){delete xe.REGISTERED_PROTOCOLS[n]},P.cM=function(n,e){const i={};for(let u=0;u<n.length;u++){const f=e&&e[n[u].id]||zs(n[u]);e&&(e[n[u].id]=f);let p=i[f];p||(p=i[f]=[]),p.push(n[u])}const o=[];for(const u in i)o.push(i[u]);return o},P.cN=ut,P.cO=Ap,P.cP=Hm,P.cQ=cf,P.cR=function(n){var e;n.bucket.createArrays(),n.bucket.tilePixelRatio=_t/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const i=n.bucket.layers[0],o=i.layout,u=i._unevaluatedLayout._values,f={layoutIconSize:u["icon-size"].possiblyEvaluate(new Ai(n.bucket.zoom+1),n.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new Ai(n.bucket.zoom+1),n.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new Ai(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:A}=n.bucket.textSizeData;f.compositeTextSizes=[u["text-size"].possiblyEvaluate(new Ai(E),n.canonical),u["text-size"].possiblyEvaluate(new Ai(A),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:A}=n.bucket.iconSizeData;f.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new Ai(E),n.canonical),u["icon-size"].possiblyEvaluate(new Ai(A),n.canonical)]}const p=o.get("text-line-height")*jn,y=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",x=o.get("text-keep-upright"),T=o.get("text-size");for(const E of n.bucket.features){const A=o.get("text-font").evaluate(E,{},n.canonical).join(","),D=T.evaluate(E,{},n.canonical),I=f.layoutTextSize.evaluate(E,{},n.canonical),O=f.layoutIconSize.evaluate(E,{},n.canonical),F={horizontal:{},vertical:void 0},V=E.text;let Z,J=[0,0];if(V){const re=V.toString(),de=o.get("text-letter-spacing").evaluate(E,{},n.canonical)*jn,Ae=Oc(re)?de:0,Ne=o.get("text-anchor").evaluate(E,{},n.canonical),Ve=$m(i,E,n.canonical);if(!Ve){const Ue=o.get("text-radial-offset").evaluate(E,{},n.canonical);J=Ue?ml(Ne,[Ue*jn,Si]):o.get("text-offset").evaluate(E,{},n.canonical).map((Oe=>Oe*jn))}let Xe=y?"center":o.get("text-justify").evaluate(E,{},n.canonical);const at=o.get("symbol-placement")==="point"?o.get("text-max-width").evaluate(E,{},n.canonical)*jn:1/0,Qe=()=>{n.bucket.allowVerticalPlacement&&hs(re)&&(F.vertical=Xh(V,n.glyphMap,n.glyphPositions,n.imagePositions,A,at,p,Ne,"left",Ae,J,P.az.vertical,!0,I,D))};if(!y&&Ve){const Ue=new Set;if(Xe==="auto")for(let ft=0;ft<Ve.values.length;ft+=2)Ue.add(sg(Ve.values[ft]));else Ue.add(Xe);let Oe=!1;for(const ft of Ue)if(!F.horizontal[ft])if(Oe)F.horizontal[ft]=F.horizontal[0];else{const gt=Xh(V,n.glyphMap,n.glyphPositions,n.imagePositions,A,at,p,"center",ft,Ae,J,P.az.horizontal,!1,I,D);gt&&(F.horizontal[ft]=gt,Oe=gt.positionedLines.length===1)}Qe()}else{Xe==="auto"&&(Xe=sg(Ne));const Ue=Xh(V,n.glyphMap,n.glyphPositions,n.imagePositions,A,at,p,Ne,Xe,Ae,J,P.az.horizontal,!1,I,D);Ue&&(F.horizontal[Xe]=Ue),Qe(),hs(re)&&y&&x&&(F.vertical=Xh(V,n.glyphMap,n.glyphPositions,n.imagePositions,A,at,p,Ne,Xe,Ae,J,P.az.vertical,!1,I,D))}}let q=!1;if(E.icon&&E.icon.name){const re=n.imageMap[E.icon.name];re&&(Z=_p(n.imagePositions[E.icon.name],o.get("icon-offset").evaluate(E,{},n.canonical),o.get("icon-anchor").evaluate(E,{},n.canonical)),q=!!re.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=q:n.bucket.sdfIcons!==q&&xn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(re.pixelRatio!==n.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const Y=Eg(F.horizontal)||F.vertical;(e=n.bucket).iconsInText||(e.iconsInText=!!Y&&Y.iconsInText),(Y||Z)&&p_(n.bucket,E,F,Z,n.imageMap,f,I,O,J,q,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},P.cS=Ku,P.cT=Xl,P.cU=$c,P.cV=function(n){const e=new of;return(function(i,o){for(const u in i.layers)o.writeMessage(3,Of,i.layers[u])})(n,e),e.finish()},P.cW=function(n,e,i,o,u,f){let p=c(n,e,i,u,0);return p=c(p,e,o,f,1),p},P.cX=class{constructor(n){this.maxEntries=n,this.map=new Map}get(n){const e=this.map.get(n);return e!==void 0&&(this.map.delete(n),this.map.set(n,e)),e}set(n,e){if(this.map.has(n))this.map.delete(n);else if(this.map.size>=this.maxEntries){const i=this.map.keys().next().value;this.map.delete(i)}this.map.set(n,e)}clear(){this.map.clear()}},P.cY=pi,P.cZ=of,P.c_=Vp,P.ca=class extends Fs{},P.cb=cm,P.cc=class extends an{},P.cd=Rh,P.ce=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},P.cf=xo,P.cg=function(n,e,i){var o=e[0],u=e[1],f=e[2],p=i[3]*o+i[7]*u+i[11]*f+i[15];return n[0]=(i[0]*o+i[4]*u+i[8]*f+i[12])/(p=p||1),n[1]=(i[1]*o+i[5]*u+i[9]*f+i[13])/p,n[2]=(i[2]*o+i[6]*u+i[10]*f+i[14])/p,n},P.ch=class extends Wo{},P.ci=class extends t{},P.cj=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},P.ck=function(n,e){var i=n[0],o=n[1],u=n[2],f=n[3],p=n[4],y=n[5],x=n[6],T=n[7],E=n[8],A=n[9],D=n[10],I=n[11],O=n[12],F=n[13],V=n[14],Z=n[15],J=e[0],q=e[1],Y=e[2],re=e[3],de=e[4],Ae=e[5],Ne=e[6],Ve=e[7],Xe=e[8],at=e[9],Qe=e[10],Ue=e[11],Oe=e[12],ft=e[13],gt=e[14],St=e[15];return Math.abs(i-J)<=ti*Math.max(1,Math.abs(i),Math.abs(J))&&Math.abs(o-q)<=ti*Math.max(1,Math.abs(o),Math.abs(q))&&Math.abs(u-Y)<=ti*Math.max(1,Math.abs(u),Math.abs(Y))&&Math.abs(f-re)<=ti*Math.max(1,Math.abs(f),Math.abs(re))&&Math.abs(p-de)<=ti*Math.max(1,Math.abs(p),Math.abs(de))&&Math.abs(y-Ae)<=ti*Math.max(1,Math.abs(y),Math.abs(Ae))&&Math.abs(x-Ne)<=ti*Math.max(1,Math.abs(x),Math.abs(Ne))&&Math.abs(T-Ve)<=ti*Math.max(1,Math.abs(T),Math.abs(Ve))&&Math.abs(E-Xe)<=ti*Math.max(1,Math.abs(E),Math.abs(Xe))&&Math.abs(A-at)<=ti*Math.max(1,Math.abs(A),Math.abs(at))&&Math.abs(D-Qe)<=ti*Math.max(1,Math.abs(D),Math.abs(Qe))&&Math.abs(I-Ue)<=ti*Math.max(1,Math.abs(I),Math.abs(Ue))&&Math.abs(O-Oe)<=ti*Math.max(1,Math.abs(O),Math.abs(Oe))&&Math.abs(F-ft)<=ti*Math.max(1,Math.abs(F),Math.abs(ft))&&Math.abs(V-gt)<=ti*Math.max(1,Math.abs(V),Math.abs(gt))&&Math.abs(Z-St)<=ti*Math.max(1,Math.abs(Z),Math.abs(St))},P.cl=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},P.cm=n=>n.type==="symbol",P.cn=n=>n.type==="circle",P.co=n=>n.type==="heatmap",P.cp=n=>n.type==="line",P.cq=n=>n.type==="fill",P.cr=n=>n.type==="fill-extrusion",P.cs=n=>n.type==="hillshade",P.ct=n=>n.type==="color-relief",P.cu=n=>n.type==="background",P.cv=n=>n.type==="custom",P.cw=dt,P.cx=function(n,e,i){if(e<=0)return n;const o=1/e;return i===void 0||Math.abs(i)<1e-10?Math.round(n*o)/o:(i>0?Math.ceil(n*o-1e-9):Math.floor(n*o+1e-10))/o},P.cy=function(n,e,i){const o=ht(e.x-i.x,e.y-i.y),u=ht(n.x-i.x,n.y-i.y);var f,p;return Oa(Math.atan2(o[0]*u[1]-o[1]*u[0],(f=o)[0]*(p=u)[0]+f[1]*p[1]))},P.cz=Mt,P.d=Me,P.d0=function(n,e,i,o,u){return h(this,void 0,void 0,(function*(){if(di())try{return yield bs(n,e,i,o,u)}catch{}return(function(f,p,y,x,T){const E=f.width,A=f.height;Hr&&Er||(Hr=new OffscreenCanvas(E,A),Er=Hr.getContext("2d",{willReadFrequently:!0})),Hr.width=E,Hr.height=A,Er.drawImage(f,0,0,E,A);const D=Er.getImageData(p,y,x,T);return Er.clearRect(0,0,E,A),D.data})(n,e,i,o,u)}))},P.d1=Gc,P.d2=ke,P.d3=class{constructor(n,e){this.layers={[ru]:this},this.name=ru,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=n.length,this.features=n}feature(n){return new rg(this.features[n],this.extent)}},P.d4=Ol,P.d5=fr,P.e=Ui,P.f=n=>h(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(e)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),P.g=B,P.h=n=>new Promise(((e,i)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=$s}))},o.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(u):$s})),P.i=ar,P.j=(n,e)=>ue(Ui(n,{type:"json"}),e),P.k=He,P.l=Se,P.m=ue,P.n=(n,e)=>ue(Ui(n,{type:"arrayBuffer"}),e),P.o=function(n){return new of(n).readFields(vm,[])},P.p=pp,P.q=function(n){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))},P.r=Ph,P.s=vl,P.t=Tn,P.u=le,P.v=ku,P.w=xn,P.x=Fc,P.y=Dr,P.z=ks})),pe("worker",["./shared"],(function(P){class h{constructor(B,N){this.keyCache={},B&&this.replace(B,N)}replace(B,N){this._layerConfigs={},this._layers={},this.update(B,[],N)}update(B,N,U){for(const ue of B){this._layerConfigs[ue.id]=ue;const Me=this._layers[ue.id]=P.bT(ue,U);Me._featureFilter=P.aj(Me.filter,U),this.keyCache[ue.id]&&delete this.keyCache[ue.id]}for(const ue of N)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const ie=P.cM(Object.values(this._layerConfigs),this.keyCache);for(const ue of ie){const Me=ue.map((le=>this._layers[le.id])),Te=Me[0];if(Te.isHidden())continue;const be=Te.source||"";let Se=this.familiesBySource[be];Se||(Se=this.familiesBySource[be]={});const He=Te.sourceLayer||P.ai;let Be=Se[He];Be||(Be=Se[He]=[]),Be.push(Me)}}}class ge{constructor(B){const N={},U=[];for(const Te in B){const be=B[Te],Se=N[Te]={};for(const He in be){const Be=be[+He];if(!Be||Be.bitmap.width===0||Be.bitmap.height===0)continue;const le={x:0,y:0,w:Be.bitmap.width+2,h:Be.bitmap.height+2};U.push(le),Se[He]={rect:le,metrics:Be.metrics}}}const{w:ie,h:ue}=P.p(U),Me=new P.r({width:ie||1,height:ue||1});for(const Te in B){const be=B[Te];for(const Se in be){const He=be[+Se];if(!He||He.bitmap.width===0||He.bitmap.height===0)continue;const Be=N[Te][Se].rect;P.r.copy(He.bitmap,Me,{x:0,y:0},{x:Be.x+1,y:Be.y+1},He.bitmap)}}this.image=Me,this.positions=N}}P.cN("GlyphAtlas",ge);class ke{constructor(B){this.tileID=new P.a2(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.uid=B.uid,this.zoom=B.zoom,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.returnDependencies=!!B.returnDependencies,this.promoteId=B.promoteId,this.inFlightDependencies=[]}parse(B,N,U,ie,ue){return P._(this,void 0,void 0,(function*(){this.status="parsing",this.data=B,this.collisionBoxArray=new P.ag;const Me=new P.cO(Object.keys(B.layers).sort()),Te=new P.cP(this.tileID,this.promoteId);Te.bucketLayerIDs=[];const be={},Se={featureIndex:Te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:U,subdivisionGranularity:ue},He=N.familiesBySource[this.source];for(const _i in He){const qi=B.layers[_i];if(!qi)continue;qi.version===1&&P.w(`Vector tile source "${this.source}" layer "${_i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ba=Me.encode(_i),Ei=[];for(let Je=0;Je<qi.length;Je++){const Ct=qi.feature(Je),Gt=Te.getId(Ct,_i);Ei.push({feature:Ct,id:Gt,index:Je,sourceLayerIndex:ba})}for(const Je of He[_i]){const Ct=Je[0];Ct.source!==this.source&&P.w(`layer.source = ${Ct.source} does not equal this.source = ${this.source}`),Ct.isHidden(this.zoom,!0)||(st(Je,this.zoom,U),(be[Ct.id]=Ct.createBucket({index:Te.bucketLayerIDs.length,layers:Je,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ba,sourceID:this.source})).populate(Ei,Se,this.tileID.canonical),Te.bucketLayerIDs.push(Je.map((Gt=>Gt.id))))}}const Be=P.bY(Se.glyphDependencies,(_i=>Object.keys(_i).map(Number)));this.inFlightDependencies.forEach((_i=>_i?.abort())),this.inFlightDependencies=[];let le=Promise.resolve({});if(Object.keys(Be).length){const _i=new AbortController;this.inFlightDependencies.push(_i),le=ie.sendAsync({type:"GG",data:{stacks:Be,source:this.source,tileID:this.tileID,type:"glyphs"}},_i)}const mt=Object.keys(Se.iconDependencies);let Bt=Promise.resolve({});if(mt.length){const _i=new AbortController;this.inFlightDependencies.push(_i),Bt=ie.sendAsync({type:"GI",data:{icons:mt,source:this.source,tileID:this.tileID,type:"icons"}},_i)}const Et=Object.keys(Se.patternDependencies);let zt=Promise.resolve({});if(Et.length){const _i=new AbortController;this.inFlightDependencies.push(_i),zt=ie.sendAsync({type:"GI",data:{icons:Et,source:this.source,tileID:this.tileID,type:"patterns"}},_i)}const Dt=Se.dashDependencies;let Ft=Promise.resolve({});if(Object.keys(Dt).length){const _i=new AbortController;this.inFlightDependencies.push(_i),Ft=ie.sendAsync({type:"GDA",data:{dashes:Dt}},_i)}const[Ki,hn,sn,Qn]=yield Promise.all([le,Bt,zt,Ft]),Qi=new ge(Ki),We=new P.cQ(hn,sn);for(const _i in be){const qi=be[_i];qi instanceof P.ah?(st(qi.layers,this.zoom,U),P.cR({bucket:qi,glyphMap:Ki,glyphPositions:Qi.positions,imageMap:hn,imagePositions:We.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Se.subdivisionGranularity})):qi.hasDependencies&&(qi instanceof P.cS||qi instanceof P.cT||qi instanceof P.cU)&&(st(qi.layers,this.zoom,U),qi.addFeatures(Se,this.tileID.canonical,We.patternPositions,Qn))}return this.status="done",{buckets:Object.values(be).filter((_i=>!_i.isEmpty())),featureIndex:Te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Qi.image,imageAtlas:We,dashPositions:Qn,glyphMap:this.returnDependencies?Ki:null,iconMap:this.returnDependencies?hn:null,glyphPositions:this.returnDependencies?Qi.positions:null}}))}}function st(xe,B,N){const U=new P.H(B);for(const ie of xe)ie.recalculate(U,N)}class Ye{constructor(){this.loading={},this.loaded={},this.parsing={}}startLoading(B,N){this.loading[B]=N}finishLoading(B){delete this.loading[B]}abort(B){const N=this.loading[B];N?.abort&&(N.abort.abort(),delete this.loading[B])}setParsing(B,N){this.parsing[B]=N}consumeParsing(B){const N=this.parsing[B];if(N)return delete this.parsing[B],N}clearParsing(B){delete this.parsing[B]}markLoaded(B,N){this.loaded[B]=N}getLoaded(B){const N=this.loaded[B];if(N)return N}removeLoaded(B){delete this.loaded[B]}clearLoaded(){this.loaded={}}}class xt{constructor(B,N,U,ie,ue){this.type=B,this.properties=U||{},this.extent=ue,this.pointsArray=N,this.id=ie}loadGeometry(){return this.pointsArray.map((B=>B.map((N=>new P.P(N.x,N.y)))))}}class Tt{constructor(B,N,U){this.version=2,this._myFeatures=B,this.name=N,this.length=B.length,this.extent=U}feature(B){return this._myFeatures[B]}}class ui{constructor(){this.layers={}}addLayer(B){this.layers[B.name]=B}}function bt(xe){let B=P.cV(xe);return B.byteOffset===0&&B.byteLength===B.buffer.byteLength||(B=new Uint8Array(B)),{vectorTile:xe,rawData:B.buffer}}function Ce(xe,B,N){const{extent:U}=xe,ie=Math.pow(2,N.z-B.z),ue=(N.x-B.x*ie)*U,Me=(N.y-B.y*ie)*U,Te=[];for(let be=0;be<xe.length;be++){const Se=xe.feature(be);let He=Se.loadGeometry();for(const le of He)for(const mt of le)mt.x=mt.x*ie-ue,mt.y=mt.y*ie-Me;const Be=128;He=P.cW(He,Se.type,-Be,-Be,U+Be,U+Be),He.length!==0&&Te.push(new xt(Se.type,He,Se.properties,Se.id,U))}return new Tt(Te,xe.name,U)}class di{constructor(B,N,U){this.actor=B,this.layerIndex=N,this.availableImages=U,this.tileState=new Ye,this.overzoomedTileResultCache=new P.cX(1e3)}loadVectorTile(B,N){return P._(this,void 0,void 0,(function*(){const U=yield P.n(B.request,N);try{return{vectorTile:B.encoding!=="mlt"?new P.cY(new P.cZ(U.data)):new P.c_(U.data),rawData:U.data,cacheControl:U.cacheControl,expires:U.expires}}catch(ie){const ue=new Uint8Array(U.data);let Me=`Unable to parse the tile at ${B.request.url}, `;throw Me+=ue[0]===31&&ue[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ie.message}`,new Error(Me)}}))}loadTile(B){return P._(this,void 0,void 0,(function*(){const{uid:N,overzoomParameters:U}=B;U&&(B.request=U.overzoomRequest);const ie=this._startRequestTiming(B),ue=new ke(B);this.tileState.startLoading(N,ue);const Me=new AbortController;ue.abort=Me;try{const Te=yield this.loadVectorTile(B,Me);if(this.tileState.finishLoading(N),!Te)return null;let{vectorTile:be,rawData:Se}=Te;U&&({vectorTile:be,rawData:Se}=this._getOverzoomTile(B,Te.vectorTile));const He=this._getExpiryData(Te),Be=this._finishRequestTiming(ie);ue.vectorTile=be,this.tileState.markLoaded(N,ue);const le={rawData:Se,cacheControl:He,resourceTiming:Be};this.tileState.setParsing(N,le);try{return yield this._parseWorkerTile(ue,B,le)}finally{this.tileState.clearParsing(N)}}catch(Te){throw this.tileState.finishLoading(N),ue.status="done",this.tileState.markLoaded(N,ue),Te}}))}_parseWorkerTile(B,N,U){return P._(this,void 0,void 0,(function*(){let ie=yield B.parse(B.vectorTile,this.layerIndex,this.availableImages,this.actor,N.subdivisionGranularity);if(U){const{rawData:ue,cacheControl:Me,resourceTiming:Te}=U;ie=P.e({rawTileData:ue.slice(0),encoding:N.encoding},ie,Me,Te)}return ie}))}_getExpiryData(B){const{expires:N,cacheControl:U}=B,ie={};return N&&(ie.expires=N),U&&(ie.cacheControl=U),ie}_startRequestTiming(B){var N;if(!((N=B.request)===null||N===void 0)&&N.collectResourceTiming)return new P.c$(B.request.url)}_finishRequestTiming(B){const N=B?.finish();return N?{resourceTiming:JSON.parse(JSON.stringify(N))}:{}}_getOverzoomTile(B,N){const{tileID:U,source:ie,overzoomParameters:ue}=B,{maxZoomTileID:Me}=ue,Te=`${Me.key}_${U.key}`,be=this.overzoomedTileResultCache.get(Te);if(be)return be;const Se=new ui,He=this.layerIndex.familiesBySource[ie];for(const le in He){const mt=N.layers[le];if(!mt)continue;const Bt=Ce(mt,Me,U.canonical);Bt.length>0&&Se.addLayer(Bt)}const Be=bt(Se);return this.overzoomedTileResultCache.set(Te,Be),Be}reloadTile(B){return P._(this,void 0,void 0,(function*(){const N=B.uid,U=this.tileState.getLoaded(N);if(!U)throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");if(U.showCollisionBoxes=B.showCollisionBoxes,U.status==="parsing"){const ie=this.tileState.consumeParsing(N);return yield this._parseWorkerTile(U,B,ie)}if(U.status==="done"&&U.vectorTile)return yield this._parseWorkerTile(U,B)}))}abortTile(B){return P._(this,void 0,void 0,(function*(){this.tileState.abort(B.uid)}))}removeTile(B){return P._(this,void 0,void 0,(function*(){this.tileState.removeLoaded(B.uid)}))}}class ti{constructor(){this.loaded={}}loadTile(B){return P._(this,void 0,void 0,(function*(){const{uid:N,encoding:U,rawImageData:ie,redFactor:ue,greenFactor:Me,blueFactor:Te,baseShift:be}=B,Se=ie.width+2,He=ie.height+2,Be=P.b(ie)?new P.R({width:Se,height:He},yield P.d0(ie,-1,-1,Se,He)):ie,le=new P.d1(N,Be,U,ue,Me,Te,be);return this.loaded=this.loaded||{},this.loaded[N]=le,le}))}removeTile(B){const N=this.loaded,U=B.uid;N&&N[U]&&delete N[U]}}var pt,si,$t=(function(){if(si)return pt;function xe(N,U){if(N.length!==0){B(N[0],U);for(var ie=1;ie<N.length;ie++)B(N[ie],!U)}}function B(N,U){for(var ie=0,ue=0,Me=0,Te=N.length,be=Te-1;Me<Te;be=Me++){var Se=(N[Me][0]-N[be][0])*(N[be][1]+N[Me][1]),He=ie+Se;ue+=Math.abs(ie)>=Math.abs(Se)?ie-He+Se:Se-He+ie,ie=He}ie+ue>=0!=!!U&&N.reverse()}return si=1,pt=function N(U,ie){var ue,Me=U&&U.type;if(Me==="FeatureCollection")for(ue=0;ue<U.features.length;ue++)N(U.features[ue],ie);else if(Me==="GeometryCollection")for(ue=0;ue<U.geometries.length;ue++)N(U.geometries[ue],ie);else if(Me==="Feature")N(U.geometry,ie);else if(Me==="Polygon")xe(U.coordinates,ie);else if(Me==="MultiPolygon")for(ue=0;ue<U.coordinates.length;ue++)xe(U.coordinates[ue],ie);return U}})(),Mi=P.d2($t);const Pt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:xe=>xe},Kt=Math.fround||(Lt=new Float32Array(1),xe=>(Lt[0]=+xe,Lt[0]));var Lt;class ii{constructor(B){this.options=Object.assign(Object.create(Pt),B),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(B){const{log:N,minZoom:U,maxZoom:ie}=this.options;N&&console.time("total time");const ue=`prepare ${B.length} points`;N&&console.time(ue),this.points=B;const Me=[];for(let be=0;be<B.length;be++){const Se=B[be];if(!Se.geometry)continue;const[He,Be]=Se.geometry.coordinates,le=Kt(Nt(He)),mt=Kt(ni(Be));Me.push(le,mt,1/0,be,-1,1),this.options.reduce&&Me.push(0)}let Te=this.trees[ie+1]=this._createTree(Me);N&&console.timeEnd(ue);for(let be=ie;be>=U;be--){const Se=+Date.now();Te=this.trees[be]=this._createTree(this._cluster(Te,be)),N&&console.log("z%d: %d clusters in %dms",be,Te.numItems,+Date.now()-Se)}return N&&console.timeEnd("total time"),this}getClusters(B,N){let U=((B[0]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,B[1]));let ue=B[2]===180?180:((B[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)U=-180,ue=180;else if(U>ue){const Be=this.getClusters([U,ie,180,Me],N),le=this.getClusters([-180,ie,ue,Me],N);return Be.concat(le)}const Te=this.trees[this._limitZoom(N)],be=Te.range(Nt(U),ni(Me),Nt(ue),ni(ie)),Se=Te.data,He=[];for(const Be of be){const le=this.stride*Be;He.push(Se[le+5]>1?gi(Se,le,this.clusterProps):this.points[Se[le+3]])}return He}getChildren(B){const N=this._getOriginId(B),U=this._getOriginZoom(B),ie="No cluster with the specified id.",ue=this.trees[U];if(!ue)throw new Error(ie);const Me=ue.data;if(N*this.stride>=Me.length)throw new Error(ie);const Te=this.options.radius/(this.options.extent*Math.pow(2,U-1)),be=ue.within(Me[N*this.stride],Me[N*this.stride+1],Te),Se=[];for(const He of be){const Be=He*this.stride;Me[Be+4]===B&&Se.push(Me[Be+5]>1?gi(Me,Be,this.clusterProps):this.points[Me[Be+3]])}if(Se.length===0)throw new Error(ie);return Se}getLeaves(B,N,U){const ie=[];return this._appendLeaves(ie,B,N=N||10,U=U||0,0),ie}getTile(B,N,U){const ie=this.trees[this._limitZoom(B)],ue=Math.pow(2,B),{extent:Me,radius:Te}=this.options,be=Te/Me,Se=(U-be)/ue,He=(U+1+be)/ue,Be={features:[]};return this._addTileFeatures(ie.range((N-be)/ue,Se,(N+1+be)/ue,He),ie.data,N,U,ue,Be),N===0&&this._addTileFeatures(ie.range(1-be/ue,Se,1,He),ie.data,ue,U,ue,Be),N===ue-1&&this._addTileFeatures(ie.range(0,Se,be/ue,He),ie.data,-1,U,ue,Be),Be.features.length?Be:null}getClusterExpansionZoom(B){let N=this._getOriginZoom(B)-1;for(;N<=this.options.maxZoom;){const U=this.getChildren(B);if(N++,U.length!==1)break;B=U[0].properties.cluster_id}return N}_appendLeaves(B,N,U,ie,ue){const Me=this.getChildren(N);for(const Te of Me){const be=Te.properties;if(be&&be.cluster?ue+be.point_count<=ie?ue+=be.point_count:ue=this._appendLeaves(B,be.cluster_id,U,ie,ue):ue<ie?ue++:B.push(Te),B.length===U)break}return ue}_createTree(B){const N=new P.aT(B.length/this.stride|0,this.options.nodeSize,Float32Array);for(let U=0;U<B.length;U+=this.stride)N.add(B[U],B[U+1]);return N.finish(),N.data=B,N}_addTileFeatures(B,N,U,ie,ue,Me){for(const Te of B){const be=Te*this.stride,Se=N[be+5]>1;let He,Be,le;if(Se)He=kt(N,be,this.clusterProps),Be=N[be],le=N[be+1];else{const Et=this.points[N[be+3]];He=Et.properties;const[zt,Dt]=Et.geometry.coordinates;Be=Nt(zt),le=ni(Dt)}const mt={type:1,geometry:[[Math.round(this.options.extent*(Be*ue-U)),Math.round(this.options.extent*(le*ue-ie))]],tags:He};let Bt;Bt=Se||this.options.generateId?N[be+3]:this.points[N[be+3]].id,Bt!==void 0&&(mt.id=Bt),Me.features.push(mt)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,N){const{radius:U,extent:ie,reduce:ue,minPoints:Me}=this.options,Te=U/(ie*Math.pow(2,N)),be=B.data,Se=[],He=this.stride;for(let Be=0;Be<be.length;Be+=He){if(be[Be+2]<=N)continue;be[Be+2]=N;const le=be[Be],mt=be[Be+1],Bt=B.within(be[Be],be[Be+1],Te),Et=be[Be+5];let zt=Et;for(const Dt of Bt){const Ft=Dt*He;be[Ft+2]>N&&(zt+=be[Ft+5])}if(zt>Et&&zt>=Me){let Dt,Ft=le*Et,Ki=mt*Et,hn=-1;const sn=(Be/He<<5)+(N+1)+this.points.length;for(const Qn of Bt){const Qi=Qn*He;if(be[Qi+2]<=N)continue;be[Qi+2]=N;const We=be[Qi+5];Ft+=be[Qi]*We,Ki+=be[Qi+1]*We,be[Qi+4]=sn,ue&&(Dt||(Dt=this._map(be,Be,!0),hn=this.clusterProps.length,this.clusterProps.push(Dt)),ue(Dt,this._map(be,Qi)))}be[Be+4]=sn,Se.push(Ft/zt,Ki/zt,1/0,sn,-1,zt),ue&&Se.push(hn)}else{for(let Dt=0;Dt<He;Dt++)Se.push(be[Be+Dt]);if(zt>1)for(const Dt of Bt){const Ft=Dt*He;if(!(be[Ft+2]<=N)){be[Ft+2]=N;for(let Ki=0;Ki<He;Ki++)Se.push(be[Ft+Ki])}}}}return Se}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,N,U){if(B[N+5]>1){const Me=this.clusterProps[B[N+6]];return U?Object.assign({},Me):Me}const ie=this.points[B[N+3]].properties,ue=this.options.map(ie);return U&&ue===ie?Object.assign({},ue):ue}}function gi(xe,B,N){return{type:"Feature",id:xe[B+3],properties:kt(xe,B,N),geometry:{type:"Point",coordinates:[(U=xe[B],360*(U-.5)),Vi(xe[B+1])]}};var U}function kt(xe,B,N){const U=xe[B+5],ie=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U,ue=xe[B+6],Me=ue===-1?{}:Object.assign({},N[ue]);return Object.assign(Me,{cluster:!0,cluster_id:xe[B+3],point_count:U,point_count_abbreviated:ie})}function Nt(xe){return xe/360+.5}function ni(xe){const B=Math.sin(xe*Math.PI/180),N=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return N<0?0:N>1?1:N}function Vi(xe){const B=(180-360*xe)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function Fe(xe,B,N,U){let ie=U;const ue=B+(N-B>>1);let Me,Te=N-B;const be=xe[B],Se=xe[B+1],He=xe[N],Be=xe[N+1];for(let le=B+3;le<N;le+=3){const mt=nt(xe[le],xe[le+1],be,Se,He,Be);if(mt>ie)Me=le,ie=mt;else if(mt===ie){const Bt=Math.abs(le-ue);Bt<Te&&(Me=le,Te=Bt)}}ie>U&&(Me-B>3&&Fe(xe,B,Me,U),xe[Me+2]=ie,N-Me>3&&Fe(xe,Me,N,U))}function nt(xe,B,N,U,ie,ue){let Me=ie-N,Te=ue-U;if(Me!==0||Te!==0){const be=((xe-N)*Me+(B-U)*Te)/(Me*Me+Te*Te);be>1?(N=ie,U=ue):be>0&&(N+=Me*be,U+=Te*be)}return Me=xe-N,Te=B-U,Me*Me+Te*Te}function ht(xe,B,N,U){const ie={type:B,geom:N},ue={id:xe??null,type:ie.type,geometry:ie.geom,tags:U,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(ie.type){case"Point":case"MultiPoint":case"LineString":_t(ue,ie.geom);break;case"Polygon":_t(ue,ie.geom[0]);break;case"MultiLineString":for(const Me of ie.geom)_t(ue,Me);break;case"MultiPolygon":for(const Me of ie.geom)_t(ue,Me[0])}return ue}function _t(xe,B){for(let N=0;N<B.length;N+=3)xe.minX=Math.min(xe.minX,B[N]),xe.minY=Math.min(xe.minY,B[N+1]),xe.maxX=Math.max(xe.maxX,B[N]),xe.maxY=Math.max(xe.maxY,B[N+1])}function li(xe,B){const N=[];switch(xe.type){case"FeatureCollection":for(let U=0;U<xe.features.length;U++)me(N,xe.features[U],B,U);break;case"Feature":me(N,xe,B);break;default:me(N,{geometry:xe,properties:void 0},B)}return N}function me(xe,B,N,U){if(!B.geometry)return;if(B.geometry.type==="GeometryCollection"){for(const Te of B.geometry.geometries)me(xe,{id:B.id,geometry:Te,properties:B.properties},N,U);return}if(!B.geometry.coordinates?.length)return;const ue=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2);let Me=B.id;switch(N.promoteId?Me=B.properties?.[N.promoteId]:N.generateId&&(Me=U||0),B.geometry.type){case"Point":{const Te=[];return Ze(B.geometry.coordinates,Te),void xe.push(ht(Me,B.geometry.type,Te,B.properties))}case"MultiPoint":{const Te=[];for(const be of B.geometry.coordinates)Ze(be,Te);return void xe.push(ht(Me,B.geometry.type,Te,B.properties))}case"LineString":{const Te=[];return lt(B.geometry.coordinates,Te,ue,!1),void xe.push(ht(Me,B.geometry.type,Te,B.properties))}case"MultiLineString":{if(N.lineMetrics){for(const be of B.geometry.coordinates){const Se=[];lt(be,Se,ue,!1),xe.push(ht(Me,"LineString",Se,B.properties))}return}const Te=[];return dt(B.geometry.coordinates,Te,ue,!1),void xe.push(ht(Me,B.geometry.type,Te,B.properties))}case"Polygon":{const Te=[];return dt(B.geometry.coordinates,Te,ue,!0),void xe.push(ht(Me,B.geometry.type,Te,B.properties))}case"MultiPolygon":{const Te=[];for(const be of B.geometry.coordinates){const Se=[];dt(be,Se,ue,!0),Te.push(Se)}return void xe.push(ht(Me,B.geometry.type,Te,B.properties))}default:throw new Error("Input data is not a valid GeoJSON object.")}}function Ze(xe,B){B.push(Mt(xe[0]),Ot(xe[1]),0)}function lt(xe,B,N,U){let ie,ue,Me=0;for(let be=0;be<xe.length;be++){const Se=Mt(xe[be][0]),He=Ot(xe[be][1]);B.push(Se,He,0),be>0&&(Me+=U?(ie*He-Se*ue)/2:Math.sqrt(Math.pow(Se-ie,2)+Math.pow(He-ue,2))),ie=Se,ue=He}const Te=B.length-3;B[2]=1,N>0&&Fe(B,0,Te,N),B[Te+2]=1,B.size=Math.abs(Me),B.start=0,B.end=B.size}function dt(xe,B,N,U){for(let ie=0;ie<xe.length;ie++){const ue=[];lt(xe[ie],ue,N,U),B.push(ue)}}function Mt(xe){return xe/360+.5}function Ot(xe){const B=Math.sin(xe*Math.PI/180),N=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return N<0?0:N>1?1:N}function Zt(xe,B,N,U,ie,ue,Me,Te){if(U/=B,ue>=(N/=B)&&Me<U)return xe;if(Me<N||ue>=U)return null;const be=[];for(const Se of xe){const He=ie===0?Se.minX:Se.minY,Be=ie===0?Se.maxX:Se.maxY;if(He>=N&&Be<U)be.push(Se);else if(!(Be<N||He>=U))switch(Se.type){case"Point":case"MultiPoint":{const le=[];if(Ui(Se.geometry,le,N,U,ie),!le.length)continue;be.push(ht(Se.id,le.length===3?"Point":"MultiPoint",le,Se.tags));continue}case"LineString":{const le=[];if(Hi(Se.geometry,le,N,U,ie,!1,Te.lineMetrics),!le.length)continue;if(Te.lineMetrics){for(const mt of le)be.push(ht(Se.id,Se.type,mt,Se.tags));continue}if(le.length>1){be.push(ht(Se.id,"MultiLineString",le,Se.tags));continue}be.push(ht(Se.id,Se.type,le[0],Se.tags));continue}case"MultiLineString":{const le=[];if(qr(Se.geometry,le,N,U,ie,!1),!le.length)continue;if(le.length===1){be.push(ht(Se.id,"LineString",le[0],Se.tags));continue}be.push(ht(Se.id,Se.type,le,Se.tags));continue}case"Polygon":{const le=[];if(qr(Se.geometry,le,N,U,ie,!0),!le.length)continue;be.push(ht(Se.id,Se.type,le,Se.tags));continue}case"MultiPolygon":{const le=[];for(const mt of Se.geometry){const Bt=[];qr(mt,Bt,N,U,ie,!0),Bt.length&&le.push(Bt)}if(!le.length)continue;be.push(ht(Se.id,Se.type,le,Se.tags));continue}}}return be.length?be:null}function Ui(xe,B,N,U,ie){for(let ue=0;ue<xe.length;ue+=3){const Me=xe[ue+ie];Me>=N&&Me<=U&&Nn(B,xe[ue],xe[ue+1],xe[ue+2])}}function Hi(xe,B,N,U,ie,ue,Me){let Te=Mr(xe);const be=ie===0?ou:xn;let Se,He,Be=xe.start;for(let zt=0;zt<xe.length-3;zt+=3){const Dt=xe[zt],Ft=xe[zt+1],Ki=xe[zt+2],hn=xe[zt+3],sn=xe[zt+4],Qn=ie===0?Dt:Ft,Qi=ie===0?hn:sn;let We=!1;Me&&(Se=Math.sqrt(Math.pow(Dt-hn,2)+Math.pow(Ft-sn,2))),Qn<N?Qi>N&&(He=be(Te,Dt,Ft,hn,sn,N),Me&&(Te.start=Be+Se*He)):Qn>U?Qi<U&&(He=be(Te,Dt,Ft,hn,sn,U),Me&&(Te.start=Be+Se*He)):Nn(Te,Dt,Ft,Ki),Qi<N&&Qn>=N&&(He=be(Te,Dt,Ft,hn,sn,N),We=!0),Qi>U&&Qn<=U&&(He=be(Te,Dt,Ft,hn,sn,U),We=!0),!ue&&We&&(Me&&(Te.end=Be+Se*He),B.push(Te),Te=Mr(xe)),Me&&(Be+=Se)}let le=xe.length-3;const mt=xe[le],Bt=xe[le+1],Et=ie===0?mt:Bt;Et>=N&&Et<=U&&Nn(Te,mt,Bt,xe[le+2]),le=Te.length-3,ue&&le>=3&&(Te[le]!==Te[0]||Te[le+1]!==Te[1])&&Nn(Te,Te[0],Te[1],Te[2]),Te.length&&B.push(Te)}function Mr(xe){const B=[];return B.size=xe.size,B.start=xe.start,B.end=xe.end,B}function qr(xe,B,N,U,ie,ue){for(const Me of xe)Hi(Me,B,N,U,ie,ue,!1)}function Nn(xe,B,N,U){xe.push(B,N,U)}function ou(xe,B,N,U,ie,ue){const Me=(ue-B)/(U-B);return Nn(xe,ue,N+(ie-N)*Me,1),Me}function xn(xe,B,N,U,ie,ue){const Me=(ue-N)/(ie-N);return Nn(xe,B+(U-B)*Me,ue,1),Me}function ca(xe,B){const N=B.buffer/B.extent;let U=xe;const ie=Zt(xe,1,-1-N,N,0,-1,2,B),ue=Zt(xe,1,1-N,2+N,0,-1,2,B);return(ie||ue)&&(U=Zt(xe,1,-N,1+N,0,-1,2,B)||[],ie&&(U=ar(ie,1).concat(U)),ue&&(U=U.concat(ar(ue,-1)))),U}function ar(xe,B){const N=[];for(const U of xe)switch(U.type){case"Point":case"MultiPoint":case"LineString":{const ie=Wi(U.geometry,B);N.push(ht(U.id,U.type,ie,U.tags));continue}case"MultiLineString":case"Polygon":{const ie=[];for(const ue of U.geometry)ie.push(Wi(ue,B));N.push(ht(U.id,U.type,ie,U.tags));continue}case"MultiPolygon":{const ie=[];for(const ue of U.geometry){const Me=[];for(const Te of ue)Me.push(Wi(Te,B));ie.push(Me)}N.push(ht(U.id,U.type,ie,U.tags));continue}}return N}function Wi(xe,B){const N=[];N.size=xe.size,xe.start!==void 0&&(N.start=xe.start,N.end=xe.end);for(let U=0;U<xe.length;U+=3)N.push(xe[U]+B,xe[U+1],xe[U+2]);return N}function Zr(xe,B){if(xe.transformed)return xe;const N=1<<xe.z,U=xe.x,ie=xe.y;for(const ue of xe.features){if(ue.type===1){const Te=[];for(let be=0;be<ue.geometry.length;be+=2)Te.push($s(ue.geometry[be],ue.geometry[be+1],B,N,U,ie));ue.geometry=Te;continue}const Me=[];for(const Te of ue.geometry){const be=[];for(let Se=0;Se<Te.length;Se+=2)be.push($s(Te[Se],Te[Se+1],B,N,U,ie));Me.push(be)}ue.geometry=Me}return xe.transformed=!0,xe}function $s(xe,B,N,U,ie,ue){return[Math.round(N*(xe*U-ie)),Math.round(N*(B*U-ue))]}function bs(xe,B,N,U,ie){const ue=B===ie.maxZoom?0:ie.tolerance/((1<<B)*ie.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:xe.length,source:null,x:N,y:U,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Te of xe)Hr(Me,Te,ue,ie);return Me}function Hr(xe,B,N,U){xe.minX=Math.min(xe.minX,B.minX),xe.minY=Math.min(xe.minY,B.minY),xe.maxX=Math.max(xe.maxX,B.maxX),xe.maxY=Math.max(xe.maxY,B.maxY);let ie,ue=B.tags||null;switch(B.type){case"Point":case"MultiPoint":{const Me=[];for(let Te=0;Te<B.geometry.length;Te+=3)Me.push(B.geometry[Te],B.geometry[Te+1]),xe.numPoints++,xe.numSimplified++;if(!Me.length)return;ie={type:1,tags:ue,geometry:Me};break}case"LineString":{const Me=[];if(Er(Me,B.geometry,xe,N,!1,!1),!Me.length)return;if(U.lineMetrics){ue={};for(const Te in B.tags)ue[Te]=B.tags[Te];ue.mapbox_clip_start=B.geometry.start/B.geometry.size,ue.mapbox_clip_end=B.geometry.end/B.geometry.size}ie={type:2,tags:ue,geometry:Me};break}case"MultiLineString":case"Polygon":{const Me=[];for(let Te=0;Te<B.geometry.length;Te++)Er(Me,B.geometry[Te],xe,N,B.type==="Polygon",Te===0);if(!Me.length)return;ie={type:B.type==="Polygon"?3:2,tags:ue,geometry:Me};break}case"MultiPolygon":{const Me=[];for(let Te=0;Te<B.geometry.length;Te++){const be=B.geometry[Te];for(let Se=0;Se<be.length;Se++)Er(Me,be[Se],xe,N,!0,Se===0)}if(!Me.length)return;ie={type:3,tags:ue,geometry:Me};break}}B.id!==null&&(ie.id=B.id),xe.features.push(ie)}function Er(xe,B,N,U,ie,ue){const Me=U*U;if(U>0&&B.size<(ie?Me:U))return void(N.numPoints+=B.length/3);const Te=[];for(let be=0;be<B.length;be+=3)(U===0||B[be+2]>Me)&&(N.numSimplified++,Te.push(B[be],B[be+1])),N.numPoints++;ie&&(function(be,Se){let He=0;for(let Be=0,le=be.length,mt=le-2;Be<le;mt=Be,Be+=2)He+=(be[Be]-be[mt])*(be[Be+1]+be[mt+1]);if(He>0===Se)for(let Be=0,le=be.length;Be<le/2;Be+=2){const mt=be[Be],Bt=be[Be+1];be[Be]=be[le-2-Be],be[Be+1]=be[le-1-Be],be[le-2-Be]=mt,be[le-1-Be]=Bt}})(Te,ue),xe.push(Te)}function vl(xe,B,N){const U=!!B.newGeometry,ie=B.removeAllProperties||B.removeProperties?.length>0||B.addOrUpdateProperties?.length>0;if(U){let ue=li({type:"FeatureCollection",features:[{type:"Feature",id:xe.id,geometry:B.newGeometry,properties:ie?Ln(xe.tags,B):xe.tags}]},N);return ue=ca(ue,N),ue[0]}if(ie){const ue={...xe};return ue.tags=Ln(ue.tags,B),ue}return null}function Ln(xe,B){if(B.removeAllProperties)return{};const N={...xe||{}};if(B.removeProperties)for(const U of B.removeProperties)delete N[U];if(B.addOrUpdateProperties)for(const{key:U,value:ie}of B.addOrUpdateProperties)N[U]=ie;return N}const Oa={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,updateable:!1,debug:0};class xl{options;tiles;tileCoords;stats={};total=0;source;constructor(B,N){const U=(N=this.options=Object.assign({},Oa,N)).debug;if(U&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");let ie=li(B,N);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ie=ca(ie,N),ie.length&&this.splitTile(ie,0,0,0),N.updateable&&(this.source=ie),U&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(B,N,U,ie,ue,Me,Te){const be=[B,N,U,ie],Se=this.options,He=Se.debug;for(;be.length;){ie=be.pop(),U=be.pop(),N=be.pop(),B=be.pop();const Be=1<<N,le=ws(N,U,ie);let mt=this.tiles[le];if(!mt&&(He>1&&console.time("creation"),mt=this.tiles[le]=bs(B,N,U,ie,Se),this.tileCoords.push({z:N,x:U,y:ie,id:le}),He)){He>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,U,ie,mt.numFeatures,mt.numPoints,mt.numSimplified),console.timeEnd("creation"));const We=`z${N}`;this.stats[We]=(this.stats[We]||0)+1,this.total++}if(mt.source=B,ue==null){if(N===Se.indexMaxZoom||mt.numPoints<=Se.indexMaxPoints)continue}else{if(N===Se.maxZoom||N===ue)continue;if(ue!=null){const We=ue-N;if(U!==Me>>We||ie!==Te>>We)continue}}if(mt.source=null,!B.length)continue;He>1&&console.time("clipping");const Bt=.5*Se.buffer/Se.extent,Et=.5-Bt,zt=.5+Bt,Dt=1+Bt;let Ft=null,Ki=null,hn=null,sn=null;const Qn=Zt(B,Be,U-Bt,U+zt,0,mt.minX,mt.maxX,Se),Qi=Zt(B,Be,U+Et,U+Dt,0,mt.minX,mt.maxX,Se);Qn&&(Ft=Zt(Qn,Be,ie-Bt,ie+zt,1,mt.minY,mt.maxY,Se),Ki=Zt(Qn,Be,ie+Et,ie+Dt,1,mt.minY,mt.maxY,Se)),Qi&&(hn=Zt(Qi,Be,ie-Bt,ie+zt,1,mt.minY,mt.maxY,Se),sn=Zt(Qi,Be,ie+Et,ie+Dt,1,mt.minY,mt.maxY,Se)),He>1&&console.timeEnd("clipping"),be.push(Ft||[],N+1,2*U,2*ie),be.push(Ki||[],N+1,2*U,2*ie+1),be.push(hn||[],N+1,2*U+1,2*ie),be.push(sn||[],N+1,2*U+1,2*ie+1)}}getTile(B,N,U){B=+B,N=+N,U=+U;const ie=this.options,{extent:ue,debug:Me}=ie;if(B<0||B>24)return null;const Te=1<<B,be=ws(B,N=N+Te&Te-1,U);if(this.tiles[be])return Zr(this.tiles[be],ue);Me>1&&console.log("drilling down to z%d-%d-%d",B,N,U);let Se,He=B,Be=N,le=U;for(;!Se&&He>0;)He--,Be>>=1,le>>=1,Se=this.tiles[ws(He,Be,le)];return Se?.source?(Me>1&&(console.log("found parent tile z%d-%d-%d",He,Be,le),console.time("drilling down")),this.splitTile(Se.source,He,Be,le,B,N,U),Me>1&&console.timeEnd("drilling down"),this.tiles[be]?Zr(this.tiles[be],ue):null):null}invalidateTiles(B){const N=this.options,{debug:U}=N;let ie=1/0,ue=-1/0,Me=1/0,Te=-1/0;for(const He of B)ie=Math.min(ie,He.minX),ue=Math.max(ue,He.maxX),Me=Math.min(Me,He.minY),Te=Math.max(Te,He.maxY);const be=N.buffer/N.extent,Se=new Set;for(const He in this.tiles){const Be=this.tiles[He],le=1<<Be.z,mt=(Be.x-be)/le,Bt=(Be.x+1+be)/le,Et=(Be.y-be)/le,zt=(Be.y+1+be)/le;if(ue<mt||ie>=Bt||Te<Et||Me>=zt)continue;let Dt=!1;for(const Ft of B)if(Ft.maxX>=mt&&Ft.minX<Bt&&Ft.maxY>=Et&&Ft.minY<zt){Dt=!0;break}if(Dt){if(U){U>1&&console.log("invalidate tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Be.z,Be.x,Be.y,Be.numFeatures,Be.numPoints,Be.numSimplified);const Ft=`z${Be.z}`;this.stats[Ft]=(this.stats[Ft]||0)-1,this.total--}delete this.tiles[He],Se.add(He)}}Se.size&&(this.tileCoords=this.tileCoords.filter((He=>!Se.has(He.id))))}updateData(B){const N=this.options,U=N.debug;if(!N.updateable)throw new Error("to update tile geojson `updateable` option must be set to true");const{affected:ie,source:ue}=(function(Be,le,mt){const Bt=(function(zt){return zt?{removeAll:zt.removeAll,remove:new Set(zt.remove||[]),add:new Map(zt.add?.map((Dt=>[Dt.id,Dt]))),update:new Map(zt.update?.map((Dt=>[Dt.id,Dt])))}:{remove:new Set,add:new Map,update:new Map}})(le);let Et=[];if(Bt.removeAll&&(Et=Be,Be=[]),Bt.remove.size||Bt.add.size){const zt=[];for(const Dt of Be){const{id:Ft}=Dt;(Bt.remove.has(Ft)||Bt.add.has(Ft))&&zt.push(Dt)}if(zt.length){Et.push(...zt);const Dt=new Set(zt.map((Ft=>Ft.id)));Be=Be.filter((Ft=>!Dt.has(Ft.id)))}if(Bt.add.size){let Dt=li({type:"FeatureCollection",features:Array.from(Bt.add.values())},mt);Dt=ca(Dt,mt),Et.push(...Dt),Be.push(...Dt)}}if(Bt.update.size)for(const[zt,Dt]of Bt.update){const Ft=Be.findIndex((sn=>sn.id===zt));if(Ft===-1)continue;const Ki=Be[Ft],hn=vl(Ki,Dt,mt);hn&&(Et.push(Ki,hn),Be[Ft]=hn)}return{affected:Et,source:Be}})(this.source,B,N);if(!ie.length)return;this.source=ue,U>1&&(console.log("invalidating tiles"),console.time("invalidating")),this.invalidateTiles(ie),U>1&&console.timeEnd("invalidating");const[Me,Te,be]=[0,0,0],Se=bs(this.source,Me,Te,be,this.options);Se.source=this.source;const He=ws(Me,Te,be);if(this.tiles[He]=Se,this.tileCoords.push({z:Me,x:Te,y:be,id:He}),U){const Be=`z${Me}`;this.stats[Be]=(this.stats[Be]||0)+1,this.total++}}}function ws(xe,B,N){return 32*((1<<xe)*N+B)+xe}class Ts{constructor(B,N,U,ie=lu){this._dataUpdateable=new Map,this.actor=B,this.layerIndex=N,this.availableImages=U,this.tileState=new Ye,this._createGeoJSONIndex=ie}loadVectorTile(B){if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const{z:N,x:U,y:ie}=B.tileID.canonical,ue=this._geoJSONIndex.getTile(N,U,ie);return ue?bt(new P.d3(ue.features,{version:2,extent:P.a5})):null}loadTile(B){return P._(this,void 0,void 0,(function*(){const{uid:N}=B,U=new ke(B);U.abort=new AbortController;try{const ie=this.loadVectorTile(B);if(!ie)return null;const{vectorTile:ue,rawData:Me}=ie;U.vectorTile=ue,this.tileState.markLoaded(N,U);const Te={rawData:Me};this.tileState.setParsing(N,Te);try{return yield this._parseWorkerTile(U,B,Te)}finally{this.tileState.clearParsing(N)}}catch(ie){throw U.status="done",this.tileState.markLoaded(N,U),ie}}))}_reloadLoadedTile(B){return P._(this,void 0,void 0,(function*(){const N=B.uid,U=this.tileState.getLoaded(N);if(!U)throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");if(U.showCollisionBoxes=B.showCollisionBoxes,U.status==="parsing"){const ie=this.tileState.consumeParsing(N);return yield this._parseWorkerTile(U,B,ie)}if(U.status==="done"&&U.vectorTile)return yield this._parseWorkerTile(U,B)}))}_parseWorkerTile(B,N,U){return P._(this,void 0,void 0,(function*(){let ie=yield B.parse(B.vectorTile,this.layerIndex,this.availableImages,this.actor,N.subdivisionGranularity);if(U){const{rawData:ue}=U;ie=P.e({rawTileData:ue.slice(0)},ie)}return ie}))}abortTile(B){return P._(this,void 0,void 0,(function*(){this.tileState.abort(B.uid)}))}removeTile(B){return P._(this,void 0,void 0,(function*(){this.tileState.removeLoaded(B.uid)}))}loadData(B){return P._(this,void 0,void 0,(function*(){var N;(N=this._pendingRequest)===null||N===void 0||N.abort();const U=this._startRequestTiming(B);this._pendingRequest=new AbortController;try{(!this._pendingData||B.request||B.data||B.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(B,this._pendingRequest));const ie=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ie,B),this.tileState.clearLoaded();const ue={};return B.request&&(ue.data=ie),this._finishRequestTiming(U,B,ue),ue}catch(ie){if(delete this._pendingRequest,P.Z(ie))return{abandoned:!0};throw ie}}))}_startRequestTiming(B){var N;if(!((N=B.request)===null||N===void 0)&&N.collectResourceTiming)return new P.c$(B.request.url)}_finishRequestTiming(B,N,U){const ie=B?.finish();ie&&(U.resourceTiming={[N.source]:JSON.parse(JSON.stringify(ie))})}getData(){return P._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(B){return this.tileState.getLoaded(B.uid)?this._reloadLoadedTile(B):this.loadTile(B)}loadAndProcessGeoJSON(B,N){return P._(this,void 0,void 0,(function*(){let U;if(B.request?U=yield this.loadGeoJSONFromUrl(B.request,B.promoteId,N):B.data?U=this._loadGeoJSONFromObject(B.data,B.promoteId):B.dataDiff&&(U=this._loadGeoJSONFromDiff(B.dataDiff,B.promoteId,B.source)),delete this._pendingRequest,typeof U!="object")throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`);return Mi(U,!0),B.filter&&(U=this._filterGeoJSON(U,B.filter)),U}))}loadGeoJSONFromUrl(B,N,U){return P._(this,void 0,void 0,(function*(){const ie=yield P.j(B,U);return this._dataUpdateable=P.a7(ie.data,N),ie.data}))}_loadGeoJSONFromObject(B,N){return this._dataUpdateable=P.a7(B,N),B}_loadGeoJSONFromDiff(B,N,U){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${U}`);P.a8(this._dataUpdateable,B,N);const ie=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(ie)}_filterGeoJSON(B,N){const U=P.d4(N,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(U.result==="error")throw new Error(U.value.map((ue=>`${ue.key}: ${ue.message}`)).join(", "));const ie=B.features.filter((ue=>U.value.evaluate({zoom:0},ue)));return this._toFeatureCollection(ie)}_toFeatureCollection(B){return{type:"FeatureCollection",features:B}}removeSource(B){return P._(this,void 0,void 0,(function*(){var N;(N=this._pendingRequest)===null||N===void 0||N.abort()}))}getClusterExpansionZoom(B){return this._geoJSONIndex.getClusterExpansionZoom(B.clusterId)}getClusterChildren(B){return this._geoJSONIndex.getChildren(B.clusterId)}getClusterLeaves(B){return this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset)}}function lu(xe,B){return B.cluster?new ii((function({superclusterOptions:N,clusterProperties:U}){if(!U||!N)return N;const ie={},ue={},Me={accumulated:null,zoom:0},Te={properties:null},be=Object.keys(U);for(const Se of be){const[He,Be]=U[Se],le=P.d4(Be),mt=P.d4(typeof He=="string"?[He,["accumulated"],["get",Se]]:He);ie[Se]=le.value,ue[Se]=mt.value}return N.map=Se=>{Te.properties=Se;const He={};for(const Be of be)He[Be]=ie[Be].evaluate(Me,Te);return He},N.reduce=(Se,He)=>{Te.properties=He;for(const Be of be)Me.accumulated=Se[Be],Se[Be]=ue[Be].evaluate(Me,Te)},N})(B)).load(xe.features):(function(N,U){return new xl(N,U)})(xe,B.geojsonVtOptions)}class Xs{constructor(B){this.self=B,this.actor=new P.L(B),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(N,U)=>{if(this.externalWorkerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.externalWorkerSourceTypes[N]=U},this.self.addProtocol=P.cK,this.self.removeProtocol=P.cL,this.self.registerRTLTextPlugin=N=>{P.d5.setMethods(N)},this.actor.registerMessageHandler("LDT",((N,U)=>this._getDEMWorkerSource(N,U.source).loadTile(U))),this.actor.registerMessageHandler("RDT",((N,U)=>P._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(N,U.source).removeTile(U)})))),this.actor.registerMessageHandler("GCEZ",((N,U)=>P._(this,void 0,void 0,(function*(){return this._getWorkerSource(N,U.type,U.source).getClusterExpansionZoom(U)})))),this.actor.registerMessageHandler("GCC",((N,U)=>P._(this,void 0,void 0,(function*(){return this._getWorkerSource(N,U.type,U.source).getClusterChildren(U)})))),this.actor.registerMessageHandler("GCL",((N,U)=>P._(this,void 0,void 0,(function*(){return this._getWorkerSource(N,U.type,U.source).getClusterLeaves(U)})))),this.actor.registerMessageHandler("LD",((N,U)=>this._getWorkerSource(N,U.type,U.source).loadData(U))),this.actor.registerMessageHandler("GD",((N,U)=>this._getWorkerSource(N,U.type,U.source).getData())),this.actor.registerMessageHandler("LT",((N,U)=>this._getWorkerSource(N,U.type,U.source).loadTile(U))),this.actor.registerMessageHandler("RT",((N,U)=>this._getWorkerSource(N,U.type,U.source).reloadTile(U))),this.actor.registerMessageHandler("AT",((N,U)=>this._getWorkerSource(N,U.type,U.source).abortTile(U))),this.actor.registerMessageHandler("RMT",((N,U)=>this._getWorkerSource(N,U.type,U.source).removeTile(U))),this.actor.registerMessageHandler("RS",((N,U)=>P._(this,void 0,void 0,(function*(){if(!this.workerSources[N]||!this.workerSources[N][U.type]||!this.workerSources[N][U.type][U.source])return;const ie=this.workerSources[N][U.type][U.source];delete this.workerSources[N][U.type][U.source],ie.removeSource!==void 0&&ie.removeSource(U)})))),this.actor.registerMessageHandler("RM",(N=>P._(this,void 0,void 0,(function*(){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N],this.globalStates.delete(N)})))),this.actor.registerMessageHandler("SR",((N,U)=>P._(this,void 0,void 0,(function*(){this.referrer=U})))),this.actor.registerMessageHandler("SRPS",((N,U)=>this._syncRTLPluginState(N,U))),this.actor.registerMessageHandler("IS",((N,U)=>P._(this,void 0,void 0,(function*(){this.self.importScripts(U)})))),this.actor.registerMessageHandler("SI",((N,U)=>this._setImages(N,U))),this.actor.registerMessageHandler("UL",((N,U)=>P._(this,void 0,void 0,(function*(){this._getLayerIndex(N).update(U.layers,U.removedIds,this._getGlobalState(N))})))),this.actor.registerMessageHandler("UGS",((N,U)=>P._(this,void 0,void 0,(function*(){const ie=this._getGlobalState(N);for(const ue in U)ie[ue]=U[ue]})))),this.actor.registerMessageHandler("SL",((N,U)=>P._(this,void 0,void 0,(function*(){this._getLayerIndex(N).replace(U,this._getGlobalState(N))}))))}_getGlobalState(B){let N=this.globalStates.get(B);return N||(N={},this.globalStates.set(B,N)),N}_setImages(B,N){return P._(this,void 0,void 0,(function*(){this.availableImages[B]=N;for(const U in this.workerSources[B]){const ie=this.workerSources[B][U];for(const ue in ie)ie[ue].availableImages=N}}))}_syncRTLPluginState(B,N){return P._(this,void 0,void 0,(function*(){return yield P.d5.syncState(N,this.self.importScripts)}))}_getAvailableImages(B){let N=this.availableImages[B];return N||(N=[]),N}_getLayerIndex(B){let N=this.layerIndexes[B];return N||(N=this.layerIndexes[B]=new h),N}_getWorkerSource(B,N,U){if(this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][N]||(this.workerSources[B][N]={}),!this.workerSources[B][N][U]){const ie={sendAsync:(ue,Me)=>(ue.targetMapId=B,this.actor.sendAsync(ue,Me))};switch(N){case"vector":this.workerSources[B][N][U]=new di(ie,this._getLayerIndex(B),this._getAvailableImages(B));break;case"geojson":this.workerSources[B][N][U]=new Ts(ie,this._getLayerIndex(B),this._getAvailableImages(B));break;default:this.workerSources[B][N][U]=new this.externalWorkerSourceTypes[N](ie,this._getLayerIndex(B),this._getAvailableImages(B))}}return this.workerSources[B][N][U]}_getDEMWorkerSource(B,N){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][N]||(this.demWorkerSources[B][N]=new ti),this.demWorkerSources[B][N]}}return P.i(self)&&(self.worker=new Xs(self)),Xs})),pe("index",["exports","./shared"],(function(P,h){var ge="5.18.0";function ke(){var m=new h.A(4);return h.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let st,Ye,xt;const Tt={frame(m,t,r,l){const d=l||window,_=d.requestAnimationFrame((b=>{v(),t(b)})),{unsubscribe:v}=h.s(m.signal,"abort",(()=>{v(),d.cancelAnimationFrame(_),r(new h.a(m.signal.reason))}),!1)},frameAsync(m,t){return new Promise(((r,l)=>{this.frame(m,r,l,t)}))},getImageData(m,t=0){return this.getImageCanvasContext(m).getImageData(-t,-t,m.width+2*t,m.height+2*t)},getImageCanvasContext(m){const t=window.document.createElement("canvas"),r=t.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return t.width=m.width,t.height=m.height,r.drawImage(m,0,0,m.width,m.height),r},resolveURL:m=>(st||(st=document.createElement("a")),st.href=m,st.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return xt!==void 0?xt:!!matchMedia&&(Ye==null&&(Ye=matchMedia("(prefers-reduced-motion: reduce)")),Ye.matches)},set prefersReducedMotion(m){xt=m}},ui=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function bt(){return ui.getCurrentTime()}class Ce{static testProp(t){if(!Ce.docStyle)return t[0];for(let r=0;r<t.length;r++)if(t[r]in Ce.docStyle)return t[r];return t[0]}static create(t,r,l){const d=window.document.createElement(t);return r!==void 0&&(d.className=r),l&&l.appendChild(d),d}static createNS(t,r){return window.document.createElementNS(t,r)}static disableDrag(){Ce.docStyle&&Ce.selectProp&&(Ce.userSelect=Ce.docStyle[Ce.selectProp],Ce.docStyle[Ce.selectProp]="none")}static enableDrag(){Ce.docStyle&&Ce.selectProp&&(Ce.docStyle[Ce.selectProp]=Ce.userSelect)}static setTransform(t,r){t.style[Ce.transformProp]=r}static addEventListener(t,r,l,d={}){t.addEventListener(r,l,"passive"in d?d:d.capture)}static removeEventListener(t,r,l,d={}){t.removeEventListener(r,l,"passive"in d?d:d.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Ce.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Ce.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Ce.suppressClickInternal,!0)}),0)}static getScale(t){const r=t.getBoundingClientRect();return{x:r.width/t.offsetWidth||1,y:r.height/t.offsetHeight||1,boundingClientRect:r}}static getPoint(t,r,l){const d=r.boundingClientRect;return new h.P((l.clientX-d.left)/r.x-t.clientLeft,(l.clientY-d.top)/r.y-t.clientTop)}static mousePos(t,r){const l=Ce.getScale(t);return Ce.getPoint(t,l,r)}static touchPos(t,r){const l=[],d=Ce.getScale(t);for(let _=0;_<r.length;_++)l.push(Ce.getPoint(t,d,r[_]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const r=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),l=r.querySelectorAll("script");for(const d of l)d.remove();return Ce.clean(r),r.innerHTML}static isPossiblyDangerous(t,r){const l=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!l.includes("javascript:")&&!l.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const r=t.children;for(const l of r)Ce.removeAttributes(l),Ce.clean(l)}static removeAttributes(t){for(const{name:r,value:l}of t.attributes)Ce.isPossiblyDangerous(r,l)&&t.removeAttribute(r)}}Ce.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Ce.selectProp=Ce.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Ce.transformProp=Ce.testProp(["transform","WebkitTransform"]);const di={supported:!1,testSupport:function(m){!si&&pt&&($t?Mi(m):ti=m)}};let ti,pt,si=!1,$t=!1;function Mi(m){const t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,pt),m.isContextLost())return;di.supported=!0}catch{}m.deleteTexture(t),si=!0}var Pt;typeof document<"u"&&(pt=document.createElement("img"),pt.onload=()=>{ti&&Mi(ti),ti=null,$t=!0},pt.onerror=()=>{si=!0,ti=null},pt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let t,r,l,d;m.resetRequestQueue=()=>{t=[],r=0,l=0,d={}},m.addThrottleControl=S=>{const C=l++;return d[C]=S,C},m.removeThrottleControl=S=>{delete d[S],v()},m.getImage=(S,C,z=!0)=>new Promise(((L,R)=>{di.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),h.e(S,{type:"image"}),t.push({abortController:C,requestParameters:S,supportImageRefresh:z,state:"queued",onError:j=>{R(j)},onSuccess:j=>{L(j)}}),v()}));const _=S=>h._(this,void 0,void 0,(function*(){S.state="running";const{requestParameters:C,supportImageRefresh:z,onError:L,onSuccess:R,abortController:j}=S,G=z===!1&&!h.i(self)&&!h.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce(((W,te)=>W&&te==="accept"),!0));r++;const $=G?b(C,j):h.m(C,j);try{const W=yield $;delete S.abortController,S.state="completed",W.data instanceof HTMLImageElement||h.b(W.data)?R(W):W.data&&R({data:yield(K=W.data,typeof createImageBitmap=="function"?h.f(K):h.h(K)),cacheControl:W.cacheControl,expires:W.expires})}catch(W){delete S.abortController,L(W)}finally{r--,v()}var K})),v=()=>{const S=(()=>{for(const C of Object.keys(d))if(d[C]())return!0;return!1})()?h.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=r;C<S&&t.length>0;C++){const z=t.shift();z.abortController.signal.aborted?C--:_(z)}},b=(S,C)=>new Promise(((z,L)=>{const R=new Image,j=S.url,G=S.credentials;G&&G==="include"?R.crossOrigin="use-credentials":(G&&G==="same-origin"||!h.d(j))&&(R.crossOrigin="anonymous"),C.signal.addEventListener("abort",(()=>{R.src="",L(new h.a(C.signal.reason))})),R.fetchPriority="high",R.onload=()=>{R.onerror=R.onload=null,z({data:R})},R.onerror=()=>{R.onerror=R.onload=null,C.signal.aborted||L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},R.src=j}))})(Pt||(Pt={})),Pt.resetRequestQueue();class Kt{constructor(t){this._transformRequestFn=t??null}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Lt(m){const t=[];if(typeof m=="string")t.push({id:"default",url:m});else if(m&&m.length>0){const r=[];for(const{id:l,url:d}of m){const _=`${l}${d}`;r.indexOf(_)===-1&&(r.push(_),t.push({id:l,url:d}))}}return t}function ii(m,t,r){try{const l=new URL(m);return l.pathname+=`${t}${r}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function gi(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class kt extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:r,promiseResolve:l}of this.requestors)l(this._getImagesForIds(r));this.requestors=[]}}getImage(t){const r=this.images[t];if(r&&!r.data&&r.spriteData){const l=r.spriteData;r.data=new h.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),r.spriteData=null}return r}addImage(t,r){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,r)&&(this.images[t]=r)}_validate(t,r){let l=!0;const d=r.data||r.spriteData;return this._validateStretch(r.stretchX,d&&d.width)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(r.stretchY,d&&d.height)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(r.content,r)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,r){if(!t)return!0;let l=0;for(const d of t){if(d[0]<l||d[1]<d[0]||r<d[1])return!1;l=d[1]}return!0}_validateContent(t,r){if(!t)return!0;if(t.length!==4)return!1;const l=r.spriteData,d=l&&l.width||r.data.width,_=l&&l.height||r.data.height;return!(t[0]<0||d<t[0]||t[1]<0||_<t[1]||t[2]<0||d<t[2]||t[3]<0||_<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,r,l=!0){const d=this.getImage(t);if(l&&(d.data.width!==r.data.width||d.data.height!==r.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=d.version+1,this.images[t]=r,this.updatedImages[t]=!0}removeImage(t){const r=this.images[t];delete this.images[t],delete this.patterns[t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((r,l)=>{let d=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(d=!1);this.isLoaded()||d?r(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:r})}))}_getImagesForIds(t){const r={};for(const l of t){let d=this.getImage(l);d||(this.fire(new h.l("styleimagemissing",{id:l})),d=this.getImage(l)),d?r[l]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:h.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:t,height:r}=this.atlasImage;return{width:t,height:r}}getPattern(t){const r=this.patterns[t],l=this.getImage(t);if(!l)return null;if(r&&r.position.version===l.version)return r.position;if(r)r.position.version=l.version;else{const d={w:l.data.width+2,h:l.data.height+2,x:0,y:0},_=new h.I(d,l);this.patterns[t]={bin:d,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const r=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.T(t,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:r,h:l}=h.p(t),d=this.atlasImage;d.resize({width:r||1,height:l||1});for(const _ in this.patterns){const{bin:v}=this.patterns[_],b=v.x+1,S=v.y+1,C=this.getImage(_).data,z=C.width,L=C.height;h.R.copy(C,d,{x:0,y:0},{x:b,y:S},{width:z,height:L}),h.R.copy(C,d,{x:0,y:L-1},{x:b,y:S-1},{width:z,height:1}),h.R.copy(C,d,{x:0,y:0},{x:b,y:S+L},{width:z,height:1}),h.R.copy(C,d,{x:z-1,y:0},{x:b-1,y:S},{width:1,height:L}),h.R.copy(C,d,{x:0,y:0},{x:b+z,y:S},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const r of t){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const l=this.getImage(r);l||h.w(`Image with ID: "${r}" was not found`),gi(l)&&this.updateImage(r,l)}}cloneImages(){const t={};for(const r in this.images){const l=this.images[r];t[r]=Object.assign(Object.assign({},l),{data:l.data?l.data.clone():null})}return t}}const Nt=1e20;function ni(m,t,r,l,d,_,v,b,S){for(let C=t;C<t+l;C++)Vi(m,r*_+C,_,d,v,b,S);for(let C=r;C<r+d;C++)Vi(m,C*_+t,1,l,v,b,S)}function Vi(m,t,r,l,d,_,v){_[0]=0,v[0]=-Nt,v[1]=Nt,d[0]=m[t];for(let b=1,S=0,C=0;b<l;b++){d[b]=m[t+b*r];const z=b*b;do{const L=_[S];C=(d[b]-d[L]+z-L*L)/(b-L)/2}while(C<=v[S]&&--S>-1);S++,_[S]=b,v[S]=C,v[S+1]=Nt}for(let b=0,S=0;b<l;b++){for(;v[S+1]<b;)S++;const C=_[S],z=b-C;m[t+b*r]=d[C]+z*z}}const Fe=h.v.layout_symbol["text-font"].default.join(",");class nt{constructor(t,r,l){this.requestManager=t,this.localIdeographFontFamily=r,this.entries={},this.lang=l}setURL(t){this.url=t}getGlyphs(t){return h._(this,void 0,void 0,(function*(){const r=[];for(const _ in t)for(const v of t[_])r.push(this._getAndCacheGlyphsPromise(_,v));const l=yield Promise.all(r),d={};for(const{stack:_,id:v,glyph:b}of l)d[_]||(d[_]={}),d[_][v]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return d}))}_getAndCacheGlyphsPromise(t,r){return h._(this,void 0,void 0,(function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let d=l.glyphs[r];return d!==void 0?{stack:t,id:r,glyph:d}:!this.url||this._charUsesLocalIdeographFontFamily(r)?(d=l.glyphs[r]=this._drawGlyph(l,t,r),{stack:t,id:r,glyph:d}):yield this._downloadAndCacheRangePromise(t,r)}))}_downloadAndCacheRangePromise(t,r){return h._(this,void 0,void 0,(function*(){const l=this.entries[t],d=Math.floor(r/256);if(l.ranges[d])return{stack:t,id:r,glyph:null};if(!l.requests[d]){const _=nt.loadGlyphRange(t,d,this.url,this.requestManager);l.requests[d]=_}try{const _=yield l.requests[d];for(const v in _)l.glyphs[+v]=_[+v];return l.ranges[d]=!0,{stack:t,id:r,glyph:_[r]||null}}catch(_){const v=l.glyphs[r]=this._drawGlyph(l,t,r);return this._warnOnMissingGlyphRange(v,d,r,_),{stack:t,id:r,glyph:v}}}))}_warnOnMissingGlyphRange(t,r,l,d){const _=256*r,v=_+255,b=l.toString(16).padStart(4,"0").toUpperCase();h.w(`Unable to load glyph range ${r}, ${_}-${v}. Rendering codepoint U+${b} locally instead. ${d}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&h.q(t)}_drawGlyph(t,r,l){const d=r===Fe&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(l),_=d?"ideographTinySDF":"tinySDF";t[_]||(t[_]=this._createTinySDF(d?this.localIdeographFontFamily:r));const v=t[_].draw(String.fromCodePoint(l)),b=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(l));return{id:l,bitmap:new h.r({width:v.width||60,height:v.height||60},v.data),metrics:{width:b?0:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:b?0:v.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const r=t?t.split(","):[];r.push("sans-serif");const l=r.map((d=>/[-\w]+/.test(d)?d:`'${CSS.escape(d)}'`)).join(",");return new nt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:this._fontWeight(r[0]),fontStyle:this._fontStyle(r[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const r={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let l;for(const[d,_]of Object.entries(r))new RegExp(`\\b${d}\\b`,"i").test(t)&&(l=`${_}`);return l}destroy(){for(const t in this.entries){const r=this.entries[t];r.tinySDF&&(r.tinySDF=null),r.ideographTinySDF&&(r.ideographTinySDF=null),r.glyphs={},r.requests={},r.ranges={}}this.entries={}}}nt.loadGlyphRange=function(m,t,r,l){return h._(this,void 0,void 0,(function*(){const d=256*t,_=d+255,v=l.transformRequest(r.replace("{fontstack}",m).replace("{range}",`${d}-${_}`),"Glyphs"),b=yield h.n(v,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${t}, ${d}-${_}`);const S={};for(const C of h.o(b.data))S[C.id]=C;return S}))},nt.TinySDF=class{constructor({fontSize:m=24,buffer:t=3,radius:r=8,cutoff:l=.25,fontFamily:d="sans-serif",fontWeight:_="normal",fontStyle:v="normal",lang:b=null}={}){this.buffer=t,this.cutoff=l,this.radius=r,this.lang=b;const S=this.size=m+4*t,C=this._createCanvas(S),z=this.ctx=C.getContext("2d",{willReadFrequently:!0});z.font=`${v} ${_} ${m}px ${d}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const t=document.createElement("canvas");return t.width=t.height=m,t}draw(m){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:d,actualBoundingBoxRight:_}=this.ctx.measureText(m),v=Math.ceil(r),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-d))),S=Math.min(this.size-this.buffer,v+Math.ceil(l)),C=b+2*this.buffer,z=S+2*this.buffer,L=Math.max(C*z,0),R=new Uint8ClampedArray(L),j={data:R,width:C,height:z,glyphWidth:b,glyphHeight:S,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(b===0||S===0)return j;const{ctx:G,buffer:$,gridInner:K,gridOuter:W}=this;this.lang&&(G.lang=this.lang),G.clearRect($,$,b,S),G.fillText(m,$,$+v);const te=G.getImageData($,$,b,S);W.fill(Nt,0,L),K.fill(0,0,L);for(let oe=0;oe<S;oe++)for(let ee=0;ee<b;ee++){const se=te.data[4*(oe*b+ee)+3]/255;if(se===0)continue;const ce=(oe+$)*C+ee+$;if(se===1)W[ce]=0,K[ce]=Nt;else{const ne=.5-se;W[ce]=ne>0?ne*ne:0,K[ce]=ne<0?ne*ne:0}}ni(W,0,0,C,z,C,this.f,this.v,this.z),ni(K,$,$,b,S,C,this.f,this.v,this.z);for(let oe=0;oe<L;oe++){const ee=Math.sqrt(W[oe])-Math.sqrt(K[oe]);R[oe]=Math.round(255-255*(ee/this.radius+this.cutoff))}return j}};class ht{constructor(){this.specification=h.u.light.position}possiblyEvaluate(t,r){return h.F(t.expression.evaluate(r))}interpolate(t,r,l){return{x:h.G.number(t.x,r.x,l),y:h.G.number(t.y,r.y,l),z:h.G.number(t.z,r.z,l)}}}let _t;class li extends h.E{constructor(t){super(),_t=_t||new h.t({anchor:new h.D(h.u.light.anchor),position:new ht,color:new h.D(h.u.light.color),intensity:new h.D(h.u.light.intensity)}),this._transitionable=new h.x(_t,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r={}){if(!this._validate(h.y,t,r))for(const l in t){const d=t[l];l.endsWith(h.z)?this._transitionable.setTransition(l.slice(0,-h.z.length),d):this._transitionable.setValue(l,d)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,l){return(!l||l.validate!==!1)&&h.B(this,t.call(h.C,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:h.u}))}}const me=new h.t({"sky-color":new h.D(h.u.sky["sky-color"]),"horizon-color":new h.D(h.u.sky["horizon-color"]),"fog-color":new h.D(h.u.sky["fog-color"]),"fog-ground-blend":new h.D(h.u.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.u.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.u.sky["atmosphere-blend"])});class Ze extends h.E{constructor(t){super(),this._transitionable=new h.x(me,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.H(0))}setSky(t,r={}){if(!this._validate(h.J,t,r)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in t){const d=t[l];l.endsWith(h.z)?this._transitionable.setTransition(l.slice(0,-h.z.length),d):this._transitionable.setValue(l,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,l={}){return l?.validate!==!1&&h.B(this,t.call(h.C,h.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:h.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class lt{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,r){const l=t.join(",")+String(r);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,r)),this.dashEntry[l]}getDashRanges(t,r,l){const d=[];let _=t.length%2==1?-t[t.length-1]*l:0,v=t[0]*l,b=!0;d.push({left:_,right:v,isDash:b,zeroLength:t[0]===0});let S=t[0];for(let C=1;C<t.length;C++){b=!b;const z=t[C];_=S*l,S+=z,v=S*l,d.push({left:_,right:v,isDash:b,zeroLength:z===0})}return d}addRoundDash(t,r,l){const d=r/2;for(let _=-l;_<=l;_++){const v=this.width*(this.nextRow+l+_);let b=0,S=t[b];for(let C=0;C<this.width;C++){C/S.right>1&&(S=t[++b]);const z=Math.abs(C-S.left),L=Math.abs(C-S.right),R=Math.min(z,L);let j;const G=_/l*(d+1);if(S.isDash){const $=d-Math.abs(G);j=Math.sqrt(R*R+$*$)}else j=d-Math.sqrt(R*R+G*G);this.data[v+C]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(t){for(let b=t.length-1;b>=0;--b){const S=t[b],C=t[b+1];S.zeroLength?t.splice(b,1):C&&C.isDash===S.isDash&&(C.left=S.left,t.splice(b,1))}const r=t[0],l=t[t.length-1];r.isDash===l.isDash&&(r.left=l.left-this.width,l.right=r.right+this.width);const d=this.width*this.nextRow;let _=0,v=t[_];for(let b=0;b<this.width;b++){b/v.right>1&&(v=t[++_]);const S=Math.abs(b-v.left),C=Math.abs(b-v.right),z=Math.min(S,C);this.data[d+b]=Math.max(0,Math.min(255,(v.isDash?z:-z)+128))}}addDash(t,r){const l=r?7:0,d=2*l+1;if(this.nextRow+d>this.height)return h.w("LineAtlas out of space"),null;let _=0;for(let b=0;b<t.length;b++)_+=t[b];if(_!==0){const b=this.width/_,S=this.getDashRanges(t,this.width,b);r?this.addRoundDash(S,b,l):this.addRegularDash(S)}const v={y:this.nextRow+l,height:2*l,width:_};return this.nextRow+=d,this.dirty=!0,v}bind(t){const r=t.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const dt="maplibre_preloaded_worker_pool";class Mt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Mt.workerCount;)this.workers.push(new Worker(h.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((r=>{r.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[dt]}numActive(){return Object.keys(this.active).length}}const Ot=Math.floor(Tt.hardwareConcurrency/2);let Zt,Ui;function Hi(){return Zt||(Zt=new Mt),Zt}Mt.workerCount=h.K(globalThis)?Math.max(Math.min(Ot,3),1):1;class Mr{constructor(t,r){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=r;const l=this.workerPool.acquire(r);for(let d=0;d<l.length;d++){const _=new h.L(l[d],r);_.name=`Worker ${d}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,r){const l=[];for(const d of this.actors)l.push(d.sendAsync({type:t,data:r}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((r=>{r.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,r){for(const l of this.actors)l.registerMessageHandler(t,r)}unregisterMessageHandler(t){for(const r of this.actors)r.unregisterMessageHandler(t)}}function qr(){return Ui||(Ui=new Mr(Hi(),h.M),Ui.registerMessageHandler("GR",((m,t,r)=>h.m(t,r)))),Ui}function Nn(m,t){const r=h.N();return h.O(r,r,[1,1,0]),h.Q(r,r,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?h.S(r,r,m.calculatePosMatrix(t.toUnwrapped())):r}function ou(m,t,r,l,d,_,v){var b;const S=(function(R,j,G){if(R)for(const $ of R){const K=j[$];if(K&&K.source===G&&K.type==="fill-extrusion")return!0}else for(const $ in j){const K=j[$];if(K.source===G&&K.type==="fill-extrusion")return!0}return!1})((b=d?.layers)!==null&&b!==void 0?b:null,t,m.id),C=_.maxPitchScaleFactor(),z=m.tilesIn(l,C,S);z.sort(xn);const L=[];for(const R of z)L.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(t,r,m.getState(),R.queryGeometry,R.cameraQueryGeometry,R.scale,d,_,C,Nn(_,R.tileID),v?(j,G)=>v(R.tileID,j,G):void 0)});return(function(R,j){for(const G in R)for(const $ of R[G])ca($,j);return R})((function(R){const j={},G={};for(const $ of R){const K=$.queryResults,W=$.wrappedTileID,te=G[W]=G[W]||{};for(const oe in K){const ee=K[oe],se=te[oe]=te[oe]||{},ce=j[oe]=j[oe]||[];for(const ne of ee)se[ne.featureIndex]||(se[ne.featureIndex]=!0,ce.push(ne))}}return j})(L),m)}function xn(m,t){const r=m.tileID,l=t.tileID;return r.overscaledZ-l.overscaledZ||r.canonical.y-l.canonical.y||r.wrap-l.wrap||r.canonical.x-l.canonical.x}function ca(m,t){const r=m.feature,l=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=l}function ar(m,t,r,l){return h._(this,void 0,void 0,(function*(){let d=m;if(m.url?d=(yield h.j(t.transformRequest(m.url,"Source"),r)).data:yield Tt.frameAsync(r,l),!d)return null;const _=h.U(h.e(d,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(_.vectorLayerIds=d.vector_layers.map((v=>v.id))),_}))}class Wi{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof h.V?new h.V(t.lng,t.lat):h.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof h.V?new h.V(t.lng,t.lat):h.V.convert(t),this}extend(t){const r=this._sw,l=this._ne;let d,_;if(t instanceof h.V)d=t,_=t;else{if(!(t instanceof Wi))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Wi.convert(t)):this.extend(h.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(h.V.convert(t)):this;if(d=t._sw,_=t._ne,!d||!_)return this}return r||l?(r.lng=Math.min(d.lng,r.lng),r.lat=Math.min(d.lat,r.lat),l.lng=Math.max(_.lng,l.lng),l.lat=Math.max(_.lat,l.lat)):(this._sw=new h.V(d.lng,d.lat),this._ne=new h.V(_.lng,_.lat)),this}getCenter(){return new h.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.V(this.getWest(),this.getNorth())}getSouthEast(){return new h.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:l}=h.V.convert(t);let d=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&d}intersects(t){if(!((t=Wi.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const r=Math.abs(this.getEast()-this.getWest()),l=Math.abs(t.getEast()-t.getWest());if(r>=360||l>=360)return!0;const d=h.W(this.getWest(),-180,180),_=h.W(this.getEast(),-180,180),v=h.W(t.getWest(),-180,180),b=h.W(t.getEast(),-180,180),S=d>_,C=v>b;return!(!S||!C)||(S?b>=d||v<=_:C?_>=v||d<=b:v<=_&&b>=d)}static convert(t){return t instanceof Wi?t:t&&new Wi(t)}static fromLngLat(t,r=0){const l=360*r/40075017,d=l/Math.cos(Math.PI/180*t.lat);return new Wi(new h.V(t.lng-d,t.lat-l),new h.V(t.lng+d,t.lat+l))}adjustAntiMeridian(){const t=new h.V(this._sw.lng,this._sw.lat),r=new h.V(this._ne.lng,this._ne.lat);return new Wi(t,t.lng>r.lng?new h.V(r.lng+360,r.lat):r)}}class Zr{constructor(t,r,l){this.bounds=Wi.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),l=Math.floor(h.Y(this.bounds.getWest())*r),d=Math.floor(h.X(this.bounds.getNorth())*r),_=Math.ceil(h.Y(this.bounds.getEast())*r),v=Math.ceil(h.X(this.bounds.getSouth())*r);return t.x>=l&&t.x<_&&t.y>=d&&t.y<v}}class $s extends h.E{constructor(t,r,l,d){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.U(r,["url","scheme","tileSize","promoteId","encoding"])),this._options=h.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ar(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(h.e(this,t),t.bounds&&(this.tileBounds=new Zr(t.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,h.Z(t)||this.fire(new h.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(t){return h._(this,void 0,void 0,(function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(r,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};l.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((_,v)=>{t.reloadPromise={resolve:_,reject:v}}))}else t.actor=this.dispatcher.getActor(),d="LT";t.abortController=new AbortController;try{const _=yield t.actor.sendAsync({type:d,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,_)}catch(_){if(delete t.abortController,t.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const r=t.tileID.scaledTo(this.maxzoom).canonical,l=r.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:r,overzoomRequest:this.map._requestManager.transformRequest(l,"Tile")}}_afterTileLoadWorkerResponse(t,r){if(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class bs extends h.E{constructor(t,r,l,d){super(),this.id=t,this.dispatcher=l,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},r),h.e(this,h.U(r,["url","scheme","tileSize"]))}load(){return h._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield ar(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,r&&(h.e(this,r),r.bounds&&(this.tileBounds=new Zr(r.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(r){this._tileJSONRequest=null,this._loaded=!0,h.Z(r)||this.fire(new h.k(r))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return h.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return h._(this,void 0,void 0,(function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield Pt.getImage(this.map._requestManager.transformRequest(r,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const d=this.map.painter.context,_=d.gl,v=l.data;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new h.T(d,v,_.RGBA,{useMipmap:!0}),t.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}}))}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class Hr extends bs{constructor(t,r,l,d){super(t,r,l,d),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(t){return h._(this,void 0,void 0,(function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(r,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const d=yield Pt.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(d&&d.data){const _=d.data;this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&t.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const v=h.b(_)&&h.$()?_:yield this.readImageNow(_),b={type:this.type,uid:t.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const S=yield t.actor.sendAsync({type:"LDT",data:b});t.dem=S,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(d){if(delete t.abortController,t.aborted)t.state="unloaded";else if(d)throw t.state="errored",d}}))}readImageNow(t){return h._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&h.a0()){const r=t.width+2,l=t.height+2;try{return new h.R({width:r,height:l},yield h.a1(t,-1,-1,r,l))}catch{}}return Tt.getImageData(t,1)}))}_getNeighboringTiles(t){const r=t.canonical,l=Math.pow(2,r.z),d=(r.x-1+l)%l,_=r.x===0?t.wrap-1:t.wrap,v=(r.x+1+l)%l,b=r.x+1===l?t.wrap+1:t.wrap,S={};return S[new h.a2(t.overscaledZ,_,r.z,d,r.y).key]={backfilled:!1},S[new h.a2(t.overscaledZ,b,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(S[new h.a2(t.overscaledZ,_,r.z,d,r.y-1).key]={backfilled:!1},S[new h.a2(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},S[new h.a2(t.overscaledZ,b,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<l&&(S[new h.a2(t.overscaledZ,_,r.z,d,r.y+1).key]={backfilled:!1},S[new h.a2(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},S[new h.a2(t.overscaledZ,b,r.z,v,r.y+1).key]={backfilled:!1}),S}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Er(m){return m.type==="GeometryCollection"?m.geometries.map((t=>t.coordinates)).flat(1/0):m.coordinates.flat(1/0)}function vl(m){const t=new Wi;let r;switch(m.type){case"FeatureCollection":r=m.features.map((l=>Er(l.geometry))).flat(1/0);break;case"Feature":r=Er(m.geometry);break;default:r=Er(m)}if(r.length==0)return t;for(let l=0;l<r.length-1;l+=2)t.extend([r[l],r[l+1]]);return t}class Ln extends h.E{constructor(t,r,l,d){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:r.data},this.actor=l.getActor(),this.setEventedParent(d),this._data=typeof r.data=="string"?{url:r.data}:{geojson:r.data},this._options=h.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:h.a5,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:h.a5,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(h.a5/this.tileSize)}_getClusterMaxZoom(t){const r=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||h.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${r}"`),r}load(){return h._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,r){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const l=this._updateWorkerData();return r?l:this}updateData(t,r){this._pendingWorkerUpdate.diff=h.a6(this._pendingWorkerUpdate.diff,t);const l=this._updateWorkerData();return r?l:this}getData(){return h._(this,void 0,void 0,(function*(){const t=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return h._(this,void 0,void 0,(function*(){return vl(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,r,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:r,offset:l}})}_updateWorkerData(){return h._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void h.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:r}=this._pendingWorkerUpdate,l=this._getLoadGeoJSONParameters(t,r);t!==void 0?this._pendingWorkerUpdate.data=void 0:r&&(this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,yield this._dispatchWorkerUpdate(l)}))}_getLoadGeoJSONParameters(t,r){const l=h.e({type:this.type},this.workerOptions);return typeof t=="string"?(l.request=this.map._requestManager.transformRequest(Tt.resolveURL(t),"Source"),l.request.collectResourceTiming=this._collectResourceTiming,l):t!==void 0?(l.data=t,l):(r&&(l.dataDiff=r),l)}_dispatchWorkerUpdate(t){return h._(this,void 0,void 0,(function*(){this._isUpdatingWorker=!0,this.fire(new h.l("dataloading",{dataType:"source"}));try{const r=yield this.actor.sendAsync({type:"LD",data:t});if(this._isUpdatingWorker=!1,this._removed||r.abandoned)return void this.fire(new h.l("dataabort",{dataType:"source"}));r.data&&(this._data={geojson:r.data});const l=this._applyDiffToSource(t.dataDiff),d=this._getShouldReloadTileOptions(l),_={dataType:"source"};this._applyResourceTiming(_,r),this.fire(new h.l("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new h.l("data",Object.assign(Object.assign({},_),{sourceDataType:"content",shouldReloadTileOptions:d})))}catch(r){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new h.l("dataabort",{dataType:"source"}));this.fire(new h.k(r))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyResourceTiming(t,r){var l;if(!this._collectResourceTiming)return;const d=(l=r.resourceTiming)===null||l===void 0?void 0:l[this.id];if(!d)return;const _=d.slice(0);_?.length&&h.e(t,{resourceTiming:_})}_applyDiffToSource(t){if(!t)return;const r=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const d=h.a7(this._data.geojson,r);if(!d)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:d}}if(!this._data.updateable)return;const l=h.a8(this._data.updateable,t,r);return t.removeAll||this._options.cluster?void 0:l}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((r=>vl(r)))}}shouldReloadTile(t,{affectedBounds:r}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:l,extent:d}=this.workerOptions.geojsonVtOptions,_=(function({x:v,y:b,z:S},C=0){const z=h.a3((v-C)/Math.pow(2,S)),L=h.a4((b+1+C)/Math.pow(2,S)),R=h.a3((v+1+C)/Math.pow(2,S)),j=h.a4((b-C)/Math.pow(2,S));return new Wi([z,L],[R,j])})(t.tileID.canonical,l/d);for(const v of r)if(_.intersects(v))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return h._(this,void 0,void 0,(function*(){const r=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const d=yield this.actor.sendAsync({type:r,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(d,this.map.painter,r==="RT")}))}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Oa extends h.E{constructor(t,r,l,d){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=r}load(t){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield Pt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,t&&(this.coordinates=t),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,h.Z(r)||this.fire(new h.k(r))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const r=t.map(h.a9.fromLngLat);var l;return this.tileID=(function(d){const _=h.aa.fromPoints(d),v=_.width(),b=_.height(),S=Math.max(v,b),C=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),z=Math.pow(2,C);return new h.ac(C,Math.floor((_.minX+_.maxX)/2*z),Math.floor((_.minY+_.maxY)/2*z))})(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map((d=>this.tileID.getTilePoint(d)._round())),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,r=t.gl;this.texture||(this.texture=new h.T(t,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return h._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:r,minY:l,maxX:d,maxY:_}=h.aa.fromPoints(t),v={};for(let b=0;b<=h.ab;b++){const S=Math.pow(2,b),C=Math.floor(r*S),z=Math.floor(l*S),L=Math.floor(d*S),R=Math.floor(_*S),j=(C%S+S)%S,G=L%S,$=Math.floor(C/S),K=Math.floor(L/S);v[b]={minWrap:$,maxWrap:K,minTileXWrapped:j,maxTileXWrapped:G,minTileY:z,maxTileY:R}}return v}}class xl extends Oa{constructor(t,r,l,d){super(t,r,l,d),this.roundZoom=!0,this.type="video",this.options=r}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const r of t.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield h.ad(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new h.k(r))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new h.k(new h.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,r=t.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new h.T(t,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ws extends Oa{constructor(t,r,l,d){super(t,r,l,d),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some((_=>!Array.isArray(_)||_.length!==2||_.some((v=>typeof v!="number"))))||this.fire(new h.k(new h.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.k(new h.ae(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new h.k(new h.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new h.k(new h.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.k(new h.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,l=r.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new h.T(r,this.canvas,l.RGBA,{premultiply:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let d=!1;for(const _ in this.tiles){const v=this.tiles[_];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,d=!0)}d&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Ts={},lu=m=>{switch(m){case"geojson":return Ln;case"image":return Oa;case"raster":return bs;case"raster-dem":return Hr;case"vector":return $s;case"video":return xl;case"canvas":return ws}return Ts[m]},Xs="RTLPluginLoaded";class xe extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=qr()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((r=>{throw this.status="error",r}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return h._(this,arguments,void 0,(function*(r,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Tt.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return h._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.l(Xs))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let B=null;function N(){return B||(B=new xe),B}var U,ie;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(U||(U={})),(function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"})(ie||(ie={}));class ue{constructor(t,r){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=h.af(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttFingerprint={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:r,fadingParentID:l,fadeEndTime:d}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=r,this.fadingParentID=l,this.fadeEndTime=d}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=bt(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,r,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(d,_){const v={};if(!_)return v;for(const b of d){const S=b.layerIds.map((C=>_.getLayer(C))).filter(Boolean);if(S.length!==0){b.layers=S,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map((C=>S.filter((z=>z.id===C))[0])));for(const C of S)v[C.id]=b}}return v})(t.buckets,r?.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof h.ah){if(this.hasSymbolBuckets=!0,!l)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof h.ah&&_.hasRTLText){this.hasRTLText=!0,N().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const _=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(d).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new h.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const d=this.buckets[l];d.uploadPending()&&d.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new h.T(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new h.T(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,l,d,_,v,b,S,C,z,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:_,scale:v,tileSize:this.tileSize,pixelPosMatrix:z,transform:S,params:b,queryPadding:this.queryPadding*C,getElevation:L},t,r,l):{}}querySourceFeatures(t,r){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const d=l.loadVTLayers(),_=r&&r.sourceLayer?r.sourceLayer:"",v=d[h.ai]||d[_];if(!v)return;const b=h.aj(r?.filter,r?.globalState),{z:S,x:C,y:z}=this.tileID.canonical,L={z:S,x:C,y:z};for(let R=0;R<v.length;R++){const j=v.feature(R);if(b.needGeometry){const K=h.ak(j,!0);if(!b.filter(new h.H(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!b.filter(new h.H(this.tileID.overscaledZ),j))continue;const G=l.getId(j,_),$=new h.al(j,S,C,z,G);$.tile=L,t.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const l=h.am(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let d=!1;if(this.expirationTime>l)d=!1;else if(r)if(this.expirationTime<r)d=!0;else{const _=this.expirationTime-r;_?this.expirationTime=l+Math.max(_,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const _=this.buckets[d],v=_.layers[0].sourceLayer||h.ai,b=l[v],S=t[v];if(!b||!S||Object.keys(S).length===0)continue;_.update(S,b,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const C=r&&r.style&&r.style.getLayer(d);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(_)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<bt()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=bt()+t}setDependencies(t,r){const l={};for(const d of r)l[d]=!0;this.dependencies[t]=l}hasDependency(t,r){for(const l of t){const d=this.dependencies[l];if(d){for(const _ of r)if(d[_])return!0}}return!1}}class Me{constructor(){this.state={},this.stateChanges={},this.deletedStates={},this.revision=0}updateState(t,r,l){const d=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][d]=this.stateChanges[t][d]||{},h.e(this.stateChanges[t][d],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==d&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][d]===null){this.deletedStates[t][d]={};for(const _ in this.state[t][d])l[_]||(this.deletedStates[t][d][_]=null)}else for(const _ in l)this.deletedStates[t]&&this.deletedStates[t][d]&&this.deletedStates[t][d][_]===null&&delete this.deletedStates[t][d][_]}removeFeatureState(t,r,l){if(this.deletedStates[t]===null)return;const d=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&r!==void 0)this.deletedStates[t][d]!==null&&(this.deletedStates[t][d]=this.deletedStates[t][d]||{},this.deletedStates[t][d][l]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][d])for(l in this.deletedStates[t][d]={},this.stateChanges[t][d])this.deletedStates[t][d][l]=null;else this.deletedStates[t][d]=null;else this.deletedStates[t]=null}getState(t,r){const l=String(r),d=h.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][r];if(_===null)return{};for(const v in _)delete d[v]}return d}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const l={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const _={};for(const v in this.stateChanges[d])this.state[d][v]||(this.state[d][v]={}),h.e(this.state[d][v],this.stateChanges[d][v]),_[v]=this.state[d][v];l[d]=_}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const _={};if(this.deletedStates[d]===null)for(const v in this.state[d])_[v]={},this.state[d][v]={};else for(const v in this.deletedStates[d]){if(this.deletedStates[d][v]===null)this.state[d][v]={};else for(const b of Object.keys(this.deletedStates[d][v]))delete this.state[d][v][b];_[v]=this.state[d][v]}l[d]=l[d]||{},h.e(l[d],_)}this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0&&(this.revision++,t.setFeatureState(l,r))}}const Te=89.25;function be(m,t){const r=h.an(t.lat,-h.ao,h.ao);return new h.P(h.Y(t.lng)*m,h.X(r)*m)}function Se(m,t){return new h.a9(t.x/m,t.y/m).toLngLat()}function He(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(h.ap(90-m.pitch)),Math.tan(h.ap(Te-m.pitch)))}function Be(m,t){const r=m.canonical,l=t/h.aq(r.z),d=r.x+Math.pow(2,r.z)*m.wrap,_=h.ar(new Float64Array(16));return h.O(_,_,[d*l,r.y*l,0]),h.Q(_,_,[l/h.a5,l/h.a5,1]),_}function le(m,t,r,l,d){const _=h.a9.fromLngLat(m,t),v=d*h.as(1,m.lat),{x:b,y:S,z:C}=mt(r,l);return new h.a9(_.x+v*-b,_.y+v*-S,_.z+v*-C)}function mt(m,t){const r=h.ap(m),l=h.ap(t),d=Math.cos(-r),_=Math.sin(r);return{x:_*Math.sin(l),y:-_*Math.cos(l),z:d}}function Bt(m,t,r){const l=t.intersectsFrustum(m);if(!r||l===0)return l;const d=t.intersectsPlane(r);return d===0?0:l===2&&d===2?2:1}function Et(m,t,r){let l=0;const d=(r-t)/10;for(let _=0;_<10;_++)l+=d*Math.pow(Math.cos(t+(_+.5)/10*(r-t)),m);return l}function zt(m,t){return function(r,l,d,_,v){const b=2*((m-1)/h.at(Math.cos(h.ap(Te-v))/Math.cos(h.ap(Te)))-1),S=Math.acos(d/_),C=2*Et(b-1,0,h.ap(v/2)),z=Math.min(h.ap(Te),S+h.ap(v/2)),L=Et(b-1,Math.min(z,S-h.ap(v/2)),z),R=Math.atan(l/d),j=Math.hypot(l,d);let G=r;return G+=h.at(_/j/Math.max(.5,Math.cos(h.ap(v/2)))),G+=b*h.at(Math.cos(R))/2,G-=h.at(Math.max(1,L/C/t))/2,G}}const Dt=zt(9.314,3);function Ft(m,t){const r=(t.roundZoom?Math.round:Math.floor)(m.zoom+h.at(m.tileSize/t.tileSize));return Math.max(0,r)}function Ki(m,t){const r=m.getCameraFrustum(),l=m.getClippingPlane(),d=m.screenPointToMercatorCoordinate(m.getCameraPoint()),_=h.a9.fromLngLat(m.center,m.elevation);d.z=_.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const v=m.getCoveringTilesDetailsProvider(),b=v.allowVariableZoom(m,t),S=Ft(m,t),C=t.minzoom||0,z=t.maxzoom!==void 0?t.maxzoom:m.maxZoom,L=Math.min(Math.max(0,S),z),R=Math.pow(2,L),j=[R*d.x,R*d.y,0],G=[R*_.x,R*_.y,0],$=Math.hypot(_.x-d.x,_.y-d.y),K=Math.abs(_.z-d.z),W=Math.hypot($,K),te=se=>({zoom:0,x:0,y:0,wrap:se,fullyVisible:!1}),oe=[],ee=[];if(m.renderWorldCopies&&v.allowWorldCopies())for(let se=1;se<=3;se++)oe.push(te(-se)),oe.push(te(se));for(oe.push(te(0));oe.length>0;){const se=oe.pop(),ce=se.x,ne=se.y;let _e=se.fullyVisible;const Ie={x:ce,y:ne,z:se.zoom},Ee=v.getTileBoundingVolume(Ie,se.wrap,m.elevation,t);if(!_e){const tt=Bt(r,Ee,l);if(tt===0)continue;_e=tt===2}const ze=v.distanceToTile2d(d.x,d.y,Ie,Ee);let De=S;b&&(De=(t.calculateTileZoom||Dt)(m.zoom+h.at(m.tileSize/t.tileSize),ze,K,W,m.fov)),De=(t.roundZoom?Math.round:Math.floor)(De),De=Math.max(0,De);const et=Math.min(De,z);if(se.wrap=v.getWrap(_,Ie,se.wrap),se.zoom>=et){if(se.zoom<C)continue;const tt=L-se.zoom,qe=j[0]-.5-(ce<<tt),rt=j[1]-.5-(ne<<tt),Vt=t.reparseOverscaled?Math.max(se.zoom,De):se.zoom;ee.push({tileID:new h.a2(se.zoom===z?Vt:se.zoom,se.wrap,se.zoom,ce,ne),distanceSq:h.au([G[0]-.5-ce,G[1]-.5-ne]),tileDistanceToCamera:Math.sqrt(qe*qe+rt*rt)})}else for(let tt=0;tt<4;tt++)oe.push({zoom:se.zoom+1,x:(ce<<1)+tt%2,y:(ne<<1)+(tt>>1),wrap:se.wrap,fullyVisible:_e})}return ee.sort(((se,ce)=>se.distanceSq-ce.distanceSq)).map((se=>se.tileID))}const hn=h.aa.fromPoints([new h.P(0,0),new h.P(h.a5,h.a5)]);function sn(m){return m==="raster"||m==="image"||m==="video"}function Qn(m,t,r,l,d,_,v){if(!t.hasData())return!1;const{tileID:b,fadingRole:S,fadingDirection:C,fadingParentID:z}=t;if(S===U.Base&&C===ie.Incoming&&z)return r[z.key]=z,!0;const L=Math.max(b.overscaledZ-d,_);for(let R=b.overscaledZ-1;R>=L;R--){const j=b.scaledTo(R),G=m.getLoadedTile(j);if(G)return t.setCrossFadeLogic({fadingRole:U.Base,fadingDirection:ie.Incoming,fadingParentID:G.tileID,fadeEndTime:l+v}),G.setCrossFadeLogic({fadingRole:U.Parent,fadingDirection:ie.Departing,fadeEndTime:l+v}),r[j.key]=j,!0}return!1}function Qi(m,t,r,l,d,_){if(!t.hasData())return!1;const v=t.tileID.children(d);let b=We(m,t,v,r,l,d,_);if(b)return!0;for(const S of v)We(m,t,S.children(d),r,l,d,_)&&(b=!0);return b}function We(m,t,r,l,d,_,v){if(r[0].overscaledZ>=_)return!1;let b=!1;for(const S of r){const C=m.getLoadedTile(S);if(!C)continue;const{fadingRole:z,fadingDirection:L,fadingParentID:R}=C;z===U.Base&&L===ie.Departing&&R||(C.setCrossFadeLogic({fadingRole:U.Base,fadingDirection:ie.Departing,fadingParentID:t.tileID,fadeEndTime:d+v}),t.setCrossFadeLogic({fadingRole:U.Parent,fadingDirection:ie.Incoming,fadeEndTime:d+v})),l[S.key]=S,b=!0}return b}function _i(m,t,r,l){const d=m.tileID;return!!m.selfFading||!m.hasData()&&!!t.has(d)&&(m.setSelfFadeLogic(r+l),!0)}function qi(m,t){var r;m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let l=t.tileID.canonical.x-m.tileID.canonical.x;const d=t.tileID.canonical.y-m.tileID.canonical.y,_=Math.pow(2,m.tileID.canonical.z),v=t.tileID.key;l===0&&d===0||Math.abs(d)>1||(Math.abs(l)>1&&(Math.abs(l+_)===1?l+=_:Math.abs(l-_)===1&&(l-=_)),t.dem&&m.dem&&(m.dem.backfillBorder(t.dem,l,d),!((r=m.neighboringTiles)===null||r===void 0)&&r[v]&&(m.neighboringTiles[v].backfilled=!0)))}class ba{constructor(){this._tiles={}}handleWrapJump(t){const r={};for(const l in this._tiles){const d=this._tiles[l];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+t),r[d.tileID.key]=d}this._tiles=r}setFeatureState(t,r){for(const l in this._tiles)this._tiles[l].setFeatureState(t,r)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((r=>r.tileID)).sort(h.aw).map((r=>r.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,r){this._tiles[t]=r}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const r=this.getTileById(t.key);return r?.hasData()?r:null}isIdRenderable(t,r=!1){var l;return(l=this.getTileById(t))===null||l===void 0?void 0:l.isRenderable(r)}getRenderableIds(t=0,r){const l=[];for(const d of this.getAllIds())this.isIdRenderable(d,r)&&l.push(this.getTileById(d));return r?l.sort(((d,_)=>{const v=d.tileID,b=_.tileID,S=new h.P(v.canonical.x,v.canonical.y)._rotate(-t),C=new h.P(b.canonical.x,b.canonical.y)._rotate(-t);return v.overscaledZ-b.overscaledZ||C.y-S.y||C.x-S.x})).map((d=>d.tileID.key)):l.map((d=>d.tileID)).sort(h.aw).map((d=>d.key))}}class Ei extends h.E{constructor(t,r,l){super(),this.id=t,this.dispatcher=l,this.on("data",(d=>this._dataHandler(d))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((d,_,v,b)=>{const S=new(lu(_.type))(d,_,v,b);if(S.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${S.id}`);return S})(t,r,l,this),this._inViewTiles=new ba,this._outOfViewCache=new h.ax(0,(d=>this._unloadTile(d))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Me,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const r of this._inViewTiles.getAllTiles())r.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new ba}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,r,l){return h._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,r,l)}catch(d){t.state="errored",d.status!==404?this._source.fire(new h.k(d,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new h.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const r of this._inViewTiles.getAllTiles())r.upload(t),r.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var r;return this._inViewTiles.getRenderableIds((r=this.transform)===null||r===void 0?void 0:r.bearingInRadians,t)}hasRenderableParent(t){const r=t.overscaledZ-1;if(r>=this._source.minzoom){const l=this.getLoadedTile(t.scaledTo(r));if(l)return this._inViewTiles.isIdRenderable(l.tileID.key)}return!1}reload(t,r=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const l of this._inViewTiles.getAllIds()){const d=this._inViewTiles.getTileById(l);r&&!this._source.shouldReloadTile(d,r)||(t?this._reloadTile(l,"expired"):d.state!=="errored"&&this._reloadTile(l,"reloading"))}}}_reloadTile(t,r){return h._(this,void 0,void 0,(function*(){const l=this._inViewTiles.getTileById(t);l&&(l.state!=="loading"&&(l.state=r),yield this._loadTile(l,t,r))}))}_tileLoaded(t,r,l){t.timeAdded=bt(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this.getSource().type==="raster-dem"&&t.dem&&(function(d,_){var v,b;const S=_.getRenderableIds();for(const C of S){if(!d.neighboringTiles||!d.neighboringTiles[C])continue;const z=_.getTileById(C);d.neighboringTiles[C].backfilled||qi(d,z),!((b=(v=z.neighboringTiles)===null||v===void 0?void 0:v[d.tileID.key])===null||b===void 0)&&b.backfilled||qi(z,d)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new h.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,r){const l=this._getLoadedDescendents(r),d=new Set;for(const _ of r){const v=l[_.key];if(!v?.length){d.add(_);continue}const b=_.overscaledZ+Ei.maxOverzooming,S=v.filter((L=>L.tileID.overscaledZ<=b));if(!S.length){d.add(_);continue}const C=Math.min(...S.map((L=>L.tileID.overscaledZ))),z=S.filter((L=>L.tileID.overscaledZ===C)).map((L=>L.tileID));for(const L of z)t[L.key]=L;this._areDescendentsComplete(z,C,_.overscaledZ)||d.add(_)}return d}_getLoadedDescendents(t){var r;const l={};for(const d of this._inViewTiles.getAllTiles().filter((_=>_.hasData())))for(const _ of t)d.tileID.isChildOf(_)&&(l[r=_.key]||(l[r]=[])).push(d);return l}_areDescendentsComplete(t,r,l){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===r:Math.pow(4,r-l)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const r=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,d=Math.floor(r*l*(this._maxTileCacheZoomLevels===null?h.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._outOfViewCache.setMaxSize(_)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,r&&(this._inViewTiles.handleWrapJump(r),this._resetTileReloadTimers())}update(t,r){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=r,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((S=>new h.a2(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y))):(l=Ki(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter((S=>this._source.hasTile(S))))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const d=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,d&&this.fire(new h.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=Ft(t,this._source),v=this._updateRetainedTiles(l,_),b=sn(this._source.type);b&&this._rasterFadeDuration>0&&!r&&(function(S,C,z,L,R,j,G){const $=bt(),K=h.av(C);for(const W of C){const te=S.getTileById(W.key);te.fadingDirection!==ie.Departing&&te.fadeOpacity!==0||te.resetFadeLogic(),Qn(S,te,z,$,L,R,G)||Qi(S,te,z,$,j,G)||_i(te,K,$,G)||te.resetFadeLogic()}})(this._inViewTiles,l,v,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),b?this._cleanUpRasterTiles(v):this._cleanUpVectorTiles(v)}_cleanUpRasterTiles(t){for(const r of this._inViewTiles.getAllIds())t[r]||this._removeTile(r)}_cleanUpVectorTiles(t){for(const r of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(r);t[r]?l.clearSymbolFadeHold():l.hasSymbolBuckets?l.holdingForSymbolFade()?l.symbolFadeFinished()&&this._removeTile(r):l.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(r)}}_addTerrainIdealTiles(t){const r=[];for(const l of t)if(l.canonical.z>this._source.minzoom){const d=l.scaledTo(l.canonical.z-1);r.push(d);const _=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));r.push(_)}return t.concat(r)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,r){var l;const d=new Set;for(const C of t)this._addTile(C).hasData()||d.add(C);const _=t.reduce(((C,z)=>(C[z.key]=z,C)),{}),v=this._retainLoadedChildren(_,d),b={},S=Math.max(r-Ei.maxUnderzooming,this._source.minzoom);for(const C of v){let z=this._inViewTiles.getTileById(C.key),L=z?.wasRequested();for(let R=C.overscaledZ-1;R>=S;--R){const j=C.scaledTo(R);if(b[j.key])break;if(b[j.key]=!0,z=this.getTile(j),!z&&L&&(z=this._addTile(j)),z){const G=z.hasData();if((G||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||L)&&(_[j.key]=j),L=z.wasRequested(),G)break}}}return _}_addTile(t){let r=this._inViewTiles.getTileById(t.key);if(r)return r;r=this._outOfViewCache.getAndRemove(t),r&&(r.resetFadeLogic(),this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null));const l=r;return r||(r=new ue(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(r,t.key,r.state)),r.uses++,this._inViewTiles.setTile(t.key,r),l||this._source.fire(new h.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){this._clearTileReloadTimer(t);const l=r.getExpiryTimeout();l&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),l))}_clearTileReloadTimer(t){const r=this._timers[t];r&&(clearTimeout(r),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const r=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,r)}}refreshTiles(t){for(const r of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(r);(this._inViewTiles.isIdRenderable(r)||l.state=="errored")&&t.some((d=>d.equals(l.tileID.canonical)))&&this._reloadTile(r,"expired")}}_removeTile(t){const r=this._inViewTiles.getTileById(t);r&&(r.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._outOfViewCache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,r,l){const d=[],_=this.transform;if(!_)return d;const v=_.getCoveringTilesDetailsProvider().allowWorldCopies(),b=l?_.getCameraQueryGeometry(t):t,S=j=>_.screenPointToMercatorCoordinate(j,this.terrain),C=this.transformBbox(t,S,!v),z=this.transformBbox(b,S,!v),L=this.getIds(),R=h.aa.fromPoints(z);for(let j=0;j<L.length;j++){const G=this._inViewTiles.getTileById(L[j]);if(G.holdingForSymbolFade())continue;const $=v?[G.tileID]:[G.tileID.unwrapTo(-1),G.tileID.unwrapTo(0)],K=Math.pow(2,_.zoom-G.tileID.overscaledZ),W=r*G.queryPadding*h.a5/G.tileSize/K;for(const te of $){const oe=R.map((ee=>te.getTilePoint(new h.a9(ee.x,ee.y))));if(oe.expandBy(W),oe.intersects(hn)){const ee=C.map((ce=>te.getTilePoint(ce))),se=z.map((ce=>te.getTilePoint(ce)));d.push({tile:G,tileID:v?te:te.unwrapTo(0),queryGeometry:ee,cameraQueryGeometry:se,scale:K})}}}return d}transformBbox(t,r,l){let d=t.map(r);if(l){const _=h.aa.fromPoints(t);_.shrinkBy(.001*Math.min(_.width(),_.height()));const v=_.map(r);h.aa.fromPoints(d).covers(v)||(d=d.map((b=>b.x>.5?new h.a9(b.x-1,b.y,b.z):b)))}return d}getVisibleCoordinates(t){const r=this.getRenderableIds(t).map((l=>this._inViewTiles.getTileById(l).tileID));return this.transform&&this.transform.populateCache(r),r}hasTransition(){return!!this._source.hasTransition()||!(!sn(this._source.type)||!(function(t,r){if(r<=0)return!1;const l=bt();for(const d of t.getAllTiles())if(d.fadeEndTime>=l)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,r,l){this._state.updateState(t=t||h.ai,r,l)}removeFeatureState(t,r,l){this._state.removeFeatureState(t=t||h.ai,r,l)}getFeatureState(t,r){return this._state.getState(t=t||h.ai,r)}setDependencies(t,r,l){const d=this._inViewTiles.getTileById(t);d&&d.setDependencies(r,l)}reloadTilesForDependencies(t,r){for(const l of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(l).hasDependency(t,r)&&this._reloadTile(l,"reloading");this._outOfViewCache.filter((l=>!l.hasDependency(t,r)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Ei.maxUnderzooming=10,Ei.maxOverzooming=3;class Je{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=h.an(t,0,1);let r=1,l=this._distances[r];const d=t*this.paddedLength+this.padding;for(;l<d&&r<this._distances.length;)l=this._distances[++r];const _=r-1,v=this._distances[_],b=l-v,S=b>0?(d-v)/b:0;return this.points[_].mult(1-S).add(this.points[r].mult(S))}}function Ct(m,t){let r=!0;return m==="always"||m!=="never"&&t!=="never"||(r=!1),r}class Gt{constructor(t,r,l){const d=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(r/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)d.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,l,d,_){this._forEachCell(r,l,d,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(_)}insertCircle(t,r,l,d){this._forEachCell(r-d,l-d,r+d,l+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(l),this.circles.push(d)}_insertBoxCell(t,r,l,d,_,v){this.boxCells[_].push(v)}_insertCircleCell(t,r,l,d,_,v){this.circleCells[_].push(v)}_query(t,r,l,d,_,v,b){if(l<0||t>this.width||d<0||r>this.height)return[];const S=[];if(t<=0&&r<=0&&this.width<=l&&this.height<=d){if(_)return[{key:null,x1:t,y1:r,x2:l,y2:d}];for(let C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const z=this.circles[3*C],L=this.circles[3*C+1],R=this.circles[3*C+2];S.push({key:this.circleKeys[C],x1:z-R,y1:L-R,x2:z+R,y2:L+R})}}else this._forEachCell(t,r,l,d,this._queryCell,S,{hitTest:_,overlapMode:v,seenUids:{box:{},circle:{}}},b);return S}query(t,r,l,d){return this._query(t,r,l,d,!1,null)}hitTest(t,r,l,d,_,v){return this._query(t,r,l,d,!0,_,v).length>0}hitTestCircle(t,r,l,d,_){const v=t-l,b=t+l,S=r-l,C=r+l;if(b<0||v>this.width||C<0||S>this.height)return!1;const z=[];return this._forEachCell(v,S,b,C,this._queryCellCircle,z,{hitTest:!0,overlapMode:d,circle:{x:t,y:r,radius:l},seenUids:{box:{},circle:{}}},_),z.length>0}_queryCell(t,r,l,d,_,v,b,S){const{seenUids:C,hitTest:z,overlapMode:L}=b,R=this.boxCells[_];if(R!==null){const G=this.bboxes;for(const $ of R)if(!C.box[$]){C.box[$]=!0;const K=4*$,W=this.boxKeys[$];if(t<=G[K+2]&&r<=G[K+3]&&l>=G[K+0]&&d>=G[K+1]&&(!S||S(W))&&(!z||!Ct(L,W.overlapMode))&&(v.push({key:W,x1:G[K],y1:G[K+1],x2:G[K+2],y2:G[K+3]}),z))return!0}}const j=this.circleCells[_];if(j!==null){const G=this.circles;for(const $ of j)if(!C.circle[$]){C.circle[$]=!0;const K=3*$,W=this.circleKeys[$];if(this._circleAndRectCollide(G[K],G[K+1],G[K+2],t,r,l,d)&&(!S||S(W))&&(!z||!Ct(L,W.overlapMode))){const te=G[K],oe=G[K+1],ee=G[K+2];if(v.push({key:W,x1:te-ee,y1:oe-ee,x2:te+ee,y2:oe+ee}),z)return!0}}}return!1}_queryCellCircle(t,r,l,d,_,v,b,S){const{circle:C,seenUids:z,overlapMode:L}=b,R=this.boxCells[_];if(R!==null){const G=this.bboxes;for(const $ of R)if(!z.box[$]){z.box[$]=!0;const K=4*$,W=this.boxKeys[$];if(this._circleAndRectCollide(C.x,C.y,C.radius,G[K+0],G[K+1],G[K+2],G[K+3])&&(!S||S(W))&&!Ct(L,W.overlapMode))return v.push(!0),!0}}const j=this.circleCells[_];if(j!==null){const G=this.circles;for(const $ of j)if(!z.circle[$]){z.circle[$]=!0;const K=3*$,W=this.circleKeys[$];if(this._circlesCollide(G[K],G[K+1],G[K+2],C.x,C.y,C.radius)&&(!S||S(W))&&!Ct(L,W.overlapMode))return v.push(!0),!0}}}_forEachCell(t,r,l,d,_,v,b,S){const C=this._convertToXCellCoord(t),z=this._convertToYCellCoord(r),L=this._convertToXCellCoord(l),R=this._convertToYCellCoord(d);for(let j=C;j<=L;j++)for(let G=z;G<=R;G++)if(_.call(this,t,r,l,d,this.xCellCount*G+j,v,b,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,l,d,_,v){const b=d-t,S=_-r,C=l+v;return C*C>b*b+S*S}_circleAndRectCollide(t,r,l,d,_,v,b){const S=(v-d)/2,C=Math.abs(t-(d+S));if(C>S+l)return!1;const z=(b-_)/2,L=Math.abs(r-(_+z));if(L>z+l)return!1;if(C<=S||L<=z)return!0;const R=C-S,j=L-z;return R*R+j*j<=l*l}}function Ba(m,t,r){const l=h.N();if(!m){const{vecSouth:L,vecEast:R}=$r(t),j=ke();j[0]=R[0],j[1]=R[1],j[2]=L[0],j[3]=L[1],d=j,(z=(v=(_=j)[0])*(C=_[3])-(S=_[2])*(b=_[1]))&&(d[0]=C*(z=1/z),d[1]=-b*z,d[2]=-S*z,d[3]=v*z),l[0]=j[0],l[1]=j[1],l[4]=j[2],l[5]=j[3]}var d,_,v,b,S,C,z;return h.Q(l,l,[1/r,1/r,1]),l}function hc(m,t,r,l){if(m){const d=h.N();if(!t){const{vecSouth:_,vecEast:v}=$r(r);d[0]=v[0],d[1]=v[1],d[4]=_[0],d[5]=_[1]}return h.Q(d,d,[l,l,1]),d}return r.pixelsToClipSpaceMatrix}function $r(m){const t=Math.cos(m.rollInRadians),r=Math.sin(m.rollInRadians),l=Math.cos(m.pitchInRadians),d=Math.cos(m.bearingInRadians),_=Math.sin(m.bearingInRadians),v=h.aC();v[0]=-d*l*r-_*t,v[1]=-_*l*r+d*t;const b=h.aD(v);b<1e-9?h.aE(v):h.aF(v,v,1/b);const S=h.aC();S[0]=d*l*t-_*r,S[1]=_*l*t+d*r;const C=h.aD(S);return C<1e-9?h.aE(S):h.aF(S,S,1/C),{vecEast:S,vecSouth:v}}function qt(m,t,r,l){let d;l?(d=[m,t,l(m,t),1],h.aH(d,d,r)):(d=[m,t,0,1],rr(d,d,r));const _=d[3];return{point:new h.P(d[0]/_,d[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function Co(m,t){return .5+m/t*.5}function Xr(m,t){return m.x>=-t[0]&&m.x<=t[0]&&m.y>=-t[1]&&m.y<=t[1]}function Ss(m,t,r,l,d,_,v,b,S,C,z,L,R){const j=r?m.textSizeData:m.iconSizeData,G=h.ay(j,t.transform.zoom),$=[256/t.width*2+1,256/t.height*2+1],K=r?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;K.clear();const W=m.lineVertexArray,te=r?m.text.placedSymbolArray:m.icon.placedSymbolArray,oe=t.transform.width/t.transform.height;let ee=!1;for(let se=0;se<te.length;se++){const ce=te.get(se);if(ce.hidden||ce.writingMode===h.az.vertical&&!ee){Kr(ce.numGlyphs,K);continue}ee=!1;const ne=new h.P(ce.anchorX,ce.anchorY),_e={getElevation:R,pitchedLabelPlaneMatrix:l,lineVertexArray:W,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:ne,unwrappedTileID:S,width:C,height:z,translation:L},Ie=wl(ce.anchorX,ce.anchorY,_e);if(!Xr(Ie.point,$)){Kr(ce.numGlyphs,K);continue}const Ee=Co(t.transform.cameraToCenterDistance,Ie.signedDistanceFromCamera),ze=h.aA(j,G,ce),De=_?ze*t.transform.getPitchedTextCorrection(ce.anchorX,ce.anchorY,S)/Ee:ze*Ee,et=dn({projectionContext:_e,pitchedLabelPlaneMatrixInverse:d,symbol:ce,fontSize:De,flip:!1,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:K,aspectRatio:oe,rotateToLine:b});ee=et.useVertical,(et.notEnoughRoom||ee||et.needsFlipping&&dn({projectionContext:_e,pitchedLabelPlaneMatrixInverse:d,symbol:ce,fontSize:De,flip:!0,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:K,aspectRatio:oe,rotateToLine:b}).notEnoughRoom)&&Kr(ce.numGlyphs,K)}r?m.text.dynamicLayoutVertexBuffer.updateData(K):m.icon.dynamicLayoutVertexBuffer.updateData(K)}function Yr(m,t,r,l,d,_,v,b){const S=_.glyphStartIndex+_.numGlyphs,C=_.lineStartIndex,z=_.lineStartIndex+_.lineLength,L=t.getoffsetX(_.glyphStartIndex),R=t.getoffsetX(S-1),j=Ar(m*L,r,l,d,_.segment,C,z,b,v);if(!j)return null;const G=Ar(m*R,r,l,d,_.segment,C,z,b,v);return G?b.projectionCache.anyProjectionOccluded?null:{first:j,last:G}:null}function Wr(m,t,r,l){return m===h.az.horizontal&&Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*l?{useVertical:!0}:(m===h.az.vertical?t.y<r.y:t.x>r.x)?{needsFlipping:!0}:null}function dn(m){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:r,symbol:l,fontSize:d,flip:_,keepUpright:v,glyphOffsetArray:b,dynamicLayoutVertexArray:S,aspectRatio:C,rotateToLine:z}=m,L=d/24,R=l.lineOffsetX*L,j=l.lineOffsetY*L;let G;if(l.numGlyphs>1){const $=l.glyphStartIndex+l.numGlyphs,K=l.lineStartIndex,W=l.lineStartIndex+l.lineLength,te=Yr(L,b,R,j,_,l,z,t);if(!te)return{notEnoughRoom:!0};const oe=Ms(te.first.point.x,te.first.point.y,t,r),ee=Ms(te.last.point.x,te.last.point.y,t,r);if(v&&!_){const se=Wr(l.writingMode,oe,ee,C);if(se)return se}G=[te.first];for(let se=l.glyphStartIndex+1;se<$-1;se++){const ce=Ar(L*b.getoffsetX(se),R,j,_,l.segment,K,W,t,z);if(!ce)return{notEnoughRoom:!0};G.push(ce)}G.push(te.last)}else{if(v&&!_){const K=ci(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,W=l.lineStartIndex+l.segment+1,te=new h.P(t.lineVertexArray.getx(W),t.lineVertexArray.gety(W)),oe=ci(te.x,te.y,t),ee=oe.signedDistanceFromCamera>0?oe.point:bl(t.tileAnchorPoint,te,K,1,t),se=Ms(K.x,K.y,t,r),ce=Ms(ee.x,ee.y,t,r),ne=Wr(l.writingMode,se,ce,C);if(ne)return ne}const $=Ar(L*b.getoffsetX(l.glyphStartIndex),R,j,_,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,t,z);if(!$||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};G=[$]}for(const $ of G)h.aG(S,$.point,$.angle);return{}}function bl(m,t,r,l,d){const _=m.add(m.sub(t)._unit()),v=ci(_.x,_.y,d).point,b=r.sub(v);return r.add(b._mult(l/b.mag()))}function na(m,t,r){const l=t.projectionCache;if(l.projections[m])return l.projections[m];const d=new h.P(t.lineVertexArray.getx(m),t.lineVertexArray.gety(m)),_=ci(d.x,d.y,t);if(_.signedDistanceFromCamera>0)return l.projections[m]=_.point,l.anyProjectionOccluded=l.anyProjectionOccluded||_.isOccluded,_.point;const v=m-r.direction;return bl(r.distanceFromAnchor===0?t.tileAnchorPoint:new h.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),d,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,t)}function ci(m,t,r){const l=m+r.translation[0],d=t+r.translation[1];let _;return r.pitchWithMap?(_=qt(l,d,r.pitchedLabelPlaneMatrix,r.getElevation),_.isOccluded=!1):(_=r.transform.projectTileCoordinates(l,d,r.unwrappedTileID,r.getElevation),_.point.x=(.5*_.point.x+.5)*r.width,_.point.y=(.5*-_.point.y+.5)*r.height),_}function Ms(m,t,r,l){if(r.pitchWithMap){const d=[m,t,0,1];return h.aH(d,d,l),r.transform.projectTileCoordinates(d[0]/d[3],d[1]/d[3],r.unwrappedTileID,r.getElevation).point}return{x:m/r.width*2-1,y:1-t/r.height*2}}function wl(m,t,r){return r.transform.projectTileCoordinates(m,t,r.unwrappedTileID,r.getElevation)}function Tl(m,t,r){return m._unit()._perp()._mult(t*r)}function Ys(m,t,r,l,d,_,v,b,S){if(b.projectionCache.offsets[m])return b.projectionCache.offsets[m];const C=r.add(t);if(m+S.direction<l||m+S.direction>=d)return b.projectionCache.offsets[m]=C,C;const z=na(m+S.direction,b,S),L=Tl(z.sub(r),v,S.direction),R=r.add(L),j=z.add(L);return b.projectionCache.offsets[m]=h.aI(_,C,R,j)||C,b.projectionCache.offsets[m]}function Ar(m,t,r,l,d,_,v,b,S){const C=l?m-t:m+t;let z=C>0?1:-1,L=0;l&&(z*=-1,L=Math.PI),z<0&&(L+=Math.PI);let R,j=z>0?_+d:_+d+1;b.projectionCache.cachedAnchorPoint?R=b.projectionCache.cachedAnchorPoint:(R=ci(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=R);let G,$,K=R,W=R,te=0,oe=0;const ee=Math.abs(C),se=[];let ce;for(;te+oe<=ee;){if(j+=z,j<_||j>=v)return null;te+=oe,W=K,$=G;const Ie={absOffsetX:ee,direction:z,distanceFromAnchor:te,previousVertex:W};if(K=na(j,b,Ie),r===0)se.push(W),ce=K.sub(W);else{let Ee;const ze=K.sub(W);Ee=ze.mag()===0?Tl(na(j+z,b,Ie).sub(K),r,z):Tl(ze,r,z),$||($=W.add(Ee)),G=Ys(j,Ee,K,_,v,$,r,b,Ie),se.push($),ce=G.sub($)}oe=ce.mag()}const ne=ce._mult((ee-te)/oe)._add($||W),_e=L+Math.atan2(K.y-W.y,K.x-W.x);return se.push(ne),{point:ne,angle:S?_e:0,path:se}}const uu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Kr(m,t){for(let r=0;r<m;r++){const l=t.length;t.resize(l+4),t.float32.set(uu,3*l)}}function rr(m,t,r){const l=t[0],d=t[1];return m[0]=r[0]*l+r[4]*d+r[12],m[1]=r[1]*l+r[5]*d+r[13],m[3]=r[3]*l+r[7]*d+r[15],m}const yi=100;class lh{constructor(t,r=new Gt(t.width+200,t.height+200,25),l=new Gt(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=l,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+yi,this.screenBottomBoundary=t.height+yi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,r,l,d,_,v,b,S,C,z,L,R){const j=this.projectAndGetPerspectiveRatio(t.anchorPointX+S[0],t.anchorPointY+S[1],_,z,R),G=l*j.perspectiveRatio;let $;if(v||b)$=this._projectCollisionBox(t,G,d,_,v,b,S,j,z,L,R);else{const ce=j.x+(L?L.x*G:0),ne=j.y+(L?L.y*G:0);$={allPointsOccluded:!1,box:[ce+t.x1*G,ne+t.y1*G,ce+t.x2*G,ne+t.y2*G]}}const[K,W,te,oe]=$.box,ee=v?$.allPointsOccluded:j.isOccluded;let se=ee;return se||(se=j.perspectiveRatio<this.perspectiveRatioCutoff),se||(se=!this.isInsideGrid(K,W,te,oe)),se||r!=="always"&&this.grid.hitTest(K,W,te,oe,r,C)?{box:[K,W,te,oe],placeable:!1,offscreen:!1,occluded:ee}:{box:[K,W,te,oe],placeable:!0,offscreen:this.isOffscreen(K,W,te,oe),occluded:ee}}placeCollisionCircles(t,r,l,d,_,v,b,S,C,z,L,R,j,G){const $=[],K=new h.P(r.anchorX,r.anchorY),W=this.getPerspectiveRatio(K.x,K.y,v,G),te=(C?_*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,v)/W:_*W)/h.aM,oe={getElevation:G,pitchedLabelPlaneMatrix:b,lineVertexArray:l,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:K,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:j},ee=Yr(te,d,r.lineOffsetX*te,r.lineOffsetY*te,!1,r,!1,oe);let se=!1,ce=!1,ne=!0;if(ee){const _e=.5*L*W+R,Ie=new h.P(-100,-100),Ee=new h.P(this.screenRightBoundary,this.screenBottomBoundary),ze=new Je,De=ee.first,et=ee.last;let tt=[];for(let Vt=De.path.length-1;Vt>=1;Vt--)tt.push(De.path[Vt]);for(let Vt=1;Vt<et.path.length;Vt++)tt.push(et.path[Vt]);const qe=2.5*_e;if(C){const Vt=this.projectPathToScreenSpace(tt,oe);tt=Vt.some((Ti=>Ti.signedDistanceFromCamera<=0))?[]:Vt.map((Ti=>Ti.point))}let rt=[];if(tt.length>0){const Vt=tt[0].clone(),Ti=tt[0].clone();for(let Gi=1;Gi<tt.length;Gi++)Vt.x=Math.min(Vt.x,tt[Gi].x),Vt.y=Math.min(Vt.y,tt[Gi].y),Ti.x=Math.max(Ti.x,tt[Gi].x),Ti.y=Math.max(Ti.y,tt[Gi].y);rt=Vt.x>=Ie.x&&Ti.x<=Ee.x&&Vt.y>=Ie.y&&Ti.y<=Ee.y?[tt]:Ti.x<Ie.x||Vt.x>Ee.x||Ti.y<Ie.y||Vt.y>Ee.y?[]:h.aJ([tt],Ie.x,Ie.y,Ee.x,Ee.y)}for(const Vt of rt){ze.reset(Vt,.25*_e);let Ti=0;Ti=ze.length<=.5*_e?1:Math.ceil(ze.paddedLength/qe)+1;for(let Gi=0;Gi<Ti;Gi++){const Oi=Gi/Math.max(Ti-1,1),Xi=ze.lerp(Oi),Ii=Xi.x+yi,un=Xi.y+yi;$.push(Ii,un,_e,0);const Yi=Ii-_e,Gn=un-_e,gn=Ii+_e,_n=un+_e;if(ne=ne&&this.isOffscreen(Yi,Gn,gn,_n),ce=ce||this.isInsideGrid(Yi,Gn,gn,_n),t!=="always"&&this.grid.hitTestCircle(Ii,un,_e,t,z)&&(se=!0,!S))return{circles:[],offscreen:!1,collisionDetected:se}}}}return{circles:!S&&se||!ce||W<this.perspectiveRatioCutoff?[]:$,offscreen:ne,collisionDetected:se}}projectPathToScreenSpace(t,r){const l=(function(d,_){const v=h.N();return h.aB(v,_.pitchedLabelPlaneMatrix),d.map((b=>{const S=qt(b.x,b.y,v,_.getElevation),C=_.transform.projectTileCoordinates(S.point.x,S.point.y,_.unwrappedTileID,_.getElevation);return C.point.x=(.5*C.point.x+.5)*_.width,C.point.y=(.5*-C.point.y+.5)*_.height,C}))})(t,r);return(function(d){let _=0,v=0,b=0,S=0;for(let C=0;C<d.length;C++)d[C].isOccluded?(b=C+1,S=0):(S++,S>v&&(v=S,_=b));return d.slice(_,_+v)})(l)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[],l=new h.aa;for(const L of t){const R=new h.P(L.x+yi,L.y+yi);l.extend(R),r.push(R)}const{minX:d,minY:_,maxX:v,maxY:b}=l,S=this.grid.query(d,_,v,b).concat(this.ignoredGrid.query(d,_,v,b)),C={},z={};for(const L of S){const R=L.key;if(C[R.bucketInstanceId]===void 0&&(C[R.bucketInstanceId]={}),C[R.bucketInstanceId][R.featureIndex])continue;const j=[new h.P(L.x1,L.y1),new h.P(L.x2,L.y1),new h.P(L.x2,L.y2),new h.P(L.x1,L.y2)];h.aK(r,j)&&(C[R.bucketInstanceId][R.featureIndex]=!0,z[R.bucketInstanceId]===void 0&&(z[R.bucketInstanceId]=[]),z[R.bucketInstanceId].push(R.featureIndex))}return z}insertCollisionBox(t,r,l,d,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:v,overlapMode:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,l,d,_,v){const b=l?this.ignoredGrid:this.grid,S={bucketInstanceId:d,featureIndex:_,collisionGroupID:v,overlapMode:r};for(let C=0;C<t.length;C+=4)b.insertCircle(S,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,r,l,d,_){if(_){let v;d?(v=[t,r,d(t,r),1],h.aH(v,v,_)):(v=[t,r,0,1],rr(v,v,_));const b=v[3];return{x:(v[0]/b+1)/2*this.transform.width+yi,y:(-v[1]/b+1)/2*this.transform.height+yi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}{const v=this.transform.projectTileCoordinates(t,r,l,d);return{x:(v.point.x+1)/2*this.transform.width+yi,y:(1-v.point.y)/2*this.transform.height+yi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(t,r,l,d){const _=this.transform.projectTileCoordinates(t,r,l,d);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(t,r,l,d){return l<yi||t>=this.screenRightBoundary||d<yi||r>this.screenBottomBoundary}isInsideGrid(t,r,l,d){return l>=0&&t<this.gridRightBoundary&&d>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=h.ar([]);return h.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,r,l,d,_,v,b,S,C,z,L){let R=1,j=0,G=0,$=1;const K=t.anchorPointX+b[0],W=t.anchorPointY+b[1];if(v&&!_){const tt=this.projectAndGetPerspectiveRatio(K+1,W,d,C,L),qe=tt.x-S.x,rt=Math.atan((tt.y-S.y)/qe)+(qe<0?Math.PI:0),Vt=Math.sin(rt),Ti=Math.cos(rt);R=Ti,j=Vt,G=-Vt,$=Ti}else if(!v&&_){const tt=$r(this.transform);R=tt.vecEast[0],j=tt.vecEast[1],G=tt.vecSouth[0],$=tt.vecSouth[1]}let te=S.x,oe=S.y,ee=r;_&&(te=K,oe=W,ee=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),ee*=this.transform.getPitchedTextCorrection(K,W,d),z||(ee*=h.an(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(te+=R*z.x*ee+G*z.y*ee,oe+=j*z.x*ee+$*z.y*ee);const se=t.x1*ee,ce=t.x2*ee,ne=(se+ce)/2,_e=t.y1*ee,Ie=t.y2*ee,Ee=(_e+Ie)/2,ze=[{offsetX:se,offsetY:_e},{offsetX:ne,offsetY:_e},{offsetX:ce,offsetY:_e},{offsetX:ce,offsetY:Ee},{offsetX:ce,offsetY:Ie},{offsetX:ne,offsetY:Ie},{offsetX:se,offsetY:Ie},{offsetX:se,offsetY:Ee}];let De=[];for(const{offsetX:tt,offsetY:qe}of ze)De.push(new h.P(te+R*tt+G*qe,oe+j*tt+$*qe));let et=!1;if(_){const tt=De.map((qe=>this.projectAndGetPerspectiveRatio(qe.x,qe.y,d,C,L)));et=tt.some((qe=>!qe.isOccluded)),De=tt.map((qe=>new h.P(qe.x,qe.y)))}else et=!0;return{box:h.aL(De),allPointsOccluded:!et}}}class yd{constructor(t,r,l,d){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):d&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class zo{constructor(t,r,l,d,_){this.text=new yd(t?t.text:null,r,l,_),this.icon=new yd(t?t.icon:null,r,d,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class uh{constructor(t,r,l){this.text=t,this.icon=r,this.skipFade=l}}class cu{constructor(t,r,l,d,_){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=l,this.bucketIndex=d,this.tileID=_}}class vd{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:l=>l.collisionGroupID===r}}return this.collisionGroups[t]}}function ha(m,t,r,l,d){const{horizontalAlign:_,verticalAlign:v}=h.aS(m);return new h.P(-(_-.5)*t+l[0]*d,-(v-.5)*r+l[1]*d)}class hu{constructor(t,r,l,d,_){this.transform=t.clone(),this.terrain=r,this.collisionIndex=new lh(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new vd(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const r=this.terrain;return r?(l,d)=>r.getElevation(t,l,d):null}getBucketParts(t,r,l,d){const _=l.getBucket(r),v=l.latestFeatureIndex;if(!_||!v||r.id!==_.layerIds[0])return;const b=l.collisionBoxArray,S=_.layers[0].layout,C=_.layers[0].paint,z=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),L=l.tileSize/h.a5,R=l.tileID.toUnwrapped(),j=S.get("text-rotation-alignment")==="map",G=h.aN(l,1,this.transform.zoom),$=h.aO(this.collisionIndex.transform,l,C.get("text-translate"),C.get("text-translate-anchor")),K=h.aO(this.collisionIndex.transform,l,C.get("icon-translate"),C.get("icon-translate-anchor")),W=Ba(j,this.transform,G);this.retainedQueryData[_.bucketInstanceId]=new cu(_.bucketInstanceId,v,_.sourceLayerIndex,_.index,l.tileID);const te={bucket:_,layout:S,translationText:$,translationIcon:K,unwrappedTileID:R,pitchedLabelPlaneMatrix:W,scale:z,textPixelRatio:L,holdingForFade:l.holdingForSymbolFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:h.ay(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(d)for(const oe of _.sortKeyRanges){const{sortKey:ee,symbolInstanceStart:se,symbolInstanceEnd:ce}=oe;t.push({sortKey:ee,symbolInstanceStart:se,symbolInstanceEnd:ce,parameters:te})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:te})}attemptAnchorPlacement(t,r,l,d,_,v,b,S,C,z,L,R,j,G,$,K,W,te,oe,ee){const se=h.aP[t.textAnchor],ce=[t.textOffset0,t.textOffset1],ne=ha(se,l,d,ce,_),_e=this.collisionIndex.placeCollisionBox(r,R,S,C,z,b,v,K,L.predicate,oe,ne,ee);if((!te||this.collisionIndex.placeCollisionBox(te,R,S,C,z,b,v,W,L.predicate,oe,ne,ee).placeable)&&_e.placeable){let Ie;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Ie=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:ce,width:l,height:d,anchor:se,textBoxScale:_,prevAnchor:Ie},this.markUsedJustification(G,se,j,$),G.allowVerticalPlacement&&(this.markUsedOrientation(G,$,j),this.placedOrientations[j.crossTileID]=$),{shift:ne,placedGlyphBoxes:_e}}}placeLayerBucketPart(t,r,l){const{bucket:d,layout:_,translationText:v,translationIcon:b,unwrappedTileID:S,pitchedLabelPlaneMatrix:C,textPixelRatio:z,holdingForFade:L,collisionBoxArray:R,partiallyEvaluatedTextSize:j,collisionGroup:G}=t.parameters,$=_.get("text-optional"),K=_.get("icon-optional"),W=h.aQ(_,"text-overlap","text-allow-overlap"),te=W==="always",oe=h.aQ(_,"icon-overlap","icon-allow-overlap"),ee=oe==="always",se=_.get("text-rotation-alignment")==="map",ce=_.get("text-pitch-alignment")==="map",ne=_.get("icon-text-fit")!=="none",_e=_.get("symbol-z-order")==="viewport-y",Ie=te&&(ee||!d.hasIconData()||K),Ee=ee&&(te||!d.hasTextData()||$);!d.collisionArrays&&R&&d.deserializeCollisionBoxes(R);const ze=this.retainedQueryData[d.bucketInstanceId].tileID,De=this._getTerrainElevationFunc(ze),et=this.transform.getFastPathSimpleProjectionMatrix(ze),tt=(qe,rt,Vt)=>{var Ti,Gi;if(r[qe.crossTileID])return;if(L)return void(this.placements[qe.crossTileID]=new uh(!1,!1,!1));let Oi=!1,Xi=!1,Ii=!0,un=null,Yi={box:null,placeable:!1,offscreen:null,occluded:!1},Gn={placeable:!1},gn=null,_n=null,qn=null,gs=0,_s=0,Or=0;rt.textFeatureIndex?gs=rt.textFeatureIndex:qe.useRuntimeCollisionCircles&&(gs=qe.featureIndex),rt.verticalTextFeatureIndex&&(_s=rt.verticalTextFeatureIndex);const Aa=rt.textBox;if(Aa){const Ca=Ci=>{let Bi=h.az.horizontal;if(d.allowVerticalPlacement&&!Ci&&this.prevPlacement){const Cn=this.prevPlacement.placedOrientations[qe.crossTileID];Cn&&(this.placedOrientations[qe.crossTileID]=Cn,Bi=Cn,this.markUsedOrientation(d,Bi,qe))}return Bi},Xa=(Ci,Bi)=>{if(d.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&rt.verticalTextBox){for(const Cn of d.writingModes)if(Cn===h.az.vertical?(Yi=Bi(),Gn=Yi):Yi=Ci(),Yi&&Yi.placeable)break}else Yi=Ci()},gr=qe.textAnchorOffsetStartIndex,_r=qe.textAnchorOffsetEndIndex;if(_r===gr){const Ci=(Bi,Cn)=>{const Pn=this.collisionIndex.placeCollisionBox(Bi,W,z,ze,S,ce,se,v,G.predicate,De,void 0,et);return Pn&&Pn.placeable&&(this.markUsedOrientation(d,Cn,qe),this.placedOrientations[qe.crossTileID]=Cn),Pn};Xa((()=>Ci(Aa,h.az.horizontal)),(()=>{const Bi=rt.verticalTextBox;return d.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&Bi?Ci(Bi,h.az.vertical):{box:null,offscreen:null}})),Ca(Yi&&Yi.placeable)}else{let Ci=h.aP[(Gi=(Ti=this.prevPlacement)===null||Ti===void 0?void 0:Ti.variableOffsets[qe.crossTileID])===null||Gi===void 0?void 0:Gi.anchor];const Bi=(Pn,jc,Nc)=>{const go=Pn.x2-Pn.x1,Bd=Pn.y2-Pn.y1,_o=qe.textBoxScale,Vc=ne&&oe==="never"?jc:null;let js=null,Ns=W==="never"?1:2,Fr="never";Ci&&Ns++;for(let Uc=0;Uc<Ns;Uc++){for(let $u=gr;$u<_r;$u++){const Xu=d.textAnchorOffsets.get($u);if(Ci&&Xu.textAnchor!==Ci)continue;const Yu=this.attemptAnchorPlacement(Xu,Pn,go,Bd,_o,se,ce,z,ze,S,G,Fr,qe,d,Nc,v,b,Vc,De);if(Yu&&(js=Yu.placedGlyphBoxes,js&&js.placeable))return Oi=!0,un=Yu.shift,js}Ci?Ci=null:Fr=W}return l&&!js&&(js={box:this.collisionIndex.placeCollisionBox(Aa,"always",z,ze,S,ce,se,v,G.predicate,De,void 0,et).box,offscreen:!1,placeable:!1,occluded:!1}),js};Xa((()=>Bi(Aa,rt.iconBox,h.az.horizontal)),(()=>{const Pn=rt.verticalTextBox;return d.allowVerticalPlacement&&(!Yi||!Yi.placeable)&&qe.numVerticalGlyphVertices>0&&Pn?Bi(Pn,rt.verticalIconBox,h.az.vertical):{box:null,occluded:!0,offscreen:null}})),Yi&&(Oi=Yi.placeable,Ii=Yi.offscreen);const Cn=Ca(Yi&&Yi.placeable);if(!Oi&&this.prevPlacement){const Pn=this.prevPlacement.variableOffsets[qe.crossTileID];Pn&&(this.variableOffsets[qe.crossTileID]=Pn,this.markUsedJustification(d,Pn.anchor,qe,Cn))}}}if(gn=Yi,Oi=gn&&gn.placeable,Ii=gn&&gn.offscreen,qe.useRuntimeCollisionCircles&&qe.centerJustifiedTextSymbolIndex>=0){const Ca=d.text.placedSymbolArray.get(qe.centerJustifiedTextSymbolIndex),Xa=h.aA(d.textSizeData,j,Ca),gr=_.get("text-padding");_n=this.collisionIndex.placeCollisionCircles(W,Ca,d.lineVertexArray,d.glyphOffsetArray,Xa,S,C,l,ce,G.predicate,qe.collisionCircleDiameter,gr,v,De),_n.circles.length&&_n.collisionDetected&&!l&&h.w("Collisions detected, but collision boxes are not shown"),Oi=te||_n.circles.length>0&&!_n.collisionDetected,Ii=Ii&&_n.offscreen}if(rt.iconFeatureIndex&&(Or=rt.iconFeatureIndex),rt.iconBox){const Ca=Xa=>this.collisionIndex.placeCollisionBox(Xa,oe,z,ze,S,ce,se,b,G.predicate,De,ne&&un?un:void 0,et);Gn&&Gn.placeable&&rt.verticalIconBox?(qn=Ca(rt.verticalIconBox),Xi=qn.placeable):(qn=Ca(rt.iconBox),Xi=qn.placeable),Ii=Ii&&qn.offscreen}const Jo=$||qe.numHorizontalGlyphVertices===0&&qe.numVerticalGlyphVertices===0,Hl=K||qe.numIconVertices===0;Jo||Hl?Hl?Jo||(Xi=Xi&&Oi):Oi=Xi&&Oi:Xi=Oi=Xi&&Oi;const Br=Xi&&qn.placeable;if(Oi&&gn.placeable&&this.collisionIndex.insertCollisionBox(gn.box,W,_.get("text-ignore-placement"),d.bucketInstanceId,Gn&&Gn.placeable&&_s?_s:gs,G.ID),Br&&this.collisionIndex.insertCollisionBox(qn.box,oe,_.get("icon-ignore-placement"),d.bucketInstanceId,Or,G.ID),_n&&Oi&&this.collisionIndex.insertCollisionCircles(_n.circles,W,_.get("text-ignore-placement"),d.bucketInstanceId,gs,G.ID),l&&this.storeCollisionData(d.bucketInstanceId,Vt,rt,gn,qn,_n),qe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[qe.crossTileID]=new uh((Oi||Ie)&&!gn?.occluded,(Xi||Ee)&&!qn?.occluded,Ii||d.justReloaded),r[qe.crossTileID]=!0};if(_e){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const qe=d.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let rt=qe.length-1;rt>=0;--rt){const Vt=qe[rt];tt(d.symbolInstances.get(Vt),d.collisionArrays[Vt],Vt)}}else for(let qe=t.symbolInstanceStart;qe<t.symbolInstanceEnd;qe++)tt(d.symbolInstances.get(qe),d.collisionArrays[qe],qe);d.justReloaded=!1}storeCollisionData(t,r,l,d,_,v){if(l.textBox||l.iconBox){let b,S;this.collisionBoxArrays.has(t)?b=this.collisionBoxArrays.get(t):(b=new Map,this.collisionBoxArrays.set(t,b)),b.has(r)?S=b.get(r):(S={text:null,icon:null},b.set(r,S)),l.textBox&&(S.text=d.box),l.iconBox&&(S.icon=_.box)}if(v){let b=this.collisionCircleArrays[t];b===void 0&&(b=this.collisionCircleArrays[t]=[]);for(let S=0;S<v.circles.length;S+=4)b.push(v.circles[S+0]-yi),b.push(v.circles[S+1]-yi),b.push(v.circles[S+2]),b.push(v.collisionDetected?1:0)}}markUsedJustification(t,r,l,d){let _;_=d===h.az.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[h.aR(r)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const b of v)b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=_>=0&&b!==_?0:l.crossTileID)}markUsedOrientation(t,r,l){const d=r===h.az.horizontal||r===h.az.horizontalOnly?r:0,_=r===h.az.vertical?r:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const b of v)t.text.placedSymbolArray.get(b).placedOrientation=d;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let l=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const d=r?r.symbolFadeChange(t):1,_=r?r.opacities:{},v=r?r.variableOffsets:{},b=r?r.placedOrientations:{};for(const S in this.placements){const C=this.placements[S],z=_[S];z?(this.opacities[S]=new zo(z,d,C.text,C.icon),l=l||C.text!==z.text.placed||C.icon!==z.icon.placed):(this.opacities[S]=new zo(null,d,C.text,C.icon,C.skipFade),l=l||C.text||C.icon)}for(const S in _){const C=_[S];if(!this.opacities[S]){const z=new zo(C,d,!1,!1);z.isHidden()||(this.opacities[S]=z,l=l||C.text.placed||C.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in b)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=b[S]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const l={};for(const d of r){const _=d.getBucket(t);_&&d.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,d.tileID,l,d.collisionBoxArray)}}updateBucketOpacities(t,r,l,d){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0],v=_.layout,b=new zo(null,0,!1,!1,!0),S=v.get("text-allow-overlap"),C=v.get("icon-allow-overlap"),z=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),L=v.get("text-rotation-alignment")==="map",R=v.get("text-pitch-alignment")==="map",j=v.get("icon-text-fit")!=="none",G=new zo(null,0,S&&(C||!t.hasIconData()||v.get("icon-optional")),C&&(S||!t.hasTextData()||v.get("text-optional")),!0);!t.collisionArrays&&d&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(d);const $=(W,te,oe)=>{for(let ee=0;ee<te/4;ee++)W.opacityVertexArray.emplaceBack(oe);W.hasVisibleVertices=W.hasVisibleVertices||oe!==Io},K=this.collisionBoxArrays.get(t.bucketInstanceId);for(let W=0;W<t.symbolInstances.length;W++){const te=t.symbolInstances.get(W),{numHorizontalGlyphVertices:oe,numVerticalGlyphVertices:ee,crossTileID:se}=te;let ce=this.opacities[se];l[se]?ce=b:ce||(ce=G,this.opacities[se]=ce),l[se]=!0;const ne=te.numIconVertices>0,_e=this.placedOrientations[te.crossTileID],Ie=_e===h.az.vertical,Ee=_e===h.az.horizontal||_e===h.az.horizontalOnly;if(oe>0||ee>0){const De=fc(ce.text);$(t.text,oe,Ie?Io:De),$(t.text,ee,Ee?Io:De);const et=ce.text.isHidden();[te.rightJustifiedTextSymbolIndex,te.centerJustifiedTextSymbolIndex,te.leftJustifiedTextSymbolIndex].forEach((rt=>{rt>=0&&(t.text.placedSymbolArray.get(rt).hidden=et||Ie?1:0)})),te.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(te.verticalPlacedTextSymbolIndex).hidden=et||Ee?1:0);const tt=this.variableOffsets[te.crossTileID];tt&&this.markUsedJustification(t,tt.anchor,te,_e);const qe=this.placedOrientations[te.crossTileID];qe&&(this.markUsedJustification(t,"left",te,qe),this.markUsedOrientation(t,qe,te))}if(ne){const De=fc(ce.icon),et=!(j&&te.verticalPlacedIconSymbolIndex&&Ie);te.placedIconSymbolIndex>=0&&($(t.icon,te.numIconVertices,et?De:Io),t.icon.placedSymbolArray.get(te.placedIconSymbolIndex).hidden=ce.icon.isHidden()),te.verticalPlacedIconSymbolIndex>=0&&($(t.icon,te.numVerticalIconVertices,et?Io:De),t.icon.placedSymbolArray.get(te.verticalPlacedIconSymbolIndex).hidden=ce.icon.isHidden())}const ze=K&&K.has(W)?K.get(W):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const De=t.collisionArrays[W];if(De){let et=new h.P(0,0);if(De.textBox||De.verticalTextBox){let tt=!0;if(z){const qe=this.variableOffsets[se];qe?(et=ha(qe.anchor,qe.width,qe.height,qe.textOffset,qe.textBoxScale),L&&et._rotate(R?-this.transform.bearingInRadians:this.transform.bearingInRadians)):tt=!1}if(De.textBox||De.verticalTextBox){let qe;De.textBox&&(qe=Ie),De.verticalTextBox&&(qe=Ee),dc(t.textCollisionBox.collisionVertexArray,ce.text.placed,!tt||qe,ze.text,et.x,et.y)}}if(De.iconBox||De.verticalIconBox){const tt=!!(!Ee&&De.verticalIconBox);let qe;De.iconBox&&(qe=tt),De.verticalIconBox&&(qe=!tt),dc(t.iconCollisionBox.collisionVertexArray,ce.icon.placed,qe,ze.icon,j?et.x:0,j?et.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const l=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function dc(m,t,r,l,d,_){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-yi,b=l[1]-yi,S=l[2]-yi,C=l[3]-yi;m.emplaceBack(t?1:0,r?1:0,d||0,_||0,v,b),m.emplaceBack(t?1:0,r?1:0,d||0,_||0,S,b),m.emplaceBack(t?1:0,r?1:0,d||0,_||0,S,C),m.emplaceBack(t?1:0,r?1:0,d||0,_||0,v,C)}const du=Math.pow(2,25),Ws=Math.pow(2,24),xd=Math.pow(2,17),Sl=Math.pow(2,16),Es=Math.pow(2,9),bd=Math.pow(2,8),Do=Math.pow(2,1);function fc(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,r=Math.floor(127*m.opacity);return r*du+t*Ws+r*xd+t*Sl+r*Es+t*bd+r*Do+t}const Io=0;class Ks{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,r,l,d,_){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(v,d,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort(((b,S)=>b.sortKey-S.sortKey)));this._currentPartIndex<v.length;)if(r.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,_())return!0;return!1}}class Ml{constructor(t,r,l,d,_,v,b,S){this.placement=new hu(t,r,v,b,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,r,l){const d=bt(),_=()=>!this._forceFullPlacement&&bt()-d>2;for(;this._currentPlacementIndex>=0;){const v=r[t[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=b)&&(!v.maxzoom||v.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Ks(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Yt=512/h.a5/2;class Cr{constructor(t,r,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const d=new Map;for(let _=0;_<r.length;_++){const v=r.get(_),b=v.key,S=d.get(b);S?S.push(v):d.set(b,[v])}for(const[_,v]of d){const b={positions:v.map((S=>({x:Math.floor(S.anchorX*Yt),y:Math.floor(S.anchorY*Yt)}))),crossTileIDs:v.map((S=>S.crossTileID))};if(b.positions.length>128){const S=new h.aT(b.positions.length,16,Uint16Array);for(const{x:C,y:z}of b.positions)S.add(C,z);S.finish(),delete b.positions,b.index=S}this._symbolsByKey[_]=b}}getScaledCoordinates(t,r){const{x:l,y:d,z:_}=this.tileID.canonical,{x:v,y:b,z:S}=r.canonical,C=Yt/Math.pow(2,S-_),z=(b*h.a5+t.anchorY)*C,L=d*h.a5*Yt;return{x:Math.floor((v*h.a5+t.anchorX)*C-l*h.a5*Yt),y:Math.floor(z-L)}}findMatches(t,r,l){const d=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let _=0;_<t.length;_++){const v=t.get(_);if(v.crossTileID)continue;const b=this._symbolsByKey[v.key];if(!b)continue;const S=this.getScaledCoordinates(v,r);if(b.index){const C=b.index.range(S.x-d,S.y-d,S.x+d,S.y+d).sort();for(const z of C){const L=b.crossTileIDs[z];if(!l[L]){l[L]=!0,v.crossTileID=L;break}}}else if(b.positions)for(let C=0;C<b.positions.length;C++){const z=b.positions[C],L=b.crossTileIDs[C];if(Math.abs(z.x-S.x)<=d&&Math.abs(z.y-S.y)<=d&&!l[L]){l[L]=!0,v.crossTileID=L;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class ch{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const l in this.indexes){const d=this.indexes[l],_={};for(const v in d){const b=d[v];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+r),_[b.tileID.key]=b}this.indexes[l]=_}this.lng=t}addBucket(t,r,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const d=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>t.overscaledZ)for(const b in v){const S=v[b];S.tileID.isChildOf(t)&&S.findMatches(r.symbolInstances,t,d)}else{const b=v[t.scaledTo(Number(_)).key];b&&b.findMatches(r.symbolInstances,t,d)}}for(let _=0;_<r.symbolInstances.length;_++){const v=r.symbolInstances.get(_);v.crossTileID||(v.crossTileID=l.generate(),d[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Cr(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const l of r.getCrossTileIDsLists())for(const d of l)delete this.usedCrossTileIDs[t][d]}removeStaleBuckets(t){let r=!1;for(const l in this.indexes){const d=this.indexes[l];for(const _ in d)t[d[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,d[_]),delete d[_],r=!0)}return r}}class kn{constructor(){this.layerIndexes={},this.crossTileIDs=new ch,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,l){let d=this.layerIndexes[t.id];d===void 0&&(d=this.layerIndexes[t.id]=new fu);let _=!1;const v={};d.handleWrapJump(l);for(const b of r){const S=b.getBucket(t);S&&t.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(b.tileID,S,this.crossTileIDs)&&(_=!0),v[S.bucketInstanceId]=!0)}return d.removeStaleBuckets(v)&&(_=!0),_}pruneUnusedLayers(t){const r={};t.forEach((l=>{r[l]=!0}));for(const l in this.layerIndexes)r[l]||delete this.layerIndexes[l]}}var En="void main() {fragColor=vec4(1.0);}";const Ji={prelude:It(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:It("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:It("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:It(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:It(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:It(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:It(En,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:It(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:It(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:It("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:It("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:It(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:It("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:It(En,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:It(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:It(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:It(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:It(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:It(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:It(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:It(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:It(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:It(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:It(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:It(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:It(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:It(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:It(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:It(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:It(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:It(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:It("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:It("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:It("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:It("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:It(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:It("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function It(m,t){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/in ([\w]+) ([\w]+)/g),d=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=_?_.concat(d):d,b={};return{fragmentSource:m=m.replace(r,((S,C,z,L,R)=>(b[R]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
in ${z} ${L} ${R};
#else
uniform ${z} ${L} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${z} ${L} ${R} = u_${R};
#endif
`))),vertexSource:t=t.replace(r,((S,C,z,L,R)=>{const j=L==="float"?"vec2":"vec4",G=R.match(/color/)?"color":j;return b[R]?C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${z} ${j} a_${R};
out ${z} ${L} ${R};
#else
uniform ${z} ${L} u_${R};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${z} ${L} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${G}(a_${R}, u_${R}_t);
#else
    ${z} ${L} ${R} = u_${R};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${z} ${j} a_${R};
#else
uniform ${z} ${L} u_${R};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${z} ${L} ${R} = a_${R};
#else
    ${z} ${L} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${z} ${L} ${R} = unpack_mix_${G}(a_${R}, u_${R}_t);
#else
    ${z} ${L} ${R} = u_${R};
#endif
`})),staticAttributes:l,staticUniforms:v}}class Li{constructor(t,r,l){this.vertexBuffer=t,this.indexBuffer=r,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var sr=h.aU([{name:"a_pos",type:"Int16",components:2}]);const fn="#define PROJECTION_MERCATOR",da="mercator";class On{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return da}get shaderDefine(){return fn}get shaderPreludeCode(){return Ji.projectionMercator}get vertexShaderPreludeCode(){return Ji.projectionMercator.vertexSource}get subdivisionGranularity(){return h.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,r,l,d,_){if(this._cachedMesh)return this._cachedMesh;const v=new h.aW;v.emplaceBack(0,0),v.emplaceBack(h.a5,0),v.emplaceBack(0,h.a5),v.emplaceBack(h.a5,h.a5);const b=t.createVertexBuffer(v,sr.members),S=h.aX.simpleSegment(0,0,4,2),C=new h.aY;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3);const z=t.createIndexBuffer(C);return this._cachedMesh=new Li(b,z,S),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Fa{constructor(t=0,r=0,l=0,d=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(l)||l<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=l,this.right=d}interpolate(t,r,l){return r.top!=null&&t.top!=null&&(this.top=h.G.number(t.top,r.top,l)),r.bottom!=null&&t.bottom!=null&&(this.bottom=h.G.number(t.bottom,r.bottom,l)),r.left!=null&&t.left!=null&&(this.left=h.G.number(t.left,r.left,l)),r.right!=null&&t.right!=null&&(this.right=h.G.number(t.right,r.right,l)),this}getCenter(t,r){const l=h.an((this.left+t-this.right)/2,0,t),d=h.an((this.top+r-this.bottom)/2,0,r);return new h.P(l,d)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Fa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Qr(m,t){if(!m.renderWorldCopies||m.lngRange)return;const r=t.lng-m.center.lng;t.lng+=r>180?-360:r<-180?360:0}function en(m){return Math.max(0,Math.floor(m))}class Qs{constructor(t,r){var l;this.applyConstrain=(d,_)=>this._constrainOverride!==null?this._constrainOverride(d,_):this._callbacks.defaultConstrain(d,_),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=r?.renderWorldCopies===void 0||!!r?.renderWorldCopies,this._minZoom=r?.minZoom||0,this._maxZoom=r?.maxZoom||22,this._minPitch=r?.minPitch==null?0:r?.minPitch,this._maxPitch=r?.maxPitch==null?60:r?.maxPitch,this._constrainOverride=(l=r?.constrainOverride)!==null&&l!==void 0?l:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new h.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=en(this._zoom),this._scale=h.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Fa,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,r,l){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=en(this._zoom),this._scale=h.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Fa(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!l&&t.autoCalculateNearFarZ,r&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const r=h.W(t,-180,180)*Math.PI/180;var l,d,_,v,b,S,C,z,L;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=ke(),l=this._rotationMatrix,_=-this._bearingInRadians,v=(d=this._rotationMatrix)[0],b=d[1],S=d[2],C=d[3],z=Math.sin(_),L=Math.cos(_),l[0]=v*L+S*z,l[1]=b*L+C*z,l[2]=v*-z+S*L,l[3]=b*-z+C*L)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const r=h.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const r=t/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return h.aZ(this._fovInRadians)}setFov(t){t=h.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=h.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const r=this.applyConstrain(this._center,t).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=h.aq(r),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,r){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,l){this._unmodified=!1,this._edgeInsets.interpolate(t,r,l),this.constrainInternal(),this._calcMatrices()}resize(t,r,l=!0){this._width=t,this._height=r,l&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Wi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-h.ao,h.ao])}getCameraQueryGeometry(t,r){if(r.length===1)return[r[0],t];{const{minX:l,minY:d,maxX:_,maxY:v}=h.aa.fromPoints(r).extend(t);return[new h.P(l,d),new h.P(_,d),new h.P(_,v),new h.P(l,v),new h.P(l,d)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:r,zoom:l}=this.applyConstrain(this.center,this.zoom);this.setCenter(r),this.setZoom(l),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=h.ar(new Float64Array(16));h.Q(t,t,[this._width/2,-this._height/2,1]),h.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=h.ar(new Float64Array(16)),h.Q(t,t,[1,-1,1]),h.O(t,t,[-1,-1,0]),h.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,r,l,d){const _=l!==void 0?l:this.bearing,v=d=d!==void 0?d:this.pitch,{distanceToCenter:b,clampedElevation:S}=this._distanceToCenterFromAltElevationPitch(r,this.elevation,v),{x:C,y:z}=mt(v,_),L=h.a9.fromLngLat(t,r);let R,j,G=h.a_(1,L.y),$=0;do{if($+=1,$>10)break;j=b/G,R=new h.a9(L.x+C*j,L.y+z*j),G=1/R.meterInMercatorCoordinateUnits()}while(Math.abs(b-j*G)>1e-12);return{center:R.toLngLat(),elevation:S,zoom:h.at(this.height/2/Math.tan(this.fovInRadians/2)/j/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const r=1/this.worldSize,l=h.as(1,this.center.lat)*this.worldSize,d=h.a9.fromLngLat(this.center,this.elevation),_=d.x/r,v=d.y/r,b=d.z/r,S=this.pitch,C=this.bearing,{x:z,y:L,z:R}=mt(S,C),j=this.cameraToCenterDistance,G=_+j*-z,$=v+j*-L,K=b+j*R,{distanceToCenter:W,clampedElevation:te}=this._distanceToCenterFromAltElevationPitch(K/l,t,S),oe=W*l,ee=new h.a9((G+z*oe)*r,($+L*oe)*r,0).toLngLat(),se=h.as(1,ee.lat),ce=h.at(this.height/2/Math.tan(this.fovInRadians/2)/W/se/this.tileSize);this._elevation=te,this._center=ee,this.setZoom(ce)}_distanceToCenterFromAltElevationPitch(t,r,l){const d=-Math.cos(h.ap(l)),_=t-r;let v,b=r;return d*_>=0||Math.abs(d)<.1?(v=1e4,b=t+v*d):v=-_/d,{distanceToCenter:v,clampedElevation:b}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=h.as(1,this.center.lat)*this.worldSize;return le(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const r=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/r,t.canonical.y/r,1/r/h.a5,1/r/h.a5]}}class ja{constructor(t,r){this.min=t,this.max=r,this.center=h.a$([],h.b0([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],l=h.b1(this.min),d=h.b1(this.max);for(let _=0;_<r.length;_++)l[_]=r[_]?this.min[_]:this.center[_],d[_]=r[_]?this.center[_]:this.max[_];return d[2]=this.max[2],new ja(l,d)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let r=!0;for(let l=0;l<t.planes.length;l++){const d=this.intersectsPlane(t.planes[l]);if(d===0)return 0;d===1&&(r=!1)}return r?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let r=t[3],l=t[3];for(let d=0;d<3;d++)t[d]>0?(r+=t[d]*this.min[d],l+=t[d]*this.max[d]):(l+=t[d]*this.min[d],r+=t[d]*this.max[d]);return r>=0?2:l<0?0:1}}class Po{distanceToTile2d(t,r,l,d){const _=d.distanceX([t,r]),v=d.distanceY([t,r]);return Math.hypot(_,v)}getWrap(t,r,l){return l}getTileBoundingVolume(t,r,l,d){var _,v;let b=0,S=0;if(d?.terrain){const z=new h.a2(t.z,r,t.z,t.x,t.y),L=d.terrain.getMinMaxElevation(z);b=(_=L.minElevation)!==null&&_!==void 0?_:Math.min(0,l),S=(v=L.maxElevation)!==null&&v!==void 0?v:Math.max(0,l)}const C=1<<t.z;return new ja([r+t.x/C,t.y/C,b],[r+(t.x+1)/C,(t.y+1)/C,S])}allowVariableZoom(t,r){const l=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,d=h.an(78.5-l/2,0,60);return!!r.terrain||t.pitch>d}allowWorldCopies(){return!0}prepareNextFrame(){}}class fa{constructor(t,r,l){this.points=t,this.planes=r,this.aabb=l}static fromInvProjectionMatrix(t,r=1,l=0,d,_){const v=_?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],b=Math.pow(2,l),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((R=>(function(j,G,$,K){const W=h.aH([],j,G),te=1/W[3]/$*K;return h.b6(W,W,[te,te,1/W[3],te])})(R,t,r,b)));d&&(function(R,j,G,$){const K=$?4:0,W=$?0:4;let te=0;const oe=[],ee=[];for(let ne=0;ne<4;ne++){const _e=h.b2([],R[ne+W],R[ne+K]),Ie=h.b7(_e);h.a$(_e,_e,1/Ie),oe.push(Ie),ee.push(_e)}for(let ne=0;ne<4;ne++){const _e=h.b8(R[ne+K],ee[ne],G);te=_e!==null&&_e>=0?Math.max(te,_e):Math.max(te,oe[ne])}const se=(function(ne,_e){const Ie=h.b2([],ne[_e[0]],ne[_e[1]]),Ee=h.b2([],ne[_e[2]],ne[_e[1]]),ze=[0,0,0,0];return h.b3(ze,h.b4([],Ie,Ee)),ze[3]=-h.b5(ze,ne[_e[0]]),ze})(R,j),ce=(function(ne,_e){const Ie=h.b9(ne),Ee=h.ba([],ne,1/Ie),ze=h.b2([],_e,h.a$([],Ee,h.b5(_e,Ee))),De=h.b9(ze);if(De>0){const et=Math.sqrt(1-Ee[3]*Ee[3]),tt=h.a$([],Ee,-Ee[3]),qe=h.b0([],tt,h.a$([],ze,et/De));return h.bb(_e,qe)}return null})(G,se);if(ce!==null){const ne=ce/h.b5(ee[0],se);te=Math.min(te,ne)}for(let ne=0;ne<4;ne++){const _e=Math.min(te,oe[ne]);R[ne+W]=[R[ne+K][0]+ee[ne][0]*_e,R[ne+K][1]+ee[ne][1]*_e,R[ne+K][2]+ee[ne][2]*_e,1]}})(S,v[0],d,_);const C=v.map((R=>{const j=h.b2([],S[R[0]],S[R[1]]),G=h.b2([],S[R[2]],S[R[1]]),$=h.b3([],h.b4([],j,G)),K=-h.b5($,S[R[1]]);return $.concat(K)})),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],L=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const R of S)for(let j=0;j<3;j++)z[j]=Math.min(z[j],R[j]),L[j]=Math.max(L[j],R[j]);return new fa(S,C,new ja(z,L))}}class In{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,l){return this._helper.interpolatePadding(t,r,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r,l=!0){this._helper.resize(t,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,r){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(r,l)=>{l=h.an(+l,this.minZoom,this.maxZoom);const d={center:new h.V(r.lng,r.lat),zoom:l};let _=this._helper._lngRange;if(!this._helper._renderWorldCopies&&_===null){const ee=179.9999999999;_=[-ee,ee]}const v=this.tileSize*h.aq(d.zoom);let b=0,S=v,C=0,z=v,L=0,R=0;const{x:j,y:G}=this.size;if(this._helper._latRange){const ee=this._helper._latRange;b=h.X(ee[1])*v,S=h.X(ee[0])*v,S-b<G&&(L=G/(S-b))}_&&(C=h.W(h.Y(_[0])*v,0,v),z=h.W(h.Y(_[1])*v,0,v),z<C&&(z+=v),z-C<j&&(R=j/(z-C)));const{x:$,y:K}=be(v,r);let W,te;const oe=Math.max(R||0,L||0);if(oe){const ee=new h.P(R?(z+C)/2:$,L?(S+b)/2:K);return d.center=Se(v,ee).wrap(),d.zoom+=h.at(oe),d}if(this._helper._latRange){const ee=G/2;K-ee<b&&(te=b+ee),K+ee>S&&(te=S-ee)}if(_){const ee=(C+z)/2;let se=$;this._helper._renderWorldCopies&&(se=h.W($,ee-v/2,ee+v/2));const ce=j/2;se-ce<C&&(W=C+ce),se+ce>z&&(W=z-ce)}if(W!==void 0||te!==void 0){const ee=new h.P(W??$,te??K);d.center=Se(v,ee).wrap()}return d},this.applyConstrain=(r,l)=>this._helper.applyConstrain(r,l),this._helper=new Qs({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,l)=>this.defaultConstrain(r,l)},t),this._coveringTilesDetailsProvider=new Po}clone(){const t=new In;return t.apply(this,!1),t}apply(t,r,l){this._helper.apply(t,r,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const r=[new h.bc(0,t)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new h.P(0,0)),d=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new h.P(0,this._helper._height)),b=Math.floor(Math.min(l.x,d.x,_.x,v.x)),S=Math.floor(Math.max(l.x,d.x,_.x,v.x)),C=1;for(let z=b-C;z<=S+C;z++)z!==0&&r.push(new h.bc(z,t))}return r}getCameraFrustum(){return fa.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const r=this.screenPointToLocation(this.centerPoint,t),l=t?t.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(t,r){const l=h.as(this.elevation,this.center.lat),d=this.screenPointToMercatorCoordinateAtZ(r,l),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),v=h.a9.fromLngLat(t),b=new h.a9(v.x-(d.x-_.x),v.y-(d.y-_.y));this.setCenter(b?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,r){return r?this.coordinatePoint(h.a9.fromLngLat(t),r.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(h.a9.fromLngLat(t))}screenPointToLocation(t,r){var l;return(l=this.screenPointToMercatorCoordinate(t,r))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(t,r){if(r){const l=r.pointCoordinate(t);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,r){const l=r||0,d=[t.x,t.y,0,1],_=[t.x,t.y,1,1];h.aH(d,d,this._pixelMatrixInverse),h.aH(_,_,this._pixelMatrixInverse);const v=d[3],b=_[3],S=d[1]/v,C=_[1]/b,z=d[2]/v,L=_[2]/b,R=z===L?0:(l-z)/(L-z);return new h.a9(h.G.number(d[0]/v,_[0]/b,R)/this.worldSize,h.G.number(S,C,R)/this.worldSize,l)}coordinatePoint(t,r=0,l=this._pixelMatrix){const d=[t.x*this.worldSize,t.y*this.worldSize,r,1];return h.aH(d,d,l),new h.P(d[0]/d[3],d[1]/d[3])}getBounds(){const t=Math.max(0,this._helper._height/2-He(this));return new Wi().extend(this.screenPointToLocation(new h.P(0,t))).extend(this.screenPointToLocation(new h.P(this._helper._width,t))).extend(this.screenPointToLocation(new h.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new h.P(0,this._helper._height)))}isPointOnMapSurface(t,r){return r?r.pointCoordinate(t)!=null:t.y>this.height/2-He(this)}calculatePosMatrix(t,r=!1,l){var d;const _=(d=t.key)!==null&&d!==void 0?d:h.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),v=r?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(_)){const C=v.get(_);return l?C.f32:C.f64}const b=Be(t,this.worldSize);h.S(b,r?this._alignedProjMatrix:this._viewProjMatrix,b);const S={f64:b,f32:new Float32Array(b)};return v.set(_,S),l?S.f32:S.f64}calculateFogMatrix(t){const r=t.key,l=this._fogMatrixCacheF32;if(l.has(r))return l.get(r);const d=Be(t,this.worldSize);return h.S(d,this._fogMatrix,d),l.set(r,new Float32Array(d)),l.get(r)}calculateCenterFromCameraLngLatAlt(t,r,l,d){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,l,d)}_calculateNearFarZIfNeeded(t,r,l){if(!this._helper.autoCalculateNearFarZ)return;const d=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=t-d*this._helper._pixelPerMeter/Math.cos(r),v=d<0?_:t,b=Math.PI/2+this.pitchInRadians,S=h.ap(this.fov)*(Math.abs(Math.cos(h.ap(this.roll)))*this.height+Math.abs(Math.sin(h.ap(this.roll)))*this.width)/this.height*(.5+l.y/this.height),C=Math.sin(S)*v/Math.sin(h.an(Math.PI-b-S,.01,Math.PI-.01)),z=He(this),L=Math.atan(z/this._helper.cameraToCenterDistance),R=h.ap(.75),j=L>R?2*L*(.5+l.y/(2*z)):R,G=Math.sin(j)*v/Math.sin(h.an(Math.PI-b-j,.01,Math.PI-.01)),$=Math.min(C,G);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*$+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,r=be(this.worldSize,this.center),l=r.x,d=r.y;this._helper._pixelPerMeter=h.as(1,this.center.lat)*this.worldSize;const _=h.ap(Math.min(this.pitch,Te)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let b;this._calculateNearFarZIfNeeded(v,_,t),b=new Float64Array(16),h.be(b,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),h.aB(this._invProjMatrix,b),b[8]=2*-t.x/this._helper._width,b[9]=2*t.y/this._helper._height,this._projectionMatrix=h.bf(b),h.Q(b,b,[1,-1,1]),h.O(b,b,[0,0,-this._helper.cameraToCenterDistance]),h.bg(b,b,-this.rollInRadians),h.bh(b,b,this.pitchInRadians),h.bg(b,b,-this.bearingInRadians),h.O(b,b,[-l,-d,0]),this._mercatorMatrix=h.Q([],b,[this.worldSize,this.worldSize,this.worldSize]),h.Q(b,b,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=h.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,b),h.O(b,b,[0,0,-this.elevation]),this._viewProjMatrix=b,this._invViewProjMatrix=h.aB([],b);const S=[0,0,-1,1];h.aH(S,S,this._invViewProjMatrix),this._cameraPosition=[S[0]/S[3],S[1]/S[3],S[2]/S[3]],this._fogMatrix=new Float64Array(16),h.be(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,h.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),h.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),h.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),h.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),h.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),h.O(this._fogMatrix,this._fogMatrix,[-l,-d,0]),h.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),h.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=h.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,b);const C=this._helper._width%2/2,z=this._helper._height%2/2,L=Math.cos(this.bearingInRadians),R=Math.sin(-this.bearingInRadians),j=l-Math.round(l)+L*C+R*z,G=d-Math.round(d)+L*z+R*C,$=new Float64Array(b);if(h.O($,$,[j>.5?j-1:j,G>.5?G-1:G,0]),this._alignedProjMatrix=$,b=h.aB(new Float64Array(16),this._pixelMatrix),!b)throw new Error("failed to invert matrix");this._pixelMatrixInverse=b,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new h.P(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return h.aH(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=h.as(1,this.center.lat)*this.worldSize;return le(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,r){const l=h.a9.fromLngLat(t),d=[l.x*this.worldSize,l.y*this.worldSize,r,1];return h.aH(d,d,this._viewProjMatrix),d[2]/d[3]}getProjectionData(t){const{overscaledTileID:r,aligned:l,applyTerrainMatrix:d}=t,_=this._helper.getMercatorTileCoordinates(r),v=r?this.calculatePosMatrix(r,l,!0):null;let b;return b=r&&r.terrainRttPosMatrix32f&&d?r.terrainRttPosMatrix32f:v||h.bi(),{mainMatrix:b,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:b}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,r,l){return 1}transformLightDirection(t){return h.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,r,l,d){const _=this.calculatePosMatrix(l);let v;d?(v=[t,r,d(t,r),1],h.aH(v,v,_)):(v=[t,r,0,1],rr(v,v,_));const b=v[3];return{point:new h.P(v[0]/b,v[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}populateCache(t){for(const r of t)this.calculatePosMatrix(r)}getMatrixForModel(t,r){const l=h.a9.fromLngLat(t,r),d=l.meterInMercatorCoordinateUnits(),_=h.bj();return h.O(_,_,[l.x,l.y,l.z]),h.bg(_,_,Math.PI),h.bh(_,_,Math.PI/2),h.Q(_,_,[-d,d,d]),_}getProjectionDataForCustomLayer(t=!0){const r=new h.a2(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:t}),d=Be(r,this.worldSize);h.S(d,this._viewProjMatrix,d),l.tileMercatorCoords=[0,0,1,1];const _=[h.a5,h.a5,this.worldSize/this._helper.pixelsPerMeter],v=h.bk();return h.Q(v,d,_),l.fallbackMatrix=v,l.mainMatrix=v,l}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function pa(){h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function pu(m){if(m.useSlerp)if(m.k<1){const t=h.bl(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),r=h.bl(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),l=new Float64Array(4);h.bm(l,t,r,m.k);const d=h.bn(l);m.tr.setRoll(d.roll),m.tr.setPitch(d.pitch),m.tr.setBearing(d.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(h.G.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(h.G.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(h.G.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function Ro(m,t,r,l,d){const _=d.padding,v=be(d.worldSize,r.getNorthWest()),b=be(d.worldSize,r.getNorthEast()),S=be(d.worldSize,r.getSouthEast()),C=be(d.worldSize,r.getSouthWest()),z=h.ap(-l),L=v.rotate(z),R=b.rotate(z),j=S.rotate(z),G=C.rotate(z),$=new h.P(Math.max(L.x,R.x,G.x,j.x),Math.max(L.y,R.y,G.y,j.y)),K=new h.P(Math.min(L.x,R.x,G.x,j.x),Math.min(L.y,R.y,G.y,j.y)),W=$.sub(K),te=(d.width-(_.left+_.right+t.left+t.right))/W.x,oe=(d.height-(_.top+_.bottom+t.top+t.bottom))/W.y;if(oe<0||te<0)return void pa();const ee=Math.min(h.at(d.scale*Math.min(te,oe)),m.maxZoom),se=h.P.convert(m.offset),ce=new h.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(h.ap(l)),ne=se.add(ce).mult(d.scale/h.aq(ee));return{center:Se(d.worldSize,v.add(S).div(2).sub(ne)),zoom:ee,bearing:l}}class Lo{get useGlobeControls(){return!1}handlePanInertia(t,r){const l=t.mag(),d=Math.abs(He(r));return{easingOffset:t.mult(Math.min(.75*d/l,1)),easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(t,r){t.bearingDelta&&r.setBearing(r.bearing+t.bearingDelta),t.pitchDelta&&r.setPitch(r.pitch+t.pitchDelta),t.rollDelta&&r.setRoll(r.roll+t.rollDelta),t.zoomDelta&&r.setZoom(r.zoom+t.zoomDelta)}handleMapControlsPan(t,r,l){t.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(l,t.around)}cameraForBoxAndBearing(t,r,l,d,_){return Ro(t,r,l,d,_)}handleJumpToCenterZoom(t,r){t.zoom!==(r.zoom!==void 0?+r.zoom:t.zoom)&&t.setZoom(+r.zoom),r.center!==void 0&&t.setCenter(h.V.convert(r.center))}handleEaseTo(t,r){const l=t.zoom,d=t.padding,_={roll:t.roll,pitch:t.pitch,bearing:t.bearing},v={roll:r.roll===void 0?t.roll:r.roll,pitch:r.pitch===void 0?t.pitch:r.pitch,bearing:r.bearing===void 0?t.bearing:r.bearing},b=r.zoom!==void 0,S=!t.isPaddingEqual(r.padding);let C=!1;const z=b?+r.zoom:t.zoom;let L=t.centerPoint.add(r.offsetAsPoint);const R=t.screenPointToLocation(L),{center:j,zoom:G}=t.applyConstrain(h.V.convert(r.center||R),z??l);Qr(t,j);const $=be(t.worldSize,R),K=be(t.worldSize,j).sub($),W=h.aq(G-l);return C=G!==l,{easeFunc:te=>{if(C&&t.setZoom(h.G.number(l,G,te)),h.bo(_,v)||pu({startEulerAngles:_,endEulerAngles:v,tr:t,k:te,useSlerp:_.roll!=v.roll}),S&&(t.interpolatePadding(d,r.padding,te),L=t.centerPoint.add(r.offsetAsPoint)),r.around)t.setLocationAtPoint(r.around,r.aroundPoint);else{const oe=h.aq(t.zoom-l),ee=G>l?Math.min(2,W):Math.max(.5,W),se=Math.pow(ee,1-te),ce=Se(t.worldSize,$.add(K.mult(te*se)).mult(oe));t.setLocationAtPoint(t.renderWorldCopies?ce.wrap():ce,L)}},isZooming:C,elevationCenter:j}}handleFlyTo(t,r){const l=r.zoom!==void 0,d=t.zoom,_=t.applyConstrain(h.V.convert(r.center||r.locationAtOffset),l?+r.zoom:d),v=_.center,b=_.zoom;Qr(t,v);const S=be(t.worldSize,r.locationAtOffset),C=be(t.worldSize,v).sub(S),z=C.mag(),L=h.aq(b-d);let R;if(r.minZoom!==void 0){const j=Math.min(+r.minZoom,d,b),G=t.applyConstrain(v,j).zoom;R=h.aq(G-d)}return{easeFunc:(j,G,$,K)=>{t.setZoom(j===1?b:d+h.at(G));const W=j===1?v:Se(t.worldSize,S.add(C.mult($)).mult(G));t.setLocationAtPoint(t.renderWorldCopies?W.wrap():W,K)},scaleOfZoom:L,targetCenter:v,scaleOfMinZoom:R,pixelPathLength:z}}}class Di{constructor(t,r,l){this.blendFunction=t,this.blendColor=r,this.mask=l}}Di.Replace=[1,0],Di.disabled=new Di(Di.Replace,h.bp.transparent,[!1,!1,!1,!1]),Di.unblended=new Di(Di.Replace,h.bp.transparent,[!0,!0,!0,!0]),Di.alphaBlended=new Di([1,771],h.bp.transparent,[!0,!0,!0,!0]);const Js=2305;class ai{constructor(t,r,l){this.enable=t,this.mode=r,this.frontFace=l}}ai.disabled=new ai(!1,1029,Js),ai.backCCW=new ai(!0,1029,Js),ai.frontCCW=new ai(!0,1028,Js);class Ht{constructor(t,r,l){this.func=t,this.mask=r,this.range=l}}Ht.ReadOnly=!1,Ht.ReadWrite=!0,Ht.disabled=new Ht(519,Ht.ReadOnly,[0,1]);const ko=7680;class hi{constructor(t,r,l,d,_,v){this.test=t,this.ref=r,this.mask=l,this.fail=d,this.depthFail=_,this.pass=v}}hi.disabled=new hi({func:519,mask:0},0,0,ko,ko,ko);const mu=new WeakMap;function or(m){var t;if(mu.has(m))return mu.get(m);{const r=(t=m.getParameter(m.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return mu.set(m,r),r}}class eo{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const r=t.context,l=r.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const d=new h.aW;d.emplaceBack(-1,-1),d.emplaceBack(2,-1),d.emplaceBack(-1,2);const _=new h.aY;_.emplaceBack(0,1,2),this._fullscreenTriangle=new Li(r.createVertexBuffer(d,sr.members),r.createIndexBuffer(_),h.aX.simpleSegment(0,0,d.length,_.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(l.TEXTURE1);const v=l.createTexture();l.bindTexture(l.TEXTURE_2D,v),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),or(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,r){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,r=t.gl;t.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,r){const l=this._cachedRenderContext.context,d=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:h.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,d.TRIANGLES,Ht.disabled,hi.disabled,Di.unblended,ai.disabled,((_,v)=>({u_input:_,u_output_expected:v}))(t,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&or(d)){d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.readBuffer(d.COLOR_ATTACHMENT0),d.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),d.bindBuffer(d.PIXEL_PACK_BUFFER,null);const _=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);d.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&or(t)){const r=t.clientWaitSync(this._readbackQueue.sync,0,0);if(r===t.WAIT_FAILED)return h.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=eo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let r=0;return r+=t[0]/256,r+=t[1]/65536,r+=t[2]/16777216,t[3]<127&&(r=-r),r/128}}const to=h.a5/128;function wd(m,t){const r=m.granularity!==void 0?Math.max(m.granularity,1):1,l=r+(m.generateBorders?2:0),d=r+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),_=l+1,v=d+1,b=m.generateBorders?-1:0,S=m.generateBorders||m.extendToNorthPole?-1:0,C=r+(m.generateBorders?1:0),z=r+(m.generateBorders||m.extendToSouthPole?1:0),L=_*v,R=l*d*6,j=_*v>65536;if(j&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const G=j||t==="32bit",$=new Int16Array(2*L);let K=0;for(let oe=S;oe<=z;oe++)for(let ee=b;ee<=C;ee++){let se=ee/r*h.a5;ee===-1&&(se=-to),ee===r+1&&(se=h.a5+to);let ce=oe/r*h.a5;oe===-1&&(ce=m.extendToNorthPole?h.br:-to),oe===r+1&&(ce=m.extendToSouthPole?h.bs:h.a5+to),$[K++]=se,$[K++]=ce}const W=G?new Uint32Array(R):new Uint16Array(R);let te=0;for(let oe=0;oe<d;oe++)for(let ee=0;ee<l;ee++){const se=ee+1+oe*_,ce=ee+(oe+1)*_,ne=ee+1+(oe+1)*_;W[te++]=ee+oe*_,W[te++]=ce,W[te++]=se,W[te++]=se,W[te++]=ce,W[te++]=ne}return{vertices:$.buffer.slice(0),indices:W.buffer.slice(0),uses32bitIndices:G}}const gu=new h.aV({fill:new h.bt(128,2),line:new h.bt(512,0),tile:new h.bt(128,32),stencil:new h.bt(128,1),circle:3});class hh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ji.projectionGlobe}get vertexShaderPreludeCode(){return Ji.projectionMercator.vertexSource}get subdivisionGranularity(){return gu}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new eo(t));const r=h.X(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,d=this._errorMeasurement.updateErrorLoop(r,l),_=bt();d!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=d,this._errorMeasurementLastChangeTime=_);const v=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=h.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,h.bv(v))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,r,l,d,_){const v=(_==="stencil"?gu.stencil:gu.tile).getGranularityForZoomLevel(r.z);return this._getMesh(t,{granularity:v,generateBorders:l,extendToNorthPole:r.y===0&&d,extendToSouthPole:r.y===(1<<r.z)-1&&d})}_getMesh(t,r){const l=this._getMeshKey(r);if(l in this._tileMeshCache)return this._tileMeshCache[l];const d=(function(_,v){const b=wd(v,"16bit"),S=h.aW.deserialize({arrayBuffer:b.vertices,length:b.vertices.byteLength/2/2}),C=h.aY.deserialize({arrayBuffer:b.indices,length:b.indices.byteLength/2/3});return new Li(_.createVertexBuffer(S,sr.members),_.createIndexBuffer(C),h.aX.simpleSegment(0,0,S.length,C.length))})(t,r);return this._tileMeshCache[l]=d,d}recalculate(t){}hasTransition(){const t=bt();let r=!1;return r=r||(t-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Zf=new h.t({type:new h.D(h.u.projection.type)});class dh extends h.E{constructor(t){super(),this._transitionable=new h.x(Zf,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.H(0)),this._mercatorProjection=new On,this._verticalPerspectiveProjection=new hh}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof h.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,r,l,d,_){return this.currentProjection.getMeshFromTileID(t,r,l,d,_)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function ma(m){const t=Oo(m.worldSize,m.center.lat);return 2*Math.PI*t}function Jr(m,t,r,l,d){const _=1/(1<<d),v=t/h.a5*_+l*_,b=h.bz((m/h.a5*_+r*_)*Math.PI*2+Math.PI,2*Math.PI),S=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,C=Math.cos(S),z=new Float64Array(3);return z[0]=Math.sin(b)*C,z[1]=Math.sin(S),z[2]=Math.cos(b)*C,z}function tn(m){return(function(t,r){const l=Math.cos(r),d=new Float64Array(3);return d[0]=Math.sin(t)*l,d[1]=Math.sin(r),d[2]=Math.cos(t)*l,d})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function Oo(m,t){return m/(2*Math.PI)/Math.cos(t*Math.PI/180)}function _u(m){const t=Math.asin(m[1])/Math.PI*180,r=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(r>1e-6){const l=m[0]/r,d=Math.acos(m[2]/r),_=(l>0?d:-d)/Math.PI*180;return new h.V(h.W(_,-180,180),t)}return new h.V(0,t)}function yu(m){return Math.cos(m*Math.PI/180)}function pn(m,t){const r=yu(m),l=yu(t);return h.at(l/r)}function Td(m,t){const r=m.rotate(t.bearingInRadians),l=t.zoom+pn(t.center.lat,0),d=h.bu(1/yu(t.center.lat),1/yu(Math.min(Math.abs(t.center.lat),60)),h.bx(l,7,3,0,1)),_=360/ma({worldSize:t.worldSize,center:{lat:t.center.lat}});return new h.V(t.center.lng-r.x*_*d,h.an(t.center.lat+r.y*_,-h.ao,h.ao))}function pc(m){const t=.5*m,r=Math.sin(t),l=Math.cos(t);return Math.log(r+l)-Math.log(l-r)}function Sd(m,t,r,l){const d=m.lat+r*l;if(Math.abs(r)>1){const _=(Math.sign(m.lat+r)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,v=Math.abs(m.lat+r)*Math.PI/180,b=pc(_+l*(v-_)),S=pc(_),C=pc(v);return new h.V(m.lng+t*((b-S)/(C-S)),d)}return new h.V(m.lng+t*l,d)}class Hf{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,r,l,d){const _=`${t.z}_${t.x}_${t.y}_${d?.terrain?"t":""}`,v=this._cache.get(_);if(v)return v;const b=this._cachePrevious.get(_);if(b)return this._cache.set(_,b),b;const S=this._boundingVolumeFactory(t,r,l,d);return this._cache.set(_,S),this._hadAnyChanges=!0,S}}class El{constructor(t,r,l,d){this.min=l,this.max=d,this.points=t,this.planes=r}static fromAabb(t,r){const l=[];for(let d=0;d<8;d++)l.push([1&~d?t[0]:r[0],(d>>1&1)==1?r[1]:t[1],(d>>2&1)==1?r[2]:t[2]]);return new El(l,[[-1,0,0,r[0]],[1,0,0,-t[0]],[0,-1,0,r[1]],[0,1,0,-t[1]],[0,0,-1,r[2]],[0,0,1,-t[2]]],t,r)}static fromCenterSizeAngles(t,r,l){const d=h.bB([],l[0],l[1],l[2]),_=h.bC([],[r[0],0,0],d),v=h.bC([],[0,r[1],0],d),b=h.bC([],[0,0,r[2]],d),S=[...t],C=[...t];for(let L=0;L<8;L++)for(let R=0;R<3;R++){const j=t[R]+_[R]*(1&~L?-1:1)+v[R]*((L>>1&1)==1?1:-1)+b[R]*((L>>2&1)==1?1:-1);S[R]=Math.min(S[R],j),C[R]=Math.max(C[R],j)}const z=[];for(let L=0;L<8;L++){const R=[...t];h.b0(R,R,h.a$([],_,1&~L?-1:1)),h.b0(R,R,h.a$([],v,(L>>1&1)==1?1:-1)),h.b0(R,R,h.a$([],b,(L>>2&1)==1?1:-1)),z.push(R)}return new El(z,[[..._,-h.b5(_,z[0])],[...v,-h.b5(v,z[0])],[...b,-h.b5(b,z[0])],[-_[0],-_[1],-_[2],-h.b5(_,z[7])],[-v[0],-v[1],-v[2],-h.b5(v,z[7])],[-b[0],-b[1],-b[2],-h.b5(b,z[7])]],S,C)}intersectsFrustum(t){let r=!0;const l=this.points.length,d=this.planes.length,_=t.planes.length,v=t.points.length;for(let b=0;b<_;b++){const S=t.planes[b];let C=0;for(let z=0;z<l;z++){const L=this.points[z];S[0]*L[0]+S[1]*L[1]+S[2]*L[2]+S[3]>=0&&C++}if(C===0)return 0;C<l&&(r=!1)}if(r)return 2;for(let b=0;b<d;b++){const S=this.planes[b];let C=0;for(let z=0;z<v;z++){const L=t.points[z];S[0]*L[0]+S[1]*L[1]+S[2]*L[2]+S[3]>=0&&C++}if(C===0)return 0}return 1}intersectsPlane(t){const r=this.points.length;let l=0;for(let d=0;d<r;d++){const _=this.points[d];t[0]*_[0]+t[1]*_[1]+t[2]*_[2]+t[3]>=0&&l++}return l===r?2:l===0?0:1}}function mc(m,t,r){const l=m-t;return l<0?-l:Math.max(0,l-r)}function Al(m,t,r,l,d){const _=m-r;let v;return v=_<0?Math.min(-_,1+_-d):_>1?Math.min(Math.max(_-d,0),1-_):0,Math.max(v,mc(t,l,d))}class fh{constructor(){this._boundingVolumeCache=new Hf(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,r,l,d){const _=1<<l.z,v=1/_,b=l.x/_,S=l.y/_;let C=2;return C=Math.min(C,Al(t,r,b,S,v)),C=Math.min(C,Al(t,r,b+.5,-S-v,v)),C=Math.min(C,Al(t,r,b+.5,2-S-v,v)),C}getWrap(t,r,l){const d=1<<r.z,_=1/d,v=r.x/d,b=mc(t.x,v,_),S=mc(t.x,v-1,_),C=mc(t.x,v+1,_),z=Math.min(b,S,C);return z===C?1:z===S?-1:0}allowVariableZoom(t,r){return Ft(t,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,r,l,d){return this._boundingVolumeCache.getTileBoundingVolume(t,r,l,d)}_computeTileBoundingVolume(t,r,l,d){var _,v;let b=0,S=0;if(d?.terrain){const C=new h.a2(t.z,r,t.z,t.x,t.y),z=d.terrain.getMinMaxElevation(C);b=(_=z.minElevation)!==null&&_!==void 0?_:Math.min(0,l),S=(v=z.maxElevation)!==null&&v!==void 0?v:Math.max(0,l)}if(b/=h.bE,S/=h.bE,b+=1,S+=1,t.z<=0)return El.fromAabb([-S,-S,-S],[S,S,S]);if(t.z===1)return El.fromAabb([t.x===0?-S:0,t.y===0?0:-S,-S],[t.x===0?0:S,t.y===0?S:0,S]);{const C=[Jr(0,0,t.x,t.y,t.z),Jr(h.a5,0,t.x,t.y,t.z),Jr(h.a5,h.a5,t.x,t.y,t.z),Jr(0,h.a5,t.x,t.y,t.z)],z=[];for(const ze of C)z.push(h.a$([],ze,S));if(S!==b)for(const ze of C)z.push(h.a$([],ze,b));t.y===0&&z.push([0,1,0]),t.y===(1<<t.z)-1&&z.push([0,-1,0]);const L=[1,1,1],R=[-1,-1,-1];for(const ze of z)for(let De=0;De<3;De++)L[De]=Math.min(L[De],ze[De]),R[De]=Math.max(R[De],ze[De]);const j=Jr(h.a5/2,h.a5/2,t.x,t.y,t.z),G=h.b4([],[0,1,0],j);h.b3(G,G);const $=h.b4([],j,G);h.b3($,$);const K=h.b4([],C[2],C[1]);h.b3(K,K);const W=h.b4([],C[0],C[3]);h.b3(W,W),z.push(h.a$([],j,S)),t.y>=(1<<t.z)/2&&z.push(h.a$([],Jr(h.a5/2,0,t.x,t.y,t.z),S)),t.y<(1<<t.z)/2&&z.push(h.a$([],Jr(h.a5/2,h.a5,t.x,t.y,t.z),S));const te=vu(j,z),oe=vu($,z),ee=[-j[0],-j[1],-j[2],te.max],se=[j[0],j[1],j[2],-te.min],ce=[-$[0],-$[1],-$[2],oe.max],ne=[$[0],$[1],$[2],-oe.min],_e=[...K,0],Ie=[...W,0],Ee=[];return t.y===0?Ee.push(h.bD(Ie,_e,ee),h.bD(Ie,_e,se)):Ee.push(h.bD(ce,_e,ee),h.bD(ce,_e,se),h.bD(ce,Ie,ee),h.bD(ce,Ie,se)),t.y===(1<<t.z)-1?Ee.push(h.bD(Ie,_e,ee),h.bD(Ie,_e,se)):Ee.push(h.bD(ne,_e,ee),h.bD(ne,_e,se),h.bD(ne,Ie,ee),h.bD(ne,Ie,se)),new El(Ee,[ee,se,ce,ne,_e,Ie],L,R)}}}function vu(m,t){let r=1/0,l=-1/0;for(const d of t){const _=h.b5(m,d);r=Math.min(r,_),l=Math.max(l,_)}return{min:r,max:l}}class Cl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,l){return this._helper.interpolatePadding(t,r,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r){this._helper.resize(t,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=h.bF(),this._projectionMatrix=h.bj(),this._globeViewProjMatrix32f=h.bi(),this._globeViewProjMatrixNoCorrection=h.bj(),this._globeViewProjMatrixNoCorrectionInverted=h.bj(),this._globeProjMatrixInverted=h.bj(),this._cameraPosition=h.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(r,l)=>{const d=h.an(r.lat,-h.ao,h.ao),_=h.an(+l,this.minZoom+pn(0,d),this.maxZoom);return{center:new h.V(r.lng,d),zoom:_}},this.applyConstrain=(r,l)=>this._helper.applyConstrain(r,l),this._helper=new Qs({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,l)=>this.defaultConstrain(r,l)},t),this._coveringTilesDetailsProvider=new fh}clone(){const t=new Cl;return t.apply(this,!1),t}apply(t,r,l){this._globeLatitudeErrorCorrectionRadians=l||0,this._helper.apply(t,r)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=h.bA();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:r,applyGlobeMatrix:l}=t,d=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const r=this.pitchInRadians,l=this.cameraToCenterDistance/t,d=Math.sin(r)*l,_=Math.cos(r)*l+1,v=1/Math.sqrt(d*d+_*_)*1;let b=-d,S=_;const C=Math.sqrt(b*b+S*S);b/=C,S/=C;const z=[0,b,S];h.bG(z,z,[0,0,0],-this.bearingInRadians),h.bH(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),h.bI(z,z,[0,0,0],this.center.lng*Math.PI/180);const L=1/h.b7(z);return h.a$(z,z,L),[...z,-v*L]}isLocationOccluded(t){return!this.isSurfacePointVisible(tn(t))}transformLightDirection(t){const r=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,d=Math.cos(l),_=[Math.sin(r)*d,Math.sin(l),Math.cos(r)*d],v=[_[2],0,-_[0]],b=[0,0,0];h.b4(b,v,_),h.b3(v,v),h.b3(b,b);const S=[0,0,0];return h.b3(S,[v[0]*t[0]+b[0]*t[1]+_[0]*t[2],v[1]*t[0]+b[1]*t[1]+_[1]*t[2],v[2]*t[0]+b[2]*t[1]+_[2]*t[2]]),S}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,r,l){const d=(function(b,S,C){const z=1/(1<<C.z);return new h.a9(b/h.a5*z+C.x*z,S/h.a5*z+C.y*z)})(t,r,l.canonical),_=(v=d.y,[h.bz(d.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(t,r,l,d){const _=l.canonical,v=Jr(t,r,_.x,_.y,_.z),b=1+(d?d(t,r):0)/h.bE,S=[v[0]*b,v[1]*b,v[2]*b,1];h.aH(S,S,this._globeViewProjMatrixNoCorrection);const C=this._cachedClippingPlane,z=C[0]*v[0]+C[1]*v[1]+C[2]*v[2]+C[3]<0;return{point:new h.P(S[0]/S[3],S[1]/S[3]),signedDistanceFromCamera:S[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Oo(this.worldSize,this.center.lat),r=h.bk(),l=h.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),h.be(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const d=this.centerOffset;r[8]=2*-d.x/this._helper._width,r[9]=2*d.y/this._helper._height,this._projectionMatrix=h.bf(r),this._globeProjMatrixInverted=h.bk(),h.aB(this._globeProjMatrixInverted,r),h.O(r,r,[0,0,-this.cameraToCenterDistance]),h.bg(r,r,this.rollInRadians),h.bh(r,r,-this.pitchInRadians),h.bg(r,r,this.bearingInRadians),h.O(r,r,[0,0,-t]);const _=h.bA();_[0]=t,_[1]=t,_[2]=t,h.bh(l,r,this.center.lat*Math.PI/180),h.bJ(l,l,-this.center.lng*Math.PI/180),h.Q(l,l,_),this._globeViewProjMatrixNoCorrection=l,h.bh(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),h.bJ(r,r,-this.center.lng*Math.PI/180),h.Q(r,r,_),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=h.bk(),h.aB(this._globeViewProjMatrixNoCorrectionInverted,l);const v=h.bA();this._cameraPosition=h.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/t,h.bG(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),h.bH(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),h.bG(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),h.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),h.bH(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),h.bI(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const b=h.bf(this._globeViewProjMatrixNoCorrectionInverted);h.Q(b,b,[1,1,-1]),this._cachedFrustum=fa.fromInvProjectionMatrix(b,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){h.w("calculateFogMatrix is not supported on globe projection.");const r=h.bk();return h.ar(r),r}getVisibleUnwrappedCoordinates(t){return[new h.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&h.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=tn(t);h.a$(l,l,1+r/h.bE);const d=h.bF();return h.aH(d,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),d[2]/d[3]}populateCache(t){}getBounds(){const t=.5*this.width,r=.5*this.height,l=[new h.P(0,0),new h.P(t,0),new h.P(this.width,0),new h.P(this.width,r),new h.P(this.width,this.height),new h.P(t,this.height),new h.P(0,this.height),new h.P(0,r)],d=[];for(const L of l)d.push(this.unprojectScreenPoint(L));let _=0,v=0,b=0,S=0;const C=this.center;for(const L of d){const R=h.bK(C.lng,L.lng),j=h.bK(C.lat,L.lat);R<v&&(v=R),R>_&&(_=R),j<S&&(S=j),j>b&&(b=j)}const z=[C.lng+v,C.lat+S,C.lng+_,C.lat+b];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new Wi(z)}calculateCenterFromCameraLngLatAlt(t,r,l,d){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,l,d)}setLocationAtPoint(t,r){const l=tn(this.unprojectScreenPoint(r)),d=tn(t),_=h.bA();h.bL(_);const v=h.bA();h.bI(v,l,_,-this.center.lng*Math.PI/180),h.bH(v,v,_,this.center.lat*Math.PI/180);const b=d[0]*d[0]+d[2]*d[2],S=v[0]*v[0];if(b<S)return;const C=Math.sqrt(b-S),z=-C,L=h.bM(d[0],d[2],v[0],C),R=h.bM(d[0],d[2],v[0],z),j=h.bA();h.bI(j,d,_,-L);const G=h.bM(j[1],j[2],v[1],v[2]),$=h.bA();h.bI($,d,_,-R);const K=h.bM($[1],$[2],v[1],v[2]),W=.5*Math.PI,te=G>=-W&&G<=W,oe=K>=-W&&K<=W;let ee,se;if(te&&oe){const Ie=this.center.lng*Math.PI/180,Ee=this.center.lat*Math.PI/180;h.bN(L,Ie)+h.bN(G,Ee)<h.bN(R,Ie)+h.bN(K,Ee)?(ee=L,se=G):(ee=R,se=K)}else if(te)ee=L,se=G;else{if(!oe)return;ee=R,se=K}const ce=ee/Math.PI*180,ne=se/Math.PI*180,_e=this.center.lat;this.setCenter(new h.V(ce,h.an(ne,-90,90))),this.setZoom(this.zoom+pn(_e,this.center.lat))}locationToScreenPoint(t,r){const l=tn(t);if(r){const d=r.getElevationForLngLatZoom(t,this._helper._tileZoom);h.a$(l,l,1+d/h.bE)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(t){const r=h.bF();return h.aH(r,[...t,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new h.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,r){if(r){const l=r.pointCoordinate(t);if(l)return l}return h.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,r){var l;return(l=this.screenPointToMercatorCoordinate(t,r))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(t,r){const l=this._cameraPosition,d=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(l,d)}getRayDirectionFromPixel(t){const r=h.bF();r[0]=t.x/this.width*2-1,r[1]=-1*(t.y/this.height*2-1),r[2]=1,r[3]=1,h.aH(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const l=h.bA();l[0]=r[0]-this._cameraPosition[0],l[1]=r[1]-this._cameraPosition[1],l[2]=r[2]-this._cameraPosition[2];const d=h.bA();return h.b3(d,l),d}isSurfacePointVisible(t){const r=this._cachedClippingPlane;return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const r=h.bF();return h.aH(r,[...t,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(t,r){const l=h.b5(t,r),d=h.bA(),_=h.bA();h.a$(_,r,l),h.b2(d,t,_);const v=1-h.b5(d,d);if(v<0)return null;const b=h.b5(t,t)-1,S=-l+(l<0?1:-1)*Math.sqrt(v),C=b/S,z=S;return{tMin:Math.min(C,z),tMax:Math.max(C,z)}}unprojectScreenPoint(t){const r=this._cameraPosition,l=this.getRayDirectionFromPixel(t),d=this.rayPlanetIntersection(r,l);if(d){const z=h.bA();h.b0(z,r,[l[0]*d.tMin,l[1]*d.tMin,l[2]*d.tMin]);const L=h.bA();return h.b3(L,z),_u(L)}const _=this._cachedClippingPlane,v=_[0]*l[0]+_[1]*l[1]+_[2]*l[2],b=-h.bb(_,r)/v,S=h.bA();if(b>0)h.b0(S,r,[l[0]*b,l[1]*b,l[2]*b]);else{const z=h.bA();h.b0(z,r,[2*l[0],2*l[1],2*l[2]]);const L=h.bb(this._cachedClippingPlane,z);h.b2(S,z,[this._cachedClippingPlane[0]*L,this._cachedClippingPlane[1]*L,this._cachedClippingPlane[2]*L])}const C=(function(z){const L=h.bA();return L[0]=z[0]*-z[3],L[1]=z[1]*-z[3],L[2]=z[2]*-z[3],{center:L,radius:Math.sqrt(1-z[3]*z[3])}})(_);return _u((function(z,L,R){const j=h.bA();h.b2(j,R,z);const G=h.bA();return h.by(G,z,j,L/h.b9(j)),G})(C.center,C.radius,S))}getMatrixForModel(t,r){const l=h.V.convert(t),d=1/h.bE,_=h.bj();return h.bJ(_,_,l.lng/180*Math.PI),h.bh(_,_,-l.lat/180*Math.PI),h.O(_,_,[0,0,1+r/h.bE]),h.bh(_,_,.5*Math.PI),h.Q(_,_,[d,d,d]),_}getProjectionDataForCustomLayer(t=!0){const r=this.getProjectionData({overscaledTileID:new h.a2(0,0,0,0,0),applyGlobeMatrix:t});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(t){}}class zl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,l){return this._helper.interpolatePadding(t,r,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r,l=!0){this._helper.resize(t,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,r){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(r,l)=>this.currentTransform.defaultConstrain(r,l),this.applyConstrain=(r,l)=>this._helper.applyConstrain(r,l),this._helper=new Qs({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,l)=>this.defaultConstrain(r,l)},t),this._globeness=1,this._mercatorTransform=new In,this._verticalPerspectiveTransform=new Cl}clone(){const t=new zl;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this,!1),t}apply(t,r){this._helper.apply(t,r),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const r=this._mercatorTransform.getProjectionData(t),l=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:r.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return h.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return h.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,r,l){const d=this._mercatorTransform.getPitchedTextCorrection(t,r,l),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,r,l);return h.bu(d,_,this._globeness)}projectTileCoordinates(t,r,l,d){return this.currentTransform.projectTileCoordinates(t,r,l,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,r){return this.currentTransform.lngLatToCameraDepth(t,r)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,r,l,d){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,l,d)}setLocationAtPoint(t,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,r),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(t,r),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(t,r){return this.currentTransform.locationToScreenPoint(t,r)}screenPointToMercatorCoordinate(t,r){return this.currentTransform.screenPointToMercatorCoordinate(t,r)}screenPointToLocation(t,r){return this.currentTransform.screenPointToLocation(t,r)}isPointOnMapSurface(t,r){return this.currentTransform.isPointOnMapSurface(t,r)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,r){return this.currentTransform.getMatrixForModel(t,r)}getProjectionDataForCustomLayer(t=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return r;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return l.fallbackMatrix=r.mainMatrix,l}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class bn{get useGlobeControls(){return!0}handlePanInertia(t,r){const l=Td(t,r);return Math.abs(l.lng-r.center.lng)>180&&(l.lng=r.center.lng+179.5*Math.sign(l.lng-r.center.lng)),{easingCenter:l,easingOffset:new h.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,r){const l=t.around,d=r.screenPointToLocation(l);t.bearingDelta&&r.setBearing(r.bearing+t.bearingDelta),t.pitchDelta&&r.setPitch(r.pitch+t.pitchDelta),t.rollDelta&&r.setRoll(r.roll+t.rollDelta);const _=r.zoom;t.zoomDelta&&r.setZoom(r.zoom+t.zoomDelta);const v=r.zoom-_;if(v===0)return;const b=h.bK(r.center.lng,d.lng),S=b/(Math.abs(b/180)+1),C=h.bK(r.center.lat,d.lat),z=r.getRayDirectionFromPixel(l),L=r.cameraPosition,R=-1*h.b5(L,z),j=h.bA();h.b0(j,L,[z[0]*R,z[1]*R,z[2]*R]);const G=h.b7(j)-1,$=Math.exp(.5*-Math.max(G-.3,0)),K=Oo(r.worldSize,r.center.lat)/Math.min(r.width,r.height),W=h.bx(K,.9,.5,1,.25),te=(1-h.aq(-v))*Math.min($,W),oe=r.center.lat,ee=r.zoom,se=new h.V(r.center.lng+S*te,h.an(r.center.lat+C*te,-h.ao,h.ao));r.setLocationAtPoint(d,l);const ce=r.center,ne=h.bx(Math.abs(b),45,85,0,1),_e=h.bx(K,.75,.35,0,1),Ie=Math.pow(Math.max(ne,_e),.25),Ee=h.bK(ce.lng,se.lng),ze=h.bK(ce.lat,se.lat);r.setCenter(new h.V(ce.lng+Ee*Ie,ce.lat+ze*Ie).wrap()),r.setZoom(ee+pn(oe,r.center.lat))}handleMapControlsPan(t,r,l){if(!t.panDelta)return;const d=r.center.lat,_=r.zoom;r.setCenter(Td(t.panDelta,r).wrap()),r.setZoom(_+pn(d,r.center.lat))}cameraForBoxAndBearing(t,r,l,d,_){const v=Ro(t,r,l,d,_),b=r.left/_.width*2-1,S=(_.width-r.right)/_.width*2-1,C=r.top/_.height*-2+1,z=(_.height-r.bottom)/_.height*-2+1,L=h.bK(l.getWest(),l.getEast())<0,R=L?l.getEast():l.getWest(),j=L?l.getWest():l.getEast(),G=Math.max(l.getNorth(),l.getSouth()),$=Math.min(l.getNorth(),l.getSouth()),K=R+.5*h.bK(R,j),W=G+.5*h.bK(G,$),te=_.clone();te.setCenter(v.center),te.setBearing(v.bearing),te.setPitch(0),te.setRoll(0),te.setZoom(v.zoom);const oe=te.modelViewProjectionMatrix,ee=[tn(l.getNorthWest()),tn(l.getNorthEast()),tn(l.getSouthWest()),tn(l.getSouthEast()),tn(new h.V(j,W)),tn(new h.V(R,W)),tn(new h.V(K,G)),tn(new h.V(K,$))],se=tn(v.center);let ce=Number.POSITIVE_INFINITY;for(const ne of ee)b<0&&(ce=bn.getLesserNonNegativeNonNull(ce,bn.solveVectorScale(ne,se,oe,"x",b))),S>0&&(ce=bn.getLesserNonNegativeNonNull(ce,bn.solveVectorScale(ne,se,oe,"x",S))),C>0&&(ce=bn.getLesserNonNegativeNonNull(ce,bn.solveVectorScale(ne,se,oe,"y",C))),z<0&&(ce=bn.getLesserNonNegativeNonNull(ce,bn.solveVectorScale(ne,se,oe,"y",z)));if(Number.isFinite(ce)&&ce!==0)return v.zoom=te.zoom+h.at(ce),v;pa()}handleJumpToCenterZoom(t,r){const l=t.center.lat,d=t.applyConstrain(r.center?h.V.convert(r.center):t.center,t.zoom).center;t.setCenter(d.wrap());const _=r.zoom!==void 0?+r.zoom:t.zoom+pn(l,d.lat);t.zoom!==_&&t.setZoom(_)}handleEaseTo(t,r){const l=t.zoom,d=t.center,_=t.padding,v={roll:t.roll,pitch:t.pitch,bearing:t.bearing},b={roll:r.roll===void 0?t.roll:r.roll,pitch:r.pitch===void 0?t.pitch:r.pitch,bearing:r.bearing===void 0?t.bearing:r.bearing},S=r.zoom!==void 0,C=!t.isPaddingEqual(r.padding);let z=!1;const L=r.center?h.V.convert(r.center):d,R=t.applyConstrain(L,l).center;Qr(t,R);const j=t.clone();j.setCenter(R),j.setZoom(S?+r.zoom:l+pn(d.lat,L.lat)),j.setBearing(r.bearing);const G=new h.P(h.an(t.centerPoint.x+r.offsetAsPoint.x,0,t.width),h.an(t.centerPoint.y+r.offsetAsPoint.y,0,t.height));j.setLocationAtPoint(R,G);const $=(r.offset&&r.offsetAsPoint.mag())>0?j.center:R,K=S?+r.zoom:l+pn(d.lat,$.lat),W=l+pn(d.lat,0),te=K+pn($.lat,0),oe=h.bK(d.lng,$.lng),ee=h.bK(d.lat,$.lat),se=h.aq(te-W);return z=K!==l,{easeFunc:ce=>{if(h.bo(v,b)||pu({startEulerAngles:v,endEulerAngles:b,tr:t,k:ce,useSlerp:v.roll!=b.roll}),C&&t.interpolatePadding(_,r.padding,ce),r.around)h.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(r.around,r.aroundPoint);else{const ne=te>W?Math.min(2,se):Math.max(.5,se),_e=Math.pow(ne,1-ce),Ie=Sd(d,oe,ee,ce*_e);t.setCenter(Ie.wrap())}if(z){const ne=h.G.number(W,te,ce)+pn(0,t.center.lat);t.setZoom(ne)}},isZooming:z,elevationCenter:$}}handleFlyTo(t,r){const l=r.zoom!==void 0,d=t.center,_=t.zoom,v=t.padding,b=!t.isPaddingEqual(r.padding),S=t.applyConstrain(h.V.convert(r.center||r.locationAtOffset),_).center,C=l?+r.zoom:t.zoom+pn(t.center.lat,S.lat),z=t.clone();z.setCenter(S),z.setZoom(C),z.setBearing(r.bearing);const L=new h.P(h.an(t.centerPoint.x+r.offsetAsPoint.x,0,t.width),h.an(t.centerPoint.y+r.offsetAsPoint.y,0,t.height));z.setLocationAtPoint(S,L);const R=z.center;Qr(t,R);const j=(function(ee,se,ce){const ne=tn(se),_e=tn(ce),Ie=h.b5(ne,_e),Ee=Math.acos(Ie),ze=ma(ee);return Ee/(2*Math.PI)*ze})(t,d,R),G=_+pn(d.lat,0),$=C+pn(R.lat,0),K=h.aq($-G);let W;if(typeof r.minZoom=="number"){const ee=+r.minZoom+pn(R.lat,0),se=Math.min(ee,G,$)+pn(0,R.lat),ce=t.applyConstrain(R,se).zoom+pn(R.lat,0);W=h.aq(ce-G)}const te=h.bK(d.lng,R.lng),oe=h.bK(d.lat,R.lat);return{easeFunc:(ee,se,ce,ne)=>{const _e=Sd(d,te,oe,ce);b&&t.interpolatePadding(v,r.padding,ee);const Ie=ee===1?R:_e;t.setCenter(Ie.wrap());const Ee=G+h.at(se);t.setZoom(ee===1?C:Ee+pn(0,Ie.lat))},scaleOfZoom:K,targetCenter:R,scaleOfMinZoom:W,pixelPathLength:j}}static solveVectorScale(t,r,l,d,_){const v=d==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],b=[l[3],l[7],l[11],l[15]],S=t[0]*v[0]+t[1]*v[1]+t[2]*v[2],C=t[0]*b[0]+t[1]*b[1]+t[2]*b[2],z=r[0]*v[0]+r[1]*v[1]+r[2]*v[2],L=r[0]*b[0]+r[1]*b[1]+r[2]*b[2];return z+_*C===S+_*L||b[3]*(S-z)+v[3]*(L-C)+S*L==z*C?null:(z+v[3]-_*L-_*b[3])/(z-S-_*L+_*C)}static getLesserNonNegativeNonNull(t,r){return r!==null&&r>=0&&r<t?r:t}}class Dl{constructor(t){this._globe=t,this._mercatorCameraHelper=new Lo,this._verticalPerspectiveCameraHelper=new bn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,r){return this.currentHelper.handlePanInertia(t,r)}handleMapControlsRollPitchBearingZoom(t,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,r)}handleMapControlsPan(t,r,l){this.currentHelper.handleMapControlsPan(t,r,l)}cameraForBoxAndBearing(t,r,l,d,_){return this.currentHelper.cameraForBoxAndBearing(t,r,l,d,_)}handleJumpToCenterZoom(t,r){this.currentHelper.handleJumpToCenterZoom(t,r)}handleEaseTo(t,r){return this.currentHelper.handleEaseTo(t,r)}handleFlyTo(t,r){return this.currentHelper.handleFlyTo(t,r)}}const Il=(m,t)=>h.B(m,t&&t.filter((r=>r.identifier!=="source.canvas"))),Pl=h.bO();class io extends h.E{constructor(t,r={}){var l,d;super(),this._rtlPluginLoaded=()=>{for(const v in this.tileManagers){const b=this.tileManagers[v].getSource().type;b!=="vector"&&b!=="geojson"||this.tileManagers[v].reload()}},this.map=t,this.dispatcher=new Mr(Hi(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((v,b)=>this.getGlyphs(v,b))),this.dispatcher.registerMessageHandler("GI",((v,b)=>this.getImages(v,b))),this.dispatcher.registerMessageHandler("GDA",((v,b)=>this.getDashes(v,b))),this.imageManager=new kt,this.imageManager.setEventedParent(this);const _=((l=t._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((d=document.documentElement)===null||d===void 0?void 0:d.lang)||void 0;this.glyphManager=new nt(t._requestManager,r.localIdeographFontFamily,_),this.lineAtlas=new lt(256,512),this.crossTileSymbolIndex=new kn,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",h.bP()),N().on(Xs,this._rtlPluginLoaded),this.on("data",(v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const b=this.tileManagers[v.sourceId];if(!b)return;const S=b.getSource();if(S&&S.vectorLayerIds)for(const C in this._layers){const z=this._layers[C];z.source===S.id&&this._validateLayer(z)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new h.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,r){var l,d,_;this._checkLoaded();const v=r===null?(_=(d=(l=this.stylesheet.state)===null||l===void 0?void 0:l[t])===null||d===void 0?void 0:d.default)!==null&&_!==void 0?_:null:r;if(h.bR(v,this._globalState[t]))return this;this._globalState[t]=v,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const r=[];for(const l in t)!h.bR(this._globalState[l],t[l].default)&&(r.push(l),this._globalState[l]=t[l].default);this._applyGlobalStateChanges(r)}_applyGlobalStateChanges(t){if(t.length===0)return;const r=new Set,l={};for(const d of t){l[d]=this._globalState[d];for(const _ in this._layers){const v=this._layers[_],b=v.getLayoutAffectingGlobalStateRefs(),S=v.getPaintAffectingGlobalStateRefs(),C=v.getVisibilityAffectingGlobalStateRefs();if(b.has(d)&&r.add(v.source),S.has(d))for(const{name:z,value:L}of S.get(d))this._updatePaintProperty(v,z,L);C?.has(d)&&(v.recalculateVisibility(),this._updateLayer(v))}}this.dispatcher.broadcast("UGS",l);for(const d in this.tileManagers)r.has(d)&&(this._reloadSource(d),this._changed=!0)}loadURL(t,r={},l){this.fire(new h.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const d=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;h.j(d,this._loadStyleRequest).then((v=>{this._loadStyleRequest=null,this._load(v.data,r,l)})).catch((v=>{this._loadStyleRequest=null,v&&!_.signal.aborted&&this.fire(new h.k(v))}))}loadJSON(t,r={},l){this.fire(new h.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Tt.frameAsync(this._frameRequest,this.map._ownerWindow).then((()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(t,r,l)})).catch((()=>{}))}loadEmpty(){this.fire(new h.l("dataloading",{dataType:"style"})),this._load(Pl,{validate:!1})}_load(t,r,l){var d,_;let v=r.transformStyle?r.transformStyle(l,t):t;if(!r.validate||!Il(this,h.C(v))){v=Object.assign({},v),this._loaded=!0,this.stylesheet=v;for(const b in v.sources)this.addSource(b,v.sources[b],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new li(this.stylesheet.light),this._setProjectionInternal(((d=this.stylesheet.projection)===null||d===void 0?void 0:d.type)||"mercator"),this.sky=new Ze(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new h.l("data",{dataType:"style"})),this.fire(new h.l("style.load"))}}_createLayers(){var t,r,l;const d=h.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",d),this._order=d.map((_=>_.id)),this._layers={},this._serializedLayers=null;for(const _ of d){const v=h.bT(_,this._globalState);if(v.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=v,h.bU(v)&&this.tileManagers[v.source]){const b=(l=(r=_.paint)===null||r===void 0?void 0:r["raster-fade-duration"])!==null&&l!==void 0?l:v.paint.get("raster-fade-duration");this.tileManagers[v.source].setRasterFadeDuration(b)}}}_loadSprite(t,r=!1,l=void 0){this.imageManager.setLoaded(!1);const d=new AbortController;let _;this._spriteRequest=d,(function(v,b,S,C){return h._(this,void 0,void 0,(function*(){const z=Lt(v),L=S>1?"@2x":"",R={},j={};for(const{id:G,url:$}of z){const K=b.transformRequest(ii($,L,".json"),"SpriteJSON");R[G]=h.j(K,C);const W=b.transformRequest(ii($,L,".png"),"SpriteImage");j[G]=Pt.getImage(W,C)}return yield Promise.all([...Object.values(R),...Object.values(j)]),(function(G,$){return h._(this,void 0,void 0,(function*(){const K={};for(const W in G){K[W]={};const te=Tt.getImageCanvasContext((yield $[W]).data),oe=(yield G[W]).data;for(const ee in oe){const{width:se,height:ce,x:ne,y:_e,sdf:Ie,pixelRatio:Ee,stretchX:ze,stretchY:De,content:et,textFitWidth:tt,textFitHeight:qe}=oe[ee];K[W][ee]={data:null,pixelRatio:Ee,sdf:Ie,stretchX:ze,stretchY:De,content:et,textFitWidth:tt,textFitHeight:qe,spriteData:{width:se,height:ce,x:ne,y:_e,context:te}}}}return K}))})(R,j)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((v=>{if(this._spriteRequest=null,v)for(const b in v){this._spritesImagesIds[b]=[];const S=this._spritesImagesIds[b]?this._spritesImagesIds[b].filter((C=>!(C in v))):[];for(const C of S)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in v[b]){const z=b==="default"?C:`${b}:${C}`;this._spritesImagesIds[b].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,v[b][C],!1):this.imageManager.addImage(z,v[b][C]),r&&(this._changedImages[z]=!0)}}})).catch((v=>{this._spriteRequest=null,_=v,d.signal.aborted||this.fire(new h.k(_))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"})),l&&l(_)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}_validateLayer(t){const r=this.tileManagers[t.source];if(!r)return;const l=t.sourceLayer;if(!l)return;const d=r.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(l)===-1)&&this.fire(new h.k(new Error(`Source layer "${l}" does not exist on source "${d.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,r=!1){const l=this._serializedAllLayers();if(!t||t.length===0)return Object.values(r?h.bV(l):l);const d=[];for(const _ of t)if(l[_]){const v=r?h.bV(l[_]):l[_];d.push(v)}return d}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const r=Object.keys(this._layers);for(const l of r){const d=this._layers[l];d.type!=="custom"&&(t[l]=d.serialize())}return t}hasTransitions(){var t,r,l;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const d in this.tileManagers)if(this.tileManagers[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const r=this._changed;if(r){const d=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(d.length||_.length)&&this._updateWorkerLayers(d,_);for(const v in this._updatedSources){const b=this._updatedSources[v];if(b==="reload")this._reloadSource(v);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const l={};for(const d in this.tileManagers){const _=this.tileManagers[d];l[d]=_.used,_.used=!1}for(const d of this._order){const _=this._layers[d];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.tileManagers[_.source].used=!0)}for(const d in l){const _=this.tileManagers[d];!!l[d]!=!!_.used&&_.fire(new h.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,r&&this.fire(new h.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const r in this.tileManagers)this.tileManagers[r].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,r={}){var l;this._checkLoaded();const d=this.serialize();if(t=r.transformStyle?r.transformStyle(d,t):t,((l=r.validate)===null||l===void 0||l)&&Il(this,h.C(t)))return!1;(t=h.bV(t)).layers=h.bS(t.layers);const _=h.bW(d,t),v=this._getOperationsToPerform(_);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const b of v.operations)b();return this.stylesheet=t,this._serializedLayers=null,this.fire(new h.l("style.load",{style:this})),!0}_getOperationsToPerform(t){const r=[],l=[];for(const d of t)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push((()=>this.addLayer.apply(this,d.args)));break;case"removeLayer":r.push((()=>this.removeLayer.apply(this,d.args)));break;case"setPaintProperty":r.push((()=>this.setPaintProperty.apply(this,d.args)));break;case"setLayoutProperty":r.push((()=>this.setLayoutProperty.apply(this,d.args)));break;case"setFilter":r.push((()=>this.setFilter.apply(this,d.args)));break;case"addSource":r.push((()=>this.addSource.apply(this,d.args)));break;case"removeSource":r.push((()=>this.removeSource.apply(this,d.args)));break;case"setLayerZoomRange":r.push((()=>this.setLayerZoomRange.apply(this,d.args)));break;case"setLight":r.push((()=>this.setLight.apply(this,d.args)));break;case"setGeoJSONSourceData":r.push((()=>this.setGeoJSONSourceData.apply(this,d.args)));break;case"setGlyphs":r.push((()=>this.setGlyphs.apply(this,d.args)));break;case"setSprite":r.push((()=>this.setSprite.apply(this,d.args)));break;case"setTerrain":r.push((()=>this.map.setTerrain.apply(this,d.args)));break;case"setSky":r.push((()=>this.setSky.apply(this,d.args)));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setGlobalState":r.push((()=>this.setGlobalState.apply(this,d.args)));break;case"setTransition":r.push((()=>{}));break;default:l.push(d.command)}return{operations:r,unimplemented:l}}addImage(t,r){if(this.getImage(t))return this.fire(new h.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,r),this._afterImageUpdated(t)}updateImage(t,r){this.imageManager.updateImage(t,r)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new h.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,r,l={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(h.C.source,`sources.${t}`,r,null,l))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const d=this.tileManagers[t]=new Ei(t,r,this.dispatcher);d.style=this,d.setEventedParent(this,(()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:t}))),d.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new h.k(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const r=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],r.fire(new h.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,r){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.tileManagers[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(r),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,r,l={}){this._checkLoaded();const d=t.id;if(this.getLayer(d))return void this.fire(new h.k(new Error(`Layer "${d}" already exists on this map.`)));let _;if(t.type==="custom"){if(Il(this,h.bX(t)))return;_=h.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(d,t.source),t=h.bV(t),t=h.e(t,{source:d})),this._validate(h.C.layer,`layers.${d}`,t,{arrayIndex:-1},l))return;_=h.bT(t,this._globalState),this._validateLayer(_),_.setEventedParent(this,{layer:{id:d}})}const v=r?this._order.indexOf(r):this._order.length;if(r&&v===-1)this.fire(new h.k(new Error(`Cannot add layer "${d}" before non-existing layer "${r}".`)));else{if(this._order.splice(v,0,d),this._layerOrderChanged=!0,this._layers[d]=_,this._removedLayers[d]&&_.source&&_.type!=="custom"){const b=this._removedLayers[d];delete this._removedLayers[d],b.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.tileManagers[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,r){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new h.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===r)return;const l=this._order.indexOf(t);this._order.splice(l,1);const d=r?this._order.indexOf(r):this._order.length;r&&d===-1?this.fire(new h.k(new Error(`Cannot move layer "${t}" before non-existing layer "${r}".`))):(this._order.splice(d,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const r=this._layers[t];if(!r)return void this.fire(new h.k(new Error(`Cannot remove non-existing layer "${t}".`)));r.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=r,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],r.onRemove&&r.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,r,l){this._checkLoaded();const d=this.getLayer(t);d?d.minzoom===r&&d.maxzoom===l||(r!=null&&(d.minzoom=r),l!=null&&(d.maxzoom=l),this._updateLayer(d)):this.fire(new h.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,r,l={}){this._checkLoaded();const d=this.getLayer(t);if(d){if(!h.bR(d.filter,r))return r==null?(d.setFilter(void 0),void this._updateLayer(d)):void(this._validate(h.C.filter,`layers.${d.id}.filter`,r,null,l)||(d.setFilter(h.bV(r)),this._updateLayer(d)))}else this.fire(new h.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return h.bV(this.getLayer(t).filter)}setLayoutProperty(t,r,l,d={}){this._checkLoaded();const _=this.getLayer(t);_?h.bR(_.getLayoutProperty(r),l)||(_.setLayoutProperty(r,l,d),this._updateLayer(_)):this.fire(new h.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,r){const l=this.getLayer(t);if(l)return l.getLayoutProperty(r);this.fire(new h.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,r,l,d={}){this._checkLoaded();const _=this.getLayer(t);_?h.bR(_.getPaintProperty(r),l)||this._updatePaintProperty(_,r,l,d):this.fire(new h.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,r,l,d={}){t.setPaintProperty(r,l,d)&&this._updateLayer(t),h.bU(t)&&r==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(l),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,r){return this.getLayer(t).getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const l=t.source,d=t.sourceLayer,_=this.tileManagers[l];if(_===void 0)return void this.fire(new h.k(new Error(`The source '${l}' does not exist in the map's style.`)));const v=_.getSource().type;v==="geojson"&&d?this.fire(new h.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||d?(t.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(d,t.id,r)):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,r){this._checkLoaded();const l=t.source,d=this.tileManagers[l];if(d===void 0)return void this.fire(new h.k(new Error(`The source '${l}' does not exist in the map's style.`)));const _=d.getSource().type,v=_==="vector"?t.sourceLayer:void 0;_!=="vector"||v?r&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new h.k(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(v,t.id,r):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const r=t.source,l=t.sourceLayer,d=this.tileManagers[r];if(d!==void 0)return d.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),d.getFeatureState(l,t.id)):void this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=h.bY(this.tileManagers,(_=>_.serialize())),r=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,d=this.stylesheet;return h.bZ({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,projection:d.projection,sources:t,layers:r,terrain:l},(_=>_!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const r=v=>this._layers[v].type==="fill-extrusion",l={},d=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(r(b)){l[b]=v;for(const S of t){const C=S[b];if(C)for(const z of C)d.push(z)}}}d.sort(((v,b)=>b.intersectionZ-v.intersectionZ));const _=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(r(b))for(let S=d.length-1;S>=0;S--){const C=d[S].feature;if(l[C.layer.id]<v)break;_.push(C),d.pop()}else for(const S of t){const C=S[b];if(C)for(const z of C)_.push(z.feature)}}return _}queryRenderedFeatures(t,r,l){r&&r.filter&&this._validate(h.C.filter,"queryRenderedFeatures.filter",r.filter,null,r);const d={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new h.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const C of r.layers){const z=this._layers[C];if(!z)return this.fire(new h.k(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];d[z.source]=!0}}const _=[];r.availableImages=this._availableImages;const v=this._serializedAllLayers(),b=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,S=Object.assign(Object.assign({},r),{layers:b,globalState:this._globalState});for(const C in this.tileManagers)r.layers&&!d[C]||_.push(ou(this.tileManagers[C],this._layers,v,t,S,l,this.map.terrain?(z,L,R)=>this.map.terrain.getElevation(z,L,R):void 0));return this.placement&&_.push((function(C,z,L,R,j,G,$){const K={},W=G.queryRenderedSymbols(R),te=[];for(const oe of Object.keys(W).map(Number))te.push($[oe]);te.sort(xn);for(const oe of te){const ee=oe.featureIndex.lookupSymbolFeatures(W[oe.bucketInstanceId],z,oe.bucketIndex,oe.sourceLayerIndex,{filterSpec:j.filter,globalState:j.globalState},j.layers,j.availableImages,C);for(const se in ee){const ce=K[se]=K[se]||[],ne=ee[se];ne.sort(((_e,Ie)=>{const Ee=oe.featureSortOrder;if(Ee){const ze=Ee.indexOf(_e.featureIndex);return Ee.indexOf(Ie.featureIndex)-ze}return Ie.featureIndex-_e.featureIndex}));for(const _e of ne)ce.push(_e)}}return(function(oe,ee,se){for(const ce in oe)for(const ne of oe[ce])ca(ne,se[ee[ce].source]);return oe})(K,C,L)})(this._layers,v,this.tileManagers,t,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,r){r?.filter&&this._validate(h.C.filter,"querySourceFeatures.filter",r.filter,null,r);const l=this.tileManagers[t];return l?(function(d,_){const v=d.getRenderableIds().map((C=>d.getTileByID(C))),b=[],S={};for(let C=0;C<v.length;C++){const z=v[C],L=z.tileID.canonical.key;S[L]||(S[L]=!0,z.querySourceFeatures(b,_))}return b})(l,r?Object.assign(Object.assign({},r),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,r={}){this._checkLoaded();const l=this.light.getLight();let d=!1;for(const v in t)if(!h.bR(t[v],l[v])){d=!0;break}if(!d)return;const _={now:bt(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,r),this.light.updateTransitions(_)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.stylesheet.projection=t,this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,r={}){this._checkLoaded();const l=this.getSky();let d=!1;if(!t&&!l)return;if(t&&!l)d=!0;else if(!t&&l)d=!0;else for(const v in t)if(!h.bR(t[v],l[v])){d=!0;break}if(!d)return;const _={now:bt(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,r),this.sky.updateTransitions(_)}_setProjectionInternal(t){const r=(function(l,d){const _={constrainOverride:d};if(Array.isArray(l)){const v=new dh({type:l});return{projection:v,transform:new zl(_),cameraHelper:new Dl(v)}}switch(l){case"mercator":return{projection:new On,transform:new In(_),cameraHelper:new Lo};case"globe":{const v=new dh({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new zl(_),cameraHelper:new Dl(v)}}case"vertical-perspective":return{projection:new hh,transform:new Cl(_),cameraHelper:new bn};default:return h.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new On,transform:new In(_),cameraHelper:new Lo}}})(t,this.map.transformConstrain);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const l in this.tileManagers)this.tileManagers[l].reload()}_validate(t,r,l,d,_={}){return(!_||_.validate!==!1)&&Il(this,t.call(h.C,h.e({key:r,style:this.serialize(),value:l,styleSpec:h.u},d)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),N().off(Xs,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.tileManagers){const l=this.tileManagers[r];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const r in this.tileManagers)this.tileManagers[r].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,r,l,d,_=!1){let v=!1,b=!1;const S={};for(const C of this._order){const z=this._layers[C];if(z.type!=="symbol")continue;if(!S[z.source]){const R=this.tileManagers[z.source];S[z.source]=R.getRenderableIds(!0).map((j=>R.getTileByID(j))).sort(((j,G)=>G.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(G.tileID)?-1:1)))}const L=this.crossTileSymbolIndex.addLayer(z,S[z.source],t.center.lng);v=v||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(bt(),t.zoom))&&(this.pauseablePlacement=new Ml(t,this.map.terrain,this._order,_,r,l,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(bt()),b=!0),v&&this.pauseablePlacement.placement.setStale()),b||v)for(const C of this._order){const z=this._layers[C];z.type==="symbol"&&this.placement.updateLayerOpacities(z,S[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(bt())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,r){return h._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const d=this.tileManagers[r.source];return d&&d.setDependencies(r.tileID.key,r.type,r.icons),l}))}getGlyphs(t,r){return h._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(r.stacks),d=this.tileManagers[r.source];return d&&d.setDependencies(r.tileID.key,r.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,r={}){this._checkLoaded(),t&&this._validate(h.C.glyphs,"glyphs",t,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,r){return h._(this,void 0,void 0,(function*(){const l={};for(const[d,_]of Object.entries(r.dashes))l[d]=this.lineAtlas.getDash(_.dasharray,_.round);return l}))}addSprite(t,r,l={},d){this._checkLoaded();const _=[{id:t,url:r}],v=[...Lt(this.stylesheet.sprite),..._];this._validate(h.C.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(_,!0,d))}removeSprite(t){this._checkLoaded();const r=Lt(this.stylesheet.sprite);if(r.find((l=>l.id===t))){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;r.splice(r.findIndex((l=>l.id===t)),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}else this.fire(new h.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Lt(this.stylesheet.sprite)}setSprite(t,r={},l){this._checkLoaded(),t&&this._validate(h.C.sprite,"sprite",t,null,r)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const r=this.tileManagers[t];r.setEventedParent(null),r.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const r=this._layers[t];r.setEventedParent(null),r.onRemove&&r.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Md=h.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class xu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,r,l,d,_,v,b,S,C){this.context=t;let z=this.boundPaintVertexBuffers.length!==d.length;for(let L=0;!z&&L<d.length;L++)this.boundPaintVertexBuffers[L]!==d[L]&&(z=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==l||z||this.boundIndexBuffer!==_||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==C?this.freshBind(r,l,d,_,v,b,S,C):(t.bindVertexArray.set(this.vao),b&&b.bind(),_&&_.dynamicDraw&&_.bind(),S&&S.bind(),C&&C.bind())}freshBind(t,r,l,d,_,v,b,S){const C=t.numAttributes,z=this.context,L=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=d,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=S,r.enableAttributes(L,t);for(const R of l)R.enableAttributes(L,t);v&&v.enableAttributes(L,t),b&&b.enableAttributes(L,t),S&&S.enableAttributes(L,t),r.bind(),r.setVertexAttribPointers(L,t,_);for(const R of l)R.bind(),R.setVertexAttribPointers(L,t,_);v&&(v.bind(),v.setVertexAttribPointers(L,t,_)),d&&d.bind(),b&&(b.bind(),b.setVertexAttribPointers(L,t,_)),S&&(S.bind(),S.setVertexAttribPointers(L,t,_)),z.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ed=(m,t,r,l,d)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:t,u_fog_color:r?r.properties.get("fog-color"):h.bp.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?0:r?r.calculateFogBlendOpacity(l):0,u_horizon_color:r?r.properties.get("horizon-color"):h.bp.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:d?1:0}),zr={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function gc(m){const t=[];for(let r=0;r<m.length;r++){if(m[r]===null)continue;const l=m[r].split(" ");t.push(l.pop())}return t}class Ad{constructor(t,r,l,d,_,v,b,S,C=[]){const z=t.gl;this.program=z.createProgram();const L=gc(r.staticAttributes),R=l?l.getBinderAttributes():[],j=L.concat(R),G=Ji.prelude.staticUniforms?gc(Ji.prelude.staticUniforms):[],$=b.staticUniforms?gc(b.staticUniforms):[],K=r.staticUniforms?gc(r.staticUniforms):[],W=l?l.getBinderUniforms():[],te=G.concat($).concat(K).concat(W),oe=[];for(const Ee of te)oe.indexOf(Ee)<0&&oe.push(Ee);const ee=l?l.defines():[];or(z)&&ee.unshift("#version 300 es"),_&&ee.push("#define OVERDRAW_INSPECTOR;"),v&&ee.push("#define TERRAIN3D;"),S&&ee.push(S),C&&ee.push(...C);let se=ee.concat(Ji.prelude.fragmentSource,b.fragmentSource,r.fragmentSource).join(`
`),ce=ee.concat(Ji.prelude.vertexSource,b.vertexSource,r.vertexSource).join(`
`);or(z)||(se=(function(Ee){return Ee.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(se),ce=(function(Ee){return Ee.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ce));const ne=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(ne,se),z.compileShader(ne),!z.getShaderParameter(ne,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(ne)}`);z.attachShader(this.program,ne);const _e=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(_e,ce),z.compileShader(_e),!z.getShaderParameter(_e,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(_e)}`);z.attachShader(this.program,_e),this.attributes={};const Ie={};this.numAttributes=j.length;for(let Ee=0;Ee<this.numAttributes;Ee++)j[Ee]&&(z.bindAttribLocation(this.program,Ee,j[Ee]),this.attributes[j[Ee]]=Ee);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(_e),z.deleteShader(ne);for(let Ee=0;Ee<oe.length;Ee++){const ze=oe[Ee];if(ze&&!Ie[ze]){const De=z.getUniformLocation(this.program,ze);De&&(Ie[ze]=De)}}this.fixedUniforms=d(t,Ie),this.terrainUniforms=((Ee,ze)=>({u_depth:new h.b_(Ee,ze.u_depth),u_terrain:new h.b_(Ee,ze.u_terrain),u_terrain_dim:new h.bq(Ee,ze.u_terrain_dim),u_terrain_matrix:new h.c0(Ee,ze.u_terrain_matrix),u_terrain_unpack:new h.c1(Ee,ze.u_terrain_unpack),u_terrain_exaggeration:new h.bq(Ee,ze.u_terrain_exaggeration)}))(t,Ie),this.projectionUniforms=((Ee,ze)=>({u_projection_matrix:new h.c0(Ee,ze.u_projection_matrix),u_projection_tile_mercator_coords:new h.c1(Ee,ze.u_projection_tile_mercator_coords),u_projection_clipping_plane:new h.c1(Ee,ze.u_projection_clipping_plane),u_projection_transition:new h.bq(Ee,ze.u_projection_transition),u_projection_fallback_matrix:new h.c0(Ee,ze.u_projection_fallback_matrix)}))(t,Ie),this.binderUniforms=l?l.getUniforms(t,Ie):[]}draw(t,r,l,d,_,v,b,S,C,z,L,R,j,G,$,K,W,te,oe){const ee=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(d),t.setColorMode(_),t.setCullFace(v),S){t.activeTexture.set(ee.TEXTURE2),ee.bindTexture(ee.TEXTURE_2D,S.depthTexture),t.activeTexture.set(ee.TEXTURE3),ee.bindTexture(ee.TEXTURE_2D,S.texture);for(const ce in this.terrainUniforms)this.terrainUniforms[ce].set(S[ce])}if(C)for(const ce in C)this.projectionUniforms[zr[ce]].set(C[ce]);if(b)for(const ce in this.fixedUniforms)this.fixedUniforms[ce].set(b[ce]);K&&K.setUniforms(t,this.binderUniforms,G,{zoom:$});let se=0;switch(r){case ee.LINES:se=2;break;case ee.TRIANGLES:se=3;break;case ee.LINE_STRIP:se=1}for(const ce of j.get()){const ne=ce.vaos||(ce.vaos={});(ne[z]||(ne[z]=new xu)).bind(t,this,L,K?K.getPaintVertexBuffers():[],R,ce.vertexOffset,W,te,oe),ee.drawElements(r,ce.primitiveLength*se,ee.UNSIGNED_SHORT,ce.primitiveOffset*se*2)}}}function Cd(m,t,r){const l=1/h.aN(r,1,t.transform.tileZoom),d=Math.pow(2,r.tileID.overscaledZ),_=r.tileSize*Math.pow(2,t.transform.tileZoom)/d,v=_*(r.tileID.canonical.x+r.tileID.wrap*d),b=_*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[l,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const _c=(m,t,r,l)=>{const d=m.style.light,_=d.properties.get("position"),v=[_.x,_.y,_.z],b=h.c4();d.properties.get("anchor")==="viewport"&&h.c5(b,m.transform.bearingInRadians),h.c6(v,v,b);const S=m.transform.transformLightDirection(v),C=d.properties.get("color");return{u_lightpos:v,u_lightpos_globe:S,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+t,u_opacity:r,u_fill_translate:l}},yc=(m,t,r,l,d,_,v)=>h.e(_c(m,t,r,l),Cd(_,m,v),{u_height_factor:-Math.pow(2,d.overscaledZ)/v.tileSize/8}),Bo=(m,t,r,l)=>h.e(Cd(t,m,r),{u_fill_translate:l}),Rl=(m,t)=>({u_world:m,u_fill_translate:t}),zd=(m,t,r,l,d)=>h.e(Bo(m,t,r,d),{u_world:l}),bu=(m,t,r,l,d)=>{const _=m.transform;let v,b,S=0;if(r.paint.get("circle-pitch-alignment")==="map"){const C=h.aN(t,1,_.zoom);v=!0,b=[C,C],S=C/(h.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*d}else v=!1,b=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:b,u_globe_extrude_scale:S,u_translate:l}},no=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),ph=m=>({u_viewport_size:[m.width,m.height]}),wu=(m,t=1)=>({u_color:m,u_overlay:0,u_overlay_scale:t}),ao=(m,t,r,l)=>{const d=h.aN(m,1,t)/(h.a5*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:h.aN(m,1,t),u_intensity:r,u_globe_extrude_scale:d}},mh=(m,t,r,l)=>{const d=h.N();h.c7(d,0,m.width,m.height,0,0,1);const _=m.context.gl;return{u_matrix:d,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:r,u_color_ramp:l,u_opacity:t.paint.get("heatmap-opacity")}},Tu=(m,t,r)=>{const l=r.paint.get("hillshade-accent-color");let d;switch(r.paint.get("hillshade-method")){case"basic":d=4;break;case"combined":d=1;break;case"igor":d=2;break;case"multidirectional":d=3;break;default:d=0}const _=r.getIlluminationProperties();for(let v=0;v<_.directionRadians.length;v++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(_.directionRadians[v]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:$f(0,t.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:_.altitudeRadians,u_azimuths:_.directionRadians,u_accent:l,u_method:d,u_highlights:_.highlightColor,u_shadows:_.shadowColor}},Dd=(m,t)=>{const r=t.stride,l=h.N();return h.c7(l,0,h.a5,-h.a5,0,0,1),h.O(l,l,[0,-h.a5,0]),{u_matrix:l,u_image:1,u_dimension:[r,r],u_zoom:m.overscaledZ,u_unpack:t.getUnpackVector()}};function $f(m,t){const r=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new h.a9(0,l/r).toLngLat().lat,new h.a9(0,(l+1)/r).toLngLat().lat]}const Id=(m,t,r=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:r,u_opacity:m.paint.get("color-relief-opacity")}),Su=(m,t,r,l)=>{const d=m.transform;return{u_translation:Mu(m,t,r),u_ratio:l/h.aN(t,1,d.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Pd=(m,t,r,l,d)=>h.e(Su(m,t,r,l),{u_image:0,u_image_height:d}),gh=(m,t,r,l,d)=>{const _=m.transform,v=lr(t,_);return{u_translation:Mu(m,t,r),u_texsize:t.imageAtlasTexture.size,u_ratio:l/h.aN(t,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[v,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},wa=(m,t,r,l,d)=>{const _=lr(t,m.transform);return h.e(Su(m,t,r,l),{u_tileratio:_,u_crossfade_from:d.fromScale,u_crossfade_to:d.toScale,u_image:0,u_mix:d.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},ro=(m,t,r,l,d,_)=>{const v=lr(t,m.transform);return h.e(Su(m,t,r,l),{u_image:0,u_image_height:_,u_tileratio:v,u_crossfade_from:d.fromScale,u_crossfade_to:d.toScale,u_image_dash:1,u_mix:d.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function lr(m,t){return 1/h.aN(m,1,t.tileZoom)}function Mu(m,t,r){return h.aO(m.transform,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const vc=(m,t,r,l,d)=>{return{u_tl_parent:m,u_scale_parent:t,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(v=l.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(_=l.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:xc(l.paint.get("raster-hue-rotate")),u_coords_top:[d[0].x,d[0].y,d[1].x,d[1].y],u_coords_bottom:[d[3].x,d[3].y,d[2].x,d[2].y]};var _,v};function xc(m){m*=Math.PI/180;const t=Math.sin(m),r=Math.cos(m);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Eu=(m,t,r,l,d,_,v,b,S,C,z,L,R)=>{const j=v.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:j.width/j.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:b,u_coord_matrix:S,u_is_text:+z,u_pitch_with_map:+l,u_is_along_line:d,u_is_variable_anchor:_,u_texsize:L,u_texture:0,u_translation:C,u_pitched_scale:R}},bc=(m,t,r,l,d,_,v,b,S,C,z,L,R,j)=>{const G=v.transform;return h.e(Eu(m,t,r,l,d,_,v,b,S,C,z,L,j),{u_gamma_scale:l?Math.cos(G.pitch*Math.PI/180)*G.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},ur=(m,t,r,l,d,_,v,b,S,C,z,L,R)=>h.e(bc(m,t,r,l,d,_,v,b,S,C,!0,z,0,R),{u_texsize_icon:L,u_texture_icon:1}),Au=(m,t)=>({u_opacity:m,u_color:t}),Cu=(m,t,r,l,d)=>h.e((function(_,v,b,S){const C=b.imageManager.getPattern(_.from.toString()),z=b.imageManager.getPattern(_.to.toString()),{width:L,height:R}=b.imageManager.getPixelSize(),j=Math.pow(2,S.tileID.overscaledZ),G=S.tileSize*Math.pow(2,b.transform.tileZoom)/j,$=G*(S.tileID.canonical.x+S.tileID.wrap*j),K=G*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[L,R],u_mix:v.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/h.aN(S,1,b.transform.tileZoom),u_pixel_coord_upper:[$>>16,K>>16],u_pixel_coord_lower:[65535&$,65535&K]}})(r,d,t,l),{u_opacity:m}),wc=(m,t)=>{},Rd={fillExtrusion:(m,t)=>({u_lightpos:new h.c2(m,t.u_lightpos),u_lightpos_globe:new h.c2(m,t.u_lightpos_globe),u_lightintensity:new h.bq(m,t.u_lightintensity),u_lightcolor:new h.c2(m,t.u_lightcolor),u_vertical_gradient:new h.bq(m,t.u_vertical_gradient),u_opacity:new h.bq(m,t.u_opacity),u_fill_translate:new h.c3(m,t.u_fill_translate)}),fillExtrusionPattern:(m,t)=>({u_lightpos:new h.c2(m,t.u_lightpos),u_lightpos_globe:new h.c2(m,t.u_lightpos_globe),u_lightintensity:new h.bq(m,t.u_lightintensity),u_lightcolor:new h.c2(m,t.u_lightcolor),u_vertical_gradient:new h.bq(m,t.u_vertical_gradient),u_height_factor:new h.bq(m,t.u_height_factor),u_opacity:new h.bq(m,t.u_opacity),u_fill_translate:new h.c3(m,t.u_fill_translate),u_image:new h.b_(m,t.u_image),u_texsize:new h.c3(m,t.u_texsize),u_pixel_coord_upper:new h.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(m,t.u_pixel_coord_lower),u_scale:new h.c2(m,t.u_scale),u_fade:new h.bq(m,t.u_fade)}),fill:(m,t)=>({u_fill_translate:new h.c3(m,t.u_fill_translate)}),fillPattern:(m,t)=>({u_image:new h.b_(m,t.u_image),u_texsize:new h.c3(m,t.u_texsize),u_pixel_coord_upper:new h.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(m,t.u_pixel_coord_lower),u_scale:new h.c2(m,t.u_scale),u_fade:new h.bq(m,t.u_fade),u_fill_translate:new h.c3(m,t.u_fill_translate)}),fillOutline:(m,t)=>({u_world:new h.c3(m,t.u_world),u_fill_translate:new h.c3(m,t.u_fill_translate)}),fillOutlinePattern:(m,t)=>({u_world:new h.c3(m,t.u_world),u_image:new h.b_(m,t.u_image),u_texsize:new h.c3(m,t.u_texsize),u_pixel_coord_upper:new h.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(m,t.u_pixel_coord_lower),u_scale:new h.c2(m,t.u_scale),u_fade:new h.bq(m,t.u_fade),u_fill_translate:new h.c3(m,t.u_fill_translate)}),circle:(m,t)=>({u_camera_to_center_distance:new h.bq(m,t.u_camera_to_center_distance),u_scale_with_map:new h.b_(m,t.u_scale_with_map),u_pitch_with_map:new h.b_(m,t.u_pitch_with_map),u_extrude_scale:new h.c3(m,t.u_extrude_scale),u_device_pixel_ratio:new h.bq(m,t.u_device_pixel_ratio),u_globe_extrude_scale:new h.bq(m,t.u_globe_extrude_scale),u_translate:new h.c3(m,t.u_translate)}),collisionBox:(m,t)=>({u_pixel_extrude_scale:new h.c3(m,t.u_pixel_extrude_scale)}),collisionCircle:(m,t)=>({u_viewport_size:new h.c3(m,t.u_viewport_size)}),debug:(m,t)=>({u_color:new h.b$(m,t.u_color),u_overlay:new h.b_(m,t.u_overlay),u_overlay_scale:new h.bq(m,t.u_overlay_scale)}),depth:wc,clippingMask:wc,heatmap:(m,t)=>({u_extrude_scale:new h.bq(m,t.u_extrude_scale),u_intensity:new h.bq(m,t.u_intensity),u_globe_extrude_scale:new h.bq(m,t.u_globe_extrude_scale)}),heatmapTexture:(m,t)=>({u_matrix:new h.c0(m,t.u_matrix),u_world:new h.c3(m,t.u_world),u_image:new h.b_(m,t.u_image),u_color_ramp:new h.b_(m,t.u_color_ramp),u_opacity:new h.bq(m,t.u_opacity)}),hillshade:(m,t)=>({u_image:new h.b_(m,t.u_image),u_latrange:new h.c3(m,t.u_latrange),u_exaggeration:new h.bq(m,t.u_exaggeration),u_altitudes:new h.c9(m,t.u_altitudes),u_azimuths:new h.c9(m,t.u_azimuths),u_accent:new h.b$(m,t.u_accent),u_method:new h.b_(m,t.u_method),u_shadows:new h.c8(m,t.u_shadows),u_highlights:new h.c8(m,t.u_highlights)}),hillshadePrepare:(m,t)=>({u_matrix:new h.c0(m,t.u_matrix),u_image:new h.b_(m,t.u_image),u_dimension:new h.c3(m,t.u_dimension),u_zoom:new h.bq(m,t.u_zoom),u_unpack:new h.c1(m,t.u_unpack)}),colorRelief:(m,t)=>({u_image:new h.b_(m,t.u_image),u_unpack:new h.c1(m,t.u_unpack),u_dimension:new h.c3(m,t.u_dimension),u_elevation_stops:new h.b_(m,t.u_elevation_stops),u_color_stops:new h.b_(m,t.u_color_stops),u_color_ramp_size:new h.b_(m,t.u_color_ramp_size),u_opacity:new h.bq(m,t.u_opacity)}),line:(m,t)=>({u_translation:new h.c3(m,t.u_translation),u_ratio:new h.bq(m,t.u_ratio),u_device_pixel_ratio:new h.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(m,t.u_units_to_pixels)}),lineGradient:(m,t)=>({u_translation:new h.c3(m,t.u_translation),u_ratio:new h.bq(m,t.u_ratio),u_device_pixel_ratio:new h.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(m,t.u_units_to_pixels),u_image:new h.b_(m,t.u_image),u_image_height:new h.bq(m,t.u_image_height)}),linePattern:(m,t)=>({u_translation:new h.c3(m,t.u_translation),u_texsize:new h.c3(m,t.u_texsize),u_ratio:new h.bq(m,t.u_ratio),u_device_pixel_ratio:new h.bq(m,t.u_device_pixel_ratio),u_image:new h.b_(m,t.u_image),u_units_to_pixels:new h.c3(m,t.u_units_to_pixels),u_scale:new h.c2(m,t.u_scale),u_fade:new h.bq(m,t.u_fade)}),lineSDF:(m,t)=>({u_translation:new h.c3(m,t.u_translation),u_ratio:new h.bq(m,t.u_ratio),u_device_pixel_ratio:new h.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(m,t.u_units_to_pixels),u_image:new h.b_(m,t.u_image),u_mix:new h.bq(m,t.u_mix),u_tileratio:new h.bq(m,t.u_tileratio),u_crossfade_from:new h.bq(m,t.u_crossfade_from),u_crossfade_to:new h.bq(m,t.u_crossfade_to),u_lineatlas_width:new h.bq(m,t.u_lineatlas_width),u_lineatlas_height:new h.bq(m,t.u_lineatlas_height)}),lineGradientSDF:(m,t)=>({u_translation:new h.c3(m,t.u_translation),u_ratio:new h.bq(m,t.u_ratio),u_device_pixel_ratio:new h.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(m,t.u_units_to_pixels),u_image:new h.b_(m,t.u_image),u_image_height:new h.bq(m,t.u_image_height),u_tileratio:new h.bq(m,t.u_tileratio),u_crossfade_from:new h.bq(m,t.u_crossfade_from),u_crossfade_to:new h.bq(m,t.u_crossfade_to),u_image_dash:new h.b_(m,t.u_image_dash),u_mix:new h.bq(m,t.u_mix),u_lineatlas_width:new h.bq(m,t.u_lineatlas_width),u_lineatlas_height:new h.bq(m,t.u_lineatlas_height)}),raster:(m,t)=>({u_tl_parent:new h.c3(m,t.u_tl_parent),u_scale_parent:new h.bq(m,t.u_scale_parent),u_buffer_scale:new h.bq(m,t.u_buffer_scale),u_fade_t:new h.bq(m,t.u_fade_t),u_opacity:new h.bq(m,t.u_opacity),u_image0:new h.b_(m,t.u_image0),u_image1:new h.b_(m,t.u_image1),u_brightness_low:new h.bq(m,t.u_brightness_low),u_brightness_high:new h.bq(m,t.u_brightness_high),u_saturation_factor:new h.bq(m,t.u_saturation_factor),u_contrast_factor:new h.bq(m,t.u_contrast_factor),u_spin_weights:new h.c2(m,t.u_spin_weights),u_coords_top:new h.c1(m,t.u_coords_top),u_coords_bottom:new h.c1(m,t.u_coords_bottom)}),symbolIcon:(m,t)=>({u_is_size_zoom_constant:new h.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.b_(m,t.u_is_size_feature_constant),u_size_t:new h.bq(m,t.u_size_t),u_size:new h.bq(m,t.u_size),u_camera_to_center_distance:new h.bq(m,t.u_camera_to_center_distance),u_pitch:new h.bq(m,t.u_pitch),u_rotate_symbol:new h.b_(m,t.u_rotate_symbol),u_aspect_ratio:new h.bq(m,t.u_aspect_ratio),u_fade_change:new h.bq(m,t.u_fade_change),u_label_plane_matrix:new h.c0(m,t.u_label_plane_matrix),u_coord_matrix:new h.c0(m,t.u_coord_matrix),u_is_text:new h.b_(m,t.u_is_text),u_pitch_with_map:new h.b_(m,t.u_pitch_with_map),u_is_along_line:new h.b_(m,t.u_is_along_line),u_is_variable_anchor:new h.b_(m,t.u_is_variable_anchor),u_texsize:new h.c3(m,t.u_texsize),u_texture:new h.b_(m,t.u_texture),u_translation:new h.c3(m,t.u_translation),u_pitched_scale:new h.bq(m,t.u_pitched_scale)}),symbolSDF:(m,t)=>({u_is_size_zoom_constant:new h.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.b_(m,t.u_is_size_feature_constant),u_size_t:new h.bq(m,t.u_size_t),u_size:new h.bq(m,t.u_size),u_camera_to_center_distance:new h.bq(m,t.u_camera_to_center_distance),u_pitch:new h.bq(m,t.u_pitch),u_rotate_symbol:new h.b_(m,t.u_rotate_symbol),u_aspect_ratio:new h.bq(m,t.u_aspect_ratio),u_fade_change:new h.bq(m,t.u_fade_change),u_label_plane_matrix:new h.c0(m,t.u_label_plane_matrix),u_coord_matrix:new h.c0(m,t.u_coord_matrix),u_is_text:new h.b_(m,t.u_is_text),u_pitch_with_map:new h.b_(m,t.u_pitch_with_map),u_is_along_line:new h.b_(m,t.u_is_along_line),u_is_variable_anchor:new h.b_(m,t.u_is_variable_anchor),u_texsize:new h.c3(m,t.u_texsize),u_texture:new h.b_(m,t.u_texture),u_gamma_scale:new h.bq(m,t.u_gamma_scale),u_device_pixel_ratio:new h.bq(m,t.u_device_pixel_ratio),u_is_halo:new h.b_(m,t.u_is_halo),u_translation:new h.c3(m,t.u_translation),u_pitched_scale:new h.bq(m,t.u_pitched_scale)}),symbolTextAndIcon:(m,t)=>({u_is_size_zoom_constant:new h.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.b_(m,t.u_is_size_feature_constant),u_size_t:new h.bq(m,t.u_size_t),u_size:new h.bq(m,t.u_size),u_camera_to_center_distance:new h.bq(m,t.u_camera_to_center_distance),u_pitch:new h.bq(m,t.u_pitch),u_rotate_symbol:new h.b_(m,t.u_rotate_symbol),u_aspect_ratio:new h.bq(m,t.u_aspect_ratio),u_fade_change:new h.bq(m,t.u_fade_change),u_label_plane_matrix:new h.c0(m,t.u_label_plane_matrix),u_coord_matrix:new h.c0(m,t.u_coord_matrix),u_is_text:new h.b_(m,t.u_is_text),u_pitch_with_map:new h.b_(m,t.u_pitch_with_map),u_is_along_line:new h.b_(m,t.u_is_along_line),u_is_variable_anchor:new h.b_(m,t.u_is_variable_anchor),u_texsize:new h.c3(m,t.u_texsize),u_texsize_icon:new h.c3(m,t.u_texsize_icon),u_texture:new h.b_(m,t.u_texture),u_texture_icon:new h.b_(m,t.u_texture_icon),u_gamma_scale:new h.bq(m,t.u_gamma_scale),u_device_pixel_ratio:new h.bq(m,t.u_device_pixel_ratio),u_is_halo:new h.b_(m,t.u_is_halo),u_translation:new h.c3(m,t.u_translation),u_pitched_scale:new h.bq(m,t.u_pitched_scale)}),background:(m,t)=>({u_opacity:new h.bq(m,t.u_opacity),u_color:new h.b$(m,t.u_color)}),backgroundPattern:(m,t)=>({u_opacity:new h.bq(m,t.u_opacity),u_image:new h.b_(m,t.u_image),u_pattern_tl_a:new h.c3(m,t.u_pattern_tl_a),u_pattern_br_a:new h.c3(m,t.u_pattern_br_a),u_pattern_tl_b:new h.c3(m,t.u_pattern_tl_b),u_pattern_br_b:new h.c3(m,t.u_pattern_br_b),u_texsize:new h.c3(m,t.u_texsize),u_mix:new h.bq(m,t.u_mix),u_pattern_size_a:new h.c3(m,t.u_pattern_size_a),u_pattern_size_b:new h.c3(m,t.u_pattern_size_b),u_scale_a:new h.bq(m,t.u_scale_a),u_scale_b:new h.bq(m,t.u_scale_b),u_pixel_coord_upper:new h.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(m,t.u_pixel_coord_lower),u_tile_units_to_pixels:new h.bq(m,t.u_tile_units_to_pixels)}),terrain:(m,t)=>({u_texture:new h.b_(m,t.u_texture),u_ele_delta:new h.bq(m,t.u_ele_delta),u_fog_matrix:new h.c0(m,t.u_fog_matrix),u_fog_color:new h.b$(m,t.u_fog_color),u_fog_ground_blend:new h.bq(m,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.bq(m,t.u_fog_ground_blend_opacity),u_horizon_color:new h.b$(m,t.u_horizon_color),u_horizon_fog_blend:new h.bq(m,t.u_horizon_fog_blend),u_is_globe_mode:new h.bq(m,t.u_is_globe_mode)}),terrainDepth:(m,t)=>({u_ele_delta:new h.bq(m,t.u_ele_delta)}),terrainCoords:(m,t)=>({u_texture:new h.b_(m,t.u_texture),u_terrain_coords_id:new h.bq(m,t.u_terrain_coords_id),u_ele_delta:new h.bq(m,t.u_ele_delta)}),projectionErrorMeasurement:(m,t)=>({u_input:new h.bq(m,t.u_input),u_output_expected:new h.bq(m,t.u_output_expected)}),atmosphere:(m,t)=>({u_sun_pos:new h.c2(m,t.u_sun_pos),u_atmosphere_blend:new h.bq(m,t.u_atmosphere_blend),u_globe_position:new h.c2(m,t.u_globe_position),u_globe_radius:new h.bq(m,t.u_globe_radius),u_inv_proj_matrix:new h.c0(m,t.u_inv_proj_matrix)}),sky:(m,t)=>({u_sky_color:new h.b$(m,t.u_sky_color),u_horizon_color:new h.b$(m,t.u_horizon_color),u_horizon:new h.c3(m,t.u_horizon),u_horizon_normal:new h.c3(m,t.u_horizon_normal),u_sky_horizon_blend:new h.bq(m,t.u_sky_horizon_blend),u_sky_blend:new h.bq(m,t.u_sky_blend)})};class Fo{constructor(t,r,l){this.context=t;const d=t.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const jo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _h{constructor(t,r,l,d){this.length=r.length,this.attributes=l,this.itemSize=r.bytesPerElement,this.dynamicDraw=d,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let l=0;l<this.attributes.length;l++){const d=r.attributes[this.attributes[l].name];d!==void 0&&t.enableVertexAttribArray(d)}}setVertexAttribPointers(t,r,l){for(let d=0;d<this.attributes.length;d++){const _=this.attributes[d],v=r.attributes[_.name];v!==void 0&&t.vertexAttribPointer(v,_.components,t[jo[_.type]],!1,this.itemSize,_.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class es extends vi{getDefault(){return h.bp.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class zu extends vi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Du extends vi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Tc extends vi{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class No extends vi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Iu extends vi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ll extends vi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Na extends vi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class yh extends vi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Sc extends vi{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Va extends vi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class ts extends vi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ga extends vi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class As extends vi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Vo extends vi{getDefault(){return h.bp.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Uo extends vi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Pu extends vi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class so extends vi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class cr extends vi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class vh extends vi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class kl extends vi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Xt extends vi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Mc extends vi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ua extends vi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ec extends vi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ga extends vi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ld extends vi{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ac extends vi{getDefault(){return null}set(t){var r;if(t===this.current&&!this.dirty)return;const l=this.gl;or(l)?l.bindVertexArray(t):(r=l.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class oo extends vi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class xh extends vi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Cc extends vi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class lo extends vi{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Ol extends lo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class _a extends lo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class uo extends lo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const co="Framebuffer is not complete";class Go{constructor(t,r,l,d,_){this.context=t,this.width=r,this.height=l;const v=t.gl,b=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new Ol(t,b),d)this.depthAttachment=_?new uo(t,b):new _a(t,b);else if(_)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(co)}destroy(){const t=this.context.gl,r=this.colorAttachment.get();if(r&&t.deleteTexture(r),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class ho{constructor(t){var r,l;if(this.gl=t,this.clearColor=new es(this),this.clearDepth=new zu(this),this.clearStencil=new Du(this),this.colorMask=new Tc(this),this.depthMask=new No(this),this.stencilMask=new Iu(this),this.stencilFunc=new Ll(this),this.stencilOp=new Na(this),this.stencilTest=new yh(this),this.depthRange=new Sc(this),this.depthTest=new Va(this),this.depthFunc=new ts(this),this.blend=new ga(this),this.blendFunc=new As(this),this.blendColor=new Vo(this),this.blendEquation=new Uo(this),this.cullFace=new Pu(this),this.cullFaceSide=new so(this),this.frontFace=new cr(this),this.program=new vh(this),this.activeTexture=new kl(this),this.viewport=new Xt(this),this.bindFramebuffer=new Mc(this),this.bindRenderbuffer=new Ua(this),this.bindTexture=new Ec(this),this.bindVertexBuffer=new Ga(this),this.bindElementBuffer=new Ld(this),this.bindVertexArray=new Ac(this),this.pixelStoreUnpack=new oo(this),this.pixelStoreUnpackPremultiplyAlpha=new xh(this),this.pixelStoreUnpackFlipY=new Cc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),or(t)){this.HALF_FLOAT=t.HALF_FLOAT;const d=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=t.RGBA16F)!==null&&r!==void 0?r:d?.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:d?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const d=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=d?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r){return new Fo(this,t,r)}createVertexBuffer(t,r,l){return new _h(this,t,r,l)}createRenderbuffer(t,r,l){const d=this.gl,_=d.createRenderbuffer();return this.bindRenderbuffer.set(_),d.renderbufferStorage(d.RENDERBUFFER,t,r,l),this.bindRenderbuffer.set(null),_}createFramebuffer(t,r,l,d){return new Go(this,t,r,l,d)}clear({color:t,depth:r,stencil:l}){const d=this.gl;let _=0;t&&(_|=d.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(_|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),l!==void 0&&(_|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),d.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){h.bR(t.blendFunction,Di.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return or(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var r;return or(this.gl)?this.gl.deleteVertexArray(t):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Bn;function Vn(m,t,r,l,d){const _=m.context,v=m.transform,b=_.gl,S=m.useProgram("collisionBox"),C=[];let z=0,L=0;for(let W=0;W<l.length;W++){const te=l[W],oe=t.getTile(te).getBucket(r);if(!oe)continue;const ee=d?oe.textCollisionBox:oe.iconCollisionBox,se=oe.collisionCircleArray;se.length>0&&(C.push({circleArray:se,circleOffset:L,coord:te}),z+=se.length/4,L=z),ee&&S.draw(_,b.LINES,Ht.disabled,hi.disabled,m.colorModeForRenderPass(),ai.disabled,no(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(te),v.getProjectionData({overscaledTileID:te,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,null,m.transform.zoom,null,null,ee.collisionVertexBuffer)}if(!d||!C.length)return;const R=m.useProgram("collisionCircle"),j=new h.ca;j.resize(4*z),j._trim();let G=0;for(const W of C)for(let te=0;te<W.circleArray.length/4;te++){const oe=4*te,ee=W.circleArray[oe+0],se=W.circleArray[oe+1],ce=W.circleArray[oe+2],ne=W.circleArray[oe+3];j.emplace(G++,ee,se,ce,ne,0),j.emplace(G++,ee,se,ce,ne,1),j.emplace(G++,ee,se,ce,ne,2),j.emplace(G++,ee,se,ce,ne,3)}(!Bn||Bn.length<2*z)&&(Bn=(function(W){const te=2*W,oe=new h.cc;oe.resize(te),oe._trim();for(let ee=0;ee<te;ee++){const se=6*ee;oe.uint16[se+0]=4*ee+0,oe.uint16[se+1]=4*ee+1,oe.uint16[se+2]=4*ee+2,oe.uint16[se+3]=4*ee+2,oe.uint16[se+4]=4*ee+3,oe.uint16[se+5]=4*ee+0}return oe})(z));const $=_.createIndexBuffer(Bn,!0),K=_.createVertexBuffer(j,h.cb.members,!0);for(const W of C){const te=ph(m.transform);R.draw(_,b.TRIANGLES,Ht.disabled,hi.disabled,m.colorModeForRenderPass(),ai.disabled,te,m.style.map.terrain&&m.style.map.terrain.getTerrainData(W.coord),null,r.id,K,$,h.aX.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,m.transform.zoom,null,null,null)}K.destroy(),$.destroy()}const is=h.ar(new Float32Array(16));function ns(m,t,r,l,d,_){const{horizontalAlign:v,verticalAlign:b}=h.aS(m);return new h.P((-(v-.5)*t/d+l[0])*_,(-(b-.5)*r/d+l[1])*_)}function Ta(m,t,r,l,d,_){const v=t.tileAnchorPoint.add(new h.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let b=l.mult(_);r||(b=b.rotate(-d));const S=v.add(b);return qt(S.x,S.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(r){const b=ci(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(m),S=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return m.add(l.rotate(S))}return m.add(l)}function Cs(m,t,r,l,d,_,v,b,S,C,z,L){const R=m.text.placedSymbolArray,j=m.text.dynamicLayoutVertexArray,G=m.icon.dynamicLayoutVertexArray,$={};j.clear();for(let K=0;K<R.length;K++){const W=R.get(K),te=W.hidden||!W.crossTileID||m.allowVerticalPlacement&&!W.placedOrientation?null:l[W.crossTileID];if(te){const oe=new h.P(W.anchorX,W.anchorY),ee={getElevation:L,width:d.width,height:d.height,pitchedLabelPlaneMatrix:_,pitchWithMap:r,transform:d,tileAnchorPoint:oe,translation:C,unwrappedTileID:z},se=r?wl(oe.x,oe.y,ee):ci(oe.x,oe.y,ee),ce=Co(d.cameraToCenterDistance,se.signedDistanceFromCamera);let ne=h.aA(m.textSizeData,b,W)*ce/h.aM;r&&(ne*=m.tilePixelRatio/v);const{width:_e,height:Ie,anchor:Ee,textOffset:ze,textBoxScale:De}=te,et=ns(Ee,_e,Ie,ze,De,ne),tt=d.getPitchedTextCorrection(oe.x+C[0],oe.y+C[1],z),qe=Ta(se.point,ee,t,et,-d.bearingInRadians,tt),rt=m.allowVerticalPlacement&&W.placedOrientation===h.az.vertical?Math.PI/2:0;for(let Vt=0;Vt<W.numGlyphs;Vt++)h.aG(j,qe,rt);S&&W.associatedIconIndex>=0&&($[W.associatedIconIndex]={shiftedAnchor:qe,angle:rt})}else Kr(W.numGlyphs,j)}if(S){G.clear();const K=m.icon.placedSymbolArray;for(let W=0;W<K.length;W++){const te=K.get(W);if(te.hidden)Kr(te.numGlyphs,G);else{const oe=$[W];if(oe)for(let ee=0;ee<te.numGlyphs;ee++)h.aG(G,oe.shiftedAnchor,oe.angle);else Kr(te.numGlyphs,G)}}m.icon.dynamicLayoutVertexBuffer.updateData(G)}m.text.dynamicLayoutVertexBuffer.updateData(j)}function bh(m,t,r){return r.iconsInText&&t?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function qo(m,t,r,l,d,_,v,b,S,C,z,L,R){const j=m.context,G=j.gl,$=m.transform,K=b==="map",W=S==="map",te=b!=="viewport"&&r.layout.get("symbol-placement")!=="point",oe=K&&!W&&!te,ee=!r.layout.get("symbol-sort-key").isConstant();let se=!1;const ce=m.getDepthModeForSublayer(0,Ht.ReadOnly),ne=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),_e=[],Ie=$.getCircleRadiusCorrection();for(const Ee of l){const ze=t.getTile(Ee),De=ze.getBucket(r);if(!De)continue;const et=d?De.text:De.icon;if(!et||!et.segments.get().length||!et.hasVisibleVertices)continue;const tt=et.programConfigurations.get(r.id),qe=d||De.sdfIcons,rt=d?De.textSizeData:De.iconSizeData,Vt=W||$.pitch!==0,Ti=m.useProgram(bh(qe,d,De),tt),Gi=h.ay(rt,$.zoom),Oi=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Ee);let Xi,Ii,un,Yi,Gn=[0,0],gn=null;if(d)Ii=ze.glyphAtlasTexture,un=G.LINEAR,Xi=ze.glyphAtlasTexture.size,De.iconsInText&&(Gn=ze.imageAtlasTexture.size,gn=ze.imageAtlasTexture,Yi=Vt||m.options.rotating||m.options.zooming||rt.kind==="composite"||rt.kind==="camera"?G.LINEAR:G.NEAREST);else{const Ci=r.layout.get("icon-size").constantOr(0)!==1||De.iconsNeedLinear;Ii=ze.imageAtlasTexture,un=qe||m.options.rotating||m.options.zooming||Ci||Vt?G.LINEAR:G.NEAREST,Xi=ze.imageAtlasTexture.size}const _n=h.aN(ze,1,m.transform.zoom),qn=Ba(K,m.transform,_n),gs=h.N();h.aB(gs,qn);const _s=hc(W,K,m.transform,_n),Or=h.aO($,ze,_,v),Aa=$.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Jo=ne&&De.hasTextData(),Hl=r.layout.get("icon-text-fit")!=="none"&&Jo&&De.hasIconData();if(te){const Ci=m.style.map.terrain?(Cn,Pn)=>m.style.map.terrain.getElevation(Ee,Cn,Pn):null,Bi=r.layout.get("text-rotation-alignment")==="map";Ss(De,m,d,qn,gs,W,C,Bi,Ee.toUnwrapped(),$.width,$.height,Or,Ci)}const Br=d&&ne||Hl,Ca=te||Br?is:W?qn:m.transform.clipSpaceToPixelsMatrix,Xa=qe&&r.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let gr;gr=qe?De.iconsInText?ur(rt.kind,Gi,oe,W,te,Br,m,Ca,_s,Or,Xi,Gn,Ie):bc(rt.kind,Gi,oe,W,te,Br,m,Ca,_s,Or,d,Xi,0,Ie):Eu(rt.kind,Gi,oe,W,te,Br,m,Ca,_s,Or,d,Xi,Ie);const _r={program:Ti,buffers:et,uniformValues:gr,projectionData:Aa,atlasTexture:Ii,atlasTextureIcon:gn,atlasInterpolation:un,atlasInterpolationIcon:Yi,isSDF:qe,hasHalo:Xa};if(ee&&De.canOverlap){se=!0;const Ci=et.segments.get();for(const Bi of Ci)_e.push({segments:new h.aX([Bi]),sortKey:Bi.sortKey,state:_r,terrainData:Oi})}else _e.push({segments:et.segments,sortKey:0,state:_r,terrainData:Oi})}se&&_e.sort(((Ee,ze)=>Ee.sortKey-ze.sortKey));for(const Ee of _e){const ze=Ee.state;if(j.activeTexture.set(G.TEXTURE0),ze.atlasTexture.bind(ze.atlasInterpolation,G.CLAMP_TO_EDGE),ze.atlasTextureIcon&&(j.activeTexture.set(G.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),ze.isSDF){const De=ze.uniformValues;ze.hasHalo&&(De.u_is_halo=1,Bl(ze.buffers,Ee.segments,r,m,ze.program,ce,z,L,De,ze.projectionData,Ee.terrainData)),De.u_is_halo=0}Bl(ze.buffers,Ee.segments,r,m,ze.program,ce,z,L,ze.uniformValues,ze.projectionData,Ee.terrainData)}}function Bl(m,t,r,l,d,_,v,b,S,C,z){const L=l.context;d.draw(L,L.gl.TRIANGLES,_,v,b,ai.backCCW,S,z,C,r.id,m.layoutVertexBuffer,m.indexBuffer,t,r.paint,l.transform.zoom,m.programConfigurations.get(r.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function wh(m,t,r,l,d){const _=m.context,v=_.gl,b=hi.disabled,S=new Di([v.ONE,v.ONE],h.bp.transparent,[!0,!0,!0,!0]),C=t.getBucket(r);if(!C)return;const z=l.key;let L=r.heatmapFbos.get(z);L||(L=ki(_,t.tileSize,t.tileSize),r.heatmapFbos.set(z,L)),_.bindFramebuffer.set(L.framebuffer),_.viewport.set([0,0,t.tileSize,t.tileSize]),_.clear({color:h.bp.transparent});const R=C.programConfigurations.get(r.id),j=m.useProgram("heatmap",R,!d),G=m.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),$=m.style.map.terrain.getTerrainData(l);j.draw(_,v.TRIANGLES,Ht.disabled,b,S,ai.disabled,ao(t,m.transform.zoom,r.paint.get("heatmap-intensity"),1),$,G,r.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,r.paint,m.transform.zoom,R)}function Un(m,t,r,l,d){const _=m.context,v=_.gl,b=m.transform;_.setColorMode(m.colorModeForRenderPass());const S=oi(_,t),C=r.key,z=t.heatmapFbos.get(C);if(!z)return;_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,z.colorAttachment.get()),_.activeTexture.set(v.TEXTURE1),S.bind(v.LINEAR,v.CLAMP_TO_EDGE);const L=b.getProjectionData({overscaledTileID:r,applyTerrainMatrix:d,applyGlobeMatrix:!l});m.useProgram("heatmapTexture").draw(_,v.TRIANGLES,Ht.disabled,hi.disabled,m.colorModeForRenderPass(),ai.disabled,mh(m,t,0,1),null,L,t.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,t.paint,b.zoom),z.destroy(),t.heatmapFbos.delete(C)}function ki(m,t,r){var l,d;const _=m.gl,v=_.createTexture();_.bindTexture(_.TEXTURE_2D,v),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const b=(l=m.HALF_FLOAT)!==null&&l!==void 0?l:_.UNSIGNED_BYTE,S=(d=m.RGBA16F)!==null&&d!==void 0?d:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,S,t,r,0,_.RGBA,b,null);const C=m.createFramebuffer(t,r,!1,!1);return C.colorAttachment.set(v),C}function oi(m,t){return t.colorRampTexture||(t.colorRampTexture=new h.T(m,t.colorRamp,m.gl.RGBA)),t.colorRampTexture}function zs(m,t,r,l,d,_,v,b){let S=256;if(d.stepInterpolant){const C=t.getSource().maxzoom,z=v.canonical.z===C?Math.ceil(1<<m.transform.maxZoom-v.canonical.z):1;S=h.an(h.ce(_.maxLineLength/h.a5*1024*z),256,r.maxTextureSize)}return b.gradient=h.cf({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:S,image:b.gradient||void 0,clips:_.lineClipsArray}),b.texture?b.texture.update(b.gradient):b.texture=new h.T(r,b.gradient,l.RGBA),b.version=d.gradientVersion,b.texture}function qa(m,t,r,l,d){m.activeTexture.set(t.TEXTURE0),r.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),l.updatePaintBuffers(d)}function on(m,t,r,l,d,_){(d||m.lineAtlas.dirty)&&(t.activeTexture.set(r.TEXTURE0),m.lineAtlas.bind(t)),l.updatePaintBuffers(_)}function Sa(m,t,r,l,d,_,v){const b=_.gradients[d.id];let S=b.texture;d.gradientVersion!==b.version&&(S=zs(m,t,r,l,d,_,v,b)),r.activeTexture.set(l.TEXTURE0),S.bind(d.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE)}function Ma(m,t,r,l,d,_,v,b,S){const C=_.gradients[d.id];let z=C.texture;d.gradientVersion!==C.version&&(z=zs(m,t,r,l,d,_,v,C)),r.activeTexture.set(l.TEXTURE0),z.bind(d.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE),r.activeTexture.set(l.TEXTURE1),m.lineAtlas.bind(r),b.updatePaintBuffers(S)}function Ru(m,t,r,l,d){if(!r||!l||!l.imageAtlas)return;const _=l.imageAtlas.patternPositions;let v=_[r.to.toString()],b=_[r.from.toString()];if(!v&&b&&(v=b),!b&&v&&(b=v),!v||!b){const S=d.getPaintProperty(t);v=_[S],b=_[S]}v&&b&&m.setConstantPatternPositions(v,b)}function as(m,t,r,l,d,_,v,b){const S=m.context.gl,C="fill-pattern",z=r.paint.get(C),L=z&&z.constantOr(1),R=r.getCrossfadeParameters();let j,G,$,K,W;const te=m.transform,oe=r.paint.get("fill-translate"),ee=r.paint.get("fill-translate-anchor");v?(G=L&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=S.LINES):(G=L?"fillPattern":"fill",j=S.TRIANGLES);const se=z.constantOr(null);for(const ce of l){const ne=t.getTile(ce);if(L&&!ne.patternsLoaded())continue;const _e=ne.getBucket(r);if(!_e)continue;const Ie=_e.programConfigurations.get(r.id),Ee=m.useProgram(G,Ie),ze=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ce);L&&(m.context.activeTexture.set(S.TEXTURE0),ne.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Ie.updatePaintBuffers(R)),Ru(Ie,C,se,ne,r);const De=te.getProjectionData({overscaledTileID:ce,applyGlobeMatrix:!b,applyTerrainMatrix:!0}),et=h.aO(te,ne,oe,ee);if(v){K=_e.indexBuffer2,W=_e.segments2;const qe=[S.drawingBufferWidth,S.drawingBufferHeight];$=G==="fillOutlinePattern"&&L?zd(m,R,ne,qe,et):Rl(qe,et)}else K=_e.indexBuffer,W=_e.segments,$=L?Bo(m,R,ne,et):{u_fill_translate:et};const tt=m.stencilModeForClipping(ce);Ee.draw(m.context,j,d,tt,_,ai.backCCW,$,ze,De,r.id,_e.layoutVertexBuffer,K,W,r.paint,m.transform.zoom,Ie)}}function rs(m,t,r,l,d,_,v,b){const S=m.context,C=S.gl,z="fill-extrusion-pattern",L=r.paint.get(z),R=L.constantOr(1),j=r.getCrossfadeParameters(),G=r.paint.get("fill-extrusion-opacity"),$=L.constantOr(null),K=m.transform;for(const W of l){const te=t.getTile(W),oe=te.getBucket(r);if(!oe)continue;const ee=m.style.map.terrain&&m.style.map.terrain.getTerrainData(W),se=oe.programConfigurations.get(r.id),ce=m.useProgram(R?"fillExtrusionPattern":"fillExtrusion",se);R&&(m.context.activeTexture.set(C.TEXTURE0),te.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),se.updatePaintBuffers(j));const ne=K.getProjectionData({overscaledTileID:W,applyGlobeMatrix:!b,applyTerrainMatrix:!0});Ru(se,z,$,te,r);const _e=h.aO(K,te,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Ie=r.paint.get("fill-extrusion-vertical-gradient"),Ee=R?yc(m,Ie,G,_e,W,j,te):_c(m,Ie,G,_e);ce.draw(S,S.gl.TRIANGLES,d,_,v,ai.backCCW,Ee,ee,ne,r.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,r.paint,m.transform.zoom,se,m.style.map.terrain&&oe.centroidVertexBuffer)}}function ss(m,t,r,l,d,_,v,b,S){var C;const z=m.style.projection,L=m.context,R=m.transform,j=L.gl,G=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],$=m.useProgram("hillshade",null,!1,G),K=!m.options.moving;for(const W of l){const te=t.getTile(W),oe=te.fbo;if(!oe)continue;const ee=z.getMeshFromTileID(L,W.canonical,b,!0,"raster"),se=(C=m.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(W);L.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,oe.colorAttachment.get());const ce=R.getProjectionData({overscaledTileID:W,aligned:K,applyGlobeMatrix:!S,applyTerrainMatrix:!0});$.draw(L,j.TRIANGLES,_,d[W.overscaledZ],v,ai.backCCW,Tu(m,te,r),se,ce,r.id,ee.vertexBuffer,ee.indexBuffer,ee.segments)}}function Ds(m,t,r,l,d,_,v,b,S){var C;const z=m.style.projection,L=m.context,R=m.transform,j=L.gl,G=m.useProgram("colorRelief"),$=!m.options.moving;let K=!0,W=0;for(const te of l){const oe=t.getTile(te),ee=oe.dem;if(K){const Ee=j.getParameter(j.MAX_TEXTURE_SIZE),{elevationTexture:ze,colorTexture:De}=r.getColorRampTextures(L,Ee,ee.getUnpackVector());L.activeTexture.set(j.TEXTURE1),ze.bind(j.NEAREST,j.CLAMP_TO_EDGE),L.activeTexture.set(j.TEXTURE4),De.bind(j.LINEAR,j.CLAMP_TO_EDGE),K=!1,W=ze.size[0]}if(!ee||!ee.data)continue;const se=ee.stride,ce=ee.getPixels();if(L.activeTexture.set(j.TEXTURE0),L.pixelStoreUnpackPremultiplyAlpha.set(!1),oe.demTexture=oe.demTexture||m.getTileTexture(se),oe.demTexture){const Ee=oe.demTexture;Ee.update(ce,{premultiply:!1}),Ee.bind(j.LINEAR,j.CLAMP_TO_EDGE)}else oe.demTexture=new h.T(L,ce,j.RGBA,{premultiply:!1}),oe.demTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const ne=z.getMeshFromTileID(L,te.canonical,b,!0,"raster"),_e=(C=m.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(te),Ie=R.getProjectionData({overscaledTileID:te,aligned:$,applyGlobeMatrix:!S,applyTerrainMatrix:!0});G.draw(L,j.TRIANGLES,_,d[te.overscaledZ],v,ai.backCCW,Id(r,oe.dem,W),_e,Ie,r.id,ne.vertexBuffer,ne.indexBuffer,ne.segments)}}const Is=[new h.P(0,0),new h.P(h.a5,0),new h.P(h.a5,h.a5),new h.P(0,h.a5)];function hr(m,t,r,l,d,_,v,b,S=!1,C=!1){const z=l[l.length-1].overscaledZ,L=m.context,R=L.gl,j=m.useProgram("raster"),G=m.transform,$=m.style.projection,K=m.colorModeForRenderPass(),W=!m.options.moving,te=r.paint.get("raster-opacity"),oe=r.paint.get("raster-resampling"),ee=r.paint.get("raster-fade-duration"),se=!!m.style.map.terrain;for(const ce of l){const ne=m.getDepthModeForSublayer(ce.overscaledZ-z,te===1?Ht.ReadWrite:Ht.ReadOnly,R.LESS),_e=t.getTile(ce),Ie=oe==="nearest"?R.NEAREST:R.LINEAR;L.activeTexture.set(R.TEXTURE0),_e.texture.bind(Ie,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),L.activeTexture.set(R.TEXTURE1);const{parentTile:Ee,parentScaleBy:ze,parentTopLeft:De,fadeValues:et}=os(_e,t,ee,se);_e.fadeOpacity=et.tileOpacity,Ee?(Ee.fadeOpacity=et.parentTileOpacity,Ee.texture.bind(Ie,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST)):_e.texture.bind(Ie,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),_e.texture.useMipmap&&L.extTextureFilterAnisotropic&&m.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const tt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ce),qe=G.getProjectionData({overscaledTileID:ce,aligned:W,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),rt=vc(De,ze,et.fadeMix,r,b),Vt=$.getMeshFromTileID(L,ce.canonical,_,v,"raster");j.draw(L,R.TRIANGLES,ne,d?d[ce.overscaledZ]:hi.disabled,K,S?ai.frontCCW:ai.backCCW,rt,tt,qe,r.id,Vt.vertexBuffer,Vt.indexBuffer,Vt.segments)}}function os(m,t,r,l){const d={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(r===0||l)return d;if(m.fadingParentID){const _=t.getLoadedTile(m.fadingParentID);if(!_)return d;const v=Math.pow(2,_.tileID.overscaledZ-m.tileID.overscaledZ),b=[m.tileID.canonical.x*v%1,m.tileID.canonical.y*v%1],S=(function(C,z,L){const R=bt(),j=(R-z.timeAdded)/L,G=C.fadingDirection===ie.Incoming,$=h.an((R-C.timeAdded)/L,0,1),K=h.an(1-j,0,1),W=G?$:K;return{tileOpacity:W,parentTileOpacity:G?K:$,fadeMix:{opacity:1,mix:1-W}}})(m,_,r);return{parentTile:_,parentScaleBy:v,parentTopLeft:b,fadeValues:S}}if(m.selfFading){const _=(function(v,b){const S=(bt()-v.timeAdded)/b,C=h.an(S,0,1);return{tileOpacity:C,fadeMix:{opacity:C,mix:0}}})(m,r);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:_}}return d}const Ps=new h.bp(1,0,0,1),ls=new h.bp(0,1,0,1),zc=new h.bp(0,0,1,1),Dc=new h.bp(1,0,1,1),Za=new h.bp(0,1,1,1);function Fl(m,t,r,l){An(m,0,t+r/2,m.transform.width,r,l)}function Rs(m,t,r,l){An(m,t-r/2,0,r,m.transform.height,l)}function An(m,t,r,l,d,_){const v=m.context,b=v.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*m.pixelRatio,r*m.pixelRatio,l*m.pixelRatio,d*m.pixelRatio),v.clear({color:_}),b.disable(b.SCISSOR_TEST)}function Lu(m,t,r){const l=m.context,d=l.gl,_=m.useProgram("debug"),v=Ht.disabled,b=hi.disabled,S=m.colorModeForRenderPass(),C="$debug",z=m.style.map.terrain&&m.style.map.terrain.getTerrainData(r);l.activeTexture.set(d.TEXTURE0);const L=t.getTileByID(r.key).latestRawTileData,R=Math.floor((L&&L.byteLength||0)/1024),j=t.getTile(r).tileSize,G=512/Math.min(j,512)*(r.overscaledZ/m.transform.zoom)*.5;let $=r.canonical.toString();r.overscaledZ!==r.canonical.z&&($+=` => ${r.overscaledZ}`),(function(W,te){W.initDebugOverlayCanvas();const oe=W.debugOverlayCanvas,ee=W.context.gl,se=W.debugOverlayCanvas.getContext("2d");se.clearRect(0,0,oe.width,oe.height),se.shadowColor="white",se.shadowBlur=2,se.lineWidth=1.5,se.strokeStyle="white",se.textBaseline="top",se.font="bold 36px Open Sans, sans-serif",se.fillText(te,5,5),se.strokeText(te,5,5),W.debugOverlayTexture.update(oe),W.debugOverlayTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE)})(m,`${$} ${R}kB`);const K=m.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(l,d.TRIANGLES,v,b,Di.alphaBlended,ai.disabled,wu(h.bp.transparent,G),null,K,C,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),_.draw(l,d.LINE_STRIP,v,b,S,ai.disabled,wu(h.bp.red),z,K,C,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Ic(m,t,r,l){const{isRenderingGlobe:d}=l,_=m.context,v=_.gl,b=m.transform,S=m.colorModeForRenderPass(),C=m.getDepthModeFor3D(),z=m.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,m.width,m.height]);for(const L of r){const R=t.getTerrainMesh(L.tileID),j=m.renderToTexture.getTexture(L),G=t.getTerrainData(L.tileID);_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,j.texture);const $=t.getMeshFrameDelta(b.zoom),K=b.calculateFogMatrix(L.tileID.toUnwrapped()),W=Ed($,K,m.style.sky,b.pitch,d),te=b.getProjectionData({overscaledTileID:L.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(_,v.TRIANGLES,C,hi.disabled,S,ai.backCCW,W,G,te,"terrain",R.vertexBuffer,R.indexBuffer,R.segments)}}function Th(m,t){if(!t.mesh){const r=new h.aW;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const l=new h.aY;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),t.mesh=new Li(m.createVertexBuffer(r,sr.members),m.createIndexBuffer(l),h.aX.simpleSegment(0,0,r.length,l.length))}return t.mesh}class kd{constructor(t,r){this.context=new ho(t),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ei.maxOverzooming+Ei.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new kn}resize(t,r,l){if(this.width=Math.floor(t*l),this.height=Math.floor(r*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const t=this.context,r=new h.aW;r.emplaceBack(0,0),r.emplaceBack(h.a5,0),r.emplaceBack(0,h.a5),r.emplaceBack(h.a5,h.a5),this.tileExtentBuffer=t.createVertexBuffer(r,sr.members),this.tileExtentSegments=h.aX.simpleSegment(0,0,4,2);const l=new h.aW;l.emplaceBack(0,0),l.emplaceBack(h.a5,0),l.emplaceBack(0,h.a5),l.emplaceBack(h.a5,h.a5),this.debugBuffer=t.createVertexBuffer(l,sr.members),this.debugSegments=h.aX.simpleSegment(0,0,4,5);const d=new h.ch;d.emplaceBack(0,0,0,0),d.emplaceBack(h.a5,0,h.a5,0),d.emplaceBack(0,h.a5,0,h.a5),d.emplaceBack(h.a5,h.a5,h.a5,h.a5),this.rasterBoundsBuffer=t.createVertexBuffer(d,Md.members),this.rasterBoundsSegments=h.aX.simpleSegment(0,0,4,2);const _=new h.aW;_.emplaceBack(0,0),_.emplaceBack(h.a5,0),_.emplaceBack(0,h.a5),_.emplaceBack(h.a5,h.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(_,sr.members),this.rasterBoundsSegmentsPosOnly=h.aX.simpleSegment(0,0,4,5);const v=new h.aW;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(v,sr.members),this.viewportSegments=h.aX.simpleSegment(0,0,4,2);const b=new h.ci;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(b);const S=new h.aY;S.emplaceBack(1,0,2),S.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S);const C=this.context.gl;this.stencilClearMode=new hi({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.tileExtentMesh=new Li(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,r=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=h.N();h.c7(l,0,this.width,this.height,0,0,1),h.Q(l,l,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const d={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(t,r.TRIANGLES,Ht.disabled,this.stencilClearMode,Di.disabled,ai.disabled,null,null,d,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,r,l){if(this.currentStencilSource===t.source||!t.isTileClipped()||!r||!r.length)return;this.currentStencilSource=t.source,this.nextStencilID+r.length>256&&this.clearStencil();const d=this.context;d.setColorMode(Di.disabled),d.setDepthMode(Ht.disabled);const _={};for(const v of r)_[v.key]=this.nextStencilID++;this._renderTileMasks(_,r,l,!0),this._renderTileMasks(_,r,l,!1),this._tileClippingMaskIDs=_}_renderTileMasks(t,r,l,d){const _=this.context,v=_.gl,b=this.style.projection,S=this.transform,C=this.useProgram("clippingMask");for(const z of r){const L=t[z.key],R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),j=b.getMeshFromTileID(this.context,z.canonical,d,!0,"stencil"),G=S.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!l,applyTerrainMatrix:!0});C.draw(_,v.TRIANGLES,Ht.disabled,new hi({func:v.ALWAYS,mask:0},L,255,v.KEEP,v.KEEP,v.REPLACE),Di.disabled,l?ai.disabled:ai.backCCW,null,R,G,"$clipping",j.vertexBuffer,j.indexBuffer,j.segments)}}_renderTilesDepthBuffer(){const t=this.context,r=t.gl,l=this.style.projection,d=this.transform,_=this.useProgram("depth"),v=this.getDepthModeFor3D(),b=Ki(d,{tileSize:d.tileSize});for(const S of b){const C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S),z=l.getMeshFromTileID(this.context,S.canonical,!0,!0,"raster"),L=d.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(t,r.TRIANGLES,v,hi.disabled,Di.disabled,ai.backCCW,null,C,L,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new hi({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){const r=this.context.gl;return new hi({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const r=this.context.gl,l=t.sort(((v,b)=>b.overscaledZ-v.overscaledZ)),d=l[l.length-1].overscaledZ,_=l[0].overscaledZ-d+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let b=0;b<_;b++)v[b+d]=new hi({func:r.GEQUAL,mask:255},b+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[v,l]}return[{[d]:hi.disabled},l]}stencilConfigForOverlapTwoPass(t){const r=this.context.gl,l=t.sort(((v,b)=>b.overscaledZ-v.overscaledZ)),d=l[l.length-1].overscaledZ,_=l[0].overscaledZ-d+1;if(this.clearStencil(),_>1){const v={},b={};for(let S=0;S<_;S++)v[S+d]=new hi({func:r.GREATER,mask:255},_+1+S,255,r.KEEP,r.KEEP,r.REPLACE),b[S+d]=new hi({func:r.GREATER,mask:255},1+S,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*_+1,[v,b,l]}return this.nextStencilID=3,[{[d]:new hi({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[d]:new hi({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Di([t.CONSTANT_COLOR,t.ONE],new h.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Di.unblended:Di.alphaBlended}getDepthModeForSublayer(t,r,l){if(!this.opaquePassEnabledForLayer())return Ht.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ht(l||this.context.gl.LEQUAL,r,[d,d])}getDepthModeFor3D(){return new Ht(this.context.gl.LEQUAL,Ht.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){var l,d;this.style=t,this.options=r,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(bt()),this.imageManager.beginFrame();const _=this.style._order,v=this.style.tileManagers,b={},S={},C={},z={isRenderingToTexture:!1,isRenderingGlobe:((l=t.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const R in v){const j=v[R];j.used&&j.prepare(this.context),b[R]=j.getVisibleCoordinates(!1),S[R]=b[R].slice().reverse(),C[R]=j.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<_.length;R++)if(this.style._layers[_[R]].is3D()){this.opaquePassCutoff=R;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const R of _){const j=this.style._layers[R];if(!j.hasOffscreenPass()||j.isHidden(this.transform.zoom))continue;const G=S[j.source];(j.type==="custom"||G.length)&&this.renderLayer(this,v[j.source],j,G,z)}if((d=this.style.projection)===null||d===void 0||d.updateGPUdependent({context:this.context,useProgram:R=>this.useProgram(R)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?h.bp.black:h.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(R,j){const G=R.context,$=G.gl,K=((ce,ne,_e)=>{const Ie=Math.cos(ne.rollInRadians),Ee=Math.sin(ne.rollInRadians),ze=He(ne),De=ne.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ce.properties.get("sky-color"),u_horizon_color:ce.properties.get("horizon-color"),u_horizon:[(ne.width/2-ze*Ee)*_e,(ne.height/2+ze*Ie)*_e],u_horizon_normal:[-Ee,Ie],u_sky_horizon_blend:ce.properties.get("sky-horizon-blend")*ne.height/2*_e,u_sky_blend:De}})(j,R.style.map.transform,R.pixelRatio),W=new Ht($.LEQUAL,Ht.ReadWrite,[0,1]),te=hi.disabled,oe=R.colorModeForRenderPass(),ee=R.useProgram("sky"),se=Th(G,j);ee.draw(G,$.TRIANGLES,W,te,oe,ai.disabled,K,null,void 0,"sky",se.vertexBuffer,se.indexBuffer,se.segments)})(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[_[this.currentLayer]],j=v[R.source],G=b[R.source];this._renderTileClippingMasks(R,G,!1),this.renderLayer(this,j,R,G,z)}this.renderPass="translucent";let L=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const R=this.style._layers[_[this.currentLayer]],j=v[R.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(R,z))continue;this.opaquePassEnabledForLayer()||L||(L=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const G=(R.type==="symbol"?C:S)[R.source];this._renderTileClippingMasks(R,b[R.source],!!this.renderToTexture),this.renderLayer(this,j,R,G,z)}if(z.isRenderingGlobe&&(function(R,j,G){const $=R.context,K=$.gl,W=R.useProgram("atmosphere"),te=new Ht(K.LEQUAL,Ht.ReadOnly,[0,1]),oe=R.transform,ee=(function(De,et){const tt=De.properties.get("position"),qe=[-tt.x,-tt.y,-tt.z],rt=h.ar(new Float64Array(16));return De.properties.get("anchor")==="map"&&(h.bg(rt,rt,et.rollInRadians),h.bh(rt,rt,-et.pitchInRadians),h.bg(rt,rt,et.bearingInRadians),h.bh(rt,rt,et.center.lat*Math.PI/180),h.bJ(rt,rt,-et.center.lng*Math.PI/180)),h.cg(qe,qe,rt),qe})(G,R.transform),se=oe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ce=j.properties.get("atmosphere-blend")*se.projectionTransition;if(ce===0)return;const ne=Oo(oe.worldSize,oe.center.lat),_e=oe.inverseProjectionMatrix,Ie=new Float64Array(4);Ie[3]=1,h.aH(Ie,Ie,oe.modelViewProjectionMatrix),Ie[0]/=Ie[3],Ie[1]/=Ie[3],Ie[2]/=Ie[3],Ie[3]=1,h.aH(Ie,Ie,_e),Ie[0]/=Ie[3],Ie[1]/=Ie[3],Ie[2]/=Ie[3],Ie[3]=1;const Ee=((De,et,tt,qe,rt)=>({u_sun_pos:De,u_atmosphere_blend:et,u_globe_position:tt,u_globe_radius:qe,u_inv_proj_matrix:rt}))(ee,ce,[Ie[0],Ie[1],Ie[2]],ne,_e),ze=Th($,j);W.draw($,K.TRIANGLES,te,hi.disabled,Di.alphaBlended,ai.disabled,Ee,null,null,"atmosphere",ze.vertexBuffer,ze.indexBuffer,ze.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const R=(function(j,G){let $=null;const K=Object.values(j._layers).flatMap((ee=>ee.source&&!ee.isHidden(G)?[j.tileManagers[ee.source]]:[])),W=K.filter((ee=>ee.getSource().type==="vector")),te=K.filter((ee=>ee.getSource().type!=="vector")),oe=ee=>{(!$||$.getSource().maxzoom<ee.getSource().maxzoom)&&($=ee)};return W.forEach((ee=>oe(ee))),$||te.forEach((ee=>oe(ee))),$})(this.style,this.transform.zoom);R&&(function(j,G,$){for(let K=0;K<$.length;K++)Lu(j,G,$[K])})(this,R,R.getVisibleCoordinates())}this.options.showPadding&&(function(R){const j=R.transform.padding;Fl(R,R.transform.height-(j.top||0),3,Ps),Fl(R,j.bottom||0,3,ls),Rs(R,j.left||0,3,zc),Rs(R,R.transform.width-(j.right||0),3,Dc);const G=R.transform.centerPoint;(function($,K,W,te){An($,K-1,W-10,2,20,te),An($,K-10,W-1,20,2,te)})(R,G.x,R.transform.height-G.y,Za)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=t?!h.cj(r,l):!h.ck(r,l)),d||(d=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),d&&(h.cl(r,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(_,v){const b=_.context,S=b.gl,C=_.transform,z=Di.unblended,L=new Ht(S.LEQUAL,Ht.ReadWrite,[0,1]),R=v.tileManager.getRenderableTiles(),j=_.useProgram("terrainDepth");b.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),b.clear({color:h.bp.transparent,depth:1});for(const G of R){const $=v.getTerrainMesh(G.tileID),K=v.getTerrainData(G.tileID),W=C.getProjectionData({overscaledTileID:G.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),te={u_ele_delta:v.getMeshFrameDelta(C.zoom)};j.draw(b,S.TRIANGLES,L,hi.disabled,z,ai.backCCW,te,K,W,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain),(function(_,v){const b=_.context,S=b.gl,C=_.transform,z=Di.unblended,L=new Ht(S.LEQUAL,Ht.ReadWrite,[0,1]),R=v.getCoordsTexture(),j=v.tileManager.getRenderableTiles(),G=_.useProgram("terrainCoords");b.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),b.clear({color:h.bp.transparent,depth:1}),v.coordsIndex=[];for(const $ of j){const K=v.getTerrainMesh($.tileID),W=v.getTerrainData($.tileID);b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,R.texture);const te={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(C.zoom)},oe=C.getProjectionData({overscaledTileID:$.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});G.draw(b,S.TRIANGLES,L,hi.disabled,z,ai.backCCW,te,W,oe,"terrain",K.vertexBuffer,K.indexBuffer,K.segments),v.coordsIndex.push($.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain))}renderLayer(t,r,l,d,_){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(d||[]).length)&&(this.id=l.id,h.cm(l)?(function(v,b,S,C,z,L){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=L,j=hi.disabled,G=v.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function($,K,W,te,oe,ee,se,ce,ne){const _e=K.transform,Ie=K.style.map.terrain,Ee=oe==="map",ze=ee==="map";for(const De of $){const et=te.getTile(De),tt=et.getBucket(W);if(!tt||!tt.text||!tt.text.segments.get().length)continue;const qe=h.ay(tt.textSizeData,_e.zoom),rt=h.aN(et,1,K.transform.zoom),Vt=Ba(Ee,K.transform,rt),Ti=W.layout.get("icon-text-fit")!=="none"&&tt.hasIconData();if(qe){const Gi=Math.pow(2,_e.zoom-et.tileID.overscaledZ),Oi=Ie?(Xi,Ii)=>Ie.getElevation(De,Xi,Ii):null;Cs(tt,Ee,ze,ne,_e,Vt,Gi,qe,Ti,h.aO(_e,et,se,ce),De.toUnwrapped(),Oi)}}})(C,v,S,b,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),z),S.paint.get("icon-opacity").constantOr(1)!==0&&qo(v,b,S,C,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),j,G,R),S.paint.get("text-opacity").constantOr(1)!==0&&qo(v,b,S,C,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),j,G,R),b.map.showCollisionBoxes&&(Vn(v,b,S,C,!0),Vn(v,b,S,C,!1))})(t,r,l,d,this.style.placement.variableOffsets,_):h.cn(l)?(function(v,b,S,C,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:L}=z,R=S.paint.get("circle-opacity"),j=S.paint.get("circle-stroke-width"),G=S.paint.get("circle-stroke-opacity"),$=!S.layout.get("circle-sort-key").isConstant();if(R.constantOr(1)===0&&(j.constantOr(1)===0||G.constantOr(1)===0))return;const K=v.context,W=K.gl,te=v.transform,oe=v.getDepthModeForSublayer(0,Ht.ReadOnly),ee=hi.disabled,se=v.colorModeForRenderPass(),ce=[],ne=te.getCircleRadiusCorrection();for(let _e=0;_e<C.length;_e++){const Ie=C[_e],Ee=b.getTile(Ie),ze=Ee.getBucket(S);if(!ze)continue;const De=S.paint.get("circle-translate"),et=S.paint.get("circle-translate-anchor"),tt=h.aO(te,Ee,De,et),qe=ze.programConfigurations.get(S.id),rt=v.useProgram("circle",qe),Vt=ze.layoutVertexBuffer,Ti=ze.indexBuffer,Gi=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ie),Oi={programConfiguration:qe,program:rt,layoutVertexBuffer:Vt,indexBuffer:Ti,uniformValues:bu(v,Ee,S,tt,ne),terrainData:Gi,projectionData:te.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!L,applyTerrainMatrix:!0})};if($){const Xi=ze.segments.get();for(const Ii of Xi)ce.push({segments:new h.aX([Ii]),sortKey:Ii.sortKey,state:Oi})}else ce.push({segments:ze.segments,sortKey:0,state:Oi})}$&&ce.sort(((_e,Ie)=>_e.sortKey-Ie.sortKey));for(const _e of ce){const{programConfiguration:Ie,program:Ee,layoutVertexBuffer:ze,indexBuffer:De,uniformValues:et,terrainData:tt,projectionData:qe}=_e.state;Ee.draw(K,W.TRIANGLES,oe,ee,se,ai.backCCW,et,tt,qe,S.id,ze,De,_e.segments,S.paint,v.transform.zoom,Ie)}})(t,r,l,d,_):h.co(l)?(function(v,b,S,C,z){if(S.paint.get("heatmap-opacity")===0)return;const L=v.context,{isRenderingToTexture:R,isRenderingGlobe:j}=z;if(v.style.map.terrain){for(const G of C){const $=b.getTile(G);b.hasRenderableParent(G)||(v.renderPass==="offscreen"?wh(v,$,S,G,j):v.renderPass==="translucent"&&Un(v,S,G,R,j))}L.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?(function(G,$,K,W){const te=G.context,oe=te.gl,ee=G.transform,se=hi.disabled,ce=new Di([oe.ONE,oe.ONE],h.bp.transparent,[!0,!0,!0,!0]);(function(ne,_e,Ie){const Ee=ne.gl;ne.activeTexture.set(Ee.TEXTURE1),ne.viewport.set([0,0,_e.width/4,_e.height/4]);let ze=Ie.heatmapFbos.get(h.cd);ze?(Ee.bindTexture(Ee.TEXTURE_2D,ze.colorAttachment.get()),ne.bindFramebuffer.set(ze.framebuffer)):(ze=ki(ne,_e.width/4,_e.height/4),Ie.heatmapFbos.set(h.cd,ze))})(te,G,K),te.clear({color:h.bp.transparent});for(let ne=0;ne<W.length;ne++){const _e=W[ne];if($.hasRenderableParent(_e))continue;const Ie=$.getTile(_e),Ee=Ie.getBucket(K);if(!Ee)continue;const ze=Ee.programConfigurations.get(K.id),De=G.useProgram("heatmap",ze),et=ee.getProjectionData({overscaledTileID:_e,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),tt=ee.getCircleRadiusCorrection();De.draw(te,oe.TRIANGLES,Ht.disabled,se,ce,ai.backCCW,ao(Ie,ee.zoom,K.paint.get("heatmap-intensity"),tt),null,et,K.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,K.paint,ee.zoom,ze)}te.viewport.set([0,0,G.width,G.height])})(v,b,S,C):v.renderPass==="translucent"&&(function(G,$){const K=G.context,W=K.gl;K.setColorMode(G.colorModeForRenderPass());const te=$.heatmapFbos.get(h.cd);te&&(K.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,te.colorAttachment.get()),K.activeTexture.set(W.TEXTURE1),oi(K,$).bind(W.LINEAR,W.CLAMP_TO_EDGE),G.useProgram("heatmapTexture").draw(K,W.TRIANGLES,Ht.disabled,hi.disabled,G.colorModeForRenderPass(),ai.disabled,mh(G,$,0,1),null,null,$.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments,$.paint,G.transform.zoom))})(v,S)})(t,r,l,d,_):h.cp(l)?(function(v,b,S,C,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:L}=z,R=S.paint.get("line-opacity"),j=S.paint.get("line-width");if(R.constantOr(1)===0||j.constantOr(1)===0)return;const G=v.getDepthModeForSublayer(0,Ht.ReadOnly),$=v.colorModeForRenderPass(),K=S.paint.get("line-dasharray"),W=K.constantOr(1),te=S.paint.get("line-pattern"),oe=te.constantOr(1),ee=S.paint.get("line-gradient"),se=S.getCrossfadeParameters();let ce;ce=oe?"linePattern":W&&ee?"lineGradientSDF":W?"lineSDF":ee?"lineGradient":"line";const ne=v.context,_e=ne.gl,Ie=v.transform;let Ee=!0;for(const ze of C){const De=b.getTile(ze);if(oe&&!De.patternsLoaded())continue;const et=De.getBucket(S);if(!et)continue;const tt=et.programConfigurations.get(S.id),qe=v.context.program.get(),rt=v.useProgram(ce,tt),Vt=Ee||rt.program!==qe,Ti=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ze),Gi=te.constantOr(null),Oi=K&&K.constantOr(null);if(Gi&&De.imageAtlas){const Gn=De.imageAtlas,gn=Gn.patternPositions[Gi.to.toString()],_n=Gn.patternPositions[Gi.from.toString()];gn&&_n&&tt.setConstantPatternPositions(gn,_n)}else if(Oi){const Gn=S.layout.get("line-cap")==="round",gn=v.lineAtlas.getDash(Oi.to,Gn),_n=v.lineAtlas.getDash(Oi.from,Gn);tt.setConstantDashPositions(gn,_n)}const Xi=Ie.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),Ii=Ie.getPixelScale();let un;oe?(un=gh(v,De,S,Ii,se),qa(ne,_e,De,tt,se)):W&&ee?(un=ro(v,De,S,Ii,se,et.lineClipsArray.length),Ma(v,b,ne,_e,S,et,ze,tt,se)):W?(un=wa(v,De,S,Ii,se),on(v,ne,_e,tt,Vt,se)):ee?(un=Pd(v,De,S,Ii,et.lineClipsArray.length),Sa(v,b,ne,_e,S,et,ze)):un=Su(v,De,S,Ii);const Yi=v.stencilModeForClipping(ze);rt.draw(ne,_e.TRIANGLES,G,Yi,$,ai.disabled,un,Ti,Xi,S.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,S.paint,v.transform.zoom,tt,et.layoutVertexBuffer2),Ee=!1}})(t,r,l,d,_):h.cq(l)?(function(v,b,S,C,z){const L=S.paint.get("fill-color"),R=S.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const{isRenderingToTexture:j}=z,G=v.colorModeForRenderPass(),$=S.paint.get("fill-pattern"),K=v.opaquePassEnabledForLayer()&&!$.constantOr(1)&&L.constantOr(h.bp.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===K){const W=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?Ht.ReadWrite:Ht.ReadOnly);as(v,b,S,C,W,G,!1,j)}if(v.renderPass==="translucent"&&S.paint.get("fill-antialias")){const W=v.getDepthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Ht.ReadOnly);as(v,b,S,C,W,G,!0,j)}})(t,r,l,d,_):h.cr(l)?(function(v,b,S,C,z){const L=S.paint.get("fill-extrusion-opacity");if(L===0)return;const{isRenderingToTexture:R}=z;if(v.renderPass==="translucent"){const j=new Ht(v.context.gl.LEQUAL,Ht.ReadWrite,v.depthRangeFor3D);if(L!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))rs(v,b,S,C,j,hi.disabled,Di.disabled,R),rs(v,b,S,C,j,v.stencilModeFor3D(),v.colorModeForRenderPass(),R);else{const G=v.colorModeForRenderPass();rs(v,b,S,C,j,hi.disabled,G,R)}}})(t,r,l,d,_):h.cs(l)?(function(v,b,S,C,z){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const{isRenderingToTexture:L}=z,R=v.context,j=v.style.projection.useSubdivision,G=v.getDepthModeForSublayer(0,Ht.ReadOnly),$=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(K,W,te,oe,ee,se,ce){const ne=K.context,_e=ne.gl;for(const Ie of te){const Ee=W.getTile(Ie),ze=Ee.dem;if(!ze||!ze.data||!Ee.needsHillshadePrepare)continue;const De=ze.dim,et=ze.stride,tt=ze.getPixels();if(ne.activeTexture.set(_e.TEXTURE1),ne.pixelStoreUnpackPremultiplyAlpha.set(!1),Ee.demTexture=Ee.demTexture||K.getTileTexture(et),Ee.demTexture){const rt=Ee.demTexture;rt.update(tt,{premultiply:!1}),rt.bind(_e.NEAREST,_e.CLAMP_TO_EDGE)}else Ee.demTexture=new h.T(ne,tt,_e.RGBA,{premultiply:!1}),Ee.demTexture.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);ne.activeTexture.set(_e.TEXTURE0);let qe=Ee.fbo;if(!qe){const rt=new h.T(ne,{width:De,height:De,data:null},_e.RGBA);rt.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),qe=Ee.fbo=ne.createFramebuffer(De,De,!0,!1),qe.colorAttachment.set(rt.texture)}ne.bindFramebuffer.set(qe.framebuffer),ne.viewport.set([0,0,De,De]),K.useProgram("hillshadePrepare").draw(ne,_e.TRIANGLES,ee,se,ce,ai.disabled,Dd(Ee.tileID,ze),null,null,oe.id,K.rasterBoundsBuffer,K.quadTriangleIndexBuffer,K.rasterBoundsSegments),Ee.needsHillshadePrepare=!1}})(v,b,C,S,G,hi.disabled,$),R.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(j){const[K,W,te]=v.stencilConfigForOverlapTwoPass(C);ss(v,b,S,te,K,G,$,!1,L),ss(v,b,S,te,W,G,$,!0,L)}else{const[K,W]=v.getStencilConfigForOverlapAndUpdateStencilID(C);ss(v,b,S,W,K,G,$,!1,L)}})(t,r,l,d,_):h.ct(l)?(function(v,b,S,C,z){if(v.renderPass!=="translucent"||!C.length)return;const{isRenderingToTexture:L}=z,R=v.style.projection.useSubdivision,j=v.getDepthModeForSublayer(0,Ht.ReadOnly),G=v.colorModeForRenderPass();if(R){const[$,K,W]=v.stencilConfigForOverlapTwoPass(C);Ds(v,b,S,W,$,j,G,!1,L),Ds(v,b,S,W,K,j,G,!0,L)}else{const[$,K]=v.getStencilConfigForOverlapAndUpdateStencilID(C);Ds(v,b,S,K,$,j,G,!1,L)}})(t,r,l,d,_):h.bU(l)?(function(v,b,S,C,z){if(v.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!C.length)return;const{isRenderingToTexture:L}=z,R=b.getSource(),j=v.style.projection.useSubdivision;if(R instanceof Oa)hr(v,b,S,C,null,!1,!1,R.tileCoords,R.flippedWindingOrder,L);else if(j){const[G,$,K]=v.stencilConfigForOverlapTwoPass(C);hr(v,b,S,K,G,!1,!0,Is,!1,L),hr(v,b,S,K,$,!0,!0,Is,!1,L)}else{const[G,$]=v.getStencilConfigForOverlapAndUpdateStencilID(C);hr(v,b,S,$,G,!1,!0,Is,!1,L)}})(t,r,l,d,_):h.cu(l)?(function(v,b,S,C,z){const L=S.paint.get("background-color"),R=S.paint.get("background-opacity");if(R===0)return;const{isRenderingToTexture:j}=z,G=v.context,$=G.gl,K=v.style.projection,W=v.transform,te=W.tileSize,oe=S.paint.get("background-pattern");if(v.isPatternMissing(oe))return;const ee=!oe&&L.a===1&&R===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==ee)return;const se=hi.disabled,ce=v.getDepthModeForSublayer(0,ee==="opaque"?Ht.ReadWrite:Ht.ReadOnly),ne=v.colorModeForRenderPass(),_e=v.useProgram(oe?"backgroundPattern":"background"),Ie=C||Ki(W,{tileSize:te,terrain:v.style.map.terrain});oe&&(G.activeTexture.set($.TEXTURE0),v.imageManager.bind(v.context));const Ee=S.getCrossfadeParameters();for(const ze of Ie){const De=W.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),et=oe?Cu(R,v,oe,{tileID:ze,tileSize:te},Ee):Au(R,L),tt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ze),qe=K.getMeshFromTileID(G,ze.canonical,!1,!0,"raster");_e.draw(G,$.TRIANGLES,ce,se,ne,ai.backCCW,et,tt,De,S.id,qe.vertexBuffer,qe.indexBuffer,qe.segments)}})(t,0,l,d,_):h.cv(l)&&(function(v,b,S,C){const{isRenderingGlobe:z}=C,L=v.context,R=S.implementation,j=v.style.projection,G=v.transform,$=G.getProjectionDataForCustomLayer(z),K={farZ:G.farZ,nearZ:G.nearZ,fov:G.fov*Math.PI/180,modelViewProjectionMatrix:G.modelViewProjectionMatrix,projectionMatrix:G.projectionMatrix,shaderData:{variantName:j.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${j.shaderPreludeCode.vertexSource}`,define:j.shaderDefine},defaultProjectionData:$},W=R.renderingMode?R.renderingMode:"2d";if(v.renderPass==="offscreen"){const te=R.prerender;te&&(v.setCustomLayerDefaults(),L.setColorMode(v.colorModeForRenderPass()),te.call(R,L.gl,K),L.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),L.setColorMode(v.colorModeForRenderPass()),L.setStencilMode(hi.disabled);const te=W==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,Ht.ReadOnly);L.setDepthMode(te),R.render(L.gl,K),L.setDirty(),v.setBaseState(),L.bindFramebuffer.set(null)}})(t,0,l,_))}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const r=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!r||!l}useProgram(t,r,l=!1,d=[]){this.cache=this.cache||{};const _=!!this.style.map.terrain,v=this.style.projection,b=l?Ji.projectionMercator:v.shaderPreludeCode,S=l?fn:v.shaderDefine,C=t+(r?r.cacheKey:"")+`/${l?da:v.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"")+(d?`/${d.join("/")}`:"");return this.cache[C]||(this.cache[C]=new Ad(this.context,Ji[t],r,Rd[t],this._showOverdrawInspector,_,b,S,d)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,r;if(this._tileTextures){for(const l in this._tileTextures){const d=this._tileTextures[l];if(d)for(const _ of d)_.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((r=this.tileExtentMesh.indexBuffer)===null||r===void 0||r.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const l in this.cache){const d=this.cache[l];d&&d.program&&this.context.gl.deleteProgram(d.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:r}=this.context.gl;return this.width!==t||this.height!==r}}function Sh(m,t){let r,l=!1,d=null,_=null;const v=()=>{d=null,l&&(m.apply(_,r),d=setTimeout(v,t),l=!1)};return(...b)=>(l=!0,_=this,r=b,d||v(),d)}class wn{constructor(t){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(l=d)})),(l&&l[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:l,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const l=r.join("/");let d=l;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${l}`);let _=window.location.hash.replace(d,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let v=window.location.href.replace(/(#.+)?$/,_);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Sh(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const r=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,d=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,d),v=Math.round(r.lng*_)/_,b=Math.round(r.lat*_)/_,S=this._map.getBearing(),C=this._map.getPitch();let z="";if(z+=t?`/${v}/${b}/${l}`:`${l}/${b}/${v}`,(S||C)&&(z+="/"+Math.round(10*S)/10),C&&(z+=`/${Math.round(C)}`),this._hashName){const L=this._hashName;let R=!1;const j=window.location.hash.slice(1).split("&").map((G=>{const $=G.split("=")[0];return $===L?(R=!0,`${$}=${z}`):G})).filter((G=>G));return R||j.push(`${L}=${z}`),`#${j.join("&")}`}return`#${z}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new h.V(+t[2],+t[1])}catch{return!1}const r=+t[0],l=+(t[3]||0),d=+(t[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&l>=-180&&l<=180&&d>=this._map.getMinPitch()&&d<=this._map.getMaxPitch()}}const us={linearity:.3,easing:h.cw(0,0,.3,1)},jl=h.e({deceleration:2500,maxSpeed:1400},us),aa=h.e({deceleration:20,maxSpeed:1400},us),Ha=h.e({deceleration:1e3,maxSpeed:360},us),Zo=h.e({deceleration:1e3,maxSpeed:90},us),ra=h.e({deceleration:1e3,maxSpeed:360},us);class Xf{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:bt(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=bt();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,r.roll+=_.rollDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(r.pan.mag()){const _=ku(r.pan.mag(),l,h.e({},jl,t||{})),v=r.pan.mult(_.amount/r.pan.mag()),b=this._map.cameraHelper.handlePanInertia(v,this._map.transform);d.center=b.easingCenter,d.offset=b.easingOffset,Nl(d,_)}if(r.zoom){const _=ku(r.zoom,l,aa),v=h.cx(this._map.transform.zoom+_.amount,this._map.getZoomSnap(),_.amount);d.zoom=v,Nl(d,_)}if(r.bearing){const _=ku(r.bearing,l,Ha);d.bearing=this._map.transform.bearing+h.an(_.amount,-179,179),Nl(d,_)}if(r.pitch){const _=ku(r.pitch,l,Zo);d.pitch=this._map.transform.pitch+_.amount,Nl(d,_)}if(r.roll){const _=ku(r.roll,l,ra);d.roll=this._map.transform.roll+h.an(_.amount,-179,179),Nl(d,_)}if(d.zoom||d.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;d.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),h.e(d,{noMoveStart:!0})}}function Nl(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function ku(m,t,r){const{maxSpeed:l,linearity:d,deceleration:_}=r,v=h.an(m*d/(t/1e3),-l,l),b=Math.abs(v)/(_*d);return{easing:r.easing,duration:1e3*b,amount:v*(b/2)}}class Fn extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l,d={}){l=l instanceof MouseEvent?l:new MouseEvent(t,l);const _=Ce.mousePos(r.getCanvas(),l),v=r.unproject(_);super(t,h.e({point:_,lngLat:v,originalEvent:l},d)),this._defaultPrevented=!1,this.target=r}}class Dr extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l){const d=t==="touchend"?l.changedTouches:l.touches,_=Ce.touchPos(r.getCanvasContainer(),d),v=_.map((S=>r.unproject(S))),b=_.reduce(((S,C,z,L)=>S.add(C.div(L.length))),new h.P(0,0));super(t,{points:_,point:b,lngLats:v,lngLat:r.unproject(b),originalEvent:l}),this._defaultPrevented=!1}}class Pc extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class Rc{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Pc(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Fn(t.type,this._map,t))}mouseup(t){this._map.fire(new Fn(t.type,this._map,t))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Fn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Fn(t.type,this._map,t))}mouseover(t){this._map.fire(new Fn(t.type,this._map,t))}mouseout(t){this._map.fire(new Fn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Dr(t.type,this._map,t))}touchmove(t){this._map.fire(new Dr(t.type,this._map,t))}touchend(t){this._map.fire(new Dr(t.type,this._map,t))}touchcancel(t){this._map.fire(new Dr(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Od{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Fn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Fn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Fn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ir{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(h.P.convert(t),this._map.terrain)}}class fo{constructor(t,r){this._map=t,this._tr=new Ir(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ce.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const l=r;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=l,this._box||(this._box=Ce.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(d.x,l.x),v=Math.max(d.x,l.x),b=Math.min(d.y,l.y),S=Math.max(d.y,l.y);Ce.setTransform(this._box,`translate(${_}px,${b}px)`),this._box.style.width=v-_+"px",this._box.style.height=S-b+"px"}mouseupWindow(t,r){if(!this._active||t.button!==0)return;const l=this._startPos,d=r;if(this.reset(),Ce.suppressClick(),l.x!==d.x||l.y!==d.y)return this._map.fire(new h.l("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(l,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Ce.remove(this._box),this._box=null),Ce.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new h.l(t,{originalEvent:r}))}}function Ea(m,t){if(m.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${t.length}`);const r={};for(let l=0;l<m.length;l++)r[m[l].identifier]=t[l];return r}class ut{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=(function(d){const _=new h.P(0,0);for(const v of d)_._add(v);return _.div(d.length)})(r),this.touches=Ea(l,r)))}touchmove(t,r,l){if(this.aborted||!this.centroid)return;const d=Ea(l,r);for(const _ in this.touches){const v=d[_];(!v||v.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,r,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Ou{constructor(t){this.singleTap=new ut(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,r,l){this.singleTap.touchstart(t,r,l)}touchmove(t,r,l){this.singleTap.touchmove(t,r,l)}touchend(t,r,l){const d=this.singleTap.touchend(t,r,l);if(d){const _=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(d)<30;if(_&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Lc{constructor(t){this._tr=new Ir(t),this._zoomIn=new Ou({numTouches:1,numTaps:2}),this._zoomOut=new Ou({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,l){this._zoomIn.touchstart(t,r,l),this._zoomOut.touchstart(t,r,l)}touchmove(t,r,l){this._zoomIn.touchmove(t,r,l),this._zoomOut.touchmove(t,r,l)}touchend(t,r,l){const d=this._zoomIn.touchend(t,r,l),_=this._zoomOut.touchend(t,r,l),v=this._tr;return d?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:h.cx(v.zoom+1,b.getZoomSnap()),around:v.unproject(d)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:h.cx(v.zoom-1,b.getZoomSnap()),around:v.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dr{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const r=this._moveFunction(...t);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(t,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,r){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const d=Array.isArray(r)?r[0]:r;return!this._moved&&d.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(l,d))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Ce.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Pr=0,Vl=2,kc={[Pr]:1,[Vl]:2};class cs{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const r=Ce.mouseButton(t);this._eventButton=r}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(r,l){const d=kc[l];return r.buttons===void 0||(r.buttons&d)!==d})(t,this._eventButton)}isValidEndEvent(t){return Ce.mouseButton(t)===this._eventButton}}class Ho{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Bu{constructor(t=new cs({checkCorrectEvent:()=>!0}),r=new Ho){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(t,r,l){return t instanceof MouseEvent?r(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?l(t):void 0}startMove(t){this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.startMove(r)),(r=>this.oneFingerTouchMoveStateManager.startMove(r)))}endMove(t){this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.endMove(r)),(r=>this.oneFingerTouchMoveStateManager.endMove(r)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.isValidStartEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.isValidMoveEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.isValidEndEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r)))}}const hs=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=t=>{t.preventDefault()}};class Oc{constructor(t,r){this._clickTolerance=t.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,r,l){return this._calculateTransform(t,r,l)}touchmove(t,r,l){if(this._active){if(!this._shouldBePrevented(l.length))return t.preventDefault(),this._calculateTransform(t,r,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,r,l){this._calculateTransform(t,r,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,l){l.length>0&&(this._active=!0);const d=Ea(l,r),_=new h.P(0,0),v=new h.P(0,0);let b=0;for(const C in d){const z=d[C],L=this._touches[C];L&&(_._add(z),v._add(z.sub(L)),b++,d[C]=z)}if(this._touches=d,this._shouldBePrevented(b)||!v.mag())return;const S=v.div(b);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(b),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,r,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,l){if(!this._firstTwoTouches)return;t.preventDefault();const[d,_]=this._firstTwoTouches,v=ds(l,r,d),b=ds(l,r,_);if(!v||!b)return;const S=this._aroundCenter?null:v.add(b).div(2);return this._move([v,b],S,t)}touchend(t,r,l){if(!this._firstTwoTouches)return;const[d,_]=this._firstTwoTouches,v=ds(l,r,d),b=ds(l,r,_);v&&b||(this._active&&Ce.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ds(m,t,r){for(let l=0;l<m.length;l++)if(m[l].identifier===r)return t[l]}function Mh(m,t){return Math.log(m/t)/Math.LN2}class fs extends Fu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Mh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mh(this._distance,l),pinchAround:r}}}function Bc(m,t){return 180*m.angleWith(t)/Math.PI}class ju extends Fu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r,l){const d=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Bc(this._vector,d),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,l=Bc(t,this._startVector);return Math.abs(l)<r}}function ps(m){return Math.abs(m.y)>Math.abs(m.x)}class Ls extends Fu{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,r,l){super.touchstart(t,r,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,ps(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,_,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(d.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,r,l){if(this._valid!==void 0)return this._valid;const d=t.mag()>=2,_=r.mag()>=2;if(!d&&!_)return;if(!d||!_)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=t.y>0==r.y>0;return ps(t)&&ps(r)&&v}}const fr={panStep:100,bearingStep:15,pitchStep:10};class Ai{constructor(t){this._tr=new Ir(t);const r=fr;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,l=0,d=0,_=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?d=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?d=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,d=0),{cameraAnimation:b=>{const S=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:Eh,zoom:r?h.cx(S.zoom+r*(t.shiftKey?2:1),b.getZoomSnap()):S.zoom,bearing:S.bearing+l*this._bearingStep,pitch:S.pitch+d*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:S.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Eh(m){return m*(2-m)}const ks=4.000244140625,po=1/450;class Nu{constructor(t,r){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new Ir(t),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=po}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=bt(),d=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,r!==0&&r%ks==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(d*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=Ce.mousePos(this._map.getCanvas(),t),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(h.V.convert(l.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const b=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=b),typeof this._targetZoom=="number"&&(this._targetZoom+=b)}if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>ks?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&S!==0&&(S=1/S);const C=typeof this._targetZoom!="number"?t.scale:h.aq(this._targetZoom),z=t.applyConstrain(t.getCameraLngLat(),h.at(C*S)).zoom,L=this._map.getZoomSnap();if(this._type==="wheel"&&L>0){const R=h.cx(t.zoom,L);this._targetZoom=h.cx(z,L,z-R)}else this._targetZoom=z;this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,l=this._startZoom,d=this._easing;let _,v=!1;if(this._type==="wheel"&&l&&d){const b=bt()-this._lastWheelEventTime,S=Math.min((b+5)/200,1),C=d(S);_=h.G.number(l,r,C),S<1?this._frameId||(this._frameId=!0):v=!0}else _=r,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!v,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=h.cz;if(this._prevEase){const l=this._prevEase,d=(bt()-l.start)/l.duration,_=l.easing(d+.01)-l.easing(d),v=.27/Math.sqrt(_*_+1e-4)*.01,b=Math.sqrt(.0729-v*v);r=h.cw(v,b,.25,1)}return this._prevEase={start:bt(),duration:t,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Fc{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $o{constructor(t){this._tr=new Ir(t),this.reset()}reset(){this._active=!1}dblclick(t,r){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:h.cx(this._tr.zoom+(t.shiftKey?-1:1),l.getZoomSnap()),around:this._tr.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vu{constructor(){this._tap=new Ou({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,r,l){if(!this._swipePoint)if(this._tapTime){const d=r[0],_=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(d)<30;_&&v?l.length>0&&(this._swipePoint=d,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,r,l)}touchmove(t,r,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const d=r[0],_=d.y-this._swipePoint.y;return this._swipePoint=d,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,r,l)}touchend(t,r,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const d=this._tap.touchend(t,r,l);d&&(this._tapTime=t.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ah{constructor(t,r,l){this._el=t,this._mousePan=r,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $a{constructor(t,r,l,d){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=r,this._mousePitch=l,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Xo{constructor(t,r,l,d){this._el=t,this._touchZoom=r,this._touchRotate=l,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ct{constructor(t,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=Ce.create("div","maplibregl-cooperative-gesture-screen",t);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=r,this._container.appendChild(d);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=l,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Ce.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,r){this._enabled&&(this._map.fire(new h.l("cooperativegestureprevented",{gestureType:t,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const yt=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class pr extends h.l{}function Ul(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class Uu{get _ownerDocument(){var t;return((t=this._el)===null||t===void 0?void 0:t.ownerDocument)||document}get _ownerWindow(){var t,r;return((r=(t=this._el)===null||t===void 0?void 0:t.ownerDocument)===null||r===void 0?void 0:r.defaultView)||window}constructor(t,r){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,_)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=d.type==="renderFrame"?void 0:d,b={needsRenderFrame:!1},S={},C={};for(const{handlerName:R,handler:j,allowed:G}of this._handlers){if(!j.isEnabled())continue;let $;if(this._blockedByActive(C,G,R))j.reset();else if(j[_||d.type]){if(h.cA(d,_||d.type)){const K=Ce.mousePos(this._map.getCanvas(),d);$=j[_||d.type](d,K)}else if(h.cB(d,_||d.type)){const K=this._getMapTouches(d.touches),W=Ce.touchPos(this._map.getCanvas(),K);$=j[_||d.type](d,W,K)}else h.cC(_||d.type)||($=j[_||d.type](d));this.mergeHandlerResult(b,S,$,R,v),$&&$.needsRenderFrame&&this._triggerRenderFrame()}($||j.isActive())&&(C[R]=j)}const z={};for(const R in this._previousActiveHandlers)C[R]||(z[R]=v);this._previousActiveHandlers=C,(Object.keys(z).length||Ul(b))&&(this._changes.push([b,S,z]),this._triggerRenderFrame()),(Object.keys(C).length||Ul(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:L}=b;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Xf(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[this._ownerDocument,"mousemove",{capture:!0}],[this._ownerDocument,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[this._ownerWindow,"blur",void 0]];for(const[d,_,v]of this._listeners)Ce.addEventListener(d,_,d===this._ownerDocument?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,r,l]of this._listeners)Ce.removeEventListener(t,r,t===this._ownerDocument?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const r=this._map,l=r.getCanvasContainer();this._add("mapEvent",new Rc(r,t));const d=r.boxZoom=new fo(r,t);this._add("boxZoom",d),t.interactive&&t.boxZoom&&d.enable();const _=r.cooperativeGestures=new ct(r,t.cooperativeGestures);this._add("cooperativeGestures",_),t.cooperativeGestures&&_.enable();const v=new Lc(r),b=new $o(r);r.doubleClickZoom=new Fc(b,v),this._add("tapZoom",v),this._add("clickZoom",b),t.interactive&&t.doubleClickZoom&&r.doubleClickZoom.enable();const S=new Vu;this._add("tapDragZoom",S);const C=r.touchPitch=new Ls(r);this._add("touchPitch",C),t.interactive&&t.touchPitch&&r.touchPitch.enable(t.touchPitch);const z=()=>r.project(r.getCenter()),L=(function({enable:ee,clickTolerance:se,aroundCenter:ce=!0,minPixelCenterThreshold:ne=100,rotateDegreesPerPixelMoved:_e=.8},Ie){const Ee=new cs({checkCorrectEvent:ze=>Ce.mouseButton(ze)===0&&ze.ctrlKey||Ce.mouseButton(ze)===2&&!ze.ctrlKey});return new dr({clickTolerance:se,move:(ze,De)=>{const et=Ie();if(ce&&Math.abs(et.y-ze.y)>ne)return{bearingDelta:h.cy(new h.P(ze.x,De.y),De,et)};let tt=(De.x-ze.x)*_e;return ce&&De.y<et.y&&(tt=-tt),{bearingDelta:tt}},moveStateManager:Ee,enable:ee,assignEvents:hs})})(t,z),R=(function({enable:ee,clickTolerance:se,pitchDegreesPerPixelMoved:ce=-.5}){const ne=new cs({checkCorrectEvent:_e=>Ce.mouseButton(_e)===0&&_e.ctrlKey||Ce.mouseButton(_e)===2});return new dr({clickTolerance:se,move:(_e,Ie)=>({pitchDelta:(Ie.y-_e.y)*ce}),moveStateManager:ne,enable:ee,assignEvents:hs})})(t),j=(function({enable:ee,clickTolerance:se,rollDegreesPerPixelMoved:ce=.3},ne){const _e=new cs({checkCorrectEvent:Ie=>Ce.mouseButton(Ie)===2&&Ie.ctrlKey});return new dr({clickTolerance:se,move:(Ie,Ee)=>{const ze=ne();let De=(Ee.x-Ie.x)*ce;return Ee.y<ze.y&&(De=-De),{rollDelta:De}},moveStateManager:_e,enable:ee,assignEvents:hs})})(t,z);r.dragRotate=new $a(t,L,R,j),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",R,["mouseRotate","mouseRoll"]),this._add("mouseRoll",j,["mousePitch"]),t.interactive&&t.dragRotate&&r.dragRotate.enable();const G=(function({enable:ee,clickTolerance:se}){const ce=new cs({checkCorrectEvent:ne=>Ce.mouseButton(ne)===0&&!ne.ctrlKey});return new dr({clickTolerance:se,move:(ne,_e)=>({around:_e,panDelta:_e.sub(ne)}),activateOnStart:!0,moveStateManager:ce,enable:ee,assignEvents:hs})})(t),$=new Oc(t,r);r.dragPan=new Ah(l,G,$),this._add("mousePan",G),this._add("touchPan",$,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&r.dragPan.enable(t.dragPan);const K=new ju,W=new fs;r.touchZoomRotate=new Xo(l,W,K,S),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&r.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Od(r));const te=r.scrollZoom=new Nu(r,(()=>this._triggerRenderFrame()));this._add("scrollZoom",te,["mousePan"]),t.interactive&&t.scrollZoom&&r.scrollZoom.enable(t.scrollZoom);const oe=r.keyboard=new Ai(r);this._add("keyboard",oe),t.interactive&&t.keyboard&&r.keyboard.enable()}_add(t,r,l){this._handlers.push({handlerName:t,handler:r,allowed:l}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,r,l){for(const d in t)if(d!==l&&(!r||r.indexOf(d)<0))return!0;return!1}_getMapTouches(t){const r=[];for(const l of t)this._el.contains(l.target)&&r.push(l);return r}mergeHandlerResult(t,r,l,d,_){if(!l)return;h.e(t,l);const v={handlerName:d,originalEvent:l.originalEvent||_};l.zoomDelta!==void 0&&(r.zoom=v),l.panDelta!==void 0&&(r.drag=v),l.rollDelta!==void 0&&(r.roll=v),l.pitchDelta!==void 0&&(r.pitch=v),l.bearingDelta!==void 0&&(r.rotate=v)}_applyChanges(){const t={},r={},l={};for(const[d,_,v]of this._changes)d.panDelta&&(t.panDelta=(t.panDelta||new h.P(0,0))._add(d.panDelta)),d.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+d.pitchDelta),d.rollDelta&&(t.rollDelta=(t.rollDelta||0)+d.rollDelta),d.around!==void 0&&(t.around=d.around),d.pinchAround!==void 0&&(t.pinchAround=d.pinchAround),d.noInertia&&(t.noInertia=d.noInertia),h.e(r,_),h.e(l,v);this._updateMapTransform(t,r,l),this._changes=[]}_updateMapTransform(t,r,l){const d=this._map,_=d._getTransformForUpdate(),v=d.terrain;if(!(Ul(t)||v&&this._terrainMovement))return this._fireEvents(r,l,!0);d._stop(!0);let{panDelta:b,zoomDelta:S,bearingDelta:C,pitchDelta:z,rollDelta:L,around:R,pinchAround:j}=t;j!==void 0&&(R=j),R=R||d.transform.centerPoint,v&&!_.isPointOnMapSurface(R)&&(R=_.centerPoint);const G={panDelta:b,zoomDelta:S,rollDelta:L,pitchDelta:z,bearingDelta:C,around:R};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(R)&&(R=_.centerPoint);const $=R.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(b?R.sub(b):R);this._handleMapControls({terrain:v,tr:_,deltasForHelper:G,preZoomAroundLoc:$,combinedEventsInProgress:r,panDelta:b}),d._applyUpdatedTransform(_),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,l,!0)}_handleMapControls({terrain:t,tr:r,deltasForHelper:l,preZoomAroundLoc:d,combinedEventsInProgress:_,panDelta:v}){const b=this._map.cameraHelper;if(b.handleMapControlsRollPitchBearingZoom(l,r),t)return b.useGlobeControls?(this._terrainMovement||!_.drag&&!_.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void b.handleMapControlsPan(l,r,d)):this._terrainMovement||!_.drag&&!_.zoom?void(_.drag&&this._terrainMovement&&v?r.setCenter(r.screenPointToLocation(r.centerPoint.sub(v))):b.handleMapControlsPan(l,r,d)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void b.handleMapControlsPan(l,r,d));b.handleMapControlsPan(l,r,d)}_fireEvents(t,r,l){const d=yt(this._eventsInProgress),_=yt(t),v={};for(const L in t){const{originalEvent:R}=t[L];this._eventsInProgress[L]||(v[`${L}start`]=R),this._eventsInProgress[L]=t[L]}!d&&_&&this._fireEvent("movestart",_.originalEvent);for(const L in v)this._fireEvent(L,v[L]);_&&this._fireEvent("move",_.originalEvent);for(const L in t){const{originalEvent:R}=t[L];this._fireEvent(L,R)}const b={};let S;for(const L in this._eventsInProgress){const{handlerName:R,originalEvent:j}=this._eventsInProgress[L];this._handlersById[R].isActive()||(delete this._eventsInProgress[L],S=r[R]||j,b[`${L}end`]=S)}for(const L in b)this._fireEvent(L,b[L]);const C=yt(this._eventsInProgress),z=(d||_)&&!C;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const L=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&L.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(L)}if(l&&z){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!L||!L.essential&&Tt.prefersReducedMotion?(this._map.fire(new h.l("moveend",{originalEvent:S})),R(this._map.getBearing())&&this._map.resetNorth()):(R(L.bearing||this._map.getBearing())&&(L.bearing=0),L.freezeElevation=!0,this._map.easeTo(L,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new h.l(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new pr("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Tn extends h.E{constructor(t,r,l){super(),this._renderFrameCallback=()=>{const d=Math.min((bt()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,this._zoomSnap=l.zoomSnap,this.cameraHelper=r,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,r){t.apply(this.transform,!0),this.transform=t,this.cameraHelper=r}getCenter(){return new h.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,r){return this.jumpTo({elevation:t},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,r,l){return t=h.P.convert(t).mult(-1),this.panTo(this.transform.center,h.e({offset:t},r),l)}panTo(t,r,l){return this.easeTo(h.e({center:t},r),l)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,l){return this.easeTo(h.e({zoom:t},r),l)}zoomIn(t,r){return this.zoomTo(h.cx(this.getZoom()+1,this._zoomSnap),t,r),this}zoomOut(t,r){return this.zoomTo(h.cx(this.getZoom()-1,this._zoomSnap),t,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,r){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new h.l("movestart",r)).fire(new h.l("move",r)).fire(new h.l("moveend",r))),this}getBearing(){return this.transform.bearing}setZoomSnap(t){return this._zoomSnap=t,this}getZoomSnap(){return this._zoomSnap}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,l){return this.easeTo(h.e({bearing:t},r),l)}resetNorth(t,r){return this.rotateTo(0,h.e({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(h.e({bearing:0,pitch:0,roll:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}getRoll(){return this.transform.roll}setRoll(t,r){return this.jumpTo({roll:t},r),this}cameraForBounds(t,r){t=Wi.convert(t).adjustAntiMeridian();const l=r&&r.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,r)}_cameraForBoxAndBearing(t,r,l,d){const _={top:0,bottom:0,right:0,left:0};if(typeof(d=h.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const C=d.padding;d.padding={top:C,bottom:C,right:C,left:C}}const v=h.e(_,d.padding);d.padding=v;const b=this.transform,S=new Wi(t,r);return this.cameraHelper.cameraForBoxAndBearing(d,v,S,l,b)}fitBounds(t,r,l){return this._fitInternal(this.cameraForBounds(t,r),r,l)}fitScreenCoordinates(t,r,l,d,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(h.P.convert(t)),this.transform.screenPointToLocation(h.P.convert(r)),l,d),d,_)}_fitInternal(t,r,l){return t?(delete(r=h.e(t,r)).padding,r.linear?this.easeTo(r,l):this.flyTo(r,l)):this}jumpTo(t,r){this.stop();const l=this._getTransformForUpdate();let d=!1,_=!1,v=!1;const b=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,t);const S=l.zoom!==b;return"elevation"in t&&l.elevation!==+t.elevation&&l.setElevation(+t.elevation),"bearing"in t&&l.bearing!==+t.bearing&&(d=!0,l.setBearing(+t.bearing)),"pitch"in t&&l.pitch!==+t.pitch&&(_=!0,l.setPitch(+t.pitch)),"roll"in t&&l.roll!==+t.roll&&(v=!0,l.setRoll(+t.roll)),t.padding==null||l.isPaddingEqual(t.padding)||l.setPadding(t.padding),this._applyUpdatedTransform(l),this.fire(new h.l("movestart",r)).fire(new h.l("move",r)),S&&this.fire(new h.l("zoomstart",r)).fire(new h.l("zoom",r)).fire(new h.l("zoomend",r)),d&&this.fire(new h.l("rotatestart",r)).fire(new h.l("rotate",r)).fire(new h.l("rotateend",r)),_&&this.fire(new h.l("pitchstart",r)).fire(new h.l("pitch",r)).fire(new h.l("pitchend",r)),v&&this.fire(new h.l("rollstart",r)).fire(new h.l("roll",r)).fire(new h.l("rollend",r)),this.fire(new h.l("moveend",r))}calculateCameraOptionsFromTo(t,r,l,d=0){const _=h.a9.fromLngLat(t,r),v=h.a9.fromLngLat(l,d),b=v.x-_.x,S=v.y-_.y,C=v.z-_.z,z=Math.hypot(b,S,C);if(z===0)throw new Error("Can't calculate camera options with same From and To");const L=Math.hypot(b,S),R=h.at(this.transform.cameraToCenterDistance/z/this.transform.tileSize),j=180*Math.atan2(b,-S)/Math.PI;let G=180*Math.acos(L/z)/Math.PI;return G=C<0?90-G:90+G,{center:v.toLngLat(),elevation:d,zoom:R,pitch:G,bearing:j}}calculateCameraOptionsFromCameraLngLatAltRotation(t,r,l,d,_){const v=this.transform.calculateCenterFromCameraLngLatAlt(t,r,l,d);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:l,pitch:d,roll:_}}easeTo(t,r){this._stop(!1,t.easeId),((t=h.e({offset:[0,0],duration:500,easing:h.cz},t)).animate===!1||!t.essential&&Tt.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),d=this.getBearing(),_=l.pitch,v=l.roll,b="bearing"in t?this._normalizeBearing(t.bearing,d):d,S="pitch"in t?+t.pitch:_,C="roll"in t?this._normalizeBearing(t.roll,v):v,z="padding"in t?t.padding:l.padding,L=h.P.convert(t.offset);let R,j;t.around&&(R=h.V.convert(t.around),j=l.locationToScreenPoint(R));const G={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},$=this.cameraHelper.handleEaseTo(l,{bearing:b,pitch:S,roll:C,padding:z,around:R,aroundPoint:j,offsetAsPoint:L,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||d!==b,this._pitching=this._pitching||S!==_,this._rolling=this._rolling||C!==v,this._padding=!l.isPaddingEqual(z),this._zooming=this._zooming||$.isZooming,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,G),this.terrain&&this._prepareElevation($.elevationCenter),this._ease((K=>{$.easeFunc(K),this.terrain&&!t.freezeElevation&&this._updateElevation(K),this._applyUpdatedTransform(l),this._fireMoveEvents(r)}),(K=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(r,K)}),t),this}_prepareEase(t,r,l={}){this._moving=!0,r||l.moving||this.fire(new h.l("movestart",t)),this._zooming&&!l.zooming&&this.fire(new h.l("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new h.l("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new h.l("pitchstart",t)),this._rolling&&!l.rolling&&this.fire(new h.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&r!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(r-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=r}this.transform.setElevation(h.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const r=t.getCameraLngLat(),l=t.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(r,t.zoom):0;if(l<d){const _=this.calculateCameraOptionsFromTo(r,d,t.center,t.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(t){const r=[];if(r.push((d=>this._elevateCameraIfInsideTerrain(d))),this.transformCameraUpdate&&r.push((d=>this.transformCameraUpdate(d))),!r.length)return;const l=t.clone();for(const d of r){const _=l.clone(),{center:v,zoom:b,roll:S,pitch:C,bearing:z,elevation:L}=d(_);v&&_.setCenter(v),L!==void 0&&_.setElevation(L),b!==void 0&&_.setZoom(b),S!==void 0&&_.setRoll(S),C!==void 0&&_.setPitch(C),z!==void 0&&_.setBearing(z),l.apply(_,!1)}this.transform.apply(l,!1)}_fireMoveEvents(t){this.fire(new h.l("move",t)),this._zooming&&this.fire(new h.l("zoom",t)),this._rotating&&this.fire(new h.l("rotate",t)),this._pitching&&this.fire(new h.l("pitch",t)),this._rolling&&this.fire(new h.l("roll",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const l=this._zooming,d=this._rotating,_=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new h.l("zoomend",t)),d&&this.fire(new h.l("rotateend",t)),_&&this.fire(new h.l("pitchend",t)),v&&this.fire(new h.l("rollend",t)),this.fire(new h.l("moveend",t))}flyTo(t,r){if(!t.essential&&Tt.prefersReducedMotion){const De=h.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(De,r)}this.stop(),t=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.cz},t);const l=this._getTransformForUpdate(),d=l.bearing,_=l.pitch,v=l.roll,b=l.padding,S="bearing"in t?this._normalizeBearing(t.bearing,d):d,C="pitch"in t?+t.pitch:_,z="roll"in t?this._normalizeBearing(t.roll,v):v,L="padding"in t?t.padding:l.padding,R=h.P.convert(t.offset);let j=l.centerPoint.add(R);const G=l.screenPointToLocation(j),$=this.cameraHelper.handleFlyTo(l,{bearing:S,pitch:C,roll:z,padding:L,locationAtOffset:G,offsetAsPoint:R,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let K=t.curve;const W=Math.max(l.width,l.height),te=W/$.scaleOfZoom,oe=$.pixelPathLength;typeof $.scaleOfMinZoom=="number"&&(K=Math.sqrt(W/$.scaleOfMinZoom/oe*2));const ee=K*K;function se(De){const et=(te*te-W*W+(De?-1:1)*ee*ee*oe*oe)/(2*(De?te:W)*ee*oe);return Math.log(Math.sqrt(et*et+1)-et)}function ce(De){return(Math.exp(De)-Math.exp(-De))/2}function ne(De){return(Math.exp(De)+Math.exp(-De))/2}const _e=se(!1);let Ie=function(De){return ne(_e)/ne(_e+K*De)},Ee=function(De){return W*((ne(_e)*(ce(et=_e+K*De)/ne(et))-ce(_e))/ee)/oe;var et},ze=(se(!0)-_e)/K;if(Math.abs(oe)<2e-6||!isFinite(ze)){if(Math.abs(W-te)<1e-6)return this.easeTo(t,r);const De=te<W?-1:1;ze=Math.abs(Math.log(te/W))/K,Ee=()=>0,Ie=et=>Math.exp(De*K*et)}return t.duration="duration"in t?+t.duration:1e3*ze/("screenSpeed"in t?+t.screenSpeed/K:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==S,this._pitching=C!==_,this._rolling=z!==v,this._padding=!l.isPaddingEqual(L),this._prepareEase(r,!1),this.terrain&&this._prepareElevation($.targetCenter),this._ease((De=>{const et=De*ze,tt=1/Ie(et),qe=Ee(et);this._rotating&&l.setBearing(h.G.number(d,S,De)),this._pitching&&l.setPitch(h.G.number(_,C,De)),this._rolling&&l.setRoll(h.G.number(v,z,De)),this._padding&&(l.interpolatePadding(b,L,De),j=l.centerPoint.add(R)),$.easeFunc(De,tt,qe,j),this.terrain&&!t.freezeElevation&&this._updateElevation(De),this._applyUpdatedTransform(l),this._fireMoveEvents(r)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(r)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,r)}return t||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(t,r,l){l.animate===!1||l.duration===0?(t(1),r()):(this._easeStart=bt(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,r){t=h.W(t,-180,180);const l=Math.abs(t-r);return Math.abs(t-360-r)<l&&(t-=360),Math.abs(t+360-r)<l&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(h.V.convert(t),this.transform):null}}const ln={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class mn{constructor(t=ln){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=Ce.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Ce.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ce.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Ce.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const l=this._map._getUIString(`AttributionControl.${r}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((d=>typeof d!="string"?"":d))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const r=this._map.style.tileManagers;for(const d in r){const _=r[d];if(_.used||_.usedForTerrain){const v=_.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter((d=>String(d).trim())),t.sort(((d,_)=>d.length-_.length)),t=t.filter(((d,_)=>{for(let v=_+1;v<t.length;v++)if(t[v].indexOf(d)>=0)return!1;return!0}));const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=Ce.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Gu{constructor(t={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Ce.create("div","maplibregl-ctrl");const r=Ce.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Ce.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Os{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,l=r?this._queue.concat(r):this._queue;for(const d of l)if(d.id===t)return void(d.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const l of r)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ei=h.aU([{name:"a_pos3d",type:"Int16",components:3}]);class wi extends h.E{constructor(t){super(),this._lastTilesetChange=bt(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,r){this.tileManager.update(t,r),this._renderableTilesKeys=[];const l={};for(const d of Ki(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.tileManager._source.calculateTileZoom}))l[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.terrainRttPosMatrix32f=new Float64Array(16),h.c7(d.terrainRttPosMatrix32f,0,h.a5,h.a5,0,0,1),this._tiles[d.key]=new ue(d,this.tileSize),this._lastTilesetChange=bt());for(const d in this._tiles)l[d]||delete this._tiles[d]}freeRtt(t){for(const r in this._tiles){const l=this._tiles[r];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,r){return r?this._getTerrainCoordsForTileRanges(t,r):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const r={};for(const l of this._renderableTilesKeys){const d=this._tiles[l].tileID,_=t.clone(),v=h.bk();if(d.canonical.equals(t.canonical))h.c7(v,0,h.a5,h.a5,0,0,1);else if(d.canonical.isChildOf(t.canonical)){const b=d.canonical.z-t.canonical.z,S=d.canonical.x-(d.canonical.x>>b<<b),C=d.canonical.y-(d.canonical.y>>b<<b),z=h.a5>>b;h.c7(v,0,z,z,0,0,1),h.O(v,v,[-S*z,-C*z,0])}else{if(!t.canonical.isChildOf(d.canonical))continue;{const b=t.canonical.z-d.canonical.z,S=t.canonical.x-(t.canonical.x>>b<<b),C=t.canonical.y-(t.canonical.y>>b<<b),z=h.a5>>b;h.c7(v,0,h.a5,h.a5,0,0,1),h.O(v,v,[S*z,C*z,0]),h.Q(v,v,[1/2**b,1/2**b,0])}}_.terrainRttPosMatrix32f=new Float32Array(v),r[l]=_}return r}_getTerrainCoordsForTileRanges(t,r){const l={};for(const d of this._renderableTilesKeys){const _=this._tiles[d].tileID;if(!this._isWithinTileRanges(_,r))continue;const v=t.clone(),b=h.bk();if(_.canonical.z===t.canonical.z){const S=t.canonical.x-_.canonical.x+t.wrap*(1<<t.canonical.z),C=t.canonical.y-_.canonical.y;h.c7(b,0,h.a5,h.a5,0,0,1),h.O(b,b,[S*h.a5,C*h.a5,0])}else if(_.canonical.z>t.canonical.z){const S=_.canonical.z-t.canonical.z,C=_.canonical.x-(_.canonical.x>>S<<S)+t.wrap*(1<<_.canonical.z),z=_.canonical.y-(_.canonical.y>>S<<S),L=t.canonical.x-(_.canonical.x>>S),R=t.canonical.y-(_.canonical.y>>S),j=h.a5>>S;h.c7(b,0,j,j,0,0,1),h.O(b,b,[-C*j+L*h.a5,-z*j+R*h.a5,0])}else{const S=t.canonical.z-_.canonical.z,C=t.canonical.x-(t.canonical.x>>S<<S)+t.wrap*(1<<t.canonical.z),z=t.canonical.y-(t.canonical.y>>S<<S),L=(t.canonical.x>>S)-_.canonical.x,R=(t.canonical.y>>S)-_.canonical.y,j=h.a5<<S;h.c7(b,0,j,j,0,0,1),h.O(b,b,[C*h.a5+L*j,z*h.a5+R*j,0])}v.terrainRttPosMatrix32f=new Float32Array(b),l[d]=v}return l}getSourceTile(t,r){const l=this.tileManager._source;let d=t.overscaledZ-this.deltaZoom;if(d>l.maxzoom&&(d=l.maxzoom),d<l.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(d).key);let _=this.findTileInCaches(this._sourceTileCache[t.key]);if(!_?.dem&&r)for(;d>=l.minzoom&&!_?.dem;)_=this.findTileInCaches(t.scaledTo(d--).key);return _}findTileInCaches(t){let r=this.tileManager.getTileByID(t);return r||(r=this.tileManager._outOfViewCache.getByKey(t),r)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,r){const l=r[t.canonical.z];return!!l&&(t.wrap>l.minWrap||t.wrap<l.maxWrap||t.canonical.x>=l.minTileXWrapped&&t.canonical.x<=l.maxTileXWrapped&&t.canonical.y>=l.minTileY&&t.canonical.y<=l.maxTileY)}}class Qt{constructor(t,r,l){this._meshCache={},this.painter=t,this.tileManager=new wi(r),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,r,l,d=h.a5){var _;const v=t.normalizeCoordinates(r,l,d);if(!v)return 0;const b=this.getTerrainData(v.tileID),S=(_=b.tile)===null||_===void 0?void 0:_.dem;if(!S)return 0;const C=h.cD([],[v.x/d*h.a5,v.y/d*h.a5],b.u_terrain_matrix),z=[C[0]*S.dim,C[1]*S.dim],L=Math.floor(z[0]),R=Math.floor(z[1]),j=z[0]-L,G=z[1]-R;return S.get(L,R)*(1-j)*(1-G)+S.get(L+1,R)*j*(1-G)+S.get(L,R+1)*(1-j)*G+S.get(L+1,R+1)*j*G}getElevationForLngLatZoom(t,r){if(!h.cE(r,t.wrap()))return 0;const{tileID:l,mercatorX:d,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(t,r);return this.getElevation(l,d%h.a5,_%h.a5,h.a5)}getElevationForLngLat(t,r){const l=Ki(r,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let d=0;for(const _ of l)_.canonical.z>d&&(d=Math.min(_.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,d)}getElevation(t,r,l,d=h.a5){return this.getDEMElevation(t,r,l,d)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const d=this.painter.context,_=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new h.T(d,_,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new h.T(d,new h.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.ar([])}const r=this.tileManager.getSourceTile(t,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const d=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new h.T(d,r.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),r.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const l=r&&r.toString()+r.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const d=this.tileManager.getSource().maxzoom;let _=t.canonical.z-r.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=d?_=t.canonical.z-d:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>_<<_),b=t.canonical.y-(t.canonical.y>>_<<_),S=h.cF(new Float64Array(16),[1/(h.a5<<_),1/(h.a5<<_),0]);h.O(S,S,[v*h.a5,b*h.a5,0]),this._demMatrixCache[t.key]={matrix:S,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(t){const r=this.painter,l=r.width/devicePixelRatio,d=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new h.T(r.context,{width:l,height:d,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new h.T(r.context,{width:l,height:d,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(l,d,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,l,d))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,v=0;_<this._coordsTextureSize;_++)for(let b=0;b<this._coordsTextureSize;b++,v+=4)r[v+0]=255&b,r[v+1]=255&_,r[v+2]=b>>8<<4|_>>8,r[v+3]=0;const l=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),d=new h.T(t,l,t.gl.RGBA,{premultiply:!1});return d.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),l=this.painter.context,d=l.gl,_=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(_,b-v-1,1,1,d.RGBA,d.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null);const S=r[0]+(r[2]>>4<<8),C=r[1]+((15&r[2])<<8),z=this.coordsIndex[255-r[3]],L=z&&this.tileManager.getTileByID(z);if(!L)return null;const R=this._coordsTextureSize,j=(1<<L.tileID.canonical.z)*R;return new h.a9((L.tileID.canonical.x*R+S)/j+L.tileID.wrap,(L.tileID.canonical.y*R+C)/j,this.getElevation(L.tileID,S,C,R))}depthAtPoint(t){const r=new Uint8Array(4),l=this.painter.context,d=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(t){var r;const l=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,d=l&&t.canonical.y===0,_=l&&t.canonical.y===(1<<t.canonical.z)-1,v=`m_${d?"n":""}_${_?"s":""}`;if(this._meshCache[v])return this._meshCache[v];const b=this.painter.context,S=new h.cG,C=new h.aY,z=this.meshSize,L=h.a5/z,R=z*z;for(let ne=0;ne<=z;ne++)for(let _e=0;_e<=z;_e++)S.emplaceBack(_e*L,ne*L,0);for(let ne=0;ne<R;ne+=z+1)for(let _e=0;_e<z;_e++)C.emplaceBack(_e+ne,z+_e+ne+1,z+_e+ne+2),C.emplaceBack(_e+ne,z+_e+ne+2,_e+ne+1);const j=S.length,G=j+(z+1),$=(z+1)*z,K=d?h.br:0,W=d?0:1,te=_?h.bs:h.a5,oe=_?0:1;for(let ne=0;ne<=z;ne++)S.emplaceBack(ne*L,K,W);for(let ne=0;ne<=z;ne++)S.emplaceBack(ne*L,te,oe);for(let ne=0;ne<z;ne++)C.emplaceBack($+ne,G+ne,G+ne+1),C.emplaceBack($+ne,G+ne+1,$+ne+1),C.emplaceBack(0+ne,j+ne+1,j+ne),C.emplaceBack(0+ne,0+ne+1,j+ne+1);const ee=S.length,se=ee+2*(z+1);for(const ne of[0,1])for(let _e=0;_e<=z;_e++)for(const Ie of[0,1])S.emplaceBack(ne*h.a5,_e*L,Ie);for(let ne=0;ne<2*z;ne+=2)C.emplaceBack(ee+ne,ee+ne+1,ee+ne+3),C.emplaceBack(ee+ne,ee+ne+3,ee+ne+2),C.emplaceBack(se+ne,se+ne+3,se+ne+1),C.emplaceBack(se+ne,se+ne+2,se+ne+3);const ce=new Li(b.createVertexBuffer(S,ei.members),b.createIndexBuffer(C),h.aX.simpleSegment(0,0,S.length,C.length));return this._meshCache[v]=ce,ce}getMeshFrameDelta(t){return 2*Math.PI*h.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,r){var l;if(!h.cE(r,t.wrap()))return 0;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(t,r);return(l=this.getMinMaxElevation(d).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const r=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return r&&r.dem&&(l.minElevation=r.dem.min*this.exaggeration,l.maxElevation=r.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,r){const l=h.a9.fromLngLat(t.wrap()),d=(1<<r)*h.a5,_=l.x*d,v=l.y*d,b=Math.floor(_/h.a5),S=Math.floor(v/h.a5);return{tileID:new h.a2(r,0,r,b,S),mercatorX:_,mercatorY:v}}}class nn{constructor(t,r,l){this._context=t,this._size=r,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new h.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(l.texture),{id:t,fbo:r,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((r=>t.id!==r)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const mr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Rr{constructor(t,r){this.painter=t,this.terrain=r,this.pool=new nn(t.context,30,r.tileManager.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,r){var l,d;this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((_=>!t._layers[_].isHidden(r))),this._coordsAscending={};for(const _ in t.tileManagers){this._coordsAscending[_]={};const v=t.tileManagers[_].getVisibleCoordinates(),b=t.tileManagers[_].getSource(),S=b instanceof Oa?b.terrainTileRanges:null;for(const C of v){const z=this.terrain.tileManager.getTerrainCoords(C,S);for(const L in z)this._coordsAscending[_][L]||(this._coordsAscending[_][L]=[]),this._coordsAscending[_][L].push(z[L])}}this._rttFingerprints={};for(const _ of t._order){const v=t._layers[_],b=v.source;if(mr[v.type]&&!this._rttFingerprints[b]){this._rttFingerprints[b]={};const S=(d=(l=t.tileManagers[b])===null||l===void 0?void 0:l.getState().revision)!==null&&d!==void 0?d:0;for(const C in this._coordsAscending[b])this._rttFingerprints[b][C]=`${this._coordsAscending[b][C].map((z=>z.key)).sort().join()}#${S}`}}for(const _ of this._renderableTiles)for(const v in this._rttFingerprints){const b=this._rttFingerprints[v][_.tileID.key];b&&b!==_.rttFingerprint[v]&&(_.rtt=[])}}renderLayer(t,r){if(t.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),d=t.type,_=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(mr[d]&&(this._prevType&&mr[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(t.id),!v))return!0;if(mr[this._prevType]||mr[d]&&v){this._prevType=d;const b=this._stacks.length-1,S=this._stacks[b]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(Ic(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[b]){const L=this.pool.getObjectForId(C.rtt[b].id);if(L.stamp===C.rtt[b].stamp){this.pool.useObject(L);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),C.rtt[b]={id:z.id,stamp:z.stamp},_.context.bindFramebuffer.set(z.fbo.framebuffer),_.context.clear({color:h.bp.transparent,stencil:0}),_.currentStencilSource=void 0;for(let L=0;L<S.length;L++){const R=_.style._layers[S[L]],j=R.source?this._coordsAscending[R.source][C.tileID.key]:[C.tileID];_.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),_._renderTileClippingMasks(R,j,!0),_.renderLayer(_,_.style.tileManagers[R.source],R,j,l),R.source&&(C.rttFingerprint[R.source]=this._rttFingerprints[R.source][C.tileID.key])}}return Ic(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),mr[d]}return!1}}const Yo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Drag to rotate map, click to reset north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Wo=ge,Bs={hash:!1,interactive:!0,bearingSnap:7,zoomSnap:0,attributionControl:ln,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Ch={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class $i{constructor(t,r,l=!1){this.mousedown=_=>{this.startMove(_,Ce.mousePos(this.element,_)),Ce.addEventListener(window,"mousemove",this.mousemove),Ce.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,Ce.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHandler.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ce.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),Ce.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ce.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=Ce.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const d=new Bu;this._rotatePitchHandler=new dr({clickTolerance:3,move:(_,v)=>{const b=r.getBoundingClientRect(),S=new h.P((b.bottom-b.top)/2,(b.right-b.left)/2);return{bearingDelta:h.cy(new h.P(_.x,v.y),v,S),pitchDelta:l?-.5*(v.y-_.y):void 0}},moveStateManager:d,enable:!0,assignEvents:()=>{}}),this.map=t,Ce.addEventListener(r,"mousedown",this.mousedown),Ce.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),Ce.addEventListener(r,"touchcancel",this.reset)}startMove(t,r){this._rotatePitchHandler.dragStart(t,r),Ce.disableDrag()}move(t,r){const l=this.map,{bearingDelta:d,pitchDelta:_}=this._rotatePitchHandler.dragMove(t,r)||{};d&&l.setBearing(l.getBearing()+d),_&&l.setPitch(l.getPitch()+_)}off(){const t=this.element;Ce.removeEventListener(t,"mousedown",this.mousedown),Ce.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Ce.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ce.removeEventListener(window,"touchend",this.touchend),Ce.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Ce.enableDrag(),Ce.removeEventListener(window,"mousemove",this.mousemove),Ce.removeEventListener(window,"mouseup",this.mouseup),Ce.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ce.removeEventListener(window,"touchend",this.touchend)}}let Lr;function Gl(m,t,r,l=!1){if(l||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const d=new h.V(m.lng,m.lat);if(m=new h.V(m.lng,m.lat),t){const _=new h.V(m.lng-360,m.lat),v=new h.V(m.lng+360,m.lat),b=r.locationToScreenPoint(m).distSqr(t);r.locationToScreenPoint(_).distSqr(t)<b?m=_:r.locationToScreenPoint(v).distSqr(t)<b&&(m=v)}for(;Math.abs(m.lng-r.center.lng)>180;){const _=r.locationToScreenPoint(m);if(_.x>=0&&_.y>=0&&_.x<=r.width&&_.y<=r.height)break;m.lng>r.center.lng?m.lng-=360:m.lng+=360}return m.lng!==d.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(m))?m:d}const ql={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function qu(m,t,r){const l=m.classList;for(const d in ql)l.remove(`maplibregl-${r}-anchor-${d}`);l.add(`maplibregl-${r}-anchor-${t}`)}class Zu extends h.E{constructor(t){if(super(),this._onClick=r=>{this.fire(new h.l("click",{originalEvent:r}))},this._onKeyPress=r=>{const l=r.code,d=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=r=>{const l=r.originalEvent.target,d=this._element;this._popup&&(l===d||d.contains(l))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(r?.type==="terrain"||r?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=Gl(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),Ce.setTransform(this._element,`${ql[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${d}`),Tt.frameAsync(new AbortController,this._map._ownerWindow).then((()=>{this._updateOpacity(r&&r.type==="moveend")})).catch((()=>{}))},this._onMove=r=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.l("dragstart"))),this.fire(new h.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=h.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ce.create("div");const r=Ce.createNS("http://www.w3.org/2000/svg","svg"),l=41,d=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${l}px`),r.setAttributeNS(null,"width",`${d}px`),r.setAttributeNS(null,"viewBox",`0 0 ${d} ${l}`);const _=Ce.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const v=Ce.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const b=Ce.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const W of S){const te=Ce.createNS("http://www.w3.org/2000/svg","ellipse");te.setAttributeNS(null,"opacity","0.04"),te.setAttributeNS(null,"cx","10.5"),te.setAttributeNS(null,"cy","5.80029008"),te.setAttributeNS(null,"rx",W.rx),te.setAttributeNS(null,"ry",W.ry),b.appendChild(te)}const C=Ce.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const z=Ce.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(z);const L=Ce.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"opacity","0.25"),L.setAttributeNS(null,"fill","#000000");const R=Ce.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),L.appendChild(R);const j=Ce.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const G=Ce.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const $=Ce.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#000000"),$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962");const K=Ce.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),G.appendChild($),G.appendChild(K),v.appendChild(b),v.appendChild(C),v.appendChild(L),v.appendChild(j),v.appendChild(G),r.appendChild(v),r.setAttributeNS(null,"height",l*this._scale+"px"),r.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(r),this._offset=h.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(r=>{r.preventDefault()})),this._element.addEventListener("mousedown",(r=>{r.preventDefault()})),qu(this._element,this._anchor,"marker"),this._element.addEventListener("click",this._onClick),t&&t.className)for(const r of t.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Ce.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=h.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const d=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var r,l;const d=(r=this._map)===null||r===void 0?void 0:r.terrain,_=this._map.transform.isLocationOccluded(this._lngLat);if(!d||_){const j=_?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==j&&(this._element.style.opacity=j))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const v=this._map,b=v.terrain.depthAtPoint(this._pos),S=v.terrain.getElevationForLngLat(this._lngLat,v.transform);if(v.transform.lngLatToCameraDepth(this._lngLat,S)-b<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/v.transform.pixelsPerMeter,z=Math.sin(v.getPitch()*Math.PI/180)*C,L=v.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),R=v.transform.lngLatToCameraDepth(this._lngLat,S+z)-L>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&R&&this._popup.remove(),this._element.style.opacity=R?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=h.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,r){return(this._opacity===void 0||t===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const Hu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let mo=0,Fs=!1;const Jn={maxWidth:100,unit:"metric"};function an(m,t,r){const l=r&&r.maxWidth||100,d=m._container.clientHeight/2,_=m._container.clientWidth/2,v=m.unproject([_-l/2,d]),b=m.unproject([_+l/2,d]),S=Math.round(m.project(b).x-m.project(v).x),C=Math.min(l,S,m._container.clientWidth),z=v.distanceTo(b);if(r&&r.unit==="imperial"){const L=3.2808*z;L>5280?ms(t,C,L/5280,m._getUIString("ScaleControl.Miles")):ms(t,C,L,m._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?ms(t,C,z/1852,m._getUIString("ScaleControl.NauticalMiles")):z>=1e3?ms(t,C,z/1e3,m._getUIString("ScaleControl.Kilometers")):ms(t,C,z,m._getUIString("ScaleControl.Meters"))}function ms(m,t,r,l){const d=(function(_){const v=Math.pow(10,`${Math.floor(_)}`.length-1);let b=_/v;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:(function(S){const C=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*C)/C})(b),v*b})(r);m.style.width=t*(d/r)+"px",m.innerHTML=`${d}&nbsp;${l}`}const Ko={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},Qo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Zl(m){if(m){if(typeof m=="number"){const t=Math.round(Math.abs(m)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,m),"top-left":new h.P(t,t),"top-right":new h.P(-t,t),bottom:new h.P(0,-m),"bottom-left":new h.P(t,-t),"bottom-right":new h.P(-t,-t),left:new h.P(m,0),right:new h.P(-m,0)}}if(m instanceof h.P||Array.isArray(m)){const t=h.P.convert(m);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:h.P.convert(m.center||[0,0]),top:h.P.convert(m.top||[0,0]),"top-left":h.P.convert(m["top-left"]||[0,0]),"top-right":h.P.convert(m["top-right"]||[0,0]),bottom:h.P.convert(m.bottom||[0,0]),"bottom-left":h.P.convert(m["bottom-left"]||[0,0]),"bottom-right":h.P.convert(m["bottom-right"]||[0,0]),left:h.P.convert(m.left||[0,0]),right:h.P.convert(m.right||[0,0])}}return Zl(new h.P(0,0))}const kr=ge;P.AJAXError=h.cJ,P.EXTENT=h.a5,P.Event=h.l,P.Evented=h.E,P.LngLat=h.V,P.MercatorCoordinate=h.a9,P.Point=h.P,P.addProtocol=h.cK,P.config=h.c,P.removeProtocol=h.cL,P.AttributionControl=mn,P.BoxZoomHandler=fo,P.CanvasSource=ws,P.CooperativeGesturesHandler=ct,P.DoubleClickZoomHandler=Fc,P.DragPanHandler=Ah,P.DragRotateHandler=$a,P.EdgeInsets=Fa,P.FullscreenControl=class extends h.E{constructor(m={}){var t;super(),this._onFullscreenChange=()=>{var r;let l=window.document.fullscreenElement||window.document.webkitFullscreenElement;for(;!((r=l?.shadowRoot)===null||r===void 0)&&r.fullscreenElement;)l=l.shadowRoot.fullscreenElement;l===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,this._pseudo=(t=m.pseudo)!==null&&t!==void 0&&t,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Ce.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=Ce.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Ce.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){this._pseudo?this._togglePseudoFullScreen():window.document.exitFullscreen?window.document.exitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._pseudo?this._togglePseudoFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},P.GeoJSONSource=Ln,P.GeolocateControl=class extends h.E{constructor(m){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new h.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const r=new h.V(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,d=this._map.getBearing(),_=h.e({bearing:d},this.options.fitBoundsOptions),v=Wi.fromLngLat(r,l);this._map.fitBounds(v,_,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const r=new h.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Fs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=Ce.create("button","maplibregl-ctrl-geolocate",this._container),Ce.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ce.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Zu({element:this._dotElement}),this._circleElement=Ce.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(r=>{const l=r?.[0]instanceof ResizeObserverEntry;r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.l("trackuserlocationend")),this.fire(new h.l("userlocationlostfocus")))}))}},this.options=h.e({},Hu,m)}onAdd(m){return this._map=m,this._container=Ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return h._(this,arguments,void 0,(function*(t=!1){if(Lr!==void 0&&!t)return Lr;if(window.navigator.permissions===void 0)return Lr=!!window.navigator.geolocation,Lr;try{Lr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Lr=!!window.navigator.geolocation}return Lr}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ce.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,mo=0,Fs=!1}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),r=m.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const t=this._map.project(m),r=this._map.unproject([t.x+100,t.y]),l=m.distanceTo(r)/100,d=2*this._accuracy/l;this._circleElement.style.width=`${d.toFixed(2)}px`,this._circleElement.style.height=`${d.toFixed(2)}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":mo--,Fs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.l("trackuserlocationstart")),this.fire(new h.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),mo++,mo>1?(m={maximumAge:6e5,timeout:0},Fs=!0):(m=this.options.positionOptions,Fs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},P.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const t=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=Ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Ce.create("button","maplibregl-ctrl-globe",this._container),Ce.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._map.on("projectiontransition",this._updateGlobeIcon),this._container}onRemove(){Ce.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._map.off("projectiontransition",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},P.Hash=wn,P.ImageSource=Oa,P.KeyboardHandler=Ai,P.LngLatBounds=Wi,P.LogoControl=Gu,P.Map=class extends Tn{get _ownerWindow(){var m,t;return((t=(m=this._container)===null||m===void 0?void 0:m.ownerDocument)===null||t===void 0?void 0:t.defaultView)||window}constructor(m){var t,r;h.cH.mark(h.cI.create);const l=Object.assign(Object.assign(Object.assign({},Bs),m),{canvasContextAttributes:Object.assign(Object.assign({},Bs.canvasContextAttributes),m.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const d=new In,_=new Lo;l.minZoom!==void 0&&d.setMinZoom(l.minZoom),l.maxZoom!==void 0&&d.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&d.setMinPitch(l.minPitch),l.maxPitch!==void 0&&d.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&d.setRenderWorldCopies(l.renderWorldCopies),l.transformConstrain!==null&&d.setConstrainOverride(l.transformConstrain),super(d,_,{bearingSnap:l.bearingSnap,zoomSnap:l.zoomSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Os,this._controls=[],this._mapId=h.af(),this._lostContextStyle={style:null,images:null},this._contextLost=b=>{if(b.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy(),this._lostContextStyle=this._getStyleAndImages(),this.style){for(const S of Object.values(this.style._layers))if(S.type==="custom"&&console.warn(`Custom layer with id '${S.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),S._listeners)for(const[C]of Object.entries(S._listeners))console.warn(`Custom layer with id '${S.id}' had event listeners for event '${C}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this.style.destroy(),this.style=null,this.fire(new h.l("webglcontextlost",{originalEvent:b}))}else this.fire(new h.l("webglcontextlost",{originalEvent:b}))},this._contextRestored=b=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new h.l("webglcontextrestored",{originalEvent:b}))},this._onMapScroll=b=>{if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._zoomSnap=l.zoomSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Yo),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this._zoomLevelsToOverscale=l.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=l.transformCameraUpdate,this.transformConstrain=l.transformConstrain,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,l.reduceMotion!==void 0&&(Tt.prefersReducedMotion=l.reduceMotion),this._imageQueueHandle=Pt.addThrottleControl((()=>this.isMoving())),this._requestManager=new Kt(l.transformRequest),this._container=this._resolveContainer(l.container),l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"&&(this._ownerWindow.addEventListener("online",this._onWindowOnline,!1),this._setupResizeObserver()),this.handlers=new Uu(this,l),this._hash=l.hash&&new wn(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,h.e({},l.fitBoundsOptions,{duration:0}))));const v=typeof l.style=="string"||((r=(t=l.style)===null||t===void 0?void 0:t.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new mn(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Gu,l.logoPosition),this.on("style.load",(()=>{if(v||this._resizeTransform(),this.transform.unmodified){const b=h.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(b)}})),this.on("data",(b=>{this._update(b.dataType==="style"),this.fire(new h.l(`${b.dataType}data`,b))})),this.on("dataloading",(b=>{this.fire(new h.l(`${b.dataType}dataloading`,b))})),this.on("dataabort",(b=>{this.fire(new h.l("sourcedataabort",b))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,t){return this.style.setGlobalStateProperty(m,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new h.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=m.onAdd(this);this._controls.push(m);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(r,l.firstChild):l.appendChild(r),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new h.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return Ki(this.transform,m)}calculateCameraOptionsFromTo(m,t,r,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLat(r,this.transform)),super.calculateCameraOptionsFromTo(m,t,r,l)}resize(m,t=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(t);const r=!this._moving;return r&&(this.stop(),this.fire(new h.l("movestart",m)).fire(new h.l("move",m))),this.fire(new h.l("resize",m)),r&&this.fire(new h.l("moveend",m)),this}_resizeInternal(m=!0){const[t,r]=this._containerDimensions(),l=this._getClampedPixelRatio(t,r);if(this._resizeCanvas(t,r,l),this.painter.resize(t,r,l),this.painter.overLimit()){const d=this.painter.context.gl;this._maxCanvasSize=[d.drawingBufferWidth,d.drawingBufferHeight];const _=this._getClampedPixelRatio(t,r);this._resizeCanvas(t,r,_),this.painter.resize(t,r,_)}this._resizeTransform(m)}_resizeTransform(m=!0){var t;const[r,l]=this._containerDimensions();this.transform.resize(r,l,m),(t=this._requestedCameraState)===null||t===void 0||t.resize(r,l,m)}_getClampedPixelRatio(m,t){const{0:r,1:l}=this._maxCanvasSize,d=this.getPixelRatio(),_=m*d,v=t*d;return Math.min(_>r?r/_:1,v>l?l/v:1)*d}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(Wi.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom){const t=this.transform.zoom,r=this._getTransformForUpdate();return r.setMinZoom(m),this._applyUpdatedTransform(r),this._update(),t!==this.transform.zoom&&this.fire(new h.l("zoomstart")).fire(new h.l("zoom")).fire(new h.l("zoomend")).fire(new h.l("movestart")).fire(new h.l("move")).fire(new h.l("moveend")),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom){const t=this.transform.zoom,r=this._getTransformForUpdate();return r.setMaxZoom(m),this._applyUpdatedTransform(r),this._update(),t!==this.transform.zoom&&this.fire(new h.l("zoomstart")).fire(new h.l("zoom")).fire(new h.l("zoomend")).fire(new h.l("movestart")).fire(new h.l("move")).fire(new h.l("moveend")),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch){const t=this.transform.pitch,r=this._getTransformForUpdate();return r.setMinPitch(m),this._applyUpdatedTransform(r),this._update(),t!==this.transform.pitch&&this.fire(new h.l("pitchstart")).fire(new h.l("pitch")).fire(new h.l("pitchend")).fire(new h.l("movestart")).fire(new h.l("move")).fire(new h.l("moveend")),this}throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch){const t=this.transform.pitch,r=this._getTransformForUpdate();return r.setMaxPitch(m),this._applyUpdatedTransform(r),this._update(),t!==this.transform.pitch&&this.fire(new h.l("pitchstart")).fire(new h.l("pitch")).fire(new h.l("pitchend")).fire(new h.l("movestart")).fire(new h.l("move")).fire(new h.l("moveend")),this}throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(h.V.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(h.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,t,r){if(m==="mouseenter"||m==="mouseover"){let l=!1;return{layers:t,listener:r,delegates:{mousemove:_=>{const v=t.filter((S=>this.getLayer(S))),b=v.length!==0?this.queryRenderedFeatures(_.point,{layers:v}):[];b.length?l||(l=!0,r.call(this,new Fn(m,this,_.originalEvent,{features:b}))):l=!1},mouseout:()=>{l=!1}}}}if(m==="mouseleave"||m==="mouseout"){let l=!1;return{layers:t,listener:r,delegates:{mousemove:v=>{const b=t.filter((S=>this.getLayer(S)));(b.length!==0?this.queryRenderedFeatures(v.point,{layers:b}):[]).length?l=!0:l&&(l=!1,r.call(this,new Fn(m,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,r.call(this,new Fn(m,this,v.originalEvent)))}}}}{const l=d=>{const _=t.filter((b=>this.getLayer(b))),v=_.length!==0?this.queryRenderedFeatures(d.point,{layers:_}):[];v.length&&(d.features=v,r.call(this,d),delete d.features)};return{layers:t,listener:r,delegates:{[m]:l}}}}_saveDelegatedListener(m,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(t)}_removeDelegatedListener(m,t,r){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const l=this._delegatedListeners[m];for(let d=0;d<l.length;d++){const _=l[d];if(_.listener===r&&_.layers.length===t.length&&_.layers.every((v=>t.includes(v)))){for(const v in _.delegates)this.off(v,_.delegates[v]);return void l.splice(d,1)}}}on(m,t,r){if(r===void 0)return super.on(m,t);const l=typeof t=="string"?[t]:t,d=this._createDelegatedListener(m,l,r);this._saveDelegatedListener(m,d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(m,l,r)}}}once(m,t,r){if(r===void 0)return super.once(m,t);const l=typeof t=="string"?[t]:t,d=this._createDelegatedListener(m,l,r);for(const _ in d.delegates){const v=d.delegates[_];d.delegates[_]=(...b)=>{this._removeDelegatedListener(m,l,r),v(...b)}}this._saveDelegatedListener(m,d);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(m,t,r){return r===void 0?super.off(m,t):(this._removeDelegatedListener(m,typeof t=="string"?[t]:t,r),this)}queryRenderedFeatures(m,t){if(!this.style)return[];let r;const l=m instanceof h.P||Array.isArray(m),d=l?m:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:m)||{},d instanceof h.P||typeof d[0]=="number")r=[h.P.convert(d)];else{const _=h.P.convert(d[0]),v=h.P.convert(d[1]);r=[_,new h.P(v.x,_.y),v,new h.P(_.x,v.y),_]}return this.style.queryRenderedFeatures(r,t,this.transform)}querySourceFeatures(m,t){return this.style.querySourceFeatures(m,t)}setStyle(m,t){return(t=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(m,t))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){var r,l;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,t)));const d=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new io(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,t,d):this.style.loadJSON(m,t,d),this):((l=(r=this.style)===null||r===void 0?void 0:r.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new io(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,t){if(typeof m=="string"){const r=this._requestManager.transformRequest(m,"Style");h.j(r,new AbortController).then((l=>{this._updateDiff(l.data,t)})).catch((l=>{l&&this.fire(new h.k(l))}))}else typeof m=="object"&&this._updateDiff(m,t)}_updateDiff(m,t){try{this.style.setState(m,t)&&this._update(!0)}catch(r){h.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(m,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(m,t){return this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)}isSourceLoaded(m){const t=this.style&&this.style.tileManagers[m];if(t!==void 0)return t.loaded();this.fire(new h.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const t=this.style.tileManagers[m.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&t.reload();for(const r in this.style._layers){const l=this.style._layers[r];l.type==="hillshade"&&l.source===m.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===m.source&&h.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Qt(this.painter,t,m),this.painter.renderToTexture=new Rr(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var l;r.dataType==="style"?this.terrain.tileManager.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=r.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new h.l("terrain",{terrain:m})),this}getTerrain(){var m,t;return(t=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const m=this.style&&this.style.tileManagers;for(const t of Object.values(m))if(!t.areTilesLoaded())return!1;return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,t,r){if(r){const l=this.getSource(r);if(!l)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);l.calculateTileZoom=zt(Math.max(1,m),Math.max(1,t))}else for(const l in this.style.tileManagers)this.style.tileManagers[l].getSource().calculateTileZoom=zt(Math.max(1,m),Math.max(1,t));return this._update(!0),this}refreshTiles(m,t){const r=this.style.tileManagers[m];if(!r)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);t===void 0?r.reload(!0):r.refreshTiles(t.map((l=>new h.ac(l.z,l.x,l.y))))}addImage(m,t,r={}){const{pixelRatio:l=1,sdf:d=!1,stretchX:_,stretchY:v,content:b,textFitWidth:S,textFitHeight:C}=r;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||h.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:L,data:R}=t,j=t;return this.style.addImage(m,{data:new h.R({width:z,height:L},new Uint8Array(R)),pixelRatio:l,stretchX:_,stretchY:v,content:b,textFitWidth:S,textFitHeight:C,sdf:d,version:0,userImage:j}),j.onAdd&&j.onAdd(this,m),this}}{const{width:z,height:L,data:R}=Tt.getImageData(t);this.style.addImage(m,{data:new h.R({width:z,height:L},R),pixelRatio:l,stretchX:_,stretchY:v,content:b,textFitWidth:S,textFitHeight:C,sdf:d,version:0})}}updateImage(m,t){const r=this.style.getImage(m);if(!r)return this.fire(new h.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||h.b(t)?Tt.getImageData(t):t,{width:d,height:_,data:v}=l;if(d===void 0||_===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==r.data.width||_!==r.data.height)return this.fire(new h.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(t instanceof HTMLImageElement||h.b(t));return r.data.replace(v,b),this.style.updateImage(m,r),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new h.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return Pt.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,t){return this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)}moveLayer(m,t){return this.style.moveLayer(m,t),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,t,r){return this.style.setLayerZoomRange(m,t,r),this._update(!0)}setFilter(m,t,r={}){return this.style.setFilter(m,t,r),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,t,r,l={}){return this.style.setPaintProperty(m,t,r,l),this._update(!0)}getPaintProperty(m,t){return this.style.getPaintProperty(m,t)}setLayoutProperty(m,t,r,l={}){return this.style.setLayoutProperty(m,t,r,l),this._update(!0)}getLayoutProperty(m,t){return this.style.getLayoutProperty(m,t)}setGlyphs(m,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,t,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,t,r,(l=>{l||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,t,(r=>{r||this._update(!0)})),this}setLight(m,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,t){return this.style.setFeatureState(m,t),this._update()}removeFeatureState(m,t){return this.style.removeFeatureState(m,t),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,t=0;return this._container&&(m=this._container.clientWidth||400,t=this._container.clientHeight||300),[m,t]}_setupResizeObserver(){var m;let t=!1;const r=Sh((d=>{this._trackResize&&!this._removed&&(this.resize(d),this.redraw())}),50),l=(m=this._ownerWindow.ResizeObserver)!==null&&m!==void 0?m:ResizeObserver;this._resizeObserver=new l((d=>{t?r(d):t=!0})),this._resizeObserver.observe(this._container)}_resolveContainer(m){if(typeof m=="string"){const t=document.getElementById(m);if(!t)throw new Error(`Container '${m}' not found.`);return t}if(m instanceof HTMLElement||m&&typeof m=="object"&&m.nodeType===1)return m;throw new Error("Invalid type: 'container' must be a String or HTMLElement.")}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const t=this._canvasContainer=Ce.create("div","maplibregl-canvas-container",m);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=Ce.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),l=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],l);const d=this._controlContainer=Ce.create("div","maplibregl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((v=>{_[v]=Ce.create("div",`maplibregl-ctrl-${v} `,d)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,t,r){this._canvas.width=Math.floor(r*m),this._canvas.height=Math.floor(r*t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{t={requestedAttributes:m},l&&(t.statusMessage=l.statusMessage,t.type=l.type)}),{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!r){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new kd(r,this.transform),di.testSupport(r)}migrateProjection(m,t){super.migrateProjection(m,t),this.painter.transform=m,this.fire(new h.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var t,r,l,d,_;const v=this._idleTriggered?this._fadeDuration:0,b=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,R=bt();this.style.zoomHistory.update(L,R);const j=new h.H(L,{now:R,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),G=j.crossFadingFactor();G===1&&G===this._crossFadingFactor||(S=!0,this._crossFadingFactor=G),this.style.update(j)}const C=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==b;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((d=this.style.projection)===null||d===void 0?void 0:d.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||C)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,C),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new h.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.cH.mark(h.cI.load),this.fire(new h.l("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.l("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,h.cH.mark(h.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&this._ownerWindow.removeEventListener("online",this._onWindowOnline,!1),Pt.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Ce.remove(this._canvasContainer),Ce.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),h.cH.remove(),this._removed=!0,this.fire(new h.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Tt.frame(this._frameRequest,(m=>{h.cH.recordStartOfFrameAt(m),this._frameRequest=null;try{this._render(m)}catch(t){if(!h.Z(t)&&!(function(r){return r.message===co})(t))throw t}}),(()=>{}),this._ownerWindow))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Wo}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},P.MapMouseEvent=Fn,P.MapTouchEvent=Dr,P.MapWheelEvent=Pc,P.Marker=Zu,P.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const t=this._map.getZoom(),r=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,r)=>{const l=this._map._getUIString(`NavigationControl.${r}`);t.title=l,t.setAttribute("aria-label",l)},this.options=h.e({},Ch,m),this._container=Ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),Ce.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),Ce.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=Ce.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $i(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Ce.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,t){const r=Ce.create("button",m,this._container);return r.type="button",r.addEventListener("click",t),r}},P.Popup=class extends h.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Ce.remove(this._content),this._container&&(Ce.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Ce.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Ce.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Gl(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const r=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const d=Zl(this.options.offset);if(!l){const v=this._container.offsetWidth,b=this._container.offsetHeight,S=(function(z){var L,R,j,G;return z?{top:(L=z.top)!==null&&L!==void 0?L:0,right:(R=z.right)!==null&&R!==void 0?R:0,bottom:(j=z.bottom)!==null&&j!==void 0?j:0,left:(G=z.left)!==null&&G!==void 0?G:0}:{top:0,right:0,bottom:0,left:0}})(this.options.padding);let C;C=r.y+d.bottom.y<b+S.top?["top"]:r.y>this._map.transform.height-b-S.bottom?["bottom"]:[],r.x<v/2+S.left?C.push("left"):r.x>this._map.transform.width-v/2-S.right&&C.push("right"),l=C.length===0?"bottom":C.join("-")}let _=r.add(d[l]);this.options.subpixelPositioning||(_=_.round()),Ce.setTransform(this._container,`${ql[l]} translate(${_.x}px,${_.y}px)`),qu(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(Ko),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=h.V.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),r=document.createElement("body");let l;for(r.innerHTML=m;l=r.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ce.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}setPadding(m){this.options.padding=m,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ce.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Qo);m&&m.focus()}},P.RasterDEMTileSource=Hr,P.RasterTileSource=bs,P.ScaleControl=class{constructor(m){this._onMove=()=>{an(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,an(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Jn),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=Ce.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Ce.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},P.ScrollZoomHandler=Nu,P.Style=io,P.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=Ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Ce.create("button","maplibregl-ctrl-terrain",this._container),Ce.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Ce.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},P.TwoFingersTouchPitchHandler=Ls,P.TwoFingersTouchRotateHandler=ju,P.TwoFingersTouchZoomHandler=fs,P.TwoFingersTouchZoomRotateHandler=Xo,P.VectorTileSource=$s,P.VideoSource=xl,P.addSourceType=(m,t)=>h._(void 0,void 0,void 0,(function*(){if(lu(m))throw new Error(`A source type called "${m}" already exists.`);((r,l)=>{Ts[r]=l})(m,t)})),P.clearPrewarmedResources=function(){const m=Zt;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(dt),Zt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},P.createTileMesh=wd,P.getMaxParallelImageRequests=function(){return h.c.MAX_PARALLEL_IMAGE_REQUESTS},P.getRTLTextPluginStatus=function(){return N().getRTLTextPluginStatus()},P.getVersion=function(){return kr},P.getWorkerCount=function(){return Mt.workerCount},P.getWorkerUrl=function(){return h.c.WORKER_URL},P.importScriptInWorkers=function(m){return qr().broadcast("IS",m)},P.isTimeFrozen=function(){return ui.isFrozen()},P.now=bt,P.prewarm=function(){Hi().acquire(dt)},P.restoreNow=function(){ui.restoreNow()},P.setMaxParallelImageRequests=function(m){h.c.MAX_PARALLEL_IMAGE_REQUESTS=m},P.setNow=function(m){ui.setNow(m)},P.setRTLTextPlugin=function(m,t){return N().setRTLTextPlugin(m,t)},P.setWorkerCount=function(m){Mt.workerCount=m},P.setWorkerUrl=function(m){h.c.WORKER_URL=m}}));var ve=he;return ve}))})(Wm)),Wm.exports}var c_=_y();const h_=z_(c_),yy=C_({__proto__:null,default:h_},[c_]),vy=X=>{const ae={dark:"https://cartodb-basemaps-a.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png",light:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",satellite:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"};return{version:8,sources:{"raster-tiles":{type:"raster",tiles:[ae[X]||ae.dark],tileSize:256,attribution:"Map data &copy; OpenStreetMap contributors"}},layers:[{id:"simple-tiles",type:"raster",source:"raster-tiles",minzoom:0,maxzoom:22}]}},xy=(X,ae,he)=>{const pe=Math.PI/180,ve=ae[1]*pe,P=ae[0]*pe,h=he[1]*pe,ge=he[0]*pe,ke=X.lat*pe,st=X.lng*pe,Ye=Math.cos((ve+h)/2),xt=(ge-P)*Ye,Tt=h-ve,ui=(st-P)*Ye,bt=ke-ve,Ce=xt*xt+Tt*Tt;if(Ce===0)return 1/0;const di=(ui*xt+bt*Tt)/Ce;if(di<0||di>1)return 1/0;const ti=di*xt,pt=di*Tt,si=ui-ti,$t=bt-pt;return Math.sqrt(si*si+$t*$t)*6371e3},by=(X,ae,he,Q)=>{const ve=X*Math.PI/180,P=he*Math.PI/180,h=(he-X)*Math.PI/180,ge=(Q-ae)*Math.PI/180,ke=Math.sin(h/2)*Math.sin(h/2)+Math.cos(ve)*Math.cos(P)*Math.sin(ge/2)*Math.sin(ge/2);return 6371e3*(2*Math.atan2(Math.sqrt(ke),Math.sqrt(1-ke)))};function wy({points:X,currentPos:ae,mapStyle:he="dark",followUser:Q,onMapDrag:pe,sensitivity:ve=1,speedInfluence:P=.5,destination:h,routeGeometry:ge,onSetDestination:ke}){const[st,Ye]=it.useState({longitude:-.09,latitude:51.505,zoom:15,pitch:0,bearing:0}),xt=h!=null&&ae!=null;it.useEffect(()=>{ae&&Q&&Ye(pt=>({...pt,longitude:ae.lng,latitude:ae.lat,pitch:xt?60:0,bearing:xt&&ae.heading||0,zoom:xt&&pt.zoom<16?16:pt.zoom}))},[ae,Q,xt]);const Tt=it.useCallback(pt=>{Ye(pt.viewState)},[]),ui=it.useCallback(pt=>{pt.originalEvent&&pe()},[pe]),bt=it.useCallback(pt=>{!xt&&pt.lngLat&&ke({lat:pt.lngLat.lat,lng:pt.lngLat.lng})},[xt,ke]),{pointData:Ce,routeData:di,directionalPointsVisible:ti}=it.useMemo(()=>{const pt=[],si=[],$t=[],Mi=X.map(Kt=>{let Lt=Kt.roughness*ve;if(Kt.speed!==void 0&&Kt.speed!==null){let kt=(Kt.speed-20)/80;kt<0&&(kt=0),kt>1&&(kt=1),Lt=Lt*(1-kt*P)}let ii="#ff0000";return Lt<2?ii="#00ff00":Lt<5?ii="#ffff00":Lt<8&&(ii="#ffa500"),{...Kt,adjustedRoughness:Lt,color:ii,usedInRoute:!1}}),Pt=Kt=>{const ii=Math.max(0,Math.min(10,Kt))/10,gi=Math.round(ii*255),kt=Math.round((1-ii)*255);return`rgb(${gi}, ${kt}, 0)`};if(ge&&ge.length>0){const Kt=ge.map(Lt=>[Lt[1],Lt[0]]);for(let Lt=0;Lt<Kt.length-1;Lt++){const ii=Kt[Lt],gi=Kt[Lt+1],kt=by(ii[1],ii[0],gi[1],gi[0]),Nt=Math.max(1,Math.ceil(kt/5));for(let ni=0;ni<Nt;ni++){const Vi=ni/Nt,Fe=(ni+1)/Nt,nt=[ii[0]+(gi[0]-ii[0])*Vi,ii[1]+(gi[1]-ii[1])*Vi],ht=[ii[0]+(gi[0]-ii[0])*Fe,ii[1]+(gi[1]-ii[1])*Fe],_t=(nt[0]+ht[0])/2,li=(nt[1]+ht[1])/2;let me=0,Ze=0;for(let dt=0;dt<Mi.length;dt++){const Mt=Mi[dt];if(Math.abs(Mt.lat-li)>2e-4||Math.abs(Mt.lng-_t)>2e-4)continue;const Ot=xy(Mt,nt,ht);if(Ot<=10){let Zt=1/(Ot+1);me+=Mt.adjustedRoughness*Zt,Ze+=Zt,Mt.usedInRoute=!0}}let lt=null;if(Ze>0){const dt=me/Ze;lt=Pt(dt)}$t.push({type:"Feature",geometry:{type:"LineString",coordinates:[nt,ht]},properties:{color:lt,originalColor:lt}})}}for(let Lt=0;Lt<$t.length;Lt++)if($t[Lt].properties.color===null){let ii=null,gi=null;for(let Nt=Lt-1;Nt>=0;Nt--)if($t[Nt].properties.originalColor!==null){ii=$t[Nt].properties.originalColor;break}for(let Nt=Lt+1;Nt<$t.length;Nt++)if($t[Nt].properties.originalColor!==null){gi=$t[Nt].properties.originalColor;break}const kt=Nt=>{const ni=Nt.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);return ni?[parseInt(ni[1]),parseInt(ni[2]),parseInt(ni[3])]:null};if(ii&&gi){const Nt=kt(ii),ni=kt(gi);if(Nt&&ni){const Vi=Math.round((Nt[0]+ni[0])/2),Fe=Math.round((Nt[1]+ni[1])/2);$t[Lt].properties.color=`rgb(${Vi}, ${Fe}, 0)`}else $t[Lt].properties.color=ii}else ii?$t[Lt].properties.color=ii:gi?$t[Lt].properties.color=gi:$t[Lt].properties.color="#3b82f6"}}for(const Kt of Mi)Kt.usedInRoute||(pt.push({type:"Feature",geometry:{type:"Point",coordinates:[Kt.lng,Kt.lat]},properties:{color:Pt(Kt.adjustedRoughness),heading:Kt.heading,speed:Kt.speed}}),Kt.speed>1&&Kt.heading!==void 0&&Kt.heading!==null&&si.push(Kt));return{pointData:{type:"FeatureCollection",features:pt},routeData:$t.length>0?{type:"FeatureCollection",features:$t}:null,directionalPointsVisible:si}},[X,ge,ve,P]);return ot.jsx("div",{className:"maplibre-container",children:ot.jsxs(J_,{...st,onMove:Tt,onMoveStart:ui,onClick:bt,mapStyle:vy(he),style:{width:"100%",height:"100%"},interactiveLayerIds:["points-layer"],mapLib:h_,children:[ot.jsx(sy,{position:"bottom-right",showCompass:!0,showZoom:!1}),di&&ot.jsx(i_,{id:"route",type:"geojson",data:di,children:ot.jsx(n_,{id:"route-line",type:"line",paint:{"line-color":["get","color"],"line-width":6,"line-opacity":.8}})}),ot.jsx(i_,{id:"points",type:"geojson",data:Ce,children:ot.jsx(n_,{id:"points-circles",type:"circle",paint:{"circle-color":["get","color"],"circle-radius":5,"circle-opacity":.7},filter:["!",["has","heading"]]})}),ti.map((pt,si)=>ot.jsx(wg,{longitude:pt.lng,latitude:pt.lat,anchor:"center",children:ot.jsx("div",{style:{transform:`rotate(${pt.heading}deg)`,display:"flex",alignItems:"center",justifyContent:"center"},children:ot.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:pt.color,stroke:"#000",strokeWidth:"1",children:ot.jsx("path",{d:"M12 2L22 22L12 18L2 22Z"})})})},`dir-${si}`)),h&&ot.jsxs(wg,{longitude:h.lng,latitude:h.lat,anchor:"bottom",children:[ot.jsx(ty,{longitude:h.lng,latitude:h.lat,closeButton:!1,anchor:"top",style:{marginTop:"10px"},children:ot.jsx("div",{style:{color:"#000",fontWeight:"bold"},children:h.name})}),ot.jsx("div",{style:{color:"#ef4444",marginTop:"-24px"},children:ot.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",stroke:"white",strokeWidth:"2",children:[ot.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),ot.jsx("circle",{cx:"12",cy:"10",r:"3"})]})})]}),ae&&ot.jsx(wg,{longitude:ae.lng,latitude:ae.lat,anchor:"center",style:{zIndex:10},children:xt||ae.speed>1&&ae.heading!==void 0?ot.jsx("div",{style:{transform:`rotate(${ae.heading}deg)`},children:ot.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"#3b82f6",stroke:"white",strokeWidth:"2",children:ot.jsx("path",{d:"M12 2L22 22L12 18L2 22Z"})})}):ot.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"50%",background:"#3b82f6",border:"2px solid white",boxShadow:"0 0 10px rgba(0,0,0,0.5)"}})})]})})}const d_=(...X)=>X.filter((ae,he,Q)=>!!ae&&ae.trim()!==""&&Q.indexOf(ae)===he).join(" ").trim();const Ty=X=>X.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const Sy=X=>X.replace(/^([A-Z])|[\s-_]+(\w)/g,(ae,he,Q)=>Q?Q.toUpperCase():he.toLowerCase());const r_=X=>{const ae=Sy(X);return ae.charAt(0).toUpperCase()+ae.slice(1)};var My={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Ey=X=>{for(const ae in X)if(ae.startsWith("aria-")||ae==="role"||ae==="title")return!0;return!1};const Ay=it.forwardRef(({color:X="currentColor",size:ae=24,strokeWidth:he=2,absoluteStrokeWidth:Q,className:pe="",children:ve,iconNode:P,...h},ge)=>it.createElement("svg",{ref:ge,...My,width:ae,height:ae,stroke:X,strokeWidth:Q?Number(he)*24/Number(ae):he,className:d_("lucide",pe),...!ve&&!Ey(h)&&{"aria-hidden":"true"},...h},[...P.map(([ke,st])=>it.createElement(ke,st)),...Array.isArray(ve)?ve:[ve]]));const cc=(X,ae)=>{const he=it.forwardRef(({className:Q,...pe},ve)=>it.createElement(Ay,{ref:ve,iconNode:ae,className:d_(`lucide-${Ty(r_(X))}`,`lucide-${X}`,Q),...pe}));return he.displayName=r_(X),he};const Cy=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]],zy=cc("crosshair",Cy);const Dy=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Iy=cc("download",Dy);const Py=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Ry=cc("map-pin",Py);const Ly=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],ky=cc("play",Ly);const Oy=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],f_=cc("search",Oy);const By=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Fy=cc("settings",By);const jy=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Ny=cc("square",jy);const Vy=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Uy=cc("upload",Vy);const Gy=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Sg=cc("x",Gy);function qy({isRecording:X,onToggleRecording:ae,roughness:he}){const Q=Math.min(Math.max(he*10,0),100);return ot.jsxs("div",{style:{position:"absolute",bottom:"calc(80px + env(safe-area-inset-bottom))",left:"50%",transform:"translateX(-50%)",zIndex:1e3,display:"flex",flexDirection:"column",gap:"10px",alignItems:"center",width:"90%",maxWidth:"400px"},children:[ot.jsxs("div",{style:{background:"rgba(30, 30, 30, 0.9)",padding:"15px",borderRadius:"12px",width:"100%",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.1)"},children:[ot.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",color:"#fff",fontSize:"0.9rem"},children:[ot.jsx("span",{children:"Road Roughness"}),ot.jsxs("span",{children:[he.toFixed(1)," / 10"]})]}),ot.jsx("div",{style:{height:"8px",background:"#333",borderRadius:"4px",overflow:"hidden"},children:ot.jsx("div",{style:{width:`${Q}%`,height:"100%",background:he>6?"#ef4444":he>3?"#eab308":"#22c55e",transition:"width 0.3s ease, background 0.3s ease"}})})]}),ot.jsxs("button",{onClick:ae,style:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 32px",borderRadius:"50px",border:"none",background:X?"#ef4444":"#22c55e",color:"white",fontSize:"1.2rem",fontWeight:"600",boxShadow:"0 4px 15px rgba(0,0,0,0.3)",cursor:"pointer",transition:"transform 0.2s active"},onMouseDown:pe=>pe.target.style.transform="scale(0.95)",onMouseUp:pe=>pe.target.style.transform="scale(1)",children:[X?ot.jsx(Ny,{size:24,fill:"currentColor"}):ot.jsx(ky,{size:24,fill:"currentColor"}),X?"Stop Recording":"Start Recording"]})]})}function Zy({isOpen:X,onClose:ae,currentStyle:he,onStyleChange:Q,sensitivity:pe,onSensitivityChange:ve,speedInfluence:P,onSpeedInfluenceChange:h,onExport:ge,onImport:ke}){if(!X)return null;const st=[{id:"dark",name:"Dark Mode (CartoDB)"},{id:"light",name:"Light Mode (OSM)"},{id:"satellite",name:"Satellite (Esri)"}];return ot.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.7)",zIndex:2e3,display:"flex",justifyContent:"center",alignItems:"center",backdropFilter:"blur(5px)"},children:ot.jsxs("div",{style:{backgroundColor:"#242424",padding:"2rem",borderRadius:"16px",width:"90%",maxWidth:"400px",color:"white",boxShadow:"0 10px 25px rgba(0,0,0,0.5)",position:"relative"},children:[ot.jsx("button",{onClick:ae,style:{position:"absolute",top:"1rem",right:"1rem",background:"none",border:"none",color:"#aaa",cursor:"pointer"},children:ot.jsx(Sg,{size:24})}),ot.jsx("h2",{style:{marginTop:0,marginBottom:"1.5rem"},children:"Settings"}),ot.jsxs("div",{style:{marginBottom:"2rem"},children:[ot.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem",color:"#aaa"},children:"Map Style"}),ot.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:st.map(Ye=>ot.jsxs("label",{k:Ye.id,style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[ot.jsx("input",{type:"radio",name:"mapStyle",value:Ye.id,checked:he===Ye.id,onChange:()=>Q(Ye.id),style:{accentColor:"#646cff"}}),Ye.name]}))})]}),ot.jsxs("div",{style:{marginBottom:"2rem"},children:[ot.jsxs("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem",color:"#aaa"},children:["Sensitivity: ",pe,"x"]}),ot.jsx("input",{type:"range",min:"0.5",max:"3.0",step:"0.1",value:pe,onChange:Ye=>ve(parseFloat(Ye.target.value)),style:{width:"100%",accentColor:"#646cff",cursor:"pointer"}}),ot.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.8rem",color:"#666"},children:[ot.jsx("span",{children:"Less Sensitive"}),ot.jsx("span",{children:"More Sensitive"})]})]}),ot.jsxs("div",{style:{marginBottom:"2rem"},children:[ot.jsxs("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem",color:"#aaa"},children:["Speed Influence: ",(P*100).toFixed(0),"%"]}),ot.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:P,onChange:Ye=>h(parseFloat(Ye.target.value)),style:{width:"100%",accentColor:"#646cff",cursor:"pointer"}}),ot.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.8rem",color:"#666"},children:[ot.jsx("span",{children:"None"}),ot.jsx("span",{children:"High"})]})]}),ot.jsxs("div",{children:[ot.jsx("h3",{style:{fontSize:"1rem",marginBottom:"1rem",color:"#aaa"},children:"Data Management"}),ot.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[ot.jsxs("button",{onClick:ge,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"8px",border:"1px solid #444",background:"#333",color:"white",cursor:"pointer",flex:1,justifyContent:"center"},children:[ot.jsx(Iy,{size:18})," Export CSV"]}),ot.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"8px",border:"1px solid #444",background:"#333",color:"white",cursor:"pointer",flex:1,justifyContent:"center"},children:[ot.jsx(Uy,{size:18})," Import CSV",ot.jsx("input",{type:"file",accept:".csv",style:{display:"none"},onChange:ke})]})]})]})]})})}function Hy({isOpen:X,onClose:ae,onSelect:he}){const[Q,pe]=it.useState(""),[ve,P]=it.useState([]),[h,ge]=it.useState(!1);if(!X)return null;const ke=async st=>{if(st.preventDefault(),!!Q.trim()){ge(!0);try{const xt=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(Q)}&limit=5`)).json();P(xt)}catch(Ye){console.error("Search error:",Ye),alert("Failed to search. Please check your connection.")}finally{ge(!1)}}};return ot.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:2e3,display:"flex",flexDirection:"column",alignItems:"center",paddingTop:"calc(60px + env(safe-area-inset-top))",paddingLeft:"20px",paddingRight:"20px"},children:ot.jsxs("div",{style:{width:"100%",maxWidth:"500px",background:"#2a2a2a",borderRadius:"16px",overflow:"hidden",boxShadow:"0 10px 30px rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",maxHeight:"80vh"},children:[ot.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[ot.jsxs("form",{onSubmit:ke,style:{flex:1,display:"flex",alignItems:"center"},children:[ot.jsx(f_,{size:20,color:"#888",style:{marginRight:"10px"}}),ot.jsx("input",{autoFocus:!0,type:"text",placeholder:"Search destination...",value:Q,onChange:st=>pe(st.target.value),style:{flex:1,background:"transparent",border:"none",color:"white",fontSize:"16px",outline:"none"}})]}),ot.jsx("button",{onClick:ae,style:{background:"none",border:"none",color:"#888",cursor:"pointer",padding:"4px"},children:ot.jsx(Sg,{size:24})})]}),ot.jsx("div",{style:{overflowY:"auto",flex:1},children:h?ot.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#888"},children:"Searching..."}):ve.length>0?ve.map((st,Ye)=>ot.jsxs("div",{onClick:()=>{he({lat:parseFloat(st.lat),lng:parseFloat(st.lon),name:st.display_name})},style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.05)",display:"flex",alignItems:"flex-start",cursor:"pointer",color:"white"},children:[ot.jsx(Ry,{size:20,color:"#3b82f6",style:{marginRight:"12px",marginTop:"2px",flexShrink:0}}),ot.jsx("div",{style:{fontSize:"14px",lineHeight:"1.4"},children:st.display_name})]},Ye)):Q.length>0&&!h?ot.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#888"},children:"No results found."}):ot.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#888"},children:"Type an address or place name to search."})})]})})}function $y(X){const[ae,he]=it.useState(0),[Q,pe]=it.useState({x:0,y:0,z:0}),ve=it.useRef(Date.now()),P=it.useRef([]);return it.useEffect(()=>{if(!X){he(0);return}const ge=ke=>{const{x:st,y:Ye,z:xt}=ke.accelerationIncludingGravity||{x:0,y:0,z:0};pe({x:st,y:Ye,z:xt});const Tt=Date.now(),ui=Math.sqrt(st*st+Ye*Ye+xt*xt),bt=Math.abs(ui-9.8);if(P.current.push(bt),Tt-ve.current>500){const Ce=P.current.reduce((ti,pt)=>ti+pt,0)/P.current.length,di=Math.min(Ce/5*10,10);he(di),P.current=[],ve.current=Tt}};return window.addEventListener("devicemotion",ge),()=>window.removeEventListener("devicemotion",ge)},[X]),{roughness:ae,motionData:Q,requestPermission:async()=>{if(typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function")try{return await DeviceMotionEvent.requestPermission()==="granted"?!0:(alert("Permission to access motion sensors was denied."),!1)}catch(ge){return console.error(ge),!1}return!0}}}function Xy(X){const ae=it.useRef(null),[he,Q]=it.useState(null);return it.useEffect(()=>{const pe=async()=>{if(ae.current)try{await ae.current.release(),ae.current=null}catch(h){console.error("Wake Lock Release Error:",h)}};if(!X){pe();return}const ve=async()=>{try{"wakeLock"in navigator&&(ae.current=await navigator.wakeLock.request("screen"),console.log("Wake Lock is active"))}catch(h){console.error(`${h.name}, ${h.message}`),Q(h)}};ve();const P=async()=>{document.visibilityState==="visible"&&X&&await ve()};return document.addEventListener("visibilitychange",P),()=>{document.removeEventListener("visibilitychange",P),pe()}},[X]),{error:he}}const Yy="1.0.0.22",Wy={version:Yy};function Ky(){const[X,ae]=it.useState(!1),[he,Q]=it.useState(null),[pe,ve]=it.useState([]),{roughness:P,requestPermission:h}=$y(X);Xy(X),it.useEffect(()=>{let kt;return"geolocation"in navigator&&(kt=navigator.geolocation.watchPosition(Nt=>{const{latitude:ni,longitude:Vi,speed:Fe,heading:nt}=Nt.coords,ht=Fe?Fe*3.6:0;Q({lat:ni,lng:Vi,speed:ht,heading:nt||0})},Nt=>console.error("Geo error:",Nt),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})),()=>{kt&&navigator.geolocation.clearWatch(kt)}},[]);const ge=it.useRef(null),ke=it.useRef(0),[st,Ye]=it.useState(!1),[xt,Tt]=it.useState("dark"),[ui,bt]=it.useState(!0),[Ce,di]=it.useState(1),[ti,pt]=it.useState(.5),[si,$t]=it.useState(!1),[Mi,Pt]=it.useState(null),[Kt,Lt]=it.useState(null);it.useEffect(()=>{Mi&&he?(async()=>{try{const ni=await(await fetch(`https://router.project-osrm.org/route/v1/driving/${he.lng},${he.lat};${Mi.lng},${Mi.lat}?overview=full&geometries=geojson`)).json();if(ni.routes&&ni.routes.length>0){const Vi=ni.routes[0].geometry.coordinates.map(Fe=>[Fe[1],Fe[0]]);Lt(Vi)}else Lt(null)}catch(Nt){console.error("Routing error",Nt),Lt(null)}})():Lt(null)},[Mi]);const ii=()=>{const kt=`timestamp,lat,lng,roughness,speed,heading
`,Nt=pe.map(nt=>`${new Date(nt.timestamp).toISOString()},${nt.lat},${nt.lng},${nt.roughness},${nt.speed||""},${nt.heading||""}`).join(`
`),ni=new Blob([kt+Nt],{type:"text/csv;charset=utf-8;"}),Vi=URL.createObjectURL(ni),Fe=document.createElement("a");Fe.href=Vi,Fe.setAttribute("download",`road_quality_${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild(Fe),Fe.click(),document.body.removeChild(Fe)},gi=kt=>{const Nt=kt.target.files[0];if(!Nt)return;const ni=new FileReader;ni.onload=Vi=>{const ht=Vi.target.result.split(`
`).slice(1).filter(_t=>_t.trim()!=="").map(_t=>{const[li,me,Ze,lt,dt,Mt]=_t.split(",");return{timestamp:new Date(li).getTime(),lat:parseFloat(me),lng:parseFloat(Ze),roughness:parseFloat(lt),speed:dt?parseFloat(dt):void 0,heading:Mt?parseFloat(Mt):void 0}}).filter(_t=>!isNaN(_t.lat)&&!isNaN(_t.lng));ve(_t=>[..._t,...ht]),Ye(!1),alert(`Imported ${ht.length} points.`)},ni.readAsText(Nt)};return it.useEffect(()=>{ge.current=he,ke.current=P},[he,P]),it.useEffect(()=>{if(!X)return;const kt=setInterval(()=>{ge.current&&ve(Nt=>[...Nt,{lat:ge.current.lat,lng:ge.current.lng,speed:ge.current.speed,heading:ge.current.heading,roughness:ke.current,timestamp:Date.now()}])},1e3);return()=>clearInterval(kt)},[X]),ot.jsxs("div",{style:{width:"100vw",height:"100vh",position:"relative"},children:[ot.jsxs("div",{style:{position:"absolute",top:"calc(10px + env(safe-area-inset-top))",left:"50%",transform:"translateX(-50%)",zIndex:1002,background:"rgba(0,0,0,0.5)",color:"rgba(255,255,255,0.7)",padding:"2px 8px",borderRadius:"10px",fontSize:"10px",pointerEvents:"none"},children:["v",Wy.version]}),ot.jsx(wy,{points:pe,currentPos:he,mapStyle:xt,followUser:ui,onMapDrag:()=>bt(!1),sensitivity:Ce,speedInfluence:ti,destination:Mi,routeGeometry:Kt,onSetDestination:kt=>{Pt({lat:kt.lat,lng:kt.lng,name:"Dropped Pin"}),bt(!0)}}),ot.jsx("button",{onClick:()=>{Mi?(Pt(null),Lt(null)):$t(!0)},style:{position:"absolute",top:"calc(20px + env(safe-area-inset-top))",left:"20px",zIndex:1001,background:Mi?"rgba(239, 68, 68, 0.9)":"rgba(30,30,30,0.8)",color:"white",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"50%",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(5px)",cursor:"pointer",boxShadow:"0 4px 6px rgba(0,0,0,0.3)"},children:Mi?ot.jsx(Sg,{size:24}):ot.jsx(f_,{size:24})}),ot.jsx("button",{onClick:()=>Ye(!0),style:{position:"absolute",top:"calc(20px + env(safe-area-inset-top))",right:"20px",zIndex:1001,background:"rgba(30,30,30,0.8)",color:"white",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"50%",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(5px)",cursor:"pointer"},children:ot.jsx(Fy,{size:24})}),ot.jsx(Zy,{isOpen:st,onClose:()=>Ye(!1),currentStyle:xt,onStyleChange:Tt,sensitivity:Ce,onSensitivityChange:di,speedInfluence:ti,onSpeedInfluenceChange:pt,onExport:ii,onImport:gi}),ot.jsx(Hy,{isOpen:si,onClose:()=>$t(!1),onSelect:kt=>{Pt(kt),$t(!1),bt(!0)}}),!ui&&ot.jsx("button",{onClick:()=>bt(!0),style:{position:"absolute",bottom:"calc(240px + env(safe-area-inset-bottom))",right:"20px",zIndex:1001,background:"rgba(30,30,30,0.8)",color:"white",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"50%",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(5px)",cursor:"pointer"},children:ot.jsx(zy,{size:24})}),ot.jsx(qy,{isRecording:X,onToggleRecording:async()=>{X?ae(!1):await h()&&ae(!0)},roughness:P})]})}F_.createRoot(document.getElementById("root")).render(ot.jsx(it.StrictMode,{children:ot.jsx(Ky,{})}));
